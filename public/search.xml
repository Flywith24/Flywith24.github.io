<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[ä½¿ç”¨ AccountManager å®žçŽ°ç³»ç»Ÿå†…å…±äº«è´¦å·]]></title>
    <url>%2F2020%2F09%2F04%2FAccountManager%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨ AccountManager å®žçŽ°ç³»ç»Ÿå†…å…±äº«è´¦å·åœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯èƒ½é‡åˆ°è‡ªå®¶åº”ç”¨é—´å…±äº«è´¦å·çš„åœºæ™¯ã€‚ä¾‹å¦‚ APP1 ç™»å½•æˆåŠŸåŽï¼Œå¯åŠ¨ APP2 æ—¶è‡ªåŠ¨å®Œæˆç™»å½•å¹¶ä¸Ž APP1 å…±äº«è´¦å·ä¿¡æ¯ã€‚ Android ä¸ºæˆ‘ä»¬æä¾›äº†AccountManager æ¥ç®¡ç†è´¦å·ä¿¡æ¯ã€‚ demo åœ°å€ å…±äº«å‰æ ä¸¤ä¸ª app åœ¨ä¸€ä¸ªç”¨æˆ·ç»„å†… ä½¿ç”¨ç›¸åŒçš„ç­¾åï¼ˆä½¿ç”¨ debug é»˜è®¤ç­¾åä¹Ÿå¯ä»¥å…±äº«ï¼‰ accountType ç›¸åŒ åŽŸç† AccountManageræ˜¯ä¸€ä¸ªé¢å‘åº”ç”¨ç¨‹åºå¼€å‘çš„ç»„ä»¶ï¼Œå®ƒæä¾›äº†ä¸€å¥—å¯¹åº”äºŽ IAccountManager åè®®çš„åº”ç”¨ç¨‹åºæŽ¥å£ï¼›è¿™ç»„æŽ¥å£é€šè¿‡Binderæœºåˆ¶ä¸Žç³»ç»ŸæœåŠ¡AccountManagerServiceè¿›è¡Œé€šä¿¡ï¼Œåä½œå®Œæˆå¸å·ç›¸å…³çš„æ“ä½œã€‚åŒæ—¶ï¼ŒAccountManageræŽ¥æ”¶authenticators æä¾›çš„å›žè°ƒï¼Œä»¥ä¾¿åœ¨å¸å·æ“ä½œå®Œæˆä¹‹åŽå‘è°ƒç”¨æ­¤å¸å·æœåŠ¡çš„ä¸šåŠ¡è¿”å›žå¯¹åº”çš„æŽ¥å£ï¼ŒåŒæ—¶è§¦å‘è¿™ä¸ªä¸šåŠ¡å¯¹ç»“æžœçš„å¤„ç†ã€‚- authenticators å³æ³¨å†Œå¸å·æœåŠ¡çš„appï¼›- ä¸šåŠ¡è°ƒç”¨æ–¹ å³ä½¿ç”¨authenticatorsæä¾›çš„å¸å·æœåŠ¡çš„ç¬¬ä¸‰æ–¹ï¼Œä¹Ÿå¯ä»¥æ˜¯authenticatorè‡ªå·± æ‘˜è‡ªï¼šAndroid AccountManagerå¸å·ç®¡ç†ï¼ˆä¸€ï¼‰ ä½¿ç”¨è¯¥é¡¹ç›®ä¸­æœ‰ä¸¤ä¸ª module ï¼Œapp å¯¹åº”æ³¨å†Œè´¦å·æœåŠ¡çš„appï¼Œapp1 å¯¹åº”ä½¿ç”¨è´¦å·æœåŠ¡çš„ç¬¬ä¸‰æ–¹åº”ç”¨ åœ¨ä¸¤ä¸ªåº”ç”¨çš„ manifest ä¸­åŠ å…¥ &lt;uses-permission android:name=&quot;android.permission.GET_ACCOUNTS&quot; /&gt; æƒé™ åœ¨ app ä¸­åˆ›å»º authenticator.xml æ–‡ä»¶ï¼Œæ³¨æ„ accountType çš„é…ç½®ï¼Œè¿™é‡Œçš„åº”ç”¨ååŠ icon ä¼šåœ¨è®¾å¤‡çš„ è®¾ç½® -&gt; è´¦å· ä¸­æ˜¾ç¤º åœ¨ app ä¸­æ³¨å†Œä¸€ä¸ª action ä¸ºâ€œandroid.accounts.AccountAuthenticatorâ€çš„ authenticator serviceï¼Œå¼•å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„ xml æ–‡ä»¶ åœ¨ app ä¸­åˆ›å»º authenticator åˆ›å»ºè´¦å· åˆ é™¤è´¦å· ç¬¬ä¸‰æ–¹ app èŽ·å– ç”¨æˆ·ï¼Œtoken ç­‰ä¿¡æ¯]]></content>
      <categories>
        <category>ROM</category>
      </categories>
      <tags>
        <tag>ROM</tag>
        <tag>framework</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æŠ˜è…¾Frameworkã€‘æºç ç¼–è¯‘ä¸Žçƒ§å†™]]></title>
    <url>%2F2020%2F08%2F18%2FFramework-Compile%2F</url>
    <content type="text"><![CDATA[å‰è¨€çŽ¯å¢ƒæ­å»ºç­‰å†…å®¹ç½‘ä¸Šèµ„æ–™å¾ˆå¤šï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ æ­¤å¤„ä»¥ Pixel 3a &amp; Android 10 ä¸ºä¾‹ä»‹ç»å¦‚ä½•ç¼–è¯‘ ROM åŒ…å¹¶çƒ§å½• æ‰‹ä¸Šæ²¡æœ‰çœŸæœºçš„å°ä¼™ä¼´å¯ä»¥é€‰æ‹©åˆ¶ä½œæ¨¡æ‹Ÿå™¨ï¼Œæœ¬æ–‡æœ€åŽæä¾›äº†åŸºäºŽ Android 10 ç¼–è¯‘çš„è‡ªå®šä¹‰ AVD ä¸‹è½½é“¾æŽ¥ ç¼–è¯‘çŽ¯å¢ƒå®˜æ–¹æ–‡æ¡£ ä¸‹è½½æºç è¿™é‡ŒæŽ¨èä½¿ç”¨ æ¸…åŽé•œåƒ ä¸‹è½½ æ¯æœˆæ›´æ–°çš„åˆå§‹åŒ–åŒ… å¹¶è§£åŽ‹ ä¸‹è½½é©±åŠ¨ï¼ˆå¯é€‰ï¼‰å¦‚æžœè¦åˆ·åˆ°çœŸæœºä¸Šï¼Œéœ€è¦ä¸‹è½½ç›¸åº”æœºåž‹çš„é©±åŠ¨ï¼Œè¿›å…¥ è¯¥é“¾æŽ¥ï¼Œé€‰æ‹©ç›¸åº”çš„æœºåž‹å¯¹åº”çš„ Android ç‰ˆæœ¬å·å’Œé©±åŠ¨ æˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯ Android 10.0.0ï¼ˆQQ3A.200605.002.A1ï¼‰ å°†ä¸¤ä¸ªé©±åŠ¨æ–‡ä»¶ä¸‹è½½å¹¶è§£åŽ‹ï¼Œå¹¶æ‰§è¡Œ 12./extract-qcom-sargo.sh./extract-google_devices-sargo.sh ç‚¹å‡» Enter å¹¶è¾“å…¥ I ACCEPT åŒæ„ License æ ¹æ® Build åœ¨ è¯¥é“¾æŽ¥ ä¸­æ‰¾åˆ°ç›¸åŒ¹é…çš„åˆ†æ”¯ï¼Œæœ¬ä¾‹ä¸­å¯¹åº” android-10.0.0_r39 é€‰æ‹©åˆ†æ”¯æ‰§è¡Œå®Œä¸Šè¿°æ“ä½œå¦‚æžœç›´æŽ¥ç¼–è¯‘çš„è¯å®žé™…ä¸Šæ˜¯ç¼–è¯‘çš„ master åˆ†æ”¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ‡æ¢åˆ°æƒ³è¦ç¼–è¯‘çš„åˆ†æ”¯ 123repo init -u git://mirrors.ustc.edu.cn/aosp/platform/manifest -b android-10.0.0_r39 --depth=1repo sync -j8repo start android-10.0.0_r39 --all ç¼–è¯‘ä¸Žçƒ§å†™åœ¨æºç ç›®å½•æ‰§è¡Œ source build/envsetup.sh lunch è¿›å…¥èœå• é€‰æ‹©ç›¸åº”çš„ç‰ˆæœ¬ æˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯ 19 ç¼–è¯‘æŽ¥ç€ä¾¿å¯ä»¥è¿›è¡Œç¼–è¯‘äº†ï¼Œå¯ä»¥ä½¿ç”¨ make -j å‘½ä»¤ï¼Œå…¶ä¸­ j ä»£è¡¨çš„æ˜¯ç¼–è¯‘ job çš„æ•°é‡ æ‰§è¡Œï¼ˆæˆ‘è¿™é‡ŒæŒ‡å®šäº†ç”Ÿæˆ log æ–‡ä»¶ï¼‰ make -j32 2&gt;&amp;1 | tee build_20200628_1635.log ç¼–è¯‘æˆåŠŸåŽä¼šå‡ºçŽ°ä¸€ä¸ª out ç›®å½•ï¼ŒROM é•œåƒæ–‡ä»¶å°±åœ¨æ­¤å¤„ ä¾‹å¦‚æˆ‘çš„è·¯å¾„ä¸ºï¼š~/aosp/out/target/product/sargo çƒ§å†™è®¾å¤‡è¿›å…¥ bootloader å¹¶æ‰§è¡Œï¼šfastboot flashall -wï¼Œå…¶ä¸­ -w ä»£è¡¨æ¸…ç©ºæ•°æ® çƒ§å†™æˆåŠŸï¼Œå¼€æœºï¼ åˆ¶ä½œè‡ªå®šä¹‰ AVDï¼ˆAndroid Virtual Devicesï¼‰ ç³»ç»Ÿé•œåƒå¾ˆå¤šå°ä¼™ä¼´æ²¡æœ‰ç›¸åº”çš„çœŸæœºï¼Œä¸è¿‡å¯ä»¥åˆ¶ä½œå‡ºè‡ªå®šä¹‰çš„ AVD ä½œä¸ºæ¨¡æ‹Ÿå™¨ä½¿ç”¨ã€‚ lunch è¿›å…¥èœå•æ—¶é€‰æ‹©ç›¸åº”çš„æ¨¡æ‹Ÿå™¨ï¼Œä¾‹å¦‚é€‰æ‹©ä¸Šå›¾çš„ 24ï¼Œ64 ä½çš„é€šç”¨è®¾å¤‡ æƒ³è¦åˆ¶ä½œ AVD ç³»ç»Ÿé•œåƒéœ€è¦åˆ¶ä½œé™„åŠ  sdk å’Œ sdk_repo è½¯ä»¶åŒ… æ‰§è¡Œ 1$ make -j32 sdk sdk_repo è¯¥æ“ä½œå¯èƒ½ä¼šå‡ºçŽ°å¼‚å¸¸ï¼Œä¾‹å¦‚ è¿™æ˜¯ç”±äºŽæ²¡æœ‰ç¼–è¯‘è¿™äº›å·¥å…·å¯¼è‡´çš„ï¼Œè§£å†³åŠžæ³•æ˜¯ä¾æ¬¡ç¼–è¯‘è¿™äº›å·¥å…· ä¾æ¬¡è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼ŒåŽé¢å·¥å…·è§†æƒ…å†µè€Œå®š 12345678910111213141516171819$ make libaapt2_jni$ make dmtracedump$ make etc1tool$ make deployagent$ make aapt$ make split-select$ make bcc_compat$ make apksigner$ make dx$ make layoutlib-legacy ç¼–è¯‘å¥½ç›¸å…³å·¥å…·æˆ‘ä»¬å†æ¬¡æ‰§è¡Œ make -j32 sdk sdk_repo ç¼–è¯‘æˆåŠŸåŽä¼šåœ¨ out/host/linux-x86/sdk/aosp_x86_64 ç›®å½•ä¸‹ç”Ÿæˆ sdk-repo-linux-system-images-eng.[username].zip æ–‡ä»¶ æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ä¸­ä½¿ç”¨é•œåƒçš„æ–¹å¼æˆ‘æ²¡æœ‰æˆåŠŸ è¿™é‡Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªå–å·§çš„æ–¹å¼ æˆ‘ä»¬åœ¨ Android Studio åˆ›å»º AVD æ—¶å¯é€‰çš„é•œåƒä¸€èˆ¬æœ‰ä¸‰ç§ï¼Œè¿™é‡Œè¿˜æ˜¯ä»¥ Android 10 ä¸ºä¾‹ Google Playï¼ŒGoogle APIsï¼Œå’Œé»˜è®¤çš„ å®ƒä»¬ä¼šä¸‹è½½åˆ° SDK/system-images/android-29 ä¸­ Google APIs ç‰ˆæœ¬å¯¹åº”çš„ç›®å½•å°±æ˜¯ google_apis æˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬ç¼–è¯‘å‡ºçš„ AVD é•œåƒ copy åˆ°å…¶ä¸­çš„ä¸€ä¸ªç›®å½• ä¾‹å¦‚ï¼Œæˆ‘å°†è‡ªå®šä¹‰çš„ AVD é•œåƒæ”¾ç½®åœ¨äº†è¿™é‡Œï¼š æˆ‘ä»¬åœ¨åˆ›å»ºæ¨¡æ‹Ÿå™¨æ—¶é€‰æ‹©è‡ªå®šä¹‰çš„ AVD é•œåƒå³å¯åˆ›å»ºå‡ºè‡ªå·±ç¼–è¯‘ ROM çš„æ¨¡æ‹Ÿå™¨ è¿™é‡Œæä¾›äº†æˆ‘ç¼–è¯‘å‡ºæ¥çš„è‡ªå®šä¹‰ AVDï¼Œä¸æ–¹ä¾¿è‡ªå·±ç¼–è¯‘çš„å°ä¼™ä¼´å¯ä»¥åœ¨æ­¤å¤„ä¸‹è½½ é“¾æŽ¥ï¼šhttps://pan.baidu.com/s/1LIcuycoU4Ou42VsSBM_MuQæå–ç ï¼šCAVD]]></content>
      <categories>
        <category>ROM</category>
      </categories>
      <tags>
        <tag>ROM</tag>
        <tag>framework</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€å¥‡æŠ€æ·«å·§ã€‘ä½¿ç”¨ ProcessLifecycle ä¼˜é›…åœ°ç›‘å¬åº”ç”¨å‰åŽå°åˆ‡æ¢]]></title>
    <url>%2F2020%2F07%2F01%2FTips-ProcessLifecycle%2F</url>
    <content type="text"><![CDATA[å‰è¨€å¾ˆé«˜å…´è§åˆ°ä½ ï¼Œåˆæ¥åˆ°äº†ã€Œå¥‡æŠ€æ·«å·§ã€ç³»åˆ—ï¼Œæœ¬ç³»åˆ—ä»‹ç»ä¸€äº›ã€Œéªšæ“ä½œã€ï¼Œå¯èƒ½ä¸é€‚åˆç”¨äºŽç”Ÿäº§ï¼Œä½†å¯ä»¥å¼€æ‹“æ€è·¯ å‰äº›å¤©åœ¨ç¾¤é‡Œçœ‹åˆ°æœ‰äººè®¨è®ºé€šè¿‡ç»´æŠ¤ activity æ ˆæ¥ç›‘å¬ç¨‹åºå‰åŽå°åˆ‡æ¢çš„é—®é¢˜ã€‚å…¶å®žå•çº¯ç›‘å¬ç¨‹åºçš„å‰åŽå°åˆ‡æ¢å®Œå…¨ä¸éœ€è¦ç»´æŠ¤ activity æ ˆï¼Œè€ŒçŽ°åœ¨æ¯”è¾ƒä¸»æµçš„åšæ³•æ˜¯ä½¿ç”¨ registerActivityLifecycleCallbacksã€‚è€Œä»Šå¤©æˆ‘æ¥ä»‹ç»ä¸€ä¸‹ä½¿ç”¨ ProcessLifecycleOwner æ¥å®žçŽ°è¿™ä¸€åŠŸèƒ½ lifecycle-process åº“Android Jetpack Lifecycle ç»„ä»¶æœ‰ä¸€ä¸ªå¯é€‰åº“ï¼šlifecycle-processï¼Œå®ƒå¯ä»¥ä¸ºæ•´ä¸ª app è¿›ç¨‹æä¾›ä¸€ä¸ª ProcessLifecycleOwner è¯¥åº“ååˆ†ç®€å•ï¼Œåªæœ‰å››ä¸ªæ–‡ä»¶ ProcessLifecycleOwnerInitializer å€ŸåŠ© ContentProvider æ‹¿åˆ° Contextï¼Œç”¨äºŽåˆå§‹åŒ–æ“ä½œ EmptyActivityLifecycleCallbacks ä¸º Application.ActivityLifecycleCallbacks çš„å®žçŽ°ç±»ï¼Œå†…éƒ¨ä¸ºç©ºå®žçŽ° LifecycleDispatcher é€šè¿‡ ReportFragment æ¥ hook å®¿ä¸»çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ æ ¸å¿ƒé€»è¾‘éƒ½åœ¨ ProcessLifecycleOwner ä¸­ è¯¥ç±»æä¾›äº†æ•´ä¸ª app è¿›ç¨‹çš„ lifecycle å¯ä»¥å°†å…¶è§†ä¸ºæ‰€æœ‰ activity çš„ LifecycleOwner ï¼Œå…¶ä¸­ Lifecycle.Event.ON_CREATE åªä¼šåˆ†å‘ä¸€æ¬¡ï¼Œè€Œ Lifecycle.Event.ON_DESTROY åˆ™æ°¸è¿œä¸ä¼šåˆ†å‘ å…¶å®ƒçš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å°†æŒ‰ä»¥ä¸‹è§„åˆ™åˆ†å‘ï¼š ProcessLifecycleOwner ä¼šåˆ†å‘ Lifecycle.Event.ON_START å’Œ Lifecycle.Event.ON_RESUME äº‹ä»¶ï¼ˆåœ¨ç¬¬ä¸€ä¸ª activity ç§»åŠ¨åˆ°è¿™äº›äº‹ä»¶æ—¶ï¼‰ Lifecycle.Event.ON_PAUSE ä¸Ž Lifecycle.Event.ON_STOP ä¼šåœ¨æœ€åŽä¸€ä¸ª activity ç§»åŠ¨åˆ°è¿™äº›çŠ¶æ€åŽ å»¶è¿Ÿ åˆ†å‘ï¼Œè¯¥å»¶è¿Ÿè¶³å¤Ÿé•¿ï¼Œä»¥ç¡®ä¿ç”±äºŽé…ç½®æ›´æ”¹ç­‰æ“ä½œé‡å»º activity åŽä¸ä¼šåˆ†å‘ä»»ä½•äº‹ä»¶ å¯¹äºŽç›‘å¬åº”ç”¨åœ¨å‰åŽå°åˆ‡æ¢ä¸”ä¸éœ€è¦æ¯«ç§’çº§çš„ç²¾åº¦çš„åœºæ™¯ï¼Œè¿™ååˆ†æœ‰ç”¨ ProcessLifecycleOwner æºç è§£æžæ ¹æ®ä¸Šå›¾æˆ‘ä»¬å¾—çŸ¥ ProcessLifecycleOwner å®žçŽ°äº† LifecycleOwner æŽ¥å£ ç”±äºŽåœ¨ ProcessLifecycleOwnerInitializer ä¸­åˆå§‹åŒ–æ—¶ä¼ å…¥äº† Contextï¼Œå› æ­¤ ProcessLifecycleOwner åœ¨ attach æ–¹æ³•ä¸­å€ŸåŠ© Context æ‹¿åˆ°äº† Application å®žä¾‹ï¼Œå¹¶è°ƒç”¨äº† registerActivityLifecycleCallbacks 1234567891011121314151617181920212223242526272829303132333435363738394041void attach(Context context) &#123; mHandler = new Handler(); mRegistry.handleLifecycleEvent(Lifecycle.Event.ON_CREATE); Application app = (Application) context.getApplicationContext(); app.registerActivityLifecycleCallbacks(new EmptyActivityLifecycleCallbacks() @RequiresApi(29) @Override public void onActivityPreCreated(@NonNull Activity activity, @Nullable Bundle savedInstanceState) &#123; //æˆ‘ä»¬éœ€è¦ ProcessLifecycleOwner åˆšå¥½åœ¨ç¬¬ä¸€ä¸ª activity çš„ LifecycleOwner started/resumed ä¹‹å‰èŽ·å– ON_START å’Œ ON_RESUMEã€‚ //activity çš„ LifecycleOwner é€šè¿‡åœ¨ onCreate() ä¸­æ·»åŠ  activity æ³¨å†Œçš„ callback æ¥èŽ·å– started/resumed çŠ¶æ€ã€‚ //é€šè¿‡åœ¨ onActivityPreCreated() ä¸­æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„ activity æ³¨å†Œçš„ callbackï¼Œæˆ‘ä»¬é¦–å…ˆèŽ·å¾—äº†å›žè°ƒï¼ŒåŒæ—¶ä¸Ž Activity çš„ onStart()/ onResume()å›žè°ƒç›¸æ¯”ä»å…·æœ‰æ­£ç¡®çš„ç›¸å¯¹é¡ºåº activity.registerActivityLifecycleCallbacks(new EmptyActivityLifecycl @Override public void onActivityPostStarted(@NonNull Activity activity) &#123; activityStarted(); &#125; @Override public void onActivityPostResumed(@NonNull Activity activity) &#123; activityResumed(); &#125; &#125;); &#125; @Override public void onActivityCreated(Activity activity, Bundle savedInstanceStat //ä»…åœ¨API 29 ä¹‹å‰ä½¿ç”¨ ReportFragmentï¼Œåœ¨æ­¤ä¹‹åŽï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ¨ onActivityPreCreated() ä¸­æ³¨å†Œçš„ onActivityPostStarted å’Œ onActivityPostResumed å›žè°ƒ if (Build.VERSION.SDK_INT &lt; 29) &#123; ReportFragment.get(activity).setProcessListener(mInitializationLi &#125; &#125; @Override public void onActivityPaused(Activity activity) &#123; activityPaused(); &#125; @Override public void onActivityStopped(Activity activity) &#123; activityStopped(); &#125; &#125;);&#125; å†…éƒ¨ç»´æŠ¤äº† Started å’Œ Resumed çš„æ•°é‡ 1234private int mStartedCounter = 0;private int mResumedCounter = 0;private boolean mPauseSent = true;private boolean mStopSent = true; å¹¶åœ¨ activityStarted å’Œ activityResumed æ–¹æ³•ä¸­å¯¹ è¿™ä¸¤ä¸ªæ•°å€¼è¿›è¡Œ ++ï¼Œå¹¶æ›´æ”¹ lifecycle çŠ¶æ€ 123456789101112131415161718void activityStarted() &#123; mStartedCounter++; if (mStartedCounter == 1 &amp;&amp; mStopSent) &#123; mRegistry.handleLifecycleEvent(Lifecycle.Event.ON_START); mStopSent = false; &#125;&#125;void activityResumed() &#123; mResumedCounter++; if (mResumedCounter == 1) &#123; if (mPauseSent) &#123; mRegistry.handleLifecycleEvent(Lifecycle.Event.ON_RESUME); mPauseSent = false; &#125; else &#123; mHandler.removeCallbacks(mDelayedPauseRunnable); &#125; &#125;&#125; åœ¨ activityPaused å’Œ activityStopped æ–¹æ³•å¯¹è¿™ä¸¤ä¸ªæ•°å€¼è¿›è¡Œ â€“ 12345678910void activityPaused() &#123; mResumedCounter--; if (mResumedCounter == 0) &#123; mHandler.postDelayed(mDelayedPauseRunnable, TIMEOUT_MS); &#125;&#125;void activityStopped() &#123; mStartedCounter--; dispatchStopIfNeeded();&#125; è€Œåœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸Šæ–‡æåˆ°çš„å»¶è¿Ÿæ“ä½œ 123456789101112131415161718192021222324252627// ä½¿ç”¨ handler è¿›è¡Œå»¶è¿Ÿæ“ä½œmHandler.postDelayed(mDelayedPauseRunnable, TIMEOUT_MS);// å»¶è¿Ÿ 700 msstatic final long TIMEOUT_MS = 700; //mlsprivate Runnable mDelayedPauseRunnable = new Runnable() &#123; @Override public void run() &#123; // æ ¹æ®éœ€è¦åˆ†å‘äº‹ä»¶ dispatchPauseIfNeeded(); dispatchStopIfNeeded(); &#125;&#125;;void dispatchPauseIfNeeded() &#123; if (mResumedCounter == 0) &#123; mPauseSent = true; mRegistry.handleLifecycleEvent(Lifecycle.Event.ON_PAUSE); &#125;&#125;void dispatchStopIfNeeded() &#123; if (mStartedCounter == 0 &amp;&amp; mPauseSent) &#123; mRegistry.handleLifecycleEvent(Lifecycle.Event.ON_STOP); mStopSent = true; &#125;&#125; æºç å°±è§£æžåˆ°è¿™é‡Œï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å§ ä½¿ç”¨é¦–å…ˆå¼•å…¥è¯¥åº“ 1implementation "androidx.lifecycle:lifecycle-process:2.3.0-alpha05" ç”±äºŽæˆ‘ä»¬è¦è‡ªå®šä¹‰ lifecycleObserverï¼Œå› æ­¤è¿˜éœ€å¼•å…¥ 1implementation "androidx.lifecycle:lifecycle-common-java8:2.3.0-alpha05" é¦–å…ˆåˆ›å»º ProcessLifecycleObserver ç±»ï¼Œå®žçŽ° DefaultLifecycleObserver æŽ¥å£ï¼Œåœ¨ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸä¸­æ‰“å° log æŽ¥ç€åœ¨è‡ªå®šä¹‰ Application ä¸­åŠ å…¥ è¿™æ ·ä¾¿å®Œæˆäº†ï¼ Demo åœ¨è¿™é‡Œ ç³»åˆ—æ–‡ç«  ã€å¥‡æŠ€æ·«å·§ã€‘AndroidStudio Nexus3.xæ­å»ºMavenç§æœé‡åˆ°é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ ã€å¥‡æŠ€æ·«å·§ã€‘ä»€ä¹ˆï¼Ÿé¡¹ç›®é‡Œgradleä»£ç è¶…è¿‡200è¡Œäº†ï¼ä½ å¯èƒ½éœ€è¦ Kotlin+buildSrc Plugin ã€å¥‡æŠ€æ·«å·§ã€‘gradleä¾èµ–æŸ¥æ‰¾å¤ªéº»çƒ¦ï¼Ÿè¿™ä¸ªæ’ä»¶å¯èƒ½å¸®åˆ°ä½  ã€å¥‡æŠ€æ·«å·§ã€‘Androidç»„ä»¶åŒ–ä¸ä½¿ç”¨ Router å¦‚ä½•å®žçŽ°ç»„ä»¶é—´ activity è·³è½¬ ã€å¥‡æŠ€æ·«å·§ã€‘æ–°çš„å›¾ç‰‡åŠ è½½åº“ï¼ŸåŸºäºŽKotlinåç¨‹çš„å›¾ç‰‡åŠ è½½åº“â€”â€”Coil ã€å¥‡æŠ€æ·«å·§ã€‘ä½¿ç”¨ Navigation + Dynamic Feature Module å®žçŽ°æ¨¡å—åŒ– ã€å¥‡æŠ€æ·«å·§ã€‘é™¤äº† buildSrc è¿˜èƒ½è¿™æ ·ç»Ÿä¸€é…ç½®ä¾èµ–ç‰ˆæœ¬ï¼Ÿå·§ç”¨ includeBuild ã€å¥‡æŠ€æ·«å·§ã€‘å·§ç”¨ kotlin æ‰©å±•å‡½æ•°å’Œ typealias å°è£… å¸¦ç½‘ç»œçŠ¶æ€å’Œè§£å†³ã€Œç²˜æ€§ã€äº‹ä»¶çš„ LiveData å…³äºŽæˆ‘æˆ‘æ˜¯ Flywith24ï¼Œæˆ‘çš„åšå®¢å†…å®¹å·²ç»åˆ†ç±»æ•´ç† åœ¨è¿™é‡Œï¼Œç‚¹å‡»å³ä¸Šè§’çš„ Watch å¯ä»¥åŠæ—¶èŽ·å–æˆ‘çš„æ–‡ç« æ›´æ–°å“¦ ðŸ˜‰ æŽ˜é‡‘ å°ä¸“æ  Github]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Tips</tag>
        <tag>å¥‡æŠ€æ·«å·§</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€å¥‡æŠ€æ·«å·§ã€‘ä½¿ç”¨ Navigation + Dynamic Feature Module å®žçŽ°æ¨¡å—åŒ–]]></title>
    <url>%2F2020%2F05%2F20%2FTips-Navagion%2BDynamicFeatureModule%2F</url>
    <content type="text"><![CDATA[androidx navigation 2.3.0 åŠ å…¥äº†å¯¹ dynamic feature module çš„å¯¼èˆªæ”¯æŒï¼Œå› æ­¤æˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªæ¥åˆ†ç¦»å‡ºå¤šä¸ªåŠŸèƒ½ module æ¥å®žçŽ°æ¨¡å—åŒ– å›½å†…åŸºæœ¬ä¸ç”¨çš„ dynamic feature moduleAndroid App Bundle æ˜¯å®˜æ–¹ 18 å¹´æŽ¨å‡ºçš„åŠ¨æ€å‘å¸ƒæ–¹æ¡ˆï¼Œç±»ä¼¼å›½å†…å„ç§æ’ä»¶åŒ–æ–¹æ¡ˆã€‚ä¸è¿‡å®ƒéœ€è¦ Google Play Store æ”¯æŒï¼Œè¿™å¯¼è‡´åœ¨å›½å†…æ— æ³•ä½¿ç”¨ å€Ÿç€ navigation ç»„ä»¶æ”¯æŒ dynamic feature module é—´å¯¼èˆªçš„å¥‘æœºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ dynamic feature module æ¥æ‹†åˆ†åŠŸèƒ½æ¨¡å—ä»¥å®žçŽ°æ¨¡å—åŒ– ä¼ ç»Ÿçš„æ‹†åˆ†æ–¹æ¡ˆå¤§æ¦‚æ˜¯è¿™æ ·ï¼Œfeature module ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œapp module ä¾èµ–å„ä¸ª feature module é—´æŽ¥ä¾èµ– base åº“ï¼Œå…¬å…±åº“ è€Œä½¿ç”¨ dynamic feature module ï¼Œå…¶ç»“æž„æ˜¯è¿™æ ·çš„ dynamic feature module ä¹Ÿå¯ä»¥æŒ‰éœ€å®‰è£…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬å¯èƒ½ä¸åŒ…å«åœ¨ç”¨æˆ·æœ€åˆä¸‹è½½çš„ APK ä¸­ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶å®‰è£…ã€‚è€Œæˆ‘ä»¬å¯ä»¥ç›´æŽ¥å°†å®ƒä»¬åŒ…å«åˆ° APK ä¸­ ä½¿ç”¨ dynamic feature moduleé¦–å…ˆæˆ‘ä»¬åœ¨ base lib ä¸­å¼•å…¥ä¾èµ– 1234567dependencies &#123; def nav_version = "2.3.0-alpha06" api "androidx.navigation:navigation-fragment-ktx:$nav_version" api "androidx.navigation:navigation-ui-ktx:$nav_version" api "androidx.navigation:navigation-dynamic-features-fragment:$nav_version"&#125; æˆ‘ä»¬åœ¨ app module ä¸­çš„ res/navigation ç›®å½•ä¸‹åˆ›å»º main_nav.xml æŽ¥ç€æˆ‘ä»¬åœ¨ activity_main ä¸­è®¾ç½®é»˜è®¤çš„ host è¿™é‡Œä¸åŒäºŽæ­£å¸¸ navigation çš„ç”¨æ³•ï¼Œæ²¡æœ‰ä½¿ç”¨ NavHostFragmentï¼Œè€Œæ˜¯ä½¿ç”¨ DynamicNavHostFragment ç›´æŽ¥è·³è½¬ fragmentæˆ‘ä»¬åˆ›å»º dynamic feature module ï¼Œå–åä¸º feature1 è¿™é‡Œ dynamic feature module çš„åŒ…åå‰éƒ¨åˆ†è¦å’Œ applicationId å³ app module åŒ…åç›¸åŒï¼Œå¦åˆ™åŽç»­çš„ include æ“ä½œä¼šæœ‰é—®é¢˜ è¿™é‡Œæˆ‘ä»¬é€‰æ‹©åœ¨å®‰è£…æ—¶é›†æˆè¯¥ module æŽ¥ç€æˆ‘ä»¬åœ¨è¯¥ module ä¸‹åˆ›å»ºä¸€ä¸ª fragment å–åä¸º Feature1OneFragment ä¹‹åŽæˆ‘ä»¬ç›´æŽ¥åœ¨ main_nav.xml ä¸­å¼•å…¥ è¯¥ fragment å¹¶åŠ å…¥ action æŽ¥ç€æˆ‘ä»¬å°±å¯ä»¥åœ¨ app ä¸‹çš„ MainFragment æ‰“å¼€ Feature1OneFragment æˆ‘çš„ demo ä¸­ feature2 æ˜¯ç›´æŽ¥å¼•å…¥ fragmentï¼Œå› æ­¤è·³è½¬çš„æ˜¯ Feature2OneFragment ç›´æŽ¥è·³è½¬ activityåœ¨ feature1 ä¸­åˆ›å»º activity (demo ä¸­ä¸º feature2) åŒæ ·éœ€è¦æŒ‡å®š moduleName ä½¿ç”¨ dynamic feature module å†…éƒ¨çš„ graphæˆ‘ä»¬å¯ä»¥ä¸º dynamic feature module å•ç‹¬é…ç½® navigation graphï¼Œè¿™æ ·å°±å¯ä»¥å¤„ç† dynamic feature module å†…éƒ¨çš„è·³è½¬äº† åœ¨ feature1 ä¸­åˆ›å»º feature1_nav.xml ï¼Œå…¶ä¸­ startDestination ä¸º Feature1OneFragment åœ¨ main_nav.xml æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¦å¤–ä¸€ç§æ–¹å¼æ¥ä½¿ç”¨è¯¥ graph æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªæ–°çš„æ ‡ç­¾ include-dynamicï¼ŒåŒæ—¶æˆ‘ä»¬çœ‹åˆ°äº†å‡ ä¸ªæ²¡ç”¨è¿‡çš„å±žæ€§ graphPackage ä¸º dynamic feature module çš„åŒ…å graphResName ä¸º dynamic feature module å†…éƒ¨ graph çš„åå­— moduleName ä¸º module å æ³¨æ„ï¼šè¿™é‡Œçš„ graphPackage å¯ä»¥çœç•¥ å¦‚æžœ module çš„åŒ…åæ²¡ç”¨æŒ‰ç…§å‰æ–‡çš„æ ¼å¼é…ç½®ä¼šå¯¼è‡´æ— æ³•æ‰¾åˆ° graphId çš„å¼‚å¸¸ include-dynamic æ ‡ç­¾çš„ id è¦ä¸Ž feature1_nav.xml navigation æ ‡ç­¾ä¸‹çš„ id ä¸€è‡´ï¼Œæˆ–è€…åŽè€…ä¸è®¾ç½® id è¿™æ ·ä»Ž app module å¯¼èˆªåˆ° feature1 çš„ startDestination åŽä¾¿å¯ä½¿ç”¨å…¶å†…éƒ¨çš„é€»è¾‘è¿›è¡ŒåŽç»­çš„å¯¼èˆªäº† feature module é—´è·³è½¬ Navigation ç»„ä»¶æš‚ä¸æ”¯æŒ Dynamic include graph çš„ deep link å› æ­¤æˆ‘ç›®å‰ä¹Ÿæ²¡æœ‰æ‰¾åˆ°ç‰¹åˆ«ä¼˜é›…çš„æ–¹å¼ï¼Œå·²çŸ¥çš„æ–¹æ¡ˆå¦‚ä¸‹ åå°„ ä½¿ç”¨ ServiceLoader ä½¿ç”¨ä¾èµ–æ³¨å…¥ demo å…³äºŽæˆ‘æˆ‘æ˜¯ Flywith24ï¼Œæˆ‘çš„åšå®¢å†…å®¹å·²ç»åˆ†ç±»æ•´ç† åœ¨è¿™é‡Œï¼Œç‚¹å‡»å³ä¸Šè§’çš„ Watch å¯ä»¥åŠæ—¶èŽ·å–æˆ‘çš„æ–‡ç« æ›´æ–°å“¦ ðŸ˜‰ æŽ˜é‡‘ å°ä¸“æ  Github]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Tips</tag>
        <tag>å¥‡æŠ€æ·«å·§</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€å¥‡æŠ€æ·«å·§ã€‘æ–°çš„å›¾ç‰‡åŠ è½½åº“ï¼ŸåŸºäºŽKotlinåç¨‹çš„å›¾ç‰‡åŠ è½½åº“â€”â€”Coil]]></title>
    <url>%2F2020%2F05%2F18%2FTips-Coil%2F</url>
    <content type="text"><![CDATA[æ–°çš„å›¾ç‰‡åŠ è½½åº“â€”â€”CoilCoil æ˜¯ Instacart å›¢é˜Ÿç ”å‘çš„æ–°çš„çš„å›¾ç‰‡åŠ è½½åº“ï¼Œå®ƒä½¿ç”¨äº†å¾ˆå¤šé«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚åç¨‹ï¼ŒOkhttpï¼Œandroidx.lifecycleã€‚Coil è¿˜åŒ…æ‹¬ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚å›¾åƒé‡‡æ ·ï¼Œæœ‰æ•ˆçš„å†…å­˜ä½¿ç”¨ä»¥åŠè¯·æ±‚çš„è‡ªåŠ¨å–æ¶ˆ/æš‚åœ é»˜è®¤æƒ…å†µä¸‹ Coil ä¸Ž R8 å®Œå…¨å…¼å®¹ï¼Œå¼€ç®±å³ç”¨ï¼Œä¸éœ€è¦æ·»åŠ é¢å¤–çš„è§„åˆ™ã€‚å¦‚æžœä½¿ç”¨ Proguard ï¼Œæ‚¨å¯èƒ½éœ€è¦ä¸º Coroutines, OkHttp å’Œ Okio æ·»åŠ è§„åˆ™ Coil çš„ä¼˜åŠ¿ å¿«é€Ÿï¼šCoil è¿›è¡Œäº†å¾ˆå¤šä¼˜åŒ–ï¼ŒåŒ…æ‹¬å†…å­˜å’Œç£ç›˜ç¼“å­˜ï¼Œå¯¹å†…å­˜ä¸­çš„å›¾åƒè¿›è¡Œé‡‡æ ·ï¼Œé‡æ–°ä½¿ç”¨ä½å›¾ï¼Œè‡ªåŠ¨æš‚åœ/å–æ¶ˆè¯·æ±‚ç­‰ç­‰ è½»é‡ï¼šCoil åœ¨æ‚¨çš„APKä¸­æ·»åŠ äº†çº¦ 2000 ç§æ–¹æ³•ï¼ˆå¯¹äºŽå·²ç»ä½¿ç”¨ OkHttp å’Œ Coroutines çš„åº”ç”¨ç¨‹åºï¼‰ï¼Œä¸Ž Picasso ç›¸å½“ï¼Œè¿œå°‘äºŽ Glide å’Œ Fresco æ˜“ç”¨ï¼šCoil çš„ API åˆ©ç”¨ Kotlin çš„ç‰¹æ€§ç®€åŒ–äº†æ ·æ¿ä»£ç  çŽ°ä»£ï¼šCoil æ˜¯ Kotlin-firstï¼Œä½¿ç”¨çŽ°ä»£åŒ–çš„åº“ï¼Œä¾‹å¦‚ Coroutines, OkHttp, Okio, ä»¥åŠ AndroidX Lifecycles Coil æ˜¯ä»¥ä¸‹åç§°çš„ç¼©å†™ï¼šCoroutine Image Loader ArtifactsCoil æ‹¥æœ‰ 5 ä¸ª artifact å¹¶å‘å¸ƒåœ¨ mavenCentral() io.coil-kt:coilï¼šä¾èµ–äºŽ io.coil-kt:coil-base å¹¶ä¸”åŒ…å«äº† Coil çš„å•ä¾‹å’Œ ImageView.load çš„æ‰©å±•å‡½æ•° io.coil-kt:coil-baseï¼šbase åº“ï¼Œä¸åŒ…å« Coil çš„å•ä¾‹å’Œ ImageView.load çš„æ‰©å±•å‡½æ•°ï¼Œå¦‚æžœä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯¥åº“ io.coil-kt:coil-gifï¼šå¼•å…¥ä¸€ç³»åˆ—è§£ç å™¨ä»¥æ”¯æŒè§£ç  gif io.coil-kt:coil-svgï¼šå¼•å…¥ä¸€ç³»åˆ—è§£ç å™¨ä»¥æ”¯æŒ svg io.coil-kt:coil-videoï¼šåŒ…æ‹¬ä¸¤ä¸ª fetchers ï¼Œä»¥æ”¯æŒä»Ž Android æ”¯æŒçš„ä»»ä½•è§†é¢‘æ ¼å¼ä¸­æå–å’Œè§£ç å¸§ 1234// æ™®é€šä½¿ç”¨å¼•ç”¨implementation "io.coil-kt:coil:0.11.0"// ä½¿ç”¨ä¾èµ–æ³¨å…¥æ—¶æˆ–è€…åˆ¶ä½œåŸºäºŽ coil çš„åº“å¼•ç”¨implementation "io.coil-kt:coil-base:0.11.0" Java 8Coil è¦æ±‚ Java 8ï¼Œè¦é€šè¿‡ D8 å¯ç”¨ Java 8 è°ƒè¯•ï¼Œè¯·å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° Gradle è„šæœ¬ Gradle (.gradle) 123456789101112android &#123; compileOptions &#123; sourceCompatibility JavaVersion.VERSION_1_8 targetCompatibility JavaVersion.VERSION_1_8 &#125;&#125;tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all &#123; kotlinOptions &#123; jvmTarget = "1.8" &#125;&#125; Gradle Kotlin DSL (.gradle.kts) 123456789101112android &#123; compileOptions &#123; sourceCompatibility = JavaVersion.VERSION_1_8 targetCompatibility = JavaVersion.VERSION_1_8 &#125;&#125;tasks.withType&lt;KotlinCompile&gt; &#123; kotlinOptions &#123; jvmTarget = "1.8" &#125;&#125; ä½¿ç”¨ImageView æ‰©å±•å‡½æ•°io.coil-kt:coil æä¾›äº† ç±»åž‹å®‰å…¨çš„ ImageView æ‰©å±•å‡½æ•° åœ¨ ImageView ä¸­åŠ è½½å›¾ç‰‡ï¼Œåªéœ€è°ƒç”¨ load æ‰©å±•å‡½æ•° 12345678910// URLimageView.load("https://www.example.com/image.jpg")// ResourceimageView.load(R.drawable.image)// FileimageView.load(File("/path/to/image.jpg"))// And more... ä¸Šé¢çš„è¯·æ±‚ç­‰ä»·äºŽï¼š 123456val imageLoader = Coil.imageLoader(context)val request = LoadRequest.Builder(imageView.context) .data("https://www.example.com/image.jpg") .target(imageView) .build()imageLoader.execute(request) å¯é€‰çš„è¯·æ±‚é…ç½®å¯ä»¥é€šè¿‡ lambda æ¥æ“ä½œ 12345imageView.load("https://www.example.com/image.jpg") &#123; crossfade(true) placeholder(R.drawable.image) transformations(CircleCropTransformation())&#125; Image LoadersÂ¶ImageLoader æ˜¯æ‰§è¡Œè¯·æ±‚çš„æœåŠ¡ç±»ã€‚ ä»–ä»¬å¤„ç†ç¼“å­˜ï¼Œæ•°æ®èŽ·å–ï¼Œå›¾åƒè§£ç ï¼Œè¯·æ±‚ç®¡ç†ï¼Œbitmap poolï¼Œå†…å­˜ç®¡ç†ç­‰ã€‚ å¯ä»¥ä½¿ç”¨ builder æ¥åˆ›å»ºå’Œé…ç½®æ–°å®žä¾‹ï¼š 1234val imageLoader = ImageLoader.Builder(context) .availableMemoryPercentage(0.25) .crossfade(true) .build() imageView.load ä½¿ç”¨å•ä¾‹ ImageLoader æ‰§è¡Œ LoadRequest ã€‚ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è®¿é—®å•ä¾‹ ImageLoaderï¼š 1val imageLoader = Coil.imageLoader(context) ï¼ˆå¯é€‰ï¼‰æ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„ImageLoaderå®žä¾‹ï¼Œå¹¶é€šè¿‡ä¾èµ–é¡¹æ³¨å…¥å°†å®ƒä»¬æ³¨å…¥ï¼š 1val imageLoader = ImageLoader(context) å½“æ‚¨åˆ›å»ºå•ä¸ª ImageLoader å¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«æ—¶ï¼ŒCoil çš„æ€§èƒ½æœ€ä½³ã€‚ è¿™æ˜¯å› ä¸ºæ¯ä¸ª ImageLoader éƒ½æœ‰è‡ªå·±çš„å†…å­˜ç¼“å­˜ï¼Œbitmap pool å’Œç½‘ç»œç›‘å¬ RequestsÂ¶æœ‰ä¸¤ç§ Request ç±»åž‹ LoadRequest æ˜¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸèŒƒå›´çš„ requestï¼Œæ”¯æŒ Targetï¼ŒTransition ç­‰ç­‰ GetRequest æŒ‚èµ·å¹¶è¿”å›ž RequestResult å¦‚æžœè¦åŠ è½½åˆ°è‡ªå®šä¹‰ target ä¸­ï¼Œå¯ä»¥æ‰§è¡Œ LoadRequest 1234567val request = LoadRequest.Builder(context) .data("https://www.example.com/image.jpg") .target &#123; drawable -&gt; // Handle the result. &#125; .build()imageLoader.execute(request) è¦å¼ºåˆ¶èŽ·å–å›¾åƒï¼Œè¯·æ‰§è¡ŒGetRequestï¼š 1234val request = GetRequest.Builder(context) .data("https://www.example.com/image.jpg") .build()val drawable = imageLoader.execute(request).drawable å•ä¾‹å¦‚æžœæ‚¨ä½¿ç”¨çš„æ˜¯ io.coil-kt:coil ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»»æ„æ–¹å¼è®¾ç½® ImageLoader çš„å®žä¾‹ åœ¨ Application ä¸­å®žçŽ° ImageLoaderFactoryï¼ˆæŽ¨èï¼‰ 12345678910111213class MyApplication : Application(), ImageLoaderFactory &#123; override fun newImageLoader(): ImageLoader &#123; return ImageLoader.Builder(context) .crossfade(true) .okHttpClient &#123; OkHttpClient.Builder() .cache(CoilUtils.createDefaultCache(context)) .build() &#125; .build() &#125;&#125; è°ƒç”¨ Coil.setImageLoader 123456789val imageLoader = ImageLoader.Builder(context) .crossfade(true) .okHttpClient &#123; OkHttpClient.Builder() .cache(CoilUtils.createDefaultCache(context)) .build() &#125; .build()Coil.setImageLoader(imageLoader) é»˜è®¤çš„ ImageLoader å¯ä»¥é€šè¿‡è¿™æ ·å–å›ž 1val imageLoader = Coil.imageLoader(context) è®¾ç½®é»˜è®¤çš„ ImageLoader æ˜¯å¯é€‰çš„ã€‚ å¦‚æžœæœªè®¾ç½®ï¼Œåˆ™ Coil ä¼šå»¶è¿Ÿåˆ›å»ºå…·æœ‰é»˜è®¤å€¼çš„ ImageLoader å¦‚æžœæ‚¨ä½¿ç”¨çš„æ˜¯ io.coil-kt:coil-baseï¼Œæ‚¨åº”åˆ›å»ºè‡ªå·±çš„ ImageLoader å®žä¾‹å¹¶é€šè¿‡ä¾èµ–æ³¨å…¥å°†å®ƒæ³¨å…¥åˆ° app ä¸­ æ³¨æ„ï¼šå¦‚æžœè®¾ç½®è‡ªå®šä¹‰OkHttpClientï¼Œåˆ™å¿…é¡»è®¾ç½®ç¼“å­˜å®žçŽ°ï¼Œå¦åˆ™ImageLoaderå°†æ²¡æœ‰ç£ç›˜ç¼“å­˜ã€‚ å¯ä»¥ä½¿ç”¨CoilUtils.createDefaultCache åˆ›å»ºé»˜è®¤çš„ Coil ç¼“å­˜å®žä¾‹ æ”¯æŒçš„æ•°æ®ç±»åž‹ImageLoader æ”¯æŒçš„æ•°æ®ç±»åž‹ä¸º String (mapped to a Uri) HttpUrl Uri (android.resource, content, file, http, and https schemes only) File @DrawableRes Int Drawable Bitmap é¢„åŠ è½½å¦‚æžœè¦é¢„åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ‰§è¡Œä¸€ä¸ªä¸å¸¦ target çš„ LoadRequest 123456val request = LoadRequest.Builder(context) .data("https://www.example.com/image.jpg") // å¯é€‰çš„ï¼Œä½†æ˜¯è®¾ç½® ViewSizeResolver å¯ä»¥é€šè¿‡é™åˆ¶é¢„åŠ è½½çš„å¤§å°æ¥èŠ‚çœå†…å­˜ .size(ViewSizeResolver(imageView)) .build()imageLoader.execute(request) å¦‚æžœåªæƒ³å°†ç½‘ç»œå›¾ç‰‡é¢„åŠ è½½åˆ°ç£ç›˜ä¸­ï¼Œå¯ä»¥ä¸º request å…³é—­å†…å­˜ç¼“å­˜ 12345val request = LoadRequest.Builder(context) .data("https://www.example.com/image.jpg") .memoryCachePolicy(CachePolicy.DISABLED) .build()imageLoader.execute(request) å–æ¶ˆè¯·æ±‚LoadRequest ä¼šè‡ªåŠ¨å–æ¶ˆåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹ å…³è”çš„ view detachedï¼Œ å…³è”çš„ lifecycle destroyed å¦ä¸€ä¸ª request åœ¨ç›¸åŒçš„ view ä¸­å¼€å¯ æ­¤å¤–ï¼Œæ¯ä¸ª LoadRequest è¿”å›žä¸€ä¸ª RequestDisposableï¼Œå¯ç”¨äºŽæ£€æŸ¥è¯·æ±‚æ˜¯å¦åœ¨è¿è¡Œä¸­æˆ–å¤„ç†è¯¥è¯·æ±‚ï¼ˆæœ‰æ•ˆåœ°å–æ¶ˆè¯·æ±‚å¹¶é‡Šæ”¾å…¶å…³è”èµ„æºï¼‰ 1234val disposable = imageView.load("https://www.example.com/image.jpg")// Cancel the request.disposable.dispose() GetRequest ä»…å½“åç¨‹çš„ä¸Šä¸‹æ–‡è¢«å–æ¶ˆæ—¶æ‰ä¼šå–æ¶ˆ å›¾ç‰‡é‡‡æ ·å‡è®¾ç£ç›˜ä¸Šæœ‰ä¸€ä¸ª 500x500 çš„æ˜ åƒï¼Œä½†æ˜¯åªéœ€è¦ä»¥ 100x100 çš„å¤§å°å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­å³å¯åœ¨è§†å›¾ä¸­æ˜¾ç¤ºã€‚ Coil ä¼šå°†å›¾åƒåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½†æ˜¯å¦‚æžœæ‚¨éœ€è¦ 500x500 çš„å›¾åƒä¼šæ€Žæ ·å‘¢ï¼Ÿ ä»Žç£ç›˜è¯»å–è¿˜æœ‰æ›´å¥½çš„ã€Œè´¨é‡ã€ï¼Œä½†æ˜¯å›¾åƒå·²ç»ä»¥ 100x100 åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬ä»Žç£ç›˜ä»¥ 500x500 è¯»å–å›¾åƒæ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ 100x100 å›¾åƒä½œä¸ºå ä½ç¬¦ã€‚ è¿™æ­£æ˜¯ Coil æ‰€åšçš„ï¼Œå¹¶ä¸” Coil è‡ªåŠ¨ä¸ºæ‰€æœ‰ BitmapDrawables å¤„ç†æ­¤è¿‡ç¨‹ã€‚ ä¸Ž crossfade(true) æ­é…ä½¿ç”¨æ—¶ï¼Œå¯ä»¥åˆ›å»ºè§†è§‰æ•ˆæžœï¼Œä½¿å›¾åƒç»†èŠ‚çœ‹èµ·æ¥åƒæ·¡å…¥æ·¡å‡ºï¼Œç±»ä¼¼äºŽæ¸è¿›å¼ JPEG ä½¿ç”¨è¦æ±‚ AndroidX Min SDK 14+ Compile SDK: 29+ Java 8+ è¯¦ç»†å†…å®¹ç§»æ­¥ å®˜æ–¹æ–‡æ¡£ å…³äºŽæˆ‘æˆ‘æ˜¯ Flywith24ï¼Œæˆ‘çš„åšå®¢å†…å®¹å·²ç»åˆ†ç±»æ•´ç† åœ¨è¿™é‡Œï¼Œç‚¹å‡»å³ä¸Šè§’çš„ Watch å¯ä»¥åŠæ—¶èŽ·å–æˆ‘çš„æ–‡ç« æ›´æ–°å“¦ ðŸ˜‰ æŽ˜é‡‘ å°ä¸“æ  Github]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Tips</tag>
        <tag>å¥‡æŠ€æ·«å·§</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Jetpackæ›´æ–°ä¹‹Fragmentã€‘1.3.0-alpha04 æ¥è¢­ï¼ŒFragment é—´é€šä¿¡çš„æ–°å§¿åŠ¿]]></title>
    <url>%2F2020%2F04%2F30%2FJetpack-fragment-ResultAPI%2F</url>
    <content type="text"><![CDATA[å‰è¨€fragment 1.3.0-alpha04 å‘å¸ƒäº†ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šå˜åŠ¨ï¼Œå…¶ä¸­æä¾›äº† fragment é—´ä¼ é€’æ•°æ®çš„æ–°æ–¹å¼ API æ›´æ”¹é¦–å…ˆæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹ API æ›´æ”¹ startActivityForResult()/onActivityResult() å’Œ requestPermissions()/onRequestPermissionsResult() å¼ƒç”¨ prepareCall() é‡å‘½åä¸º registerForActivityResult() target fragment API è¢«å¼ƒç”¨ Activity Result API ä¸Šä½ç”±äºŽå®˜æ–¹æä¾›äº† Activity Result API æ¥æ›¿æ¢ onActivityResult æœºåˆ¶ï¼Œå› æ­¤ fragment çš„ startActivityForResult()/onActivityResult() å’Œ requestPermissions()/onRequestPermissionsResult() æ–¹æ³•è¢«æ ‡è®°å¼ƒç”¨äº† Activity Result API è¯¦æƒ…å¯å‚è€ƒ ç§‰å¿ƒè¯´ çš„ æ˜¯æ—¶å€™ä¸¢æŽ‰ onActivityResult äº† ï¼ æ–‡ç« ä»‹ç»çš„å¾ˆè¯¦å°½ï¼Œè¿™é‡Œä¸å†èµ˜è¿° prepareCall é‡å‘½åå€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯ prepareCall() è¢«å‘½åä¸º registerForActivityResult() æ³¨æ„ï¼šåœ¨ç‰ˆæœ¬å¤„äºŽ Alpha ç‰ˆçŠ¶æ€æ—¶ï¼Œå¯ä»¥æ·»åŠ ã€ç§»é™¤æˆ–æ›´æ”¹ APIã€‚å› æ­¤ Alpha ç‰ˆæœ¬ä¸é€‚åˆåœ¨ç”Ÿäº§ä¸Šä½¿ç”¨ target fragment API è¢«å¼ƒç”¨å…¶å®ž target fragment API æ—©å·²è¢«å¼ƒç”¨ target fragment éœ€è¦ç›´æŽ¥è®¿é—®å¦ä¸€ä¸ª fragment çš„å®žä¾‹ï¼Œè¿™æ˜¯ååˆ†å±é™©çš„ï¼Œå› ä¸ºä½ ä¸çŸ¥é“ç›®æ ‡ fragment å¤„äºŽä»€ä¹ˆçŠ¶æ€ã€‚è€Œä¸” target fragment ä¸æ”¯æŒ Navigation é‚£ä¹ˆï¼Œfragment ä¹‹é—´ä¼ é€’æ•°æ®æ›´å¹²å‡€çš„æ–¹å¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ fragment ä¹‹é—´ä¼ é€’æ•°æ®çš„æ–°æ–¹å¼å‰æ–‡æåˆ°ï¼Œåœ¨ç›¸åŒçš„ FragmentManager ä¸­å¯ä»¥ä½¿ç”¨ target fragment API æ¥åœ¨ fragment é—´ä¼ é€’æ•°æ®ï¼Œä½†è¿™ç§æ–¹å¼éœ€è¦ç›´æŽ¥è®¿é—®ç›®æ ‡fragment çš„å®žä¾‹ï¼Œè¿™å¾ˆå±é™©ï¼Œå› ä¸ºç›®æ ‡ fragment çš„çŠ¶æ€æ˜¯æœªçŸ¥çš„ å› æ­¤å®˜æ–¹æä¾›äº†è¿™æ ·çš„ APIï¼Œå®ƒå…è®¸åœ¨ä¸€ä¸ª fragment ä¸Šè®¾ç½®ç»“æžœï¼Œå¹¶å°†è¯¥ç»“æžœåœ¨ fragment çš„é€‚å½“çš„ç”Ÿå‘½å‘¨æœŸä¸­ä½¿ç”¨ã€‚ è¿™ç§ä¼ é€’æ•°æ®çš„æ–¹å¼é€‚ç”¨äºŽ DialogFragment ï¼ŒNavigation ä¸­çš„ fragment æ­¤æ›´æ”¹è¿˜åŒ…æ‹¬ -ktx æ‰©å±•åŠŸèƒ½ä»¥ç¡®ä¿ kotlin ç”¨æˆ·å¯ä»¥å°† FragmentResultListener ä½œä¸º lambda ä¼ é€’ æºç åˆ†æžè€è§„çŸ©ï¼Œæˆ‘ä»¬æ²¿ç€å®˜æ–¹çš„ commit log æ¥çœ‹çœ‹å®˜æ–¹å®žçŽ°è¯¥åŠŸèƒ½çš„æ€è·¯ é¦–å…ˆï¼Œæ·»åŠ äº† FragmentResultOwner è¿™æ ·çš„çš„æŠ½è±¡ï¼Œç”¨äºŽå¤„ç† fragment resultï¼Œå…¶å†…éƒ¨æœ‰ä¸¤ä¸ªæ–¹æ³• setResult setResultListener å‰è€…ç”¨äºŽå‘é€æ•°æ®ï¼ŒåŽè€…ç”¨äºŽæŽ¥æ”¶æ•°æ® è€Œå…¶å®žçŽ°ç±»ä¸º FragmentManager æˆ‘ä»¬æ¥çœ‹çœ‹ FragmentManager ä¸¤ä¸ªæ–¹æ³•çš„å…·ä½“å®žçŽ° 123456789101112131415161718192021222324252627282930313233343536373839public final void setFragmentResultListener(@NonNull final String requestKey, @NonNull final LifecycleOwner lifecycleOwner, @Nullable final FragmentResultListener listener) &#123; // è®¾ç½®çš„ listener ä¸ºç©ºæ—¶å°† requestKey å¯¹åº”çš„ listener ç§»é™¤ if (listener == null) &#123; mResultListeners.remove(requestKey); return; &#125; // å½“fragment å¤„äºŽDESTROYED çŠ¶æ€æ—¶ ç›´æŽ¥ return ï¼Œé¿å…äº†å¼‚å¸¸ final Lifecycle lifecycle = lifecycleOwner.getLifecycle(); if (lifecycle.getCurrentState() == Lifecycle.State.DESTROYED) &#123; return; &#125; // è§‚å¯Ÿç”Ÿå‘½å‘¨æœŸï¼Œfragment started åŽæŽ¥æ”¶å›žè°ƒï¼Œdestroyed ç§»é™¤å›žè°ƒ LifecycleEventObserver observer = new LifecycleEventObserver() &#123; @Override public void onStateChanged(@NonNull LifecycleOwner source, @NonNull Lifecycle.Event event) &#123; if (event == Lifecycle.Event.ON_START) &#123; // once we are started, check for any stored results Bundle storedResult = mResults.get(requestKey); if (storedResult != null) &#123; // if there is a result, fire the callback listener.onFragmentResult(requestKey, storedResult); // and clear the result setFragmentResult(requestKey, null); &#125; &#125; if (event == Lifecycle.Event.ON_DESTROY) &#123; lifecycle.removeObserver(this); mResultListeners.remove(requestKey); &#125; &#125; &#125;; lifecycle.addObserver(observer); mResultListeners.put(requestKey, new LifecycleAwareResultListener(lifecycle, listener));&#125; ä»¥ä¸Šä¾¿æ˜¯è¿™éƒ¨åˆ†çš„æºç  è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ fragment result api æ˜¯åŸºäºŽåŒä¸€ FragmentManager çš„ æ€»ç»“å®˜æ–¹ä¸€ç›´è‡´åŠ›äºŽå°† fragment çš„ api å˜å¾—æ›´å¥½ç”¨ Ian Lake åœ¨ Fragments: Past, Present, and Future (Android Dev Summit â€˜19) ä¸­æåˆ°äº† fragment é—´é€šä¿¡çš„é—®é¢˜ï¼Œæœªæ¥ fragment ä¼šæ•´åˆ fragment è‡ªèº«å’Œå…¶å†…éƒ¨ view çš„ç”Ÿå‘½å‘¨æœŸï¼Œæä¾›åŒä¸€ FragmentManager å¤šè¿”å›žæ ˆçš„æ”¯æŒ çœ‹åˆ° fragment result API ï¼Œæˆ‘çªç„¶æœ‰ä¸ªæƒ³æ³•ï¼Œå¦‚æžœå°†å…¶åº”ç”¨åˆ° Navigation ä¸­æ˜¯å¦æ˜¯è§£å†³ Navigation è·³è½¬è¿”å›žåŽçŠ¶æ€é‡ç½®çš„ä¸€ä¸ªæ–¹æ³•å‘¢ï¼Ÿ å„ä½å°ä¼™ä¼´æœ‰ä»€ä¹ˆæƒ³æ³•æ¬¢è¿Žè¯„è®ºåŒºç•™è¨€ å…³äºŽæˆ‘æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github æ¬¢è¿Žå…³æ³¨æˆ‘çš„å…¬ä¼—å·]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
        <tag>Fragment</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Jetpackæ›´æ–°ä¹‹Fragmentã€‘setRetainInstance è¢«å¼ƒç”¨ï¼Œé‚£ä¹ˆ fragment æ˜¯å¦‚ä½•ä¿å­˜çŠ¶æ€çš„ï¼Ÿ]]></title>
    <url>%2F2020%2F04%2F30%2FJetpack-fragment-savestate%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬éƒ½çŸ¥é“ fragment ä¸­çš„ setRetainInstance ç”¨äºŽæŽ§åˆ¶æ˜¯å¦åœ¨ activity ä¿ç•™ fragment å®žä¾‹ï¼Œå…·ä½“å†…å®¹å¯å‚è§ WanAndroid çš„æ¯æ—¥ä¸€é—®ï¼šFragment æ˜¯å¦‚ä½•è¢«å­˜å‚¨ä¸Žæ¢å¤çš„ï¼Ÿ ä½†æ˜¯è¯¥æ–¹æ³•å·²äºŽ androidx fragment 1.3.0-alpha01 å¼ƒç”¨äº† è€è§„çŸ©ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ commit log ç®€å•æ¦‚å†µä¸€ä¸‹ SetRetainInstance å°è¯•åœ¨ activity é‡å»ºæ—¶ä¿å­˜çŠ¶æ€ã€‚ä½†å®ƒå¸¦æ¥äº†å¾ˆå¤šå‰¯ä½œç”¨ã€‚ éšç€ ViewModel çš„å¼•å…¥ï¼Œå¼€å‘è€…æ‹¥æœ‰ä¸€ä¸ªç‰¹å®šçš„ APIï¼Œç”¨äºŽä¿ç•™ä¸Ž Activityï¼ŒFragments å’Œ Navigation ç›¸å…³è”çš„çŠ¶æ€ã€‚ è¿™ä½¿å¼€å‘è€…å¯ä»¥ä½¿ç”¨æ­£å¸¸çš„ï¼Œä¸éœ€è¦ä¿ç•™ fragment ï¼Œä»Žè€Œåœ¨ä¿å­˜å•ä¸ªéœ€è¦çš„å±žæ€§æ—¶é¿å…äº†å¸¸è§çš„æ³„æ¼æºï¼Œå¹¶ä¸”å¯ä»¥é”€æ¯ä¿å­˜çš„çŠ¶æ€ï¼ˆå³ ViewModel çš„æž„é€ å™¨å’Œ onCleared å›žè°ƒï¼‰ è¯¦æƒ…å¯å‚è§ ã€èƒŒä¸ŠJetpackã€‘ç»ä¸ä¸¢å¤±çš„çŠ¶æ€ androidx SaveState ViewModel-SaveState åˆ†æž å’Œ ã€èƒŒä¸ŠJetpackä¹‹ViewModelã€‘å³ä½¿æ‚¨ä¸ä½¿ç”¨MVVMä¹Ÿè¦äº†è§£ViewModel â€”â€”ViewModel çš„èŒèƒ½è¾¹ç•Œ ä»Žè¿™ä¸ªæ”¹åŠ¨å¯ä»¥çœ‹å‡ºå®˜æ–¹æ­£è‡´åŠ›äºŽä¿è¯é€»è¾‘çš„å•ä¸€æ€§ï¼ŒçŠ¶æ€ä¿å­˜äº¤ç»™ ViewModel ï¼Œå‡å°‘è¿™ç§ç‰¹æ®Šçš„ä¾‹å¤–æƒ…å†µï¼Œä»Žè€Œæ¶ˆé™¤ä¸€äº›ä¸ç¬¦åˆé¢„æœŸçš„é—®é¢˜ å…³äºŽæˆ‘æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github æ¬¢è¿Žå…³æ³¨æˆ‘çš„å…¬ä¼—å·]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
        <tag>Fragment</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Jetpackæ›´æ–°ä¹‹Fragmentã€‘setMaxLifecycle ä¸Šä½ï¼ŒsetUserVisibleHint è¢«å¼ƒç”¨]]></title>
    <url>%2F2020%2F04%2F29%2FJetpack-fragment-setMaxLifecycle%2F</url>
    <content type="text"><![CDATA[å¾ˆå¤šæƒ…å†µä¸‹ï¼Œfragment çš„ç”Ÿå‘½å‘¨æœŸä¸Šé™åº”è¯¥ä½ŽäºŽ FragmentManager/Activityã€‚ä¾‹å¦‚ï¼ŒViewPager å±å¹•å¤–çš„ç•Œé¢ä¸åº”è¢« resumed ç†æƒ³çŠ¶æ€ä¸‹ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ API å®žçŽ° 1234supportFragmentManager .beginTransaction() .setMaxLifecycle(fragment, Lifecycle.State.RESUMED) .commit() å°†æœ€å¤§ç”Ÿå‘½å‘¨æœŸè®¾ç½®ä¸º Lifecycle.State.RESUMED å°†æœ‰æ•ˆåœ°æ¶ˆé™¤é™åˆ¶ï¼ˆå› ä¸ºè¿™æ˜¯æœ€é«˜ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼‰ è¿™å°†å…è®¸åºŸå¼ƒ setUserVisibleHint() API setMaxLifecycle å‡ºçŽ°å§‹æœ«è¯¥åŠŸèƒ½åº”å¦‚ä½•å®žçŽ°çš„ï¼Ÿæˆ‘ä»¬æ²¿ç€ commit log æ¥ç†ä¸€ä¸‹å®˜æ–¹çš„æ€è·¯ å°† BackStackRecord çš„éƒ¨åˆ†é€»è¾‘è½¬ç§»è‡³çˆ¶ç±» FragmentTransaction ä¸­ åœ¨ FragmentTransaction ä¸­æ·»åŠ  setMaxLifecycle API ä¿å­˜ fragment maxState å¼ƒç”¨ setUserVisibleHint FragmentPagerAdapter æž„é€ å™¨æ–°å¢žå‚æ•°ï¼Œä½¿ç”¨ setMaxLifecycle() API ç¡®ä¿ fragment resumed æ—¶å¯¹ç”¨æˆ·å¯è§ å¼ƒç”¨ FragmentStatePagerAdapter åŽŸæ¥çš„å•å‚æž„é€ å™¨ï¼ŒæŽ¨èä½¿ç”¨æ–°çš„æž„é€  éšç€ ViewPager2 1.0.0 æ­£å¼ç‰ˆå‘å¸ƒï¼Œä¸Ž ViewPager äº¤äº’çš„FragmentPagerAdapter å’Œ FragmentStatePagerAdapter è¢«å¼ƒç”¨äº† è‡³æ­¤æˆ‘ä»¬æ‹é¡ºäº† setMaxLifecycle çš„å‡ºçŽ°ï¼ŒsetUserVisibleHint çš„å¼ƒç”¨ä»¥åŠä¸ŽViewPager ç›¸å…³çš„ FragmentPagerAdapter å’Œ FragmentStatePagerAdapter çš„å¼ƒç”¨ setMaxLifecycle å†…éƒ¨é€»è¾‘æŽ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ setMaxLifecycle æ˜¯å¦‚ä½•å‘æŒ¥ä½œç”¨çš„ é¦–å…ˆæˆ‘ä»¬è¦ç ”ç©¶ä¸€ä¸‹ fragment çš„çŠ¶æ€ç®¡ç†ï¼Œä¸ºäº†æ›´å¥½çš„ç®¡ç† fragment çš„çŠ¶æ€ï¼Œå®˜æ–¹æ·»åŠ äº† FragmentStateManager ç±»æ¥ä¸“é—¨ç®¡ç† fragment çš„çŠ¶æ€ï¼ŒèŒèƒ½å•ä¸€åŽŸåˆ™å“ˆ æŽ¥ç€åœ¨è¯¥ç±»ä¸­æ·»åŠ äº†è®¡ç®— fragment æœ€å¤§ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³• computeMaxState() åŽæ¥è¯¥æ–¹æ³•æ”¹åä¸º computeExpectedState() å¹¶åŠ å…¥äº† moveToExpectedState() æ–¹æ³• computeExpectedState() æ–¹æ³•ä¼šæ ¹æ® fragment mMaxState è®¡ç®— fragment åº”è¯¥æ‰€å¤„çš„ç”Ÿå‘½å‘¨æœŸ è€Œ fragment çš„ mMaxState æ˜¯é€šè¿‡ FragmentManager çš„ setMaxLifecycle() æ–¹æ³•è®¾ç½®çš„ ï¼Œè€Œè¯¥æ–¹æ³•æ˜¯ BackStackRecord æ‰§è¡Œ OP æ—¶è°ƒç”¨çš„ï¼Œè€Œ OP å€¼æ­£æ˜¯é€šè¿‡ FragmentTransaction çš„ setMaxLifecycle() è®¾ç½®çš„ è‡³æ­¤ï¼Œæˆ‘ä»¬ç†æ¸…äº† setMaxLifecycle() çš„å†…éƒ¨é€»è¾‘ æ€»ç»“æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®˜æ–¹ä¸ºäº†ä½¿ fragment èƒ½å¤Ÿåœ¨æ­£ç¡®çš„ç”Ÿå‘½å‘¨æœŸä¸Šï¼Œå¼•å…¥äº† setMaxLifecycle() æ–¹æ³•ï¼ŒåŒæ—¶ä¸ºäº†æ›´å¥½çš„ç®¡ç† fragment çš„çŠ¶æ€ï¼ŒæŠ½è±¡å‡ºäº† FragmentStateManager ã€‚æ›´å°‘çš„ä»£ç ï¼Œæ›´å°‘çš„èŒè´£ï¼Œfragment çš„å†…éƒ¨é€»è¾‘ä¼šè¶Šæ¥è¶Šæ¸…æ™° å…³äºŽå¦‚ä½•è¿ç§»è‡³ ViewPager2 ï¼Œè¯·ç§»æ­¥ å®˜æ–¹è§†é¢‘ å…³äºŽæ–°çš„ API ä¸‹æ‡’åŠ è½½å®žçŽ°ï¼Œè¯·ç§»æ­¥ Androidx ä¸‹ Fragment æ‡’åŠ è½½çš„æ–°å®žçŽ° å…³äºŽæˆ‘æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github æ¬¢è¿Žå…³æ³¨æˆ‘çš„å…¬ä¼—å·]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
        <tag>Fragment</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€å¥‡æŠ€æ·«å·§ã€‘å·§ç”¨ kotlin æ‰©å±•å‡½æ•°å’Œ typealias å°è£… LiveData]]></title>
    <url>%2F2020%2F04%2F15%2FTips-StateLiveData%2F</url>
    <content type="text"><![CDATA[å…³äºŽ LiveData ä¸¤ä¸ªå¸¸ç”¨çš„å§¿åŠ¿ä½¿ç”¨åŒ…è£…ç±»ä¼ é€’äº‹ä»¶æˆ‘ä»¬åœ¨ä½¿ç”¨ LiveData æ—¶å¯èƒ½ä¼šé‡åˆ°ã€Œç²˜æ€§ã€äº‹ä»¶çš„é—®é¢˜ï¼Œè¯¥é—®é¢˜å¯ä»¥ä½¿ç”¨åŒ…è£…ç±»çš„æ–¹å¼è§£å†³ã€‚è§£å†³æ–¹æ¡ˆè§ [è¯‘] åœ¨ SnackBarï¼ŒNavigation å’Œå…¶ä»–äº‹ä»¶ä¸­ä½¿ç”¨ LiveDataï¼ˆSingleLiveEvent æ¡ˆä¾‹ï¼‰ ä½¿ç”¨æ—¶æ˜¯è¿™æ ·çš„ 1234567891011121314151617class ListViewModel : ViewModel &#123; private val _navigateToDetails = MutableLiveData&lt;Event&lt;String&gt;&gt;() val navigateToDetails : LiveData&lt;Event&lt;String&gt;&gt; get() = _navigateToDetails fun userClicksOnButton(itemId: String) &#123; _navigateToDetails.value = Event(itemId) // Trigger the event by setting a new Event as a new value &#125;&#125;myViewModel.navigateToDetails.observe(this, Observer &#123; it.getContentIfNotHandled()?.let &#123; // Only proceed if the event has never been handled startActivity(DetailsActivity...) &#125;&#125;) ä¸è¿‡è¿™æ ·å†™ç”šæ˜¯ç¹çï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´ä¼˜é›…çš„æ–¹å¼è§£å†³è¯¥é—®é¢˜ 1234//ä¸º LiveData&lt;Event&lt;T&gt;&gt;æä¾›ç±»åž‹åˆ«åï¼Œä½¿ç”¨ EventLiveData&lt;T&gt; å³å¯typealias EventMutableLiveData&lt;T&gt; = MutableLiveData&lt;Event&lt;T&gt;&gt;typealias EventLiveData&lt;T&gt; = LiveData&lt;Event&lt;T&gt;&gt; ä½¿ç”¨ typealias å…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªç±»åž‹åˆ«åï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨ 12//ç­‰ä»·äºŽ MutableLiveData&lt;Event&lt;Boolean&gt;&gt;(Event(false))val eventContent = EventMutableLiveData&lt;Boolean&gt;(Event(false)) çŽ°åœ¨å£°æ˜Žæ—¶ä¸ç”¨å¤šåŠ ä¸€å±‚æ³›åž‹äº†ï¼Œé‚£ä¹ˆä½¿ç”¨æ—¶è¿˜æ˜¯å¾ˆç¹ç æˆ‘ä»¬å¯ä»¥å€ŸåŠ© kotlin çš„ æ‰©å±•å‡½æ•°æ›´ä¼˜é›…çš„ä½¿ç”¨ demo ä¸­å°è£…äº†ä¸¤ç§å½¢å¼çš„ LiveDataï¼Œä¸€ç§ä¸º LiveData&lt;Boolean&gt;ï¼Œä¸€ç§ä¸º EventLiveData&lt;Boolean&gt;ï¼Œå½“å±å¹•æ—‹è½¬æ—¶ï¼Œå‰è€…ä¼šå†æ¬¡å›žè°ƒç»“æžœï¼Œè€ŒåŽè€…ç”±äºŽäº‹ä»¶å·²è¢«å¤„ç†è€Œä¸æ‰§è¡Œ onChangedï¼Œæˆ‘ä»¬é€šè¿‡ Toast å¯è§‚å¯Ÿåˆ°è¿™ä¸€çŽ°è±¡ java ç‰ˆçš„å¯å‚è€ƒ å°è£…å¸¦ç½‘ç»œçŠ¶æ€çš„æ•°æ®å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åœ¨èŽ·å–ç½‘ç»œæ•°æ®æ—¶è¦å°è£…ä¸€å±‚ç½‘ç»œçŠ¶æ€ï¼Œä¾‹å¦‚ï¼šåŠ è½½ä¸­ï¼ŒæˆåŠŸï¼Œå¤±è´¥ åœ¨ä½¿ç”¨æ—¶æˆ‘ä»¬é‡åˆ°äº†å’Œä¸Šé¢ä¸€æ ·çš„é—®é¢˜ï¼Œå¤šå±‚æ³›åž‹ç”¨èµ·æ¥å¾ˆéº»çƒ¦ æˆ‘ä»¬ä¾ç„¶å¯ä»¥ä½¿ç”¨ typealias + æ‰©å±•å‡½æ•°æ¥ä¼˜é›…çš„å¤„ç†è¯¥é—®é¢˜ demo æˆªå›¾ Demodemo åœ¨è¿™ï¼Œå¦‚æžœæ„Ÿè§‰è¿™ä¸ªæ€è·¯å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œç‚¹ä¸€é¢—å°æ˜Ÿæ˜Ÿå§ï½ž ðŸ˜‰ å¦å¤–æˆ‘è¿˜å°†å®ƒä¼ åˆ°äº† JitPack ä¸Šï¼Œå¼•å…¥å§¿åŠ¿å¦‚ä¸‹ï¼š åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ build.gradle åŠ å…¥ 123456allprojects &#123; repositories &#123; //... maven &#123; url 'https://jitpack.io' &#125; &#125;&#125; æ·»åŠ ä¾èµ– 123dependencies &#123; implementation 'com.github.Flywith24:WrapperLiveData:$version'&#125; å¾€æœŸæ–‡ç« è¯¥ç³»åˆ—ä¸»è¦ä»‹ç»ä¸€äº›ã€Œéªšæ“ä½œã€ï¼Œå®ƒæœªå¿…é€‚åˆç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨ï¼Œä½†æ˜¯æ˜¯ä¸€äº›æ¯”è¾ƒæ–°é¢–çš„æ€è·¯ ã€å¥‡æŠ€æ·«å·§ã€‘AndroidStudio Nexus3.xæ­å»ºMavenç§æœé‡åˆ°é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ ã€å¥‡æŠ€æ·«å·§ã€‘ä»€ä¹ˆï¼Ÿé¡¹ç›®é‡Œgradleä»£ç è¶…è¿‡200è¡Œäº†ï¼ä½ å¯èƒ½éœ€è¦ Kotlin+buildSrc Plugin ã€å¥‡æŠ€æ·«å·§ã€‘gradleä¾èµ–æŸ¥æ‰¾å¤ªéº»çƒ¦ï¼Ÿè¿™ä¸ªæ’ä»¶å¯èƒ½å¸®åˆ°ä½  ã€å¥‡æŠ€æ·«å·§ã€‘Androidç»„ä»¶åŒ–ä¸ä½¿ç”¨ Router å¦‚ä½•å®žçŽ°ç»„ä»¶é—´ activity è·³è½¬ ã€å¥‡æŠ€æ·«å·§ã€‘æ–°çš„å›¾ç‰‡åŠ è½½åº“ï¼ŸåŸºäºŽKotlinåç¨‹çš„å›¾ç‰‡åŠ è½½åº“â€”â€”Coil ã€å¥‡æŠ€æ·«å·§ã€‘ä½¿ç”¨ Navigation + Dynamic Feature Module å®žçŽ°æ¨¡å—åŒ– ã€å¥‡æŠ€æ·«å·§ã€‘é™¤äº† buildSrc è¿˜èƒ½è¿™æ ·ç»Ÿä¸€é…ç½®ä¾èµ–ç‰ˆæœ¬ï¼Ÿå·§ç”¨ includeBuild æˆ‘çš„å…¶ä»–ç³»åˆ—æ–‡ç«  åœ¨è¿™é‡Œ å…³äºŽæˆ‘æˆ‘æ˜¯ Flywith24ï¼Œæˆ‘çš„åšå®¢å†…å®¹å·²ç»åˆ†ç±»æ•´ç† åœ¨è¿™é‡Œï¼Œç‚¹å‡»å³ä¸Šè§’çš„ Watch å¯ä»¥åŠæ—¶èŽ·å–æˆ‘çš„æ–‡ç« æ›´æ–°å“¦ ðŸ˜‰ æŽ˜é‡‘ ç®€ä¹¦ Github]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Tips</tag>
        <tag>å¥‡æŠ€æ·«å·§</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€å¥‡æŠ€æ·«å·§ã€‘é™¤äº† buildSrc è¿˜èƒ½è¿™æ ·ç»Ÿä¸€é…ç½®ä¾èµ–ç‰ˆæœ¬ï¼Ÿå·§ç”¨ includeBuild]]></title>
    <url>%2F2020%2F04%2F15%2FTips-includeBuild%2F</url>
    <content type="text"><![CDATA[buildSrc çš„ç¼ºé™·Android å¼€å‘ä¸­ç»Ÿä¸€ä¸åŒ module çš„ä¾èµ–ç‰ˆæœ¬ååˆ†é‡è¦ï¼Œä¼ ç»Ÿçš„æ–¹å¼æ˜¯ä½¿ç”¨ ext çš„æ–¹å¼ ä¹‹å‰æˆ‘å‘è¿‡å…³äºŽä½¿ç”¨ buildSrc ç®€åŒ–é¡¹ç›®ä¸­ gradle ä»£ç çš„è¯‘æ–‡ï¼šä»€ä¹ˆï¼Ÿé¡¹ç›®é‡Œgradleä»£ç è¶…è¿‡200è¡Œäº†ï¼ä½ å¯èƒ½éœ€è¦ Kotlin+buildSrc Plugin è¯¥ç§æ–¹å¼å¯ä»¥å¾ˆå¥½çš„ç®¡ç† gradle çš„å…¬å…±é…ç½®ï¼Œè¿™å…¶ä¸­å½“ç„¶åŒ…æ‹¬ä¾èµ–ç‰ˆæœ¬ å¦‚å›¾ï¼Œåœ¨ä½¿ç”¨ä¾èµ–æ—¶æœ‰ä»£ç æç¤ºï¼Œè€Œä¸”å¯ä»¥ç‚¹å‡»è¿›å…¥æŸ¥çœ‹ ä½†æ˜¯ç”±äºŽ buildSrc æ˜¯å¯¹å…¨å±€çš„æ‰€æœ‰ module çš„é…ç½®ï¼Œå› æ­¤åœ¨æž„å»ºé€Ÿåº¦ä¸Šä¼šæ…¢ä¸€äº›ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ä¸ªæ›´çº¯å‡€çš„æ–¹å¼æ¥é…ç½®ä¾èµ–ç‰ˆæœ¬å‘¢ï¼Ÿ ä»Šå¤©æˆ‘ä»¬æ¥ä»‹ç»ä¸€ç§æ–°çš„æ–¹å¼ è‡ªå®šä¹‰ plugin + includeBuildä½¿ç”¨ Gradle Composite builds å¯ä»¥å¾ˆå®¹æ˜“è§£å†³è¿™ä¸€é—®é¢˜ æˆ‘ä»¬æ–°å»ºä¸€ä¸ª moduleï¼Œå‘½åä¸º version ï¼Œå¹¶å°†åŽŸæ¥çš„ buildSrc çš„ä»£ç è½¬ç§»è¿‡æ¥ 12345class DependencyVersionPlugin : Plugin&lt;Project&gt; &#123; override fun apply(project: Project) &#123; &#125;&#125; åœ¨ version çš„ build.gradle æ–‡ä»¶åŠ å…¥ 12345678gradlePlugin &#123; plugins &#123; version &#123; id = 'com.flywith24.version' implementationClass = 'com.flywith24.version.DependencyVersionPlugin' &#125; &#125;&#125; åœ¨ settings.gradle åŠ å…¥ includeBuild(&quot;version&quot;) ï¼ˆé‡ç‚¹ï¼‰ 12345includeBuild("version")rootProject.name='VersionControlDemo'include ':app'include ':lib' æŽ¥ä¸‹æ¥åœ¨éœ€è¦å¼•ç”¨çš„ module ä¸­å¼•å…¥è¯¥æ’ä»¶ 123plugins &#123; id "com.flywith24.version"&#125; ä¹‹åŽæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨äº† Demo demo åœ¨è¿™ å¾€æœŸæ–‡ç« è¯¥ç³»åˆ—ä¸»è¦ä»‹ç»ä¸€äº›ã€Œéªšæ“ä½œã€ï¼Œå®ƒæœªå¿…é€‚åˆç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨ï¼Œä½†æ˜¯æ˜¯ä¸€äº›æ¯”è¾ƒæ–°é¢–çš„æ€è·¯ ã€å¥‡æŠ€æ·«å·§ã€‘AndroidStudio Nexus3.xæ­å»ºMavenç§æœé‡åˆ°é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ ã€å¥‡æŠ€æ·«å·§ã€‘ä»€ä¹ˆï¼Ÿé¡¹ç›®é‡Œgradleä»£ç è¶…è¿‡200è¡Œäº†ï¼ä½ å¯èƒ½éœ€è¦ Kotlin+buildSrc Plugin ã€å¥‡æŠ€æ·«å·§ã€‘gradleä¾èµ–æŸ¥æ‰¾å¤ªéº»çƒ¦ï¼Ÿè¿™ä¸ªæ’ä»¶å¯èƒ½å¸®åˆ°ä½  ã€å¥‡æŠ€æ·«å·§ã€‘Androidç»„ä»¶åŒ–ä¸ä½¿ç”¨ Router å¦‚ä½•å®žçŽ°ç»„ä»¶é—´ activity è·³è½¬ ã€å¥‡æŠ€æ·«å·§ã€‘æ–°çš„å›¾ç‰‡åŠ è½½åº“ï¼ŸåŸºäºŽKotlinåç¨‹çš„å›¾ç‰‡åŠ è½½åº“â€”â€”Coil ã€å¥‡æŠ€æ·«å·§ã€‘ä½¿ç”¨ Navigation + Dynamic Feature Module å®žçŽ°æ¨¡å—åŒ– æˆ‘çš„å…¶ä»–ç³»åˆ—æ–‡ç«  åœ¨è¿™é‡Œ å…³äºŽæˆ‘æˆ‘æ˜¯ Flywith24ï¼Œæˆ‘çš„åšå®¢å†…å®¹å·²ç»åˆ†ç±»æ•´ç† åœ¨è¿™é‡Œï¼Œç‚¹å‡»å³ä¸Šè§’çš„ Watch å¯ä»¥åŠæ—¶èŽ·å–æˆ‘çš„æ–‡ç« æ›´æ–°å“¦ ðŸ˜‰ æŽ˜é‡‘ å°ä¸“æ  Github]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Tips</tag>
        <tag>å¥‡æŠ€æ·«å·§</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€å¥‡æŠ€æ·«å·§ã€‘Androidç»„ä»¶åŒ–ä¸ä½¿ç”¨ Router å¦‚ä½•å®žçŽ°ç»„ä»¶é—´ activity è·³è½¬]]></title>
    <url>%2F2020%2F04%2F15%2FTips-Components-Jump%2F</url>
    <content type="text"><![CDATA[å‰è¨€è¶Šæ¥è¶Šå¤šçš„é¡¹ç›®ä½¿ç”¨äº†ç»„ä»¶åŒ–ï¼Œç»„ä»¶ä¹‹é—´çš„é€šä¿¡æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„é—®é¢˜ã€‚ARouter ç­‰è·¯ç”±æ–¹æ¡ˆä¸ºæˆ‘ä»¬æä¾›äº†è§£å†³åŠžæ³•ã€‚é‚£ä¹ˆå¦‚æžœä¸ä½¿ç”¨ Router å¦‚ä½•å®žçŽ°ç»„ä»¶é—´çš„ç•Œé¢è·³è½¬å‘¢ï¼Ÿ ä¸‡èƒ½çš„ setClassNameä»Žä¸€ä¸ª Activity è·³è½¬åˆ°å¦ä¸€ä¸ªActivity çš„æœ€ç›´æŽ¥æ–¹æ³•å¦‚ä¸‹ï¼š 12val intent = Intent(this, TestActivity::class.java)startActivity(intent) ä½†æ˜¯ï¼Œé‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œå½“åŽŸ activity ä½äºŽä¸€ä¸ª moduleï¼ˆä¾‹å¦‚ FeatureA ï¼‰ä¸­ï¼Œè€Œç›®æ ‡ activity ä½äºŽå¦ä¸€ä¸ª moduleï¼ˆFeatureBï¼‰ä¸­æ—¶ï¼Œè¯¥æ€Žä¹ˆåŠžï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Intent çš„ setClassName æ–¹æ³• 123val intent = Intent()intent.setClassName(this, â€œcom.flywith24.demo.TestActivityâ€)startActivity(intent) ä½†æ˜¯è¿™ç§æ–¹å¼ç¡¬ç¼–ç ç›®æ ‡ activity çš„å®Œæ•´ç±»åï¼Œå¦‚æžœ activity çš„ç±»åè¢«æ›´æ”¹æˆ–è€…ç§»åŠ¨ï¼Œè€Œä¸”æ²¡æœ‰æ›´æ”¹ç¡¬ç¼–ç ï¼Œåˆ™ç¼–è¯‘å¯ä»¥é€šè¿‡ï¼Œä½†æ˜¯è¿è¡Œæ—¶å´©æºƒ å¦‚æžœå¯ä»¥è‡ªåŠ¨ç”Ÿæˆ activity å®Œæ•´ç±»åå°±å¥½äº† ä½¿ç”¨æ’ä»¶æˆ‘ä»¬çŸ¥é“ activity ä½œä¸º Android çš„ç»„ä»¶ä¹‹ä¸€éœ€è¦åœ¨ Manifest æ–‡ä»¶ä¸­å£°æ˜Ž 123&lt;activity android:name=â€com.flywith24.demo.MainActivityâ€ /&gt;&lt;activity android:name=â€com.flywith24.demo.TestActivityâ€ /&gt; å¦‚æžœæˆ‘ä»¬çš„æ•°æ®æ˜¯ä»Ž Manifest ä¸­èŽ·å¾—çš„ï¼Œé‚£ä¹ˆå°±è§£å†³äº†ç¡¬ç¼–ç çš„é—®é¢˜äº† æœ‰è¿™æ ·ä¸€ä¸ªæ’ä»¶ ï¼Œåœ¨ build æ—¶ä¼šå°†æ‰€æœ‰åœ¨ Manifest ä¸­å£°æ˜Žçš„ activity çš„å®Œæ•´ç±»åä»¥é™æ€å¸¸é‡çš„å½¢å¼ç½—åˆ—åˆ°ä¸€ä¸ªé™æ€ç±»ä¸­ 12345678object QuadrantConstants &#123; const val MAIN_ACTIVITY: String = "com.gaelmarhic.quadrant.MainActivity" const val SECONDARY_ACTIVITY: String = "com.gaelmarhic.quadrant.SecondaryActivity" const val TERTIARY_ACTIVITY: String = "com.gaelmarhic.quadrant.TertiaryActivity"&#125; è¿™æ ·åœ¨ä½¿ç”¨æ—¶å°±é¿å…äº†ç¡¬ç¼–ç  123val intent = Intent()intent.setClassName(context, QuadrantConstants.MAIN_ACTIVITY)startActivity(intent) ä½¿ç”¨ä¾èµ–æ³¨å…¥ç»„ä»¶åŒ–ä¸­ app module ä¼šä¾èµ–æ‰€æœ‰çš„åŠŸèƒ½ module ï¼Œå› æ­¤å¦‚æžœæˆ‘ä»¬ä½¿ç”¨ä¾èµ–æ³¨å…¥åœ¨ app ä¸­å°†æ‰€æœ‰çš„ç›®æ ‡ activity çš„å®Œæ•´ç±»åå£°æ˜Žå‡ºæ¥ï¼Œä¹Ÿèƒ½è¾¾åˆ°è§£å†³ç¡¬ç¼–ç çš„é—®é¢˜ è¿™é‡Œä»¥ koin ä¸ºä¾‹ 12345678910111213class MyApplication : Application() &#123; val myModule = module &#123; single &#123; Feature2Activity::class.java.name &#125; &#125; override fun onCreate() &#123; super.onCreate() startKoin &#123; androidContext(this@MyApplication) modules(myModule) &#125; &#125;&#125; è¿™æ ·é€šè¿‡ get() æ–¹æ³•å³å¯æ‹¿åˆ° Feature2Activity çš„å®Œæ•´ç±»å 1234val intent = Intent() .setClassName(this@Feature1Activity, get()) .putExtra("key", "value")startActivity(intent) DemoDemo åœ°å€ å„ä½æœ‰ä»€ä¹ˆæƒ³æ³•æ¬¢è¿Žåœ¨è¯„è®ºåŒºç•™è¨€ å…³äºŽæˆ‘æˆ‘æ˜¯ Flywith24ï¼Œæˆ‘çš„åšå®¢å†…å®¹å·²ç»åˆ†ç±»æ•´ç† åœ¨è¿™é‡Œï¼Œç‚¹å‡»å³ä¸Šè§’çš„ Watch å¯ä»¥åŠæ—¶èŽ·å–æˆ‘çš„æ–‡ç« æ›´æ–°å“¦ ðŸ˜‰ æŽ˜é‡‘ å°ä¸“æ  Github]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Tips</tag>
        <tag>å¥‡æŠ€æ·«å·§</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€èƒŒä¸ŠJetpackä¹‹DataBindingã€‘æ•°æ®é©±åŠ¨é­”æ³•å¸ˆ ä½•æ—¶è¿Žæ¥ç¿»èº«æ—¥ï¼Ÿ]]></title>
    <url>%2F2020%2F04%2F09%2FJetpack-DataBinding%2F</url>
    <content type="text"><![CDATA[LiveData ç¯‡ æˆ‘ä»¬æåˆ° Android å¼€å‘çš„ä¸»è¦å·¥ä½œå†…å®¹æ˜¯å°†æ•°æ®è½¬æ¢ä¸º UI ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿä»‹ç»äº†æ•°æ®é©±åŠ¨ UI çš„æ€æƒ³ï¼Œä½¿ç”¨ ViewModel + LiveDataï¼Œå¯ä»¥å®‰å…¨åœ°åœ¨è®¢é˜…è€…çš„ç”Ÿå‘½å‘¨æœŸå†…åˆ†å‘æ­£ç¡®çš„æ•°æ®ã€‚ä½†æ˜¯ activity å’Œ fragment å……æ–¥ç€å¤§é‡çš„æ¨¡æ¿ä»£ç ï¼Œé“ºå¤©ç›–åœ°çš„ findViewByIdï¼Œä»¥åŠå„ç§ set ï¼ˆæ ¹æ®æ•°æ®è®¾ç½® UIï¼‰ã€‚å¦‚æžœèƒ½å¤Ÿæ¶ˆç­æŽ‰è¿™äº›æ¨¡æ¿ä»£ç å°±å¥½äº† ä»–æ¥äº†ä»–æ¥äº†ï¼Œä»–æ¬¢å¿«åœ°èµ°æ¥äº† ç„¶è€Œï¼Œå¾ˆå¤šå¼€å‘è€…å¯¹ DataBinding å­˜åœ¨åè§ï¼Œã€ŒDataBinding ä¸æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œåœ¨å£°æ˜Žå¼ç¼–ç¨‹ä¸­ä¹¦å†™ UI é€»è¾‘ï¼Œæ—¢ä¸å¯è°ƒè¯•ï¼Œä¹Ÿä¸ä¾¿äºŽå¯Ÿè§‰å’Œè¿½è¸ªï¼Œä¸‡ä¸€å‡ºçŽ°é—®é¢˜å°±éº»çƒ¦äº†ã€‚ã€ æœ¬æ–‡ä¸»è¦ä»‹ç» DataBinding çš„è§£å†³çš„é—®é¢˜ä»¥åŠå…¶èƒŒåŽçš„é€»è¾‘ï¼Œå¸¦æ‚¨å¯¹ DataBinding æœ‰ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯†ã€‚æœ¬æ–‡æœ«å°¾ä¼šå¯¹å„ä¸ª findViewById çš„æ›¿ä»£æ–¹æ¡ˆè¿›è¡Œå¯¹æ¯” DataBinding çš„ç›¸å…³èµ„æº å®˜æ–¹æ–‡æ¡£ codelab å®˜æ–¹ç¤ºä¾‹ æ•°æ®é©±åŠ¨é­”æ³•å¸ˆ DataBinding å…è®¸ä½¿ç”¨å£°æ˜Žæ€§æ ¼å¼è€Œä¸æ˜¯é€šè¿‡ç¼–ç¨‹æ–¹å¼å°†å¸ƒå±€ä¸­çš„ UI ç»„ä»¶ä¸Žæ•°æ®æºç»‘å®š 123// beforeTextView textView = findViewById(R.id.sample_text);textView.setText(viewModel.getUserName()); 12&lt;TextView android:text="@&#123;viewmodel.userName&#125;" /&gt; é€šè¿‡åœ¨å¸ƒå±€æ–‡ä»¶ä¸­ç»‘å®šç»„ä»¶ï¼Œæ‚¨å¯ä»¥åˆ é™¤ activity ä¸­çš„è®¸å¤šè®¾ç½® UI è°ƒç”¨ï¼Œä»Žè€Œä½¿å®ƒä»¬æ›´æ˜“äºŽç»´æŠ¤ã€‚ è¿™ä¹Ÿå¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå¹¶æœ‰åŠ©äºŽé˜²æ­¢å†…å­˜æ³„æ¼å’Œç©ºæŒ‡é’ˆå¼‚å¸¸ å¦‚æžœä»…æ›¿æ¢ findViewById è€Œä¸éœ€è¦æ•°æ®çš„ç»‘å®šï¼Œå¯ä»¥ä½¿ç”¨ ViewBindingï¼Œå®ƒä½¿ç”¨èµ·æ¥æ›´ç®€å•ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚ ä½¿ç”¨æ–¹æ³•å‚è§ [è¯‘]æ·±å…¥ç ”ç©¶ViewBinding åœ¨ include, merge, adapter, fragment, activity ä¸­ä½¿ç”¨ DataBinding åŸºç¡€ è¯¦ç»†å†…å®¹å‚è§ å®˜æ–¹æ–‡æ¡£ ï¼Œè¿™é‡Œåªç®€å•ä»‹ç» DataBinding DataBinding å¼•å…¥app build.gradle ä¸­åŠ å…¥ 1234567891011121314android &#123; ... dataBinding &#123; enabled = true &#125;&#125;// Android Studio 4.0android &#123; ... buildFeatures &#123; dataBinding = true &#125;&#125; å¿…é¡»åœ¨ app module ä¸­å£°æ˜Žï¼Œå£°æ˜ŽåŽå…¶ä»–å­ module å¯ç›´æŽ¥ä½¿ç”¨ DataBinding ä½¿ç”¨ DataBinding æ— éœ€å¼€å‘è€…æ‰‹åŠ¨å¼•å…¥åº“ï¼Œandroid build gradle plugin å†…éƒ¨å·²ç»å¼•å…¥äº† DataBinding ä¸­ä½¿ç”¨äº†æ³¨è§£ï¼Œå› æ­¤åœ¨æž„å»ºé€Ÿåº¦ä¸Šæ¯” ViewBinding å·®äº›ï¼ˆä¸è¿‡åŠŸèƒ½è¿™ä¹ˆå¼ºå¤§è¦å•¥è‡ªè¡Œè½¦ï¼‰ å¸ƒå±€DataBinding å¸ƒå±€æ–‡ä»¶ç•¥æœ‰ä¸åŒï¼Œå®ƒä»¬ä»¥ layout çš„æ ¹æ ‡è®°å¼€å§‹ï¼ŒåŽè·Ÿä¸€ä¸ª data å…ƒç´ å’Œä¸€ä¸ª view æ ¹å…ƒç´ ã€‚ view å…ƒç´ æ˜¯æ‚¨çš„æ ¹å°†ä½äºŽéžç»‘å®šå¸ƒå±€æ–‡ä»¶ä¸­çš„å…ƒç´ ã€‚ ä»¥ä¸‹ä»£ç æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹å¸ƒå±€æ–‡ä»¶ï¼š 123456789&lt;layout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/apk/res-auto"&gt; &lt;data&gt; &lt;variable name="viewmodel" type="com.myapp.data.ViewModel" /&gt; &lt;/data&gt; &lt;ConstraintLayout... /&gt; &lt;!-- UI layout's root element --&gt;&lt;/layout&gt; ç”Ÿæˆç»‘å®šç±»DataBinding ä¼šä¸ºæ¯ä¸ªåœ¨å¸ƒå±€å£°æ˜Ž layout æ ‡ç­¾çš„ xml å¸ƒå±€æ–‡ä»¶ç”Ÿæˆä¸€ä¸ªç»‘å®šç±»ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œç±»çš„åç§°åŸºäºŽå¸ƒå±€æ–‡ä»¶çš„åç§°ã€‚ ä¸Šé¢çš„å¸ƒå±€æ–‡ä»¶åæ˜¯ activity_main.xmlï¼Œå› æ­¤ç›¸åº”çš„ç”Ÿæˆç±»æ˜¯ ActivityMainBindingã€‚ æ­¤ç±»åŒ…å«ä»Žå¸ƒå±€å±žæ€§ï¼ˆä¾‹å¦‚ï¼Œviewmodel å˜é‡ï¼‰åˆ°å¸ƒå±€è§†å›¾çš„æ‰€æœ‰ç»‘å®šï¼Œå¹¶ä¸”çŸ¥é“å¦‚ä½•ä¸ºç»‘å®šè¡¨è¾¾å¼åˆ†é…å€¼ é…ç½®ç»‘å®š12345678910@Overrideprotected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); // before // setContentView(R.layout.activity_main) // after val binding : ActivityMainBinding = DataBindingUtil.setContentView(this, R.layout.activity_main)&#125; ä½¿ç”¨DataBinding è§£å†³çš„é—®é¢˜åŠå®žçŽ°åŽŸç† ä¸çŸ¥é“ä½ æ˜¯å¦æœ‰è¿™äº›çƒ¦æ¼ï¼šactivity å’Œ fragment ä¸­æœ‰ç€å¤§é‡çš„æ¨¡æ¿ä»£ç ï¼Œå³ä½¿ä½¿ç”¨ ButterKnife ç­‰å·¥å…·å†™èµ·ä»£ç æ¥ä¹Ÿå¾ˆç¹çã€‚è€Œä¸” View id ä¸Ž View çš„ç±»åž‹ä¸åŒ¹é…æ—¶ï¼Œåªæœ‰åœ¨è¿è¡ŒæœŸæ‰èƒ½å‘çŽ°ï¼›æ—‹è½¬å±å¹•åŽå¦‚æžœæ–°çš„å¸ƒå±€ä¸­ä¸å­˜åœ¨ä¹‹å‰ id çš„ view ï¼Œå¯èƒ½è¿˜å¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›é¡¹ç›®ä¸­ä½¿ç”¨å„ç±» bus é€šçŸ¥ UI åˆ·æ–°ï¼Œä½†æ˜¯æœ‰æ—¶ UI çš„æ˜¾ç¤ºå¹¶ä¸ç¬¦åˆé¢„æœŸï¼Œè€ŒæŽ’æŸ¥èµ·æ¥ç‰¹åˆ«å›°éš¾ï¼Œå› ä¸ºæ•°æ®æºå¾ˆå¤šâ€¦ ä¸è¦æ…Œï¼ŒDataBinding å¯ä»¥è§£å†³ä»¥ä¸‹é—®é¢˜ æ›¿æ¢ findViewById ï¼Œå‡å°‘æ¨¡æ¿ä»£ç  è§£å†³ç±»åž‹å®‰å…¨é—®é¢˜ è§£å†³ç©ºå®‰å…¨é—®é¢˜ ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ é­”æ³•çš„èƒŒåŽcom.android.tools.build:gradle æ’ä»¶ä¸­å°è£…äº† DataBinding çš„é­”æ³• æŸ¥çœ‹ com.android.tools.build:gradle:3.6.2 çš„æºç ï¼Œæ‰¾åˆ° DataBinding é…ç½®é¡¹çš„ç±» DataBindingOptions 123456// DataBindingOptions.java@Overridepublic boolean isEnabled() &#123; // DataBinding æ˜¯å¦å¼€å¯ï¼Œå¯¹åº”ä¸Šé¢åœ¨ build.gradle ä¸­çš„é…ç½® return enabled;&#125; å®ƒçš„è°ƒç”¨è€…å¾ˆå¤šï¼Œåœ¨ TaskManager ä¸­çš„ createDataBindingTasksIfNecessary 12345678910111213141516171819202122232425// TaskManager protected void createDataBindingTasksIfNecessary(@NonNull VariantScope scope) &#123; // æ˜¯å¦å¼€å¯ DataBinding boolean dataBindingEnabled = extension.getDataBinding().isEnabled(); boolean viewBindingEnabled = extension.getViewBinding().isEnabled(); if (!dataBindingEnabled &amp;&amp; !viewBindingEnabled) &#123; // DataBinding å’Œ ViewBinding å‡æœªå¼€å¯åˆ™ç›´æŽ¥ return return; &#125; createDataBindingMergeBaseClassesTask(scope); createDataBindingMergeArtifactsTask(scope); //... // æž„å»º DataBinding ç›¸åº”ç»‘å®šç±» taskFactory.register(new DataBindingGenBaseClassesTask.CreationAction(scope));&#125;// CreationActionoverride fun handleProvider(taskProvider: TaskProvider&lt;out DataBindingGenBaseClassesTask&gt;) &#123; variantScope.artifacts.producesDir( // DATA_BINDING_BASE_CLASS_SOURCE_OUT InternalArtifactType.DATA_BINDING_BASE_CLASS_SOURCE_OUT, BuildArtifactsHolder.OperationType.INITIAL, taskProvider, DataBindingGenBaseClassesTask::sourceOutFolder )&#125; å¯ä»¥çœ‹åˆ°ç”Ÿæˆ DataBinding ç»‘å®šç±»çš„ task ä¸º DataBindingGenBaseClassesTaskï¼Œè€ŒInternalArtifactType.DATA_BINDING_BASE_CLASS_SOURCE_OUT åˆ™å¯¹åº”ç€ build ç›®å½•ç”Ÿæˆçš„ DataBinding ç±»çš„ data_binding_base_class_source_out ç›®å½• è¿™é‡Œå¯ä»¥ç®€å•çœ‹ä¸€ä¸‹ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªå·±æŸ¥çœ‹æºç  DataBinding å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜çš„æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ DataBinding ç”Ÿæˆçš„ç»‘å®šç±» 1234567891011121314151617181920212223public final class FragmentSingleChildBinding implements ViewBinding &#123; // NonNull æ³¨è§£æ ‡è®° // å¦‚æžœå­˜åœ¨ä¸åŒé…ç½®çš„ä¸åŒå¸ƒå±€æ–‡ä»¶ï¼ˆå¦‚æ¨ªç«–å±ï¼‰ä¸”è¯¥æŽ§ä»¶ä¸æ˜¯å­˜åœ¨äºŽæ‰€æœ‰å¸ƒå±€ï¼Œè¯¥å¤„ä½¿ç”¨ Nullableæ³¨è§£æ ‡è®° @NonNull public final MaterialButton button; // çœç•¥... @NonNull public static FragmentSingleChildBinding bind(@NonNull View rootView) &#123; String missingId; missingId: &#123; //å…¶å†…éƒ¨ä¹Ÿæ˜¯ä½¿ç”¨ findViewById MaterialButton button = rootView.findViewById(R.id.button); if (button == null) &#123; missingId = "button"; break missingId; &#125; return new FragmentSingleChildBinding((MaterialButton) rootView, button); &#125; throw new NullPointerException("Missing required view with ID: ".concat(missingId)); &#125;&#125; Binding ç±»å†…éƒ¨çš„ä¹Ÿæ˜¯ä½¿ç”¨ findViewById ï¼Œå› æ­¤ DataBinding å¯ä»¥ä»£æ›¿ findViewById ï¼Œå¹¶ä¸”å‡å°‘æ¨¡æ¿ä»£ç  View æŽ§ä»¶å˜é‡ç±»åž‹æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ä¸ä¼šå‡ºçŽ°ç±»åž‹å®‰å…¨é—®é¢˜ View æŽ§ä»¶å˜é‡ç”±ç©º/éžç©ºæ³¨è§£ä¿®é¥°ï¼Œï¼ˆå¦‚æžœä¸º Nullable java ä¸­ä¼šæœ‰ lint è­¦å‘Šï¼Œè€Œ kotlin ç›´æŽ¥è°ƒç”¨æ—¶æ— æ³•é€šè¿‡ç¼–è¯‘çš„ï¼‰å› æ­¤ ä¸ä¼šå‡ºçŽ°ç©ºå®‰å…¨é—®é¢˜ é€šè¿‡å£°æ˜Žå¼çš„é…ç½®ï¼ŒUI å®Œå…¨æ¥è‡ªå”¯ä¸€å¯ä¿¡çš„æ•°æ®æºé…ç½®ï¼Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ æ³¨æ„ï¼šä»¥ä¸Šåˆ†æžåŒæ ·é€‚ç”¨äºŽ ViewBinding æ„Ÿå—é­”æ³•çš„é­…åŠ› è¿™é‡Œç®€å•å±•ç¤ºä¸€ä¸‹ DataBinding çš„ã€Œé­”æ³•ã€ åŸºæœ¬æ“ä½œ123456789101112131415161718192021&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;layout xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;data&gt; &lt;/data&gt; &lt;LinearLayout android:orientation="vertical" android:layout_width="match_parent" android:layout_height="match_parent"&gt; &lt;TextView android:id="@+id/firstName" android:layout_width="wrap_content" android:layout_height="wrap_content" /&gt; &lt;TextView android:id="@+id/lastName" android:layout_width="wrap_content" android:layout_height="wrap_content" /&gt; &lt;/LinearLayout&gt;&lt;/layout&gt; 1234567891011121314151617181920212223public class MainActivity extends AppCompatActivity &#123; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); // Before Data Binding //setContentView(R.layout.activity_main); //TextView firstName = (TextView) findViewById(R.id.firstName); //TextView lastName = (TextView) findViewById(R.id.lastName); //firstName.setText("xxx"); //lastName.setText("xxx"); // After Data Binding ActivityMainBinding binding = DataBindingUtil.setContentView(this, R.layout.activity_main); binding.firstName.setText("xxx"); binding.lastName.setText("xxx"); &#125;&#125; ä¸Šé¢å±•ç¤ºäº† DataBinding çš„åŸºç¡€æ“ä½œï¼ˆå•çº¯çš„æ›¿æ¢ findViewByIdï¼‰ï¼Œå¦‚æžœä»…ä½¿ç”¨ DataBinding è¿™éƒ¨åˆ†åŠŸèƒ½ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ ViewBinding ç»‘å®šæ•°æ®åœ¨ä¹‹å‰çš„å¸ƒå±€çš„åŸºç¡€ä¸Šç»‘å®šæ•°æ® 123456789101112131415161718192021&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;layout xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;data&gt; &lt;variable name="user" type="com.example.User"/&gt; &lt;/data&gt; &lt;LinearLayout android:orientation="vertical" android:layout_width="match_parent" android:layout_height="match_parent"&gt; &lt;TextView android:id="@+id/firstName" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="@&#123;user.firstName&#125;"/&gt; &lt;TextView android:id="@+id/lastName" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="@&#123;user.lastName&#125;"/&gt; &lt;/LinearLayout&gt;&lt;/layout&gt; 123456789public class MainActivity extends AppCompatActivity &#123; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); ActivityMainBinding binding = DataBindingUtil.setContentView(this, R.layout.activity_main); binding.user = new User("xxx","xxx"); &#125;&#125; è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥ç”¨åœ¨ recyclerview adapter ä¸­ï¼Œadapter ä¸­çš„ä»£ç å¤§å¤§å‡å°‘ Binding Adapteræ‚¨å¯èƒ½ä¼šå¥½å¥‡é…ç½® android:text=&quot;@{user.firstName} åŽå†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆ DataBinding ä¸­ä½¿ç”¨ Binding Adapter æ¥å¤„ç†ï¼Œå®ƒä¸»è¦å¤„ç†ã€Œå±žæ€§ã€å’Œã€Œäº‹ä»¶ã€ï¼Œå‰è€…å¦‚ setText() ï¼ŒåŽè€…å¦‚ setOnClickListener()ã€‚ä¸Šé¢çš„ android:text å®žé™…ä¸Šè°ƒç”¨çš„æ˜¯ä¸‹é¢çš„æ–¹æ³• DataBinding ä¸­æä¾›äº†å¾ˆå¤š Binding Adapter å¦‚æžœå®˜æ–¹æä¾›çš„ Binding Adapter ä¸æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼Œæ‚¨è¿˜å¯ä»¥è‡ªå®šä¹‰ Binding Adapter 1234@BindingAdapter(&#123;"imageUrl", "error"&#125;)public static void loadImage(ImageView view, String url, Drawable error) &#123; Glide.with(view).load(url).error(error).into(view);&#125; 1&lt;ImageView app:imageUrl="@&#123;venue.imageUrl&#125;" app:error="@&#123;@drawable/venueError&#125;" /&gt; DadaBinding + LiveDataè¦å°† LiveData ä¸Ž DataBinding ä¸€èµ·ä½¿ç”¨ï¼Œéœ€è¦æŒ‡å®šç”Ÿå‘½å‘¨æœŸæ‰€æœ‰è€…æ¥å®šä¹‰ LiveData å¯¹è±¡çš„èŒƒå›´ 12345678class ViewModelActivity extends AppCompatActivity &#123; @Override protected void onCreate(Bundle savedInstanceState) &#123; UserBinding binding = DataBindingUtil.setContentView(this, R.layout.user); binding.setLifecycleOwner(this); &#125;&#125; åŒå‘ç»‘å®šä½¿ç”¨å•å‘ DataBindingï¼Œå¯ä»¥åœ¨å±žæ€§ä¸Šè®¾ç½®ä¸€ä¸ªå€¼ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªå¯¹è¯¥å±žæ€§çš„æ›´æ”¹åšå‡ºååº”çš„ç›‘å¬å™¨ï¼š 12345&lt;CheckBox android:id="@+id/rememberMeCheckBox" android:checked="@&#123;viewmodel.rememberMe&#125;" android:onCheckedChanged="@&#123;viewmodel.rememberMeChanged&#125;"/&gt; ä½¿ç”¨åŒå‘ç»‘å®šå¯ä»¥ç®€åŒ–è¯¥è¿‡ç¨‹ 1234&lt;CheckBox android:id="@+id/rememberMeCheckBox" android:checked="@=&#123;viewmodel.rememberMe&#125;"/&gt; ä½¿ç”¨ @={} æŽ¥æ”¶å¯¹è¯¥å±žæ€§çš„æ•°æ®æ›´æ”¹ï¼Œå¹¶åŒæ—¶ç›‘å¬ç”¨æˆ·æ›´æ–°ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œæœ‰ = ï¼‰ é‚£ä¹ˆç©¶ç«Ÿä»€ä¹ˆæ˜¯åŒå‘ç»‘å®šå‘¢ï¼Ÿ æ‰€è°“çš„ã€Œæ•°æ®é©±åŠ¨ã€å°±æ˜¯æ•°æ®é©±åŠ¨è§†å›¾çš„å˜åŒ–ï¼Œè€Œ DataBinding çš„å•å‘ç»‘å®šå°±æ˜¯å¦‚æ­¤ã€‚åè¿‡æ¥è®²ï¼Œæœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦è§†å›¾æ¥é©±åŠ¨æ•°æ®çš„å˜åŒ–ï¼ˆä¾‹å¦‚å½“æˆ‘ä»¬åœ¨ EditText ä¸Šè¾“å…¥äº†æ–‡å­—ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹åº”çš„ ViewModel çš„ LiveData çš„å€¼èƒ½å¤ŸåŠæ—¶å“åº”è¯¥å˜åŒ–ï¼‰ å¦‚å›¾ï¼Œç»¿è‰²éƒ¨åˆ†ä¸ºç‹¬ç«‹çš„ fragment ï¼Œå†…éƒ¨å­˜åœ¨ä¸¤ä¸ª TextViewï¼Œç”¨äºŽæ˜¾ç¤ºå¤–éƒ¨ fragment EditText è¾“å…¥çš„æ–‡å­— å¦‚æžœå®žçŽ°ä¸Šè¿°åŠŸèƒ½ï¼Œä¼ ç»Ÿåšæ³•å¯èƒ½æ˜¯ä½¿ç”¨ activity çº§åˆ«çš„ ViewModel è¿›è¡Œä¸¤ä¸ª fragment ä¹‹é—´çš„é€šä¿¡ï¼Œé€šè¿‡ç›‘å¬ EditText æ–‡å­—çš„å˜åŒ–æ”¹å˜ ViewModel ä¸­ LiveData çš„å€¼ï¼Œå¹¶åœ¨ç»¿è‰² fragment ä¸­è§‚å¯Ÿ LiveData å¹¶æ˜¾ç¤ºåˆ° TextView ä¸­ 123456789101112131415161718192021222324252627282930class NormalViewModel : ViewModel() &#123; val firstName = MutableLiveData&lt;String&gt;() val lastName = MutableLiveData&lt;String&gt;()&#125;class NormalDetailFragment : Fragment(R.layout.fragment_normal_detail) &#123; private val mViewModel by activityViewModels&lt;NormalViewModel&gt;() override fun onViewCreated(view: View, savedInstanceState: Bundle?) &#123; mViewModel.firstName.observe(viewLifecycleOwner) &#123; tvFirstName.text = it &#125; mViewModel.lastName.observe(viewLifecycleOwner) &#123; tvLastName.text = it &#125; &#125;&#125;class NormalFragment : Fragment(R.layout.fragment_normal) &#123; private val mViewModel by activityViewModels&lt;NormalViewModel&gt;() override fun onViewCreated(view: View, savedInstanceState: Bundle?) &#123; etFirstName.addTextChangedListener &#123; mViewModel.firstName.value = it.toString() &#125; etLastName.addTextChangedListener &#123; mViewModel.lastName.value = it.toString() &#125; &#125;&#125; å¾—ç›ŠäºŽ kotlin ï¼Œä¸Šé¢çš„ä»£ç ä»¥åŠå¾ˆç®€æ´äº†ï¼Œå¦‚æžœä½¿ç”¨ java ä»£ç ç‰‡æ®µåªä¼šæ›´é•¿ã€‚ ä¸è¿‡ä½¿ç”¨ DataBindingï¼Œè¿˜å¯ä»¥æ›´ç®€æ´ 123456&lt;com.google.android.material.textview.MaterialTextView android:id="@+id/tvFirstName" android:text="@&#123;vm.firstName&#125;"/&gt;&lt;com.google.android.material.textview.MaterialTextView android:id="@+id/tvLastName" android:text="@&#123;vm.lastName&#125;"/&gt; 123456&lt;com.google.android.material.textfield.TextInputEditText android:id="@+id/etFirstName" android:text="@=&#123;vm.firstName&#125;"/&gt;&lt;com.google.android.material.textfield.TextInputEditText android:id="@+id/etLastName" android:text="@=&#123;vm.lastName&#125;"/&gt; åªéœ€é…ç½®å¥½åŒå‘ç»‘å®šï¼ˆEditText é©±åŠ¨ ViewModel çš„ LiveData çš„å€¼å˜åŒ–ï¼ŒViewModel å†é©±åŠ¨ TextView æ˜¾ç¤ºæ•°æ®ï¼‰ï¼Œå¹¶åœ¨ fragment é€šè¿‡å›ºå®šçš„æ¨¡æ¿ä»£ç è®¾ç½®å¥½ ViewModel å³å¯ è¿™é‡Œçš„é­”æ³•è¿˜æ˜¯æ¥è‡ª Binding Adapter 12345678910111213141516171819202122232425262728293031323334353637383940414243// TextViewBindingAdapter.java@BindingAdapter(value = &#123;"android:beforeTextChanged", "android:onTextChanged", "android:afterTextChanged", "android:textAttrChanged"&#125;, requireAll = false)public static void setTextWatcher(TextView view, final BeforeTextChanged before, final OnTextChanged on, final AfterTextChanged after, final InverseBindingListener textAttrChanged) &#123; final TextWatcher newValue; if (before == null &amp;&amp; after == null &amp;&amp; on == null &amp;&amp; textAttrChanged == null) &#123; newValue = null; &#125; else &#123; newValue = new TextWatcher() &#123; @Override public void beforeTextChanged(CharSequence s, int start, int count, int after) &#123; if (before != null) &#123; before.beforeTextChanged(s, start, count, after); &#125; &#125; @Override public void onTextChanged(CharSequence s, int start, int before, int count) &#123; if (on != null) &#123; on.onTextChanged(s, start, before, count); &#125; if (textAttrChanged != null) &#123; //é€šçŸ¥å‘ç”Ÿå˜åŒ– textAttrChanged.onChange(); &#125; &#125; @Override public void afterTextChanged(Editable s) &#123; if (after != null) &#123; after.afterTextChanged(s); &#125; &#125; &#125;; &#125; final TextWatcher oldValue = ListenerUtil.trackListener(view, newValue, R.id.textWatcher); if (oldValue != null) &#123; view.removeTextChangedListener(oldValue); &#125; if (newValue != null) &#123; view.addTextChangedListener(newValue); &#125;&#125; è¿™é‡Œä½¿ç”¨ InverseBindingListener ï¼ˆè°ƒç”¨ textAttrChanged.onChange()ï¼‰æ¥é€šçŸ¥ LiveData æ•°æ®å‘ç”Ÿå˜åŒ– è€Œå˜åŒ–åŽçš„å€¼ é€šè¿‡ @InverseBindingAdapter æ³¨è§£æ ‡è®°çš„æ–¹æ³•å¤„ç†ï¼Œè¿™é‡Œçš„ event ä¸Žä¸Šé¢çš„æ ‡è®°åŒ¹é…ï¼ˆandroid:textAttrChangedï¼‰ 12345// TextViewBindingAdapter.java@InverseBindingAdapter(attribute = "android:text", event = "android:textAttrChanged")public static String getTextString(TextView view) &#123; return view.getText().toString();&#125; view å±‚å˜åŒ–é€šçŸ¥æ•°æ®å˜åŒ–ï¼Œæ•°æ®å˜åŒ–å†é€šçŸ¥ view å±‚å˜åŒ–ï¼Œä»¿ä½›æ˜¯ä¸ªå¥—å¨ƒ å› æ­¤é¿å…è¿™ç§æ­»å¾ªçŽ¯ååˆ†é‡è¦ï¼ŒsetText æ–¹æ³•åˆ¤æ–­äº†æ–°æ—§å€¼æ˜¯å¦ç›¸ç­‰æ¥é¿å…æ­»å¾ªçŽ¯ æ€»ç»“ DataBinding ä¸»è¦æä¾›ä¸¤éƒ¨åˆ†åŠŸèƒ½ æ›¿æ¢ findViewById ï¼Œå¦‚æžœåªç”¨è¿™éƒ¨åˆ†åŠŸèƒ½å¯ä»¥ä½¿ç”¨ ViewBinding è¿›è¡Œ data å’Œ UI çš„ç»‘å®šï¼Œä½¿ç”¨ã€Œæ•°æ®é©±åŠ¨ã€çš„æ€æƒ³è§£å†³äº†è§†å›¾çš„ä¸€è‡´æ€§é—®é¢˜ å„ç§ findViewById æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯” findViewById Butterknife Kotlin Synthetics Data Binding View Binding findViewById findViewById æœ‰ä¸¤ä¸ªé—®é¢˜ å½“ä¸èƒ½åœ¨ Activity/Fragment/ViewGroup ä¸­å®šä½åˆ°æŒ‡å®š id çš„ Viewï¼Œä¼šåœ¨è¿è¡ŒæœŸé—´å´©æºƒï¼Œå³éžç©ºå®‰å…¨ å¦‚æžœæŸä¸ª view ä¸º TextView ç±»åž‹ï¼Œè€Œåœ¨ä½¿ç”¨ä¸­å°†å…¶æŒ‡å®šä¸ºå…¶ä»–ç±»åž‹ä¸ä¼šåœ¨ç¼–è¯‘å™¨æŠ¥é”™ï¼Œå³éžç±»åž‹å®‰å…¨ åœ¨ compileSdk çš„ API çº§åˆ« 26 ä¸­ï¼Œå¯¹è¯¥æ–¹æ³•çš„å®šä¹‰ç¨ä½œæ›´æ”¹ä»¥æ¶ˆé™¤å¼ºåˆ¶ç±»åž‹è½¬æ¢é—®é¢˜ çŽ°åœ¨ï¼Œå¼€å‘äººå‘˜æ— éœ€åœ¨ä»£ç ä¸­æ‰‹åŠ¨è½¬æ¢ view ç±»åž‹ã€‚ å¦‚æžœæ‚¨å¼•ç”¨ id æŒ‡å‘ç±»åž‹ TextView çš„ View å¹¶å°†å…¶æŒ‡å®šä¸º Buttonï¼Œåˆ™ Android SDK ä¼šå°è¯•æŸ¥æ‰¾å…·æœ‰æä¾›çš„ id çš„ Buttonï¼Œå¹¶ä¸”å®ƒå°†è¿”å›ž Nullï¼Œå› ä¸ºå®ƒå°†æ— æ³•æ‰¾åˆ°å®ƒ ä½†æ˜¯åœ¨ Kotlin ä¸­ï¼Œæ‚¨ä»ç„¶éœ€è¦æä¾›è¯¸å¦‚ findViewById(R.id.txtUsername) ä¹‹ç±»çš„ç±»åž‹ã€‚ å¦‚æžœæ‚¨ä¸æ£€æŸ¥è§†å›¾æ˜¯å¦å…·æœ‰ null å®‰å…¨ï¼Œåˆ™å¯èƒ½å‡ºçŽ° NullPointerExceptionï¼Œä½†æ˜¯æ­¤æ–¹æ³•ä¸ä¼šåƒä»¥å‰é‚£æ ·æŠ›å‡ºClassCastException ButterknifeButterknife æ˜¯ Jake Wharton å¤§ç¥žå†™çš„æ›¿ä»£ findViewById çš„åº“ï¼Œè¯¥åº“ä½¿ç”¨æ³¨è§£å¤„ç†å¹¶ç”Ÿæˆ findViewById ä»£ç  å®ƒå…·æœ‰ä¸Ž findViewById å‡ ä¹Žç›¸ä¼¼çš„é—®é¢˜ã€‚ ä½†æ˜¯ï¼Œå®ƒåœ¨è¿è¡Œæ—¶æ·»åŠ äº†null å®‰å…¨æ£€æŸ¥ä»¥é¿å… NullPointerException ç”±äºŽ DataBinding å’Œ ViewBinding çš„å‡ºçŽ°ï¼Œæ²ƒç¥žå·²ç»å®£å¸ƒå¼ƒç”¨è¯¥åº“ Kotlin SyntheticsKotlin å¼•å…¥çš„æœ€å¤§åŠŸèƒ½ä¹‹ä¸€æ˜¯ Kotlin æ‰©å±•æ–¹æ³•ã€‚ åœ¨å®ƒçš„å¸®åŠ©ä¸‹ï¼ŒKotlin Synthetics è¯žç”Ÿäº†ã€‚ Kotlin Synthetics é€šè¿‡è‡ªåŠ¨ç”Ÿæˆçš„ Kotlin æ‰©å±•æ–¹æ³•ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥ä»Ž xml å¸ƒå±€ç›´æŽ¥è®¿é—®å…¶å†…éƒ¨çš„ view Kotlin Synthetics ç¬¬ä¸€æ¬¡è°ƒç”¨ findViewById æ–¹æ³•ï¼Œç„¶åŽé»˜è®¤æƒ…å†µä¸‹å°† view å®žä¾‹ç¼“å­˜åœ¨ HashMap ä¸­ã€‚ å¯ä»¥é€šè¿‡Gradle è®¾ç½®å°†æ­¤ç¼“å­˜é…ç½®æ›´æ”¹ä¸º SparseArray æˆ–ä¸ç¼“å­˜ æ€»ä½“è€Œè¨€ï¼ŒKotlin Synthetics æ˜¯ä¸€ç§å¾ˆå¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒç±»åž‹å®‰å…¨ï¼Œå¹¶ä¸”é€šè¿‡ Kotlin çš„ ï¼Ÿè¿›è¡Œç©ºæ£€æŸ¥ã€‚ å®ƒä¸éœ€è¦å¼€å‘äººå‘˜çš„é¢å¤–ä»£ç ã€‚ ä½†è¿™ä»…é€‚ç”¨äºŽ Kotlin é¡¹ç›® ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨ Kotlin Synthetics æ—¶é‡åˆ°äº†ä¸€ä¸ªå°é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œå¦‚æžœå°†å†…å®¹è§†å›¾è®¾ç½®ä¸ºå¸ƒå±€ï¼Œç„¶åŽä½¿ç”¨ä»…å­˜åœ¨äºŽå…¶ä»–å¸ƒå±€ä¸­çš„ id ï¼Œåˆ™ IDE å¯è®©æ‚¨è‡ªåŠ¨å®Œæˆå¹¶æ·»åŠ æ–°çš„ import è¯­å¥ã€‚ é™¤éžæ‚¨ä¸“é—¨æ£€æŸ¥ä»¥ç¡®ä¿å…¶ import è¯­å¥ä»…å¯¼å…¥æ­£ç¡®çš„ viewï¼Œå¦åˆ™æ²¡æœ‰å®‰å…¨çš„æ–¹æ³•æ¥éªŒè¯è¿™ä¸ä¼šå¯¼è‡´è¿è¡Œæ—¶é—®é¢˜ DataBindingDataBinding åœ¨åŠŸèƒ½ä¸Šæ¯”å…¶ä»–æ–¹æ³•ä¼˜è¶Šå¾—å¤šï¼Œå› ä¸ºå®ƒä¸ä»…ä¸ºæ‚¨æä¾›ç±»åž‹å®‰å…¨å’Œç©ºå®‰å…¨çš„ view å¼•ç”¨ï¼Œè€Œä¸”è¿˜å…è®¸æ‚¨ç›´æŽ¥åœ¨ xml å¸ƒå±€å†…ä½¿ç”¨æ•°æ®é©±åŠ¨è§†å›¾å˜åŒ– ViewBindingæœ€è¿‘åœ¨ Android Studio 3.6 ä¸­å¼•å…¥çš„ ViewBinding æ˜¯ DataBinding åº“çš„å­é›†ã€‚ ç”±äºŽä¸éœ€è¦æ³¨è§£å¤„ç†ï¼Œå› æ­¤å¯ä»¥ç¼©çŸ­æž„å»ºæ—¶é—´ã€‚è¯¦ç»†çš„ä½¿ç”¨å¯ä»¥å‚è§ è¿™ç¯‡æ–‡ç«  findViewById Butterknife Kotlin Synthetics DataBinding ViewBinding ä¸€ç›´ç©ºå®‰å…¨ âŒ éƒ¨åˆ† éƒ¨åˆ† âœ”ï¸ âœ”ï¸ ç±»åž‹å®‰å…¨ âŒ âŒ âœ”ï¸ âœ”ï¸ âœ”ï¸ æ ·æ¿ä»£ç  å¤š å°‘ å°‘ ä¸­ç­‰ å°‘ æž„å»ºæ—¶é—´ âœ”ï¸ âŒ âœ”ï¸ âŒ âœ”ï¸ æ”¯æŒè¯­éŸ³ java/kotlin java/kotlin kotlin java/kotlin java/kotlin å…³äºŽæˆ‘ æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Jetpackæ›´æ–°ä¹‹Recyclerviewã€‘æ›´ä¼˜é›…åœ°æ¢å¤ recyclerview çš„æ»šåŠ¨ä½ç½®]]></title>
    <url>%2F2020%2F04%2F09%2FJetpack-Recyclerview-Scoroll%2F</url>
    <content type="text"><![CDATA[è¢«æˆ‘å¿½è§†çš„æ›´æ–°androidx recyclerview 1.2.0-alpha02 ç‰ˆæœ¬æ·»åŠ äº†æ–°åŠŸèƒ½ MergeAdapterï¼Œå¸®åŠ©å¼€å‘è€…æ›´å®¹æ˜“åœ°ä¸º RecyclerView æ·»åŠ  Header å’Œ Footerã€‚è¯¦æƒ…å‚è§ ã€è¯‘ã€‘MergeAdapter çš„ä½¿ç”¨ ä½¿ç”¨å®˜æ–¹ API ä¸º Recyclerview æ·»åŠ  Header å’Œ Footer è¯¥ç‰ˆæœ¬ä¸­è¿˜æœ‰ä¸€ä¸ªæ”¹åŠ¨ï¼šRecyclerView.Adapter lazy state restorationï¼Œå¸®åŠ©å¼€å‘è€…æ¢å¤ RecyclerView çš„çŠ¶æ€ æˆ‘å¯¹è¿™ä¸ªåŠŸèƒ½å¹¶æ²¡æœ‰ä»€ä¹ˆæ„Ÿè§‰ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒAndroid ä¸­çš„ View å†…éƒ¨æ˜¯æœ‰ç€çŠ¶æ€ä¿å­˜å’Œæ¢å¤çš„æ–¹æ³•çš„ã€‚RecyclerView ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ƒå¯ä»¥æ¢å¤è‡ªèº«å·²æ»šåŠ¨çš„ä½ç½® æœ‰å…³çŠ¶æ€ä¿å­˜çš„å†…å®¹å¯ä»¥å‚è§ ã€èƒŒä¸ŠJetpackã€‘ç»ä¸ä¸¢å¤±çš„çŠ¶æ€ androidx SaveState ViewModel-SaveState åˆ†æž çœŸå®žæƒ…å†µä¹Ÿæ˜¯å¦‚æ­¤ æ„å¤–å‘çŽ°æœ€è¿‘çœ‹åˆ° Florina Muntenescu çš„ Restore RecyclerView scroll position ï¼Œå…¶ä¸­ä»‹ç»äº† RecyclerView.Adapter lazy state restorationï¼Œè¿™å‹¾èµ·äº†æˆ‘çš„å…´è¶£ å¦‚æ–‡ä¸­æè¿°ï¼ŒRecyclerView åœ¨ activity/fragment é‡å»ºæ—¶å¤±åŽ»æ»šåŠ¨ä½ç½®æ˜¯å› ä¸º Adapter ä¸­çš„æ•°æ®æ˜¯ å¼‚æ­¥ åŠ è½½çš„ï¼Œå½“ RecyclerView layout æ—¶æ•°æ®å¹¶æ²¡æœ‰åŠ è½½ï¼Œå› æ­¤ä¹Ÿæ¢å¤ä¸äº†ä¹‹å‰çš„ä½ç½®çŠ¶æ€ã€‚ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä¾‹å­æ˜¯ä½¿ç”¨ Navigation ç»„ä»¶è¿›è¡Œå¯¼èˆªï¼Œè¿”å›žæ—¶ fragment ä¸­çš„ RecyclerView ç”±äºŽå†æ¬¡è°ƒç”¨æŽ¥å£èŽ·å–æ•°æ®ï¼Œå¯¼è‡´å…¶æ»‘åŠ¨ä½ç½®å¤±åŽ» è§£å†³æ–¹æ¡ˆæœ‰å‡ ç§æ–¹æ³•å¯ä»¥ä¿è¯ RecyclerView æ¢å¤åˆ°æ­£ç¡®çš„æ»šåŠ¨ä½ç½®ï¼Œæœ€å¥½çš„åŠžæ³•æ˜¯å€ŸåŠ©ç¼“å­˜ï¼ŒViewModel æˆ– Repository ä¸­ç¼“å­˜è¦æ˜¾ç¤ºçš„æ•°æ®ï¼Œç¡®ä¿å§‹ç»ˆåœ¨ç¬¬ä¸€ä¸ªå¸ƒå±€ä¼ å…¥å‰åœ¨ Adapter ä¸Šè®¾ç½®æ•°æ®ã€‚ä¹Ÿæœ‰ä¸€äº›å…¶ä»–çš„æ–¹æ¡ˆï¼Œè¿™äº›æ–¹æ¡ˆè¦ä¹ˆå¤ªå¤æ‚ï¼Œè¦ä¹ˆä¸å¤Ÿä¼˜é›… recyclerview:1.2.0-alpha02 ä¸­çš„è§£å†³æ–¹æ¡ˆæ˜¯æä¾›ä¸€ä¸ªæ–°çš„ Adapter æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸è®¾ç½®çŠ¶æ€æ¢å¤ç­–ç•¥ï¼Œå®ƒæœ‰ä¸‰ä¸ªé€‰é¡¹ ALLOW PREVENT_WHEN_EMPTY PREVENT ALLOWè¿™æ˜¯ é»˜è®¤ çš„çŠ¶æ€ï¼Œå®ƒä¼šç«‹å³æ¢å¤ RecyclerView çš„çŠ¶æ€ï¼Œè¯¥ç§ç­–ç•¥æ— æ³•è§£å†³å»¶è¿ŸåŠ è½½çš„æ•°æ®çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ PREVENT_WHEN_EMPTY PREVENT_WHEN_EMPTYä»…å½“ Adapter ä¸ä¸ºç©ºï¼ˆadapter.getItemCount() &gt; 0ï¼‰æ—¶ï¼Œæ‰æ¢å¤ RecyclerView çŠ¶æ€ã€‚ å¦‚æžœæ‚¨çš„æ•°æ®æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼Œé‚£ä¹ˆ RecyclerView ä¼šä¸€ç›´ç­‰åˆ°æ•°æ®åŠ è½½å®Œæ¯•ï¼Œç„¶åŽçŠ¶æ€æ‰èƒ½æ¢å¤ã€‚ å¦‚æžœæ‚¨æœ‰é»˜è®¤ itemï¼ˆä¾‹å¦‚ Header æˆ– åŠ è½½æŒ‡ç¤ºå™¨ï¼‰ä½œä¸ºé€‚é…å™¨çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™åº”è¯¥ä½¿ç”¨PREVENT é€‰é¡¹ï¼Œé™¤éžä½¿ç”¨ MergeAdapter æ·»åŠ äº†é»˜è®¤ itemã€‚ MergeAdapter ç­‰å¾…æ‰€æœ‰é€‚é…å™¨å‡†å¤‡å°±ç»ªï¼Œç„¶åŽæ‰æ¢å¤çŠ¶æ€ PREVENTçŠ¶æ€ä¸ä¼šæ¢å¤ï¼Œç›´åˆ°é…ç½®äº† ALLOW æˆ–è€… PREVENT_WHEN_EMPTY ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š 1adapter.stateRestorationPolicy = PREVENT_WHEN_EMPTY åŠ å…¥äº†ä¸Šé¢çš„é…ç½®åŽå³ä½¿æ˜¯å¼‚æ­¥åŠ è½½æ•°æ®ä¹Ÿèƒ½æ¢å¤ RecyclerView çš„ä½ç½® è¿½è¸ªå¼•å…¥è¿‡ç¨‹è€è§„çŸ©ï¼Œæˆ‘ä»¬æ²¿ç€å®˜æ–¹çš„ commit log æ¥çœ‹çœ‹å…¶å®žçŽ°åŽŸç† é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹ IssueTracker ä¸Šæçš„ Feature è¡¨è¾¾çš„æ„æ€ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å½“åŠ è½½å¼‚æ­¥æ•°æ®æ—¶ RecyclerView çš„ä½ç½®çŠ¶æ€æ— æ³•æ¢å¤ï¼ŒAdapter åº”è¯¥æä¾›ç›¸å…³çš„è§£å†³æ–¹æ¡ˆ æœ‰æ„æ€çš„æ˜¯ï¼Œå®žçŽ°è¯¥åŠŸèƒ½æ—¶è¿˜é‡æ–°å®žçŽ°äº†å‰ä¸€ä¸ªç‰ˆæœ¬çš„é€»è¾‘ï¼Œæˆ‘åœ¨ git commit log ä¸­çœ‹åˆ°äº† revert æ“ä½œ ä¸ºäº†é˜²æ­¢ LayoutManager#onRestore æ‰§è¡Œå¤šæ¬¡ï¼Œæ²¡æœ‰é‡‡ç”¨æœ€å¼€å§‹çš„å®žçŽ°æ–¹å¼ã€‚ä½† Yigit Boyar (è¿™ä¸ªæäº¤çš„å¼€å‘è€…) ä»ç„¶å¸Œæœ›ä½¿ç”¨æœ€å¼€å§‹çš„å®žçŽ°æ–¹å¼ï¼Œä½†æ˜¯ LayoutManager#onRestoreInstance çš„çŠ¶æ€æ—¶ public ï¼Œå› æ­¤åªèƒ½é€‰å–ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆ è¿‡åŽ»ï¼Œå¼€å‘è€…ä¼šæ— æ„é—´è°ƒç”¨ onRestoreInstanceState(State) æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œä¸€äº›å¼€å‘è€…å·²ä½¿ç”¨å®ƒæ¥æ‰‹åŠ¨è®¾ç½®è‡ªå·±æ›´æ–°çš„çŠ¶æ€ï¼Œè¿™æ ·å³ä½¿åœ¨æ­¤çŠ¶æ€ä¹‹å‰å·²æ¢å¤ï¼Œåœ¨æ­¤å¤„ä¼ é€’çŠ¶æ€ä¹Ÿå°†å¯¼è‡´ LayoutManager æŽ¥æ”¶å®ƒå¹¶ç›¸åº”åœ°æ›´æ–°å…¶å†…éƒ¨çŠ¶æ€ã€‚å› æ­¤ï¼Œå³ä½¿çœ‹èµ·æ¥å¥½åƒå¾ˆå¥‡æ€ªï¼Œä¹Ÿå¿…é¡»å§‹ç»ˆè°ƒç”¨ requestLayout æ¥ä¿ç•™åŠŸèƒ½ æºç åˆ†æžæŽ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æžè¿™éƒ¨åˆ†æºç ï¼Œå†…å®¹å¾ˆå°‘ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯¦ç»†çœ‹ä¸‹ é¦–å…ˆæ˜¯å¼•å…¥ StateRestorationPolicyçš„æžšä¸¾ ç„¶åŽéœ€è¦æä¾› setStateRestorationPolicy å’Œ getStateRestorationPolicy æ–¹æ³•ï¼Œæ­¤æ—¶æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦è¦å°† SavedState ä¼ é€’ç»™ LayoutManager å‰é¢çš„ setStateRestorationPolicy æ–¹æ³•ä¸­ è°ƒç”¨äº† notifyStateRestorationPolicyChangedï¼Œè€Œ notifyStateRestorationPolicyChanged ä¸ºé™æ€ç±» AdapterDataObservable ä¸­çš„æ–¹æ³•ï¼Œè¯¥ç±»ä¸­çš„å…¶ä»–æ–¹æ³•æˆ‘ä»¬ä¹Ÿå¾ˆç†Ÿæ‚‰ï¼Œå‡æ˜¯åˆ·æ–° Adapter ä¸­æ•°æ®çš„æ–¹æ³•ã€‚ è€Œ notifyStateRestorationPolicyChanged ä¸­è°ƒç”¨äº† mObservers list ä¸­å…ƒç´ çš„ onStateRestorationPolicyChanged æ–¹æ³•ï¼Œé€šè¿‡æºç æˆ‘ä»¬å¾—çŸ¥è¯¥ list ä¸­çš„å…ƒç´ ç±»åž‹ä¸º AdapterDataObserverï¼Œå› æ­¤è¿˜éœ€è¦åœ¨ AdapterDataObserver ä¸­åŠ å…¥ onStateRestorationPolicyChanged æ–¹æ³• è¯¥æ–¹æ³•æ˜¯ä¸ªç©ºå®žçŽ°ï¼Œè€Œ RecyclerViewDataObserver é‡å†™äº†è¯¥æ–¹æ³• é…ç½®æ¢å¤ç­–ç•¥ä»¥åŠæ¢å¤ç­–ç•¥å˜åŒ–æ—¶çš„ç›‘å¬éƒ½æœ‰äº†ï¼ŒæŽ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯å¦‚æžœä¹‹å‰æœ‰å¾…æ¢å¤çš„è£…åˆ™æ¢å¤ä¹‹å‰çš„çŠ¶æ€ æ³¨æ„ï¼šå‘å¸ƒä¹‹å‰ StateRestorationPolicy å«åš StateRestorationStrategyï¼ŒåŽæ¥å‘½åä¸º StateRestorationPolicyï¼Œalpha ç‰ˆæœ¬çš„åº“å¯èƒ½éšæ—¶æ›´æ”¹ API çš„å‘½åå’Œåˆ é™¤ APIï¼Œå› æ­¤æŸ¥çœ‹è¿™éƒ¨åˆ†æºç çš„åŒå­¦è¯·æ³¨æ„ è‡³æ­¤ï¼Œç›¸å…³çš„æºç éƒ½åœ¨è¿™é‡Œäº† æ€»ç»“StateRestorationPolicy æä¾›äº† RecyclerView å¼‚æ­¥åŠ è½½æ•°æ®æ¢å¤æ»šåŠ¨ä½ç½®çš„è§£å†³æ–¹æ¡ˆã€‚åŽŸç†å°±æ˜¯é€šè¿‡é…ç½® StateRestorationPolicy æ¥æ”¹å˜æ¢å¤ç­–ç•¥ï¼ŒåŒæ—¶åœ¨ç­–ç•¥æ”¹å˜æ—¶è°ƒç”¨ requestLayout æ–¹æ³•ã€‚åœ¨ dispatchLayoutStep2() (è¯¥æ–¹æ³•ä¼šåœ¨ onLayout å’Œ measure æ–¹æ³•ä¸­è°ƒç”¨) æ–¹æ³•ä¸­æ¢å¤çŠ¶æ€(å¦‚æžœ canRestoreState() è¿”å›ž true) demo åœ°å€ ä¸€ç‚¹æ€è€ƒï¼šæˆ‘ä»¬éƒ½çŸ¥é“ ViewPager2 æ˜¯ä½¿ç”¨ RecyclerView å®žçŽ°çš„ï¼Œé‚£ä¹ˆå€ŸåŠ©æœ¬æ–‡ä»‹ç»çš„ API å¯ä»¥åšç‚¹ä»€ä¹ˆå—ï¼Ÿ æ¬¢è¿Žå„ä½å°ä¼™ä¼´åœ¨è¯„è®ºåŒºç•™è¨€ï¼Œè¯´è¯´ä½ çš„æƒ³æ³• å…³äºŽæˆ‘æˆ‘æ˜¯ Flywith24ï¼Œæˆ‘çš„åšå®¢å†…å®¹å·²ç»åˆ†ç±»æ•´ç† åœ¨è¿™é‡Œï¼Œç‚¹å‡»å³ä¸Šè§’çš„ Watch å¯ä»¥åŠæ—¶èŽ·å–æˆ‘çš„æ–‡ç« æ›´æ–°å“¦ ðŸ˜‰ æŽ˜é‡‘ å°ä¸“æ  Github]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
        <tag>RecyclerView</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Jetpackæ›´æ–°ä¹‹Fragmentã€‘ç»ˆäºŽåŠ¨æ‰‹äº†ï¼ŒonActivityCreated è¢«å¼ƒç”¨]]></title>
    <url>%2F2020%2F04%2F09%2FJetpack-fragment-onActivityCreated-Deprecated%2F</url>
    <content type="text"><![CDATA[æœ¬ç³»åˆ—æ–‡ç« ä»‹ç» Jetpack ç»„ä»¶åº“çš„æ›´æ–°ä¸€ç›´ä»¥æ¥ï¼Œ fragment çš„ api éƒ½éžå¸¸éš¾ç”¨ï¼Œå®˜æ–¹ä¹Ÿæ‰¿è®¤è¿™ä¸€ç‚¹ã€‚ä¸€ä¸ªæœˆå‰ï¼Œfragment ä¸­çš„ onActivityCreated() è¢«å¼ƒç”¨äº† Fragmentfragment 1.3.0-alpha02 ä¸­ onActivityCreated() æ–¹æ³•è¢«å¼ƒç”¨äº† è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æäº¤ log ç®€å•ç¿»è¯‘ä¸€ä¸‹ onActivityCreated() æœ€åˆçš„ç›®çš„æ˜¯è®© fragment çš„é€»è¾‘ä¸Žå…¶å®¿ä¸» activity åˆ›å»ºå»ºç«‹å…³è”ï¼Œæˆ‘ä»¬ä¸é¼“åŠ±è¿™ç§è€¦åˆ æˆ‘ä»¬åº”è¯¥ä¼ é€’å¤–éƒ¨ä¾èµ–æ¥ä½œä¸º FragmentFactory å‚æ•°ã€‚view ç›¸å…³çš„ä»£ç åº”è¯¥æ”¾ç½®åœ¨ onViewCreated() å®Œæˆï¼Œå…¶ä»–çš„åˆå§‹åŒ–ä»£ç åº”è¯¥åœ¨ onCreate() ä¸­å®Œæˆã€‚ä¸ºäº†åœ¨ activity onCreate() å®ŒæˆåŽæŽ¥æ”¶å›žè°ƒï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ª activity ç”Ÿå‘½å‘¨æœŸçš„ LifecycleObserver ï¼Œå¹¶ä¸”æŽ¥æ”¶åˆ° Lifecycle.State#CREATED å›žè°ƒæ—¶å°†å…¶ç§»é™¤ 123456789override fun onAttach(context: Context) &#123; super.onAttach(context) requireActivity().lifecycle.addObserver(object : DefaultLifecycleObserver &#123; override fun onCreate(owner: LifecycleOwner) &#123; // æƒ³åšå•¥åšç‚¹å•¥ owner.lifecycle.removeObserver(this) &#125; &#125;)&#125; DialogFragmenté‚£ä¹ˆ DialogFragment æ€Žä¹ˆåŠžï¼Ÿå…¶ onActivityCreated å˜ä¸ºå¯é€‰çš„ ç®€å•ç¿»è¯‘ä¸€ä¸‹ DialogFragment ä½¿ç”¨ onActivityCreated() å¸®åŠ©åˆ›å»º dialogã€‚onActivityCreated() å¼ƒç”¨åŽæˆ‘ä»¬åº”å½“å¯»æ‰¾ä¸€ä¸ªæ›´å¥½çš„æ–¹å¼æ¥æ‰§è¡Œè¿™éƒ¨åˆ†é€»è¾‘ å…³äºŽ view ç›¸å…³çš„ä»£ç å·²ç»è½¬ç§»è‡³ DialogFragment çš„ viewLifecycleOwnerLiveData ï¼Œå…¶ä»–åˆå§‹åŒ–é€»è¾‘å¯ä»¥æ”¾åœ¨ onGetLayoutInflater æˆ‘ä»¬ä»æ”¯æŒä¸ºè‡ªå®šä¹‰ dialog åœ¨ onActivityCreated() ä¸­é…ç½® dialog EndæŸ¥çœ‹ Jetpack fragment çš„å˜åŠ¨ï¼Œä¸éš¾çœ‹å‡ºå®˜æ–¹æ­£è‡´åŠ›äºŽä¸º fragment ã€Œå‡è´Ÿã€ï¼Œå°†å°çš„ï¼Œç‹¬ç«‹çš„åŠŸèƒ½ä»Ž fragment ä¸­æŠ½ç¦»å‡ºåŽ»ï¼Œé™ä½Žè€¦åˆï¼ŒåŽç»­æ–‡ç« æˆ‘ä»¬ä»‹ç»å…¶ä»–çš„æ”¹åŠ¨ å…³äºŽæˆ‘æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github æ¬¢è¿Žå…³æ³¨æˆ‘çš„å…¬ä¼—å·]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
        <tag>Fragment</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€èƒŒä¸ŠJetpackä¹‹LiveDataã€‘ViewModelçš„å·¦è†€å³è‡‚ æ•°æ®é©±åŠ¨çœŸçš„é¦™]]></title>
    <url>%2F2020%2F03%2F31%2FJetpack-LiveData%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ä¹‹å‰æˆ‘ä»¬è®¨è®ºè¿‡ ViewModel çš„èŒèƒ½è¾¹ç•Œ ï¼Œå¾—ç›ŠäºŽ ViewModel çš„ç”Ÿå‘½å‘¨æœŸæ›´é•¿ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ activity é‡å»ºåŽå°†æ•°æ®ä¼ é€’ç»™ activity ï¼Œä¹Ÿå¯ä»¥é¿å…å†…å­˜æ³„æ¼ã€‚ä½†æ˜¯å¦‚æžœä¸æ˜¯æ¯æ¬¡éœ€è¦å°±èŽ·å–æ•°æ®ï¼Œè€Œæ˜¯å½“æ¯æ¬¡æœ‰æ–°æ•°æ®æ—¶é€šçŸ¥æˆ‘ä»¬ï¼Œåº”è¯¥æ€Žä¹ˆåŠžï¼Ÿ æœ¬æ–‡ä»‹ç» LiveData ï¼Œä¸€ä¸ª ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„ï¼Œå¯è§‚å¯Ÿçš„ï¼Œæ•°æ®æŒæœ‰è€…ã€‚åŒæ—¶è¿˜ä¼šç®€å•åˆ†æž LiveData çš„æºç å®žçŽ° æˆ‘ä»¬éƒ½æ˜¯ Adapteråœ¨è°ˆ LiveData å‰æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ Android å¼€å‘ï¼ˆäº¦æˆ–è€…è¯´å‰ç«¯å¼€å‘ï¼‰çš„æœ¬è´¨å·¥ä½œå†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ å¯¹äºŽåº”ç”¨å±‚ app å¼€å‘è€…ï¼Œå¼€å‘è€…çš„å·¥ä½œä¸»è¦å·¥ä½œå°±æ˜¯ Adapter ä»€ä¹ˆæ˜¯ Adapter ï¼Œä¸‹å›¾å¯èƒ½æ¯”è¾ƒç›´è§‚ å›¾ç‰‡æ¥è‡ª google image æˆ‘ä»¬çš„å·¥ä½œæœ¬è´¨æ˜¯ å°†æ•°æ®è½¬æ¢æˆ UI æ•°æ®å¯èƒ½æ¥è‡ªç½‘ç»œï¼Œæ¥è‡ªæœ¬åœ°æ•°æ®åº“ï¼Œæ¥è‡ªå†…å­˜ï¼Œè€Œ UI å¯èƒ½æ˜¯ activity æˆ– fragmentã€‚ ç†æƒ³çš„æ•°æ®æ¨¡åž‹ä¸Šé¢æˆ‘ä»¬æåˆ° Android å¼€å‘è€…çš„æ ¸å¿ƒå·¥ä½œå°±æ˜¯å°†æ•°æ®è½¬æ¢ä¸º UI ã€‚è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒç†æƒ³çš„çŠ¶æ€æ˜¯ï¼šå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒUI è·Ÿéšå˜åŒ–ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥å±•å¼€ï¼šå½“ UI å¯¹ç”¨æˆ·å¯è§æ—¶ï¼Œæ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ UI è·Ÿéšå˜åŒ–ï¼›å½“ UI å¯¹ç”¨æˆ·ä¸å¯è§æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›æ•°æ®å˜åŒ–æ—¶ä»€ä¹ˆéƒ½ä¸åšï¼Œå½“ UI å†æ¬¡å¯¹ç”¨æˆ·å¯è§æ—¶æ ¹æ®æœ€æ–°çš„æ•°æ®è¿›è¡Œ UI çš„å¤„ç†ã€‚ è€Œ LiveData å°±æ˜¯æˆ‘ä»¬ç†æƒ³ä¸­çš„æ•°æ®æ¨¡åž‹ å›¾ç‰‡æ¥è‡ª Android Dev Summit â€˜18-Fun with LiveData LiveData å¯ä»¥ä¸‰ä¸ªå…³é”®è¯æ¦‚æ‹¬ lifecycle-aware observable data holder observableAndroid ä¸­ä¸åŒçš„ç»„ä»¶æœ‰ç€ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸åŒçš„å­˜æ´»æ—¶é—´ å› æ­¤æˆ‘ä»¬ä¸ä¼šåœ¨ ViewModel ä¸­æŒæœ‰ Activity çš„å¼•ç”¨ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´å½“ Activity é‡å»ºæ—¶å†…å­˜æ³„æ¼ï¼Œç”šè‡³å‡ºçŽ°ç©ºæŒ‡é’ˆçš„æƒ…å†µ é€šå¸¸æˆ‘ä»¬ä¼šåœ¨ Activity ä¸­æŒæœ‰ ViewModel çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå¦‚ä½•è¿›è¡ŒäºŒè€…é—´çš„é€šä¿¡ï¼Œå¦‚ä½•å‘ Activity å‘é€ ViewModel ä¸­çš„æ•°æ®ï¼Ÿ ç­”æ¡ˆæ˜¯è®© Activity è§‚å¯Ÿ ViewModel LiveData æ˜¯ observable lifecycle-awareå½“è§‚å¯Ÿè€…è§‚å¯Ÿç€æŸä¸ªæ•°æ®æ—¶ï¼Œè¯¥æ•°æ®å¿…é¡»ä¿ç•™å¯¹è§‚å¯Ÿè€…çš„å¼•ç”¨æ‰èƒ½è°ƒç”¨å®ƒï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒLiveData è¢«è®¾è®¡æˆå¯æ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸ å½“ activity / fragment è¢«é”€æ¯åŽï¼Œå®ƒä¼šè‡ªåŠ¨çš„å–æ¶ˆè®¢é˜… data holderLiveData ä»…æŒæœ‰ å•ä¸ªä¸”æœ€æ–° çš„æ•°æ® ä¸Šå›¾ä¸­ï¼Œæœ€å³ä¾§æ˜¯åœ¨ ViewModel ä¸­çš„ LiveDataï¼Œå·¦ä¾§ä¸ºè§‚å¯Ÿè¿™ä¸ª LiveData çš„ activity / fragment ã€‚ä¸€æ—¦æˆ‘ä»¬ä¸º LiveData è®¾å€¼ï¼Œè¯¥å€¼ä¼šä¼ é€’åˆ° activityã€‚ç®€è€Œè¨€ä¹‹ï¼ŒLiveData å€¼æ”¹å˜ï¼Œactivity æ”¶åˆ°æœ€æ–°çš„å€¼çš„å˜åŒ–ã€‚ä½†æ˜¯å½“è§‚å¯Ÿè€…ä¸å†å¤„äºŽæ´»åŠ¨çŠ¶æ€ï¼ˆSTARTED åˆ° RESUMED ï¼‰ï¼Œæ•°æ® C ä¸ä¼šè¢«å‘é€åˆ° activity ã€‚å½“ activity å›žåˆ°å‰å°ï¼Œå®ƒå°†æ”¶åˆ°æœ€æ–°çš„å€¼ï¼Œæ•°æ® Dã€‚LiveData ä»…æŒæœ‰å•ä¸ªä¸”æœ€æ–°çš„æ•°æ®ã€‚å½“ activity æ‰§è¡Œé”€æ¯æµç¨‹æ—¶ï¼Œæ­¤æ—¶çš„æ•°æ® E ä¹Ÿä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ TransformationsLiveData æä¾› ä¸¤ç§ transformation ï¼Œmap å’Œ switch mapã€‚å¼€å‘è€…ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„ MediatorLiveData æˆ‘ä»¬éƒ½çŸ¥é“ LiveData å¯ä»¥ä¸º View å’Œ ViewModel æä¾›é€šä¿¡ï¼Œä½†å¦‚æžœæœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶ï¼ˆä¾‹å¦‚ repository ï¼‰ä¹ŸæŒæœ‰ LiveDataã€‚é‚£ä¹ˆå®ƒåº”è¯¥å¦‚ä½•åœ¨ ViewModel ä¸­è®¢é˜…ï¼Ÿè¯¥ç»„ä»¶å¹¶æ²¡æœ‰ lifecycle ä¸€æ—¦æˆ‘ä»¬çš„åº”ç”¨æ„ˆå‘å¤æ‚ï¼Œrepository å¯èƒ½ä¼šè§‚å¯Ÿæ•°æ®æº é‚£ä¹ˆ view å¦‚ä½•èŽ·å– repository ä¸­çš„ LiveDataï¼Ÿ ä¸€å¯¹ä¸€çš„é™æ€è½¬æ¢ï¼ˆmapï¼‰ åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒViewModel ä»…å°†æ•°æ®ä»Ž repository è½¬å‘åˆ° viewï¼Œç„¶åŽå°†å…¶è½¬æ¢ä¸º UI Modelã€‚ æ¯å½“ repository ä¸­æœ‰æ–°æ•°æ®æ—¶ï¼ŒViewModel åªéœ€ map 12345class MainViewModel &#123; val viewModelResult = Transformations.map(repository.getDataForUser()) &#123; data -&gt; convertDataToMainUIModel(data) &#125;&#125; ç¬¬ä¸€ä¸ªå‚æ•°ä¸º LiveData æºï¼ˆæ¥è‡ª repository ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè½¬æ¢å‡½æ•°ã€‚ 123// è¿™é‡Œçš„è½¬æ¢ä¸ºå°† X è½¬æ¢ä¸º Yinline fun &lt;X, Y&gt; LiveData&lt;X&gt;.map(crossinline transform: (X) -&gt; Y): LiveData&lt;Y&gt; = Transformations.map(this) &#123; transform(it) &#125; ä¸€å¯¹ä¸€çš„åŠ¨æ€è½¬æ¢ï¼ˆswitchMapï¼‰å‡å¦‚æ‚¨æ­£åœ¨è§‚å¯Ÿä¸€ä¸ªæä¾›ç”¨æˆ·çš„ç”¨æˆ·ç®¡ç†å™¨ï¼Œå¹¶ä¸”éœ€è¦æä¾›ç”¨æˆ·çš„ id æ‰èƒ½å¼€å§‹è§‚å¯Ÿ repository æ‚¨ä¸èƒ½å°†å…¶å†™åˆ° ViewModel åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæ­¤æ—¶ç”¨æˆ·çš„ id è¿˜ä¸å¯ç”¨ è¿™æ—¶ switchMap å°±æ´¾ä¸Šç”¨åœºäº† 12345class MainViewModel &#123; val repositoryResult = Transformations.switchMap(userManager.userId) &#123; userId -&gt; repository.getDataForUser(userId) &#125;&#125; switchMap åœ¨å†…éƒ¨ä½¿ç”¨ MediatorLiveDataï¼Œå› æ­¤äº†è§£å®ƒéžå¸¸é‡è¦ï¼Œå› ä¸ºå½“æ‚¨è¦ç»„åˆå¤šä¸ª LiveData æºæ—¶éœ€è¦ä½¿ç”¨å®ƒ 1234// è¿™é‡Œçš„è½¬æ¢ä¸ºå°† X è½¬æ¢ä¸º LiveData&lt;Y&gt;inline fun &lt;X, Y&gt; LiveData&lt;X&gt;.switchMap( crossinline transform: (X) -&gt; LiveData&lt;Y&gt;): LiveData&lt;Y&gt; = Transformations.switchMap(this) &#123; transform(it) &#125; ä¸€å¯¹å¤šä¾èµ–ï¼ˆMediatorLiveDataï¼‰MediatorLiveData å…è®¸æ‚¨å°†ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®æºæ·»åŠ åˆ°å•ä¸ªå¯è§‚å¯Ÿçš„ LiveData ä¸­ 1234567891011val liveData1: LiveData&lt;Int&gt; = ...val liveData2: LiveData&lt;Int&gt; = ...val result = MediatorLiveData&lt;Int&gt;()result.addSource(liveData1) &#123; value -&gt; result.setValue(value)&#125;result.addSource(liveData2) &#123; value -&gt; result.setValue(value)&#125; åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå½“ä»»ä½•ä¸€ä¸ªæ•°æ®æºå˜åŒ–æ—¶ï¼Œresult ä¼šæ›´æ–°ã€‚ æ³¨æ„ï¼šæ•°æ®å¹¶ä¸æ˜¯åˆå¹¶ï¼ŒMediatorLiveData åªæ˜¯å¤„ç†é€šçŸ¥ ä¸ºäº†å®žçŽ°ç¤ºä¾‹ä¸­çš„è½¬æ¢ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸¤ä¸ªä¸åŒçš„ LiveData ç»„åˆä¸ºä¸€ä¸ª å›¾ç‰‡æ¥è‡ª LiveData beyond the ViewModel â€” Reactive patterns using Transformations and MediatorLiveData ä½¿ç”¨ MediatorLiveData åˆå¹¶æ•°æ®çš„ä¸€ç§æ–¹æ³•æ˜¯æ·»åŠ æºå¹¶ä»¥å…¶ä»–æ–¹æ³•è®¾ç½®å€¼ï¼š 123456789101112131415fun blogpostBoilerplateExample(newUser: String): LiveData&lt;UserDataResult&gt; &#123; val liveData1 = userOnlineDataSource.getOnlineTime(newUser) val liveData2 = userCheckinsDataSource.getCheckins(newUser) val result = MediatorLiveData&lt;UserDataResult&gt;() result.addSource(liveData1) &#123; value -&gt; result.value = combineLatestData(liveData1, liveData2) &#125; result.addSource(liveData2) &#123; value -&gt; result.value = combineLatestData(liveData1, liveData2) &#125; return result&#125; æ•°æ®çš„å®žé™…ç»„åˆæ˜¯åœ¨ combineLatestData æ–¹æ³•ä¸­å®Œæˆçš„ 1234567891011121314151617private fun combineLatestData( onlineTimeResult: LiveData&lt;Long&gt;, checkinsResult: LiveData&lt;CheckinsResult&gt;): UserDataResult &#123; val onlineTime = onlineTimeResult.value val checkins = checkinsResult.value // Don't send a success until we have both results if (onlineTime == null || checkins == null) &#123; return UserDataLoading() &#125; // TODO: Check for errors and return UserDataError if any. return UserDataSuccess(timeOnline = onlineTime, checkins = checkins)&#125; æ£€æŸ¥å€¼æ˜¯å¦å‡†å¤‡å¥½å¹¶å‘å‡ºç»“æžœï¼ˆåŠ è½½ä¸­ï¼Œå¤±è´¥æˆ–æˆåŠŸï¼‰ LiveData çš„é”™è¯¯ç”¨æ³•é”™è¯¯åœ°ä½¿ç”¨ var LiveData1234567var lateinit randomNumber: LiveData&lt;Int&gt;fun onGetNumber() &#123; randomNumber = Transformations.map(numberGenerator.getNumber()) &#123; it &#125;&#125; è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„é—®é¢˜éœ€è¦ç†è§£ï¼šè½¬æ¢ä¼šåœ¨è°ƒç”¨æ—¶ï¼ˆmap å’Œ switchMapï¼‰ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ LiveDataã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒrandomNumber å…¬å¼€ç»™ View ï¼Œä½†æ˜¯æ¯æ¬¡ç”¨æˆ·å•å‡»æŒ‰é’®æ—¶éƒ½ä¼šå¯¹å…¶è¿›è¡Œé‡æ–°èµ‹å€¼ã€‚ è§‚å¯Ÿè€…åªä¼šåœ¨è®¢é˜…æ—¶æ”¶åˆ°åˆ†é…ç»™ var çš„ LiveData æ›´æ–°çš„ä¿¡æ¯ 1234// åªä¼šæ”¶åˆ°ç¬¬ä¸€æ¬¡åˆ†é…çš„å€¼viewmodel.randomNumber.observe(this, Observer &#123; number -&gt; numberTv.text = resources.getString(R.string.random_text, number)&#125;) å¦‚æžœ viewmodel.randomNumber LiveData å®žä¾‹å‘ç”Ÿæ›´æ”¹ï¼Œè¿™é‡Œæ°¸è¿œä¸ä¼šå›žè°ƒã€‚è€Œä¸”è¿™é‡Œæ³„æ¼äº†ä¹‹å‰çš„ LiveData ï¼Œè¿™äº› LiveData ä¸ä¼šå†å‘é€æ›´æ–° ä¸€è¨€ä»¥è”½ä¹‹ï¼Œä¸è¦åœ¨ var ä¸­ä½¿ç”¨ Livedata æ­£ç¡®ç¤ºä¾‹è§ demo LiveData ç²˜æ€§äº‹ä»¶ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä½¿ç”¨ LiveData æŒæœ‰ UI æ•°æ®å’ŒçŠ¶æ€ï¼Œä½†æ˜¯å¦‚æžœé€šè¿‡å®ƒæ¥å‘é€äº‹ä»¶ï¼Œå¯èƒ½ä¼šå‡ºçŽ°ä¸€äº›é—®é¢˜ã€‚è¿™äº›é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ åœ¨è¿™ fragment ä¸­é”™è¯¯åœ°ä¼ å…¥ LifecycleOwnerandroidx fragment 1.2.0 èµ·ï¼Œæ·»åŠ äº†æ–°çš„ Lint æ£€æŸ¥ï¼Œä»¥ç¡®ä¿æ‚¨åœ¨ä»Ž onCreateView()ã€onViewCreated() æˆ– onActivityCreated() è§‚å¯Ÿ LiveData æ—¶ä½¿ç”¨ getViewLifecycleOwner() å¦‚å›¾ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª fragment ï¼ŒonCreate è§‚å¯Ÿ LiveDataï¼Œé€šè¿‡æ­£å¸¸çš„ç”Ÿå‘½å‘¨æœŸåˆ›å»ºäº† View ï¼ŒæŽ¥ç€è¿›å…¥äº† resume çŠ¶æ€ã€‚æ­¤æ—¶ä½ ä½¿ç”¨äº† LiveDataï¼ŒUI å°†å¼€å§‹å±•ç¤ºå®ƒã€‚ä¹‹åŽï¼Œç”¨æˆ·ç‚¹å‡»äº†æŒ‰é’®ï¼Œç”±äºŽè·³è½¬äº†å¦ä¸€ä¸ª fragmentï¼Œæ‰€ä»¥è¦ detach è¯¥ fragmentï¼Œä¸€æ—¦ fragment stop æˆ‘ä»¬å°±ä¸éœ€è¦å…¶ä¸­çš„ view äº†ï¼Œå› æ­¤ destroyView ã€‚ä¹‹åŽç”¨æˆ·ç‚¹å‡»äº†è¿”å›žæŒ‰é’®å›žåˆ°äº†ä¸Šä¸€ä¸ª fragmentï¼Œç”±äºŽæˆ‘ä»¬å·²ç» destroyViewï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ view ï¼ŒæŽ¥ç€è¿›å…¥æ­£å¸¸çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†æ­¤æ—¶ï¼Œå‡ºçŽ°äº†ä¸€ä¸ª bug ã€‚è¿™ä¸ªæ–° View ä¸ä¼šæ¢å¤ LiveData çš„çŠ¶æ€ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ fragment çš„ lifecycle observe çš„ LiveData æˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼Œåœ¨ onCreate æˆ–è€…åœ¨ onCreateView ä¸­ä½¿ç”¨ fragment çš„ lifecycle observe LiveData å‰è€…çš„ä¼˜ç‚¹æ˜¯ä¸€æ¬¡æ³¨å†Œï¼Œç¼ºç‚¹æ˜¯å½“ recreate æ—¶æœ‰bugï¼›åŽè€…ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿè§£å†³ recreate çš„ bugï¼Œä½†ä¼šå¯¼è‡´é‡å¤æ³¨å†Œ è¯¥é—®é¢˜çš„æ ¸å¿ƒæ˜¯ fragment æ‹¥æœ‰ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸï¼šfragment è‡ªèº«å’Œ fragment å†…éƒ¨ view çš„ç”Ÿå‘½å‘¨æœŸ androidx fragment 1.0 å’Œ support library 28 äº† viewLifecycle å› æ­¤ï¼Œå½“éœ€è¦è§‚å¯Ÿ view ç›¸å…³çš„ LiveData ï¼Œå¯ä»¥åœ¨ onCreateView()ã€onViewCreated() æˆ– onActivityCreated() ä¸­ LiveData observe æ–¹æ³•ä¸­ä¼ å…¥ viewLifecycleOwner è€Œä¸æ˜¯ä¼ å…¥ this æºç ç»“æž„é¦–å…ˆæ¥çœ‹ LiveData ä¸»è¦çš„æºç ç»“æž„ LiveData MutableLiveData Observer LiveDataLiveData æ˜¯å¯ä»¥åœ¨ç»™å®šç”Ÿå‘½å‘¨æœŸå†…è§‚å¯Ÿåˆ°çš„æ•°æ®æŒæœ‰è€…ç±»ã€‚ è¿™æ„å‘³ç€å¯ä»¥å°†ä¸€ä¸ªObserver ä¸Ž LifecycleOwner æˆå¯¹æ·»åŠ ï¼Œå¹¶ä¸”åªæœ‰åœ¨é…å¯¹çš„ LifecycleOwner å¤„äºŽæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œæ‰ä¼šå‘è¯¥è§‚å¯Ÿè€…é€šçŸ¥æœ‰å…³åŒ…è£…æ•°æ®çš„ä¿®æ”¹ã€‚ å¦‚æžœ LifecycleOwner çš„çŠ¶æ€ä¸º Lifecycle.State.STARTED æˆ– Lifecycle.State.RESUMEDï¼Œåˆ™å°†å…¶è§†ä¸ºæ´»åŠ¨çŠ¶æ€ã€‚ é€šè¿‡ observeForeverï¼ˆObserverï¼‰æ·»åŠ çš„è§‚å¯Ÿè€…è¢«è§†ä¸ºå§‹ç»ˆå¤„äºŽæ´»åŠ¨çŠ¶æ€ï¼Œå› æ­¤å°†å§‹ç»ˆæ”¶åˆ°æœ‰å…³ä¿®æ”¹çš„é€šçŸ¥ã€‚ å¯¹äºŽé‚£äº›è§‚å¯Ÿè€…ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ removeObserverï¼ˆObserverï¼‰ å¦‚æžœç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸç§»è‡³ Lifecycle.State.DESTROYED çŠ¶æ€ï¼Œåˆ™æ·»åŠ äº†ç”Ÿå‘½å‘¨æœŸçš„è§‚å¯Ÿè€…å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚ è¿™å¯¹äºŽ activity å’Œ fragment å¯ä»¥å®‰å…¨åœ°è§‚å¯Ÿ LiveData è€Œä¸ç”¨æ‹…å¿ƒæ³„æ¼ æ­¤å¤–ï¼ŒLiveData å…·æœ‰ onActive() å’Œ onInactive() æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨æ´»åŠ¨è§‚å¯Ÿè€…çš„æ•°é‡åœ¨ 0 åˆ° 1 ä¹‹é—´å˜åŒ–æ—¶å¾—åˆ°é€šçŸ¥ã€‚è¿™ä½¿ LiveData åœ¨æ²¡æœ‰ä»»ä½•æ´»åŠ¨è§‚å¯Ÿè€…çš„æƒ…å†µä¸‹å¯ä»¥é‡Šæ”¾å¤§é‡èµ„æºã€‚ ä¸»è¦æ–¹æ³•æœ‰ï¼š T getValue() èŽ·å–LiveData åŒ…è£…çš„æ•°æ® observe(LifecycleOwner owner, Observer&lt;? super T&gt; observer) è®¾ç½®è§‚å¯Ÿè€…ï¼ˆä¸»çº¿ç¨‹è°ƒç”¨ï¼‰ setValue(T value) è®¾å€¼ï¼ˆä¸»çº¿ç¨‹è°ƒç”¨ï¼‰ï¼Œå¯è§æ€§ä¸º protected æ— æ³•ç›´æŽ¥ä½¿ç”¨ postValue(T value) è®¾ç½®ï¼ˆå…¶ä»–çº¿ç¨‹è°ƒç”¨ï¼‰ï¼Œå¯è§æ€§ä¸º protected æ— æ³•ç›´æŽ¥ä½¿ç”¨ MutableLiveDataLiveData å®žçŽ°ç±»ï¼Œå…¬å¼€äº† setValue å’Œ postValue æ–¹æ³• ObserveræŽ¥å£ï¼Œå†…éƒ¨åªæœ‰ onChanged(T t) æ–¹æ³•ï¼Œåœ¨æ•°æ®å˜åŒ–æ—¶è¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨ æºç åˆ†æžæˆ‘ä»¬é€šè¿‡æºç æ¥çœ‹çœ‹ LiveData å¦‚ä½•å®žçŽ°å®ƒçš„ç‰¹æ€§çš„ å¦‚ä½•æŽ§åˆ¶åœ¨ activity æˆ– fragment æ´»åŠ¨çŠ¶æ€æ—¶æŽ¥æ”¶å›žè°ƒï¼Œå¦åˆ™ä¸æŽ¥æ”¶ï¼Ÿ å¦‚ä½•åœ¨ activity æˆ– fragment é”€æ¯æ—¶è‡ªåŠ¨å–æ¶ˆæ³¨å†Œè§‚å¯Ÿè€…ï¼Ÿ å¦‚ä½•ä¿è¯ LiveData æŒæœ‰æœ€æ–°çš„æ•°æ®ï¼Ÿ æˆ‘ä»¬æŸ¥çœ‹ LiveData çš„ observe æ–¹æ³• 123456789101112131415161718192021222324252627// LiveData.java@MainThreadpublic void observe(LifecycleOwner owner, Observer&lt;? super T&gt; observer) &#123; if (owner.getLifecycle().getCurrentState() == DESTROYED) &#123; // å¦‚æžœ owner å·²ç»æ˜¯ DESTROYED çŠ¶æ€ï¼Œåˆ™å¿½ç•¥ return; &#125; // ä½¿ç”¨ LifecycleBoundObserver åŒ…è£… owner å’Œ observer LifecycleBoundObserver wrapper = new LifecycleBoundObserver(owner, observer); ObserverWrapper existing = mObservers.putIfAbsent(observer, wrapper); // å¦‚æžœå·²ç»æ·»åŠ è¿‡ç›´æŽ¥ return if (existing != null) &#123; return; &#125; owner.getLifecycle().addObserver(wrapper);&#125;// LifecycleBoundObserver.javaclass LifecycleBoundObserver extends ObserverWrapper implements LifecycleEventObserver &#123; @NonNull final LifecycleOwner mOwner; LifecycleBoundObserver(LifecycleOwner owner, Observer&lt;? super T&gt; observer) &#123; super(observer); mOwner = owner; &#125;&#125; é€šè¿‡æºç æˆ‘ä»¬çŸ¥é“ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ observe æ–¹æ³•æ—¶ï¼Œå†…éƒ¨æ˜¯é€šè¿‡ LifecycleBoundObserver å°† owner å’Œ observer åŒ…è£¹èµ·æ¥å¹¶é€šè¿‡ addObserver æ–¹æ³•æ·»åŠ è§‚å¯Ÿè€…çš„ï¼Œå› è€Œå½“æ•°æ®å˜åŒ–æ—¶ï¼Œä¼šè°ƒç”¨ LifecycleBoundObserver çš„ onStateChanged æ–¹æ³• 1234567891011// LiveData.LifecycleBoundObserver.java@Overridepublic void onStateChanged(@NonNull LifecycleOwner source, @NonNull Lifecycle.Event event) &#123; if (mOwner.getLifecycle().getCurrentState() == DESTROYED) &#123; // è‡ªåŠ¨ç§»é™¤è§‚å¯Ÿè€…ï¼Œé—®é¢˜ 2 å¾—åˆ°è§£é‡Š removeObserver(mObserver); return; &#125; activeStateChanged(shouldBeActive());&#125; å½“ä»€ä¹ˆå‘¨æœŸæ‰€æœ‰è€…å¤„äºŽ DESTROYED çŠ¶æ€æ—¶ï¼Œä¼šè°ƒç”¨ removeObserver æ–¹æ³•ï¼Œå› æ­¤é—®é¢˜ 2 å¾—åˆ°è§£é‡Š æˆ‘ä»¬ç»§ç»­å‘ä¸‹çœ‹ï¼ŒactiveStateChanged æ–¹æ³•è°ƒç”¨æ—¶ä¼ å…¥äº† shouldBeActive() 1234567891011121314151617181920212223242526@Overrideboolean shouldBeActive() &#123; // è‡³å°‘æ˜¯ STARTED çŠ¶æ€ è¿”å›ž true return mOwner.getLifecycle().getCurrentState().isAtLeast(STARTED);&#125;void activeStateChanged(boolean newActive) &#123; if (newActive == mActive) &#123; // ä¸Žä¸Šæ¬¡å€¼ç›¸åŒï¼Œåˆ™ç›´æŽ¥ return ï¼ˆä¸¤æ¬¡å‡ä¸ºæ´»åŠ¨çŠ¶æ€æˆ–å‡ä¸ºéžæ´»åŠ¨çŠ¶æ€ï¼‰ return; &#125; mActive = newActive; boolean wasInactive = LiveData.this.mActiveCount == 0; // æ ¹æ® mActive ä¿®æ”¹æ´»åŠ¨çŠ¶æ€è§‚å¯Ÿè€…çš„æ•°é‡ï¼ˆåŠ  1 æˆ–å‡ 1 ï¼‰ LiveData.this.mActiveCount += mActive ? 1 : -1; if (wasInactive &amp;&amp; mActive) &#123; onActive(); &#125; if (LiveData.this.mActiveCount == 0 &amp;&amp; !mActive) &#123; onInactive(); &#125; if (mActive) &#123; // å¦‚æžœæ˜¯æ´»åŠ¨çŠ¶æ€ï¼Œåˆ™å‘é€æ•°æ®ï¼Œé—®é¢˜ 1 å¾—åˆ°è§£é‡Š dispatchingValue(this); &#125;&#125; è¿™é‡Œç‰µæ‰¯äº† Lifecycle State æ¯”è¾ƒçš„çŸ¥è¯†ï¼Œè¯¦æƒ…åœ¨è¿™ åªæœ‰ STARTED å’Œ RESUMED çŠ¶æ€ shouldBeActive() æ‰è¿”å›ž trueï¼Œè‡³æ­¤é—®é¢˜ 1 å¾—åˆ°è§£é‡Š dispatchingValue æ–¹æ³•å†…éƒ¨è°ƒç”¨äº† considerNotify æ–¹æ³• 1234567891011121314151617private void considerNotify(ObserverWrapper observer) &#123; if (!observer.mActive) &#123; return; &#125; // å†æ¬¡åˆ¤æ–­ç”Ÿå‘½å‘¨æœŸæ‰€æœ‰è€…çŠ¶æ€ if (!observer.shouldBeActive()) &#123; observer.activeStateChanged(false); return; &#125; // æ¯”è¾ƒç‰ˆæœ¬å· if (observer.mLastVersion &gt;= mVersion) &#123; return; &#125; observer.mLastVersion = mVersion; // è°ƒç”¨æˆ‘ä»¬ä¼ å…¥çš„ mObserver çš„ onChanged æ–¹æ³• observer.mObserver.onChanged((T) mData);&#125; å¯ä»¥çœ‹åˆ° considerNotify ä¸­æ¯”è¾ƒäº† observer çš„ç‰ˆæœ¬å·ï¼Œå¦‚æžœæ˜¯æœ€æ–°çš„æ•°æ®ï¼Œç›´æŽ¥ return è€Œ mVersion åœ¨ setValue æ–¹æ³•ä¸­ è¿›è¡Œæ›´æ”¹ 1234567@MainThreadprotected void setValue(T value) &#123; // æ¯æ¬¡è®¾ç½®å¯¹ mVersion è¿›è¡Œ++ mVersion++; mData = value; dispatchingValue(null);&#125; å› æ­¤ LiveData æ¯æ¬¡éƒ½æŒæœ‰æœ€æ–°çš„æ•°æ®ï¼Œé—®é¢˜ 3 å¾—åˆ°è§£é‡Š æ€»ç»“å›žåˆ°æœ¬æ–‡å¼€å¤´çš„æ€è€ƒï¼ŒAndroid å¼€å‘è€…çš„ä¸»è¦å·¥ä½œæ˜¯å°†æ•°æ®è½¬æ¢æˆ UI ï¼Œè€Œ LiveData æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ã€Œæ•°æ®é©±åŠ¨ã€ï¼Œå³é€šè¿‡æ”¹å˜çŠ¶æ€æ•°æ®ï¼Œæ¥é©±åŠ¨è§†å›¾æ ‘ä¸­ç»‘å®šäº†ç›¸åº”çŠ¶æ€æ•°æ®çš„æŽ§ä»¶é‡æ–°å‘ç”Ÿç»˜åˆ¶ã€‚Flutter å’Œæœªæ¥çš„ Jetpack Compose é‡‡ç”¨çš„éƒ½æ˜¯è¿™ç§æœºåˆ¶ã€‚ä½¿ç”¨ ViewModel + LiveDataï¼Œå¯ä»¥ å®‰å…¨åœ°åœ¨è®¢é˜…è€…çš„ç”Ÿå‘½å‘¨æœŸå†…åˆ†å‘æ­£ç¡®çš„æ•°æ®ï¼Œä½¿å¼€å‘è€…ä¸çŸ¥ä¸è§‰ä¸­å®Œæˆäº† UI -&gt; ViewModel -&gt; Data çš„å•å‘ä¾èµ–ã€‚ æ‰€è°“æž¶æž„ï¼Œå¾ˆå¤šæ—¶å€™ä¸æ˜¯ä½¿ç”¨å®ƒèƒ½åšä»€ä¹ˆï¼Œæ›´å¤šçš„æ˜¯ä¸è¦åšä»€ä¹ˆï¼Œä½¿ç”¨å®ƒæ—¶å¼€å‘è€…èƒ½å¤Ÿå¾—åˆ°çº¦æŸï¼Œä»¥ä¾¿äº§å‡ºæ›´å¥å£®çš„ä»£ç  å„ä½å°ä¼™ä¼´å¦‚æžœæœ‰ä»€ä¹ˆæƒ³æ³•æ¬¢è¿Žåœ¨è¯„è®ºåŒºç•™è¨€ å…³äºŽæˆ‘ æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€èƒŒä¸ŠJetpackä¹‹Lifecycleã€‘ä¸‡ç‰©åŸºäºŽLifecycle é»˜é»˜æ— é—»å¤§ä½œç”¨]]></title>
    <url>%2F2020%2F03%2F30%2FJetpack-Lifecycle%2F</url>
    <content type="text"><![CDATA[Android ä¸­æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µï¼šã€Œç”Ÿå‘½å‘¨æœŸã€ã€‚åˆšæ¯•ä¸šåŽ»é¢è¯•ï¼Œæ€»ä¼šè¢«é—®åˆ°ã€Œå››å¤§ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€è¿™ç±»çš„é—®é¢˜ã€‚17å¹´çš„ IO å¤§ä¼šä¸Šï¼ŒGoogle æŽ¨å‡ºäº† Lifecycle-Aware Componentsï¼ˆç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶ï¼‰ï¼Œå¸®åŠ©å¼€å‘è€…ç»„ç»‡æ›´å¥½ï¼Œæ›´è½»é‡ï¼Œæ˜“äºŽç»´æŠ¤çš„ä»£ç  æœ¬æ–‡ä»‹ç» Lifecycle çš„èŒè´£ä»¥åŠç®€å•åˆ†æž lifecycle å¦‚ä½•æ„ŸçŸ¥ activity å’Œ fragment ï¼Œå¸®åŠ©æ‚¨å¯¹ Lifecycle æœ‰ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯† ä¸‡ç‰©åŸºäºŽ Lifecycleæ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸçš„ç—›è‹¦ä½ ä¸æ‡‚ é²è¿…æ›¾è¯´è¿‡ï¼šä¸‡ç‰©åŸºäºŽ Lifecycle å“¦ä¸å¯¹ Android ä¸­çš„è§†å›¾æŽ§åˆ¶å™¨å°±æœ‰è¿™ä¹ˆå¤šç”Ÿå‘½å‘¨æœŸçš„æƒ…å†µï¼Œæ‰€ä»¥å¤„ç†å¥½ç”Ÿå‘½å‘¨æœŸååˆ†é‡è¦ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ç”šè‡³æ˜¯ç¨‹åºå´©æºƒã€‚è¿™é‡Œå¼•ç”¨ å®˜æ–¹æ–‡æ¡£ çš„ä¾‹å­ 1234567891011121314151617181920212223242526272829303132333435363738class MyLocationListener &#123; public MyLocationListener(Context context, Callback callback) &#123; // ... &#125; void start() &#123; // è¿žæŽ¥ç³»ç»Ÿçš„å®šä½æœåŠ¡ &#125; void stop() &#123; // ä¸Žç³»ç»Ÿçš„å®šä½æœåŠ¡æ–­å¼€è¿žæŽ¥ &#125;&#125;class MyActivity extends AppCompatActivity &#123; private MyLocationListener myLocationListener; @Override public void onCreate(...) &#123; myLocationListener = new MyLocationListener(this, (location) -&gt; &#123; // æ›´æ–° UI &#125;); &#125; @Override public void onStart() &#123; super.onStart(); myLocationListener.start(); //ç®¡ç†å…¶ä»–éœ€è¦å“åº” activity ç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶ &#125; @Override public void onStop() &#123; super.onStop(); myLocationListener.stop(); //ç®¡ç†å…¶ä»–éœ€è¦å“åº” activity ç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶ &#125;&#125; æ­¤ç¤ºä¾‹çœ‹èµ·æ¥ä¸é”™ï¼Œåœ¨å®žé™…çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨ä»ç„¶ä¼šå“åº”ç”Ÿå‘½å‘¨æœŸçš„å½“å‰çŠ¶æ€è€Œè¿›è¡Œè¿‡å¤šçš„è°ƒç”¨æ¥ç®¡ç† UI å’Œå…¶ä»–ç»„ä»¶ã€‚ ç®¡ç†å¤šä¸ªç»„ä»¶ä¼šåœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æ”¾ç½®å¤§é‡ä»£ç ï¼Œä¾‹å¦‚ onStart() å’Œ onStop()ï¼Œè¿™ä½¿å®ƒä»¬éš¾ä»¥ç»´æŠ¤ è€Œä¸”ï¼Œä¸èƒ½ä¿è¯ç»„ä»¶åœ¨ activity æˆ– fragment åœæ­¢ä¹‹å‰å°±å·²å¯åŠ¨ã€‚ å¦‚æžœæˆ‘ä»¬éœ€è¦æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œï¼ˆä¾‹å¦‚onStart() ä¸­çš„æŸäº›é…ç½®æ£€æŸ¥ï¼‰ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´äº‰ç”¨æƒ…å†µï¼Œå…¶ä¸­onStop() æ–¹æ³•åœ¨ onStart() ä¹‹å‰å®Œæˆï¼Œä»Žè€Œä½¿ç»„ä»¶çš„ç”Ÿå­˜æœŸè¶…è¿‡äº†æ‰€éœ€çš„ç”Ÿå­˜æœŸã€‚ 1234567891011121314151617181920212223242526class MyActivity extends AppCompatActivity &#123; private MyLocationListener myLocationListener; public void onCreate(...) &#123; myLocationListener = new MyLocationListener(this, location -&gt; &#123; // æ›´æ–° UI &#125;); &#125; @Override public void onStart() &#123; super.onStart(); Util.checkUserStatus(result -&gt; &#123; // å¦‚æžœåœ¨ activity åœæ­¢åŽè°ƒç”¨æ­¤å›žè°ƒæ€Žä¹ˆåŠžï¼Ÿ if (result) &#123; myLocationListener.start(); &#125; &#125;); &#125; @Override public void onStop() &#123; super.onStop(); myLocationListener.stop(); &#125;&#125; å¦‚æžœæœ‰æ‰€æœ‰çš„ç»„ä»¶ï¼Œéƒ½èƒ½æ„ŸçŸ¥å¤–éƒ¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œèƒ½åœ¨ç›¸åº”çš„æ—¶æœºé‡Šæ”¾èµ„æºï¼Œå¹¶ä¸”åœ¨é”™è¿‡ç”Ÿå‘½å‘¨æœŸæ—¶èƒ½åŠæ—¶å«åœå¼‚æ­¥çš„ä»»åŠ¡å°±å¥½äº†ï¼Œ æˆ‘ä»¬ä¸å¦¨å…ˆæ€è€ƒä¸€ä¸‹ï¼Œå¦‚æžœå®žçŽ°è¿™æ ·çš„æƒ³æ³•ï¼Œåº”è¯¥å¦‚ä½•åš æŒ‰ç…§æƒ¯ä¾‹çš„æ€è€ƒé¦–å…ˆæˆ‘ä»¬å…ˆæ¥æ•´ç†ä¸€ä¸‹æˆ‘ä»¬çš„éœ€æ±‚ å†…éƒ¨ç»„ä»¶èƒ½å¤Ÿæ„ŸçŸ¥å¤–éƒ¨çš„ç”Ÿå‘½å‘¨æœŸ èƒ½å¤Ÿç»Ÿä¸€åœ°ç®¡ç†ï¼Œåšåˆ°ä¸€å¤„ä¿®æ”¹ï¼Œå¤„å¤„ç”Ÿæ•ˆ èƒ½å¤ŸåŠæ—¶å«åœé”™è¿‡çš„ä»»åŠ¡ é’ˆå¯¹éœ€æ±‚1ï¼Œå¯ä»¥ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå†…éƒ¨ç»„ä»¶èƒ½å¤Ÿåœ¨å¤–éƒ¨ç”Ÿå‘½å‘¨æœŸå˜åŒ–æ—¶åšå‡ºç›¸åº” é’ˆå¯¹éœ€æ±‚2ï¼Œå¯ä»¥å°†ä¾èµ–ç»„ä»¶çš„ä»£ç ç§»å‡ºç”Ÿå‘½å‘¨æœŸæ–¹æ³•å†…ï¼Œç„¶åŽç§»å…¥ç»„ä»¶æœ¬èº«ï¼Œè¿™æ ·åªéœ€ä¿®æ”¹ç»„ä»¶å†…éƒ¨é€»è¾‘å³å¯ é’ˆå¯¹éœ€æ±‚3ï¼Œå¯ä»¥åœ¨åˆé€‚çš„æ—¶æœºç§»é™¤è§‚å¯Ÿè€… è§‚å¯Ÿè€…æ¨¡å¼å…³äºŽå¼€å‘è€…æ¨¡å¼ï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ¯”è¾ƒè¯¦ç»†çš„äº†è§£æ˜¯åœ¨ æ‰”ç‰©çº¿ çš„ ç»™ Android å¼€å‘è€…çš„ RxJava è¯¦è§£ã€‚ è§‚å¯Ÿè€…æ¨¡å¼é¢å‘çš„éœ€æ±‚æ˜¯ï¼šA å¯¹è±¡ï¼ˆè§‚å¯Ÿè€…ï¼‰å¯¹ B å¯¹è±¡ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰çš„æŸç§å˜åŒ–é«˜åº¦æ•æ„Ÿï¼Œéœ€è¦åœ¨ B å˜åŒ–çš„ä¸€çž¬é—´åšå‡ºååº”ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ–°é—»é‡Œå–œé—»ä¹è§çš„è­¦å¯ŸæŠ“å°å·ï¼Œè­¦å¯Ÿéœ€è¦åœ¨å°å·ä¼¸æ‰‹ä½œæ¡ˆçš„æ—¶å€™å®žæ–½æŠ“æ•ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œè­¦å¯Ÿæ˜¯è§‚å¯Ÿè€…ï¼Œå°å·æ˜¯è¢«è§‚å¯Ÿè€…ï¼Œè­¦å¯Ÿéœ€è¦æ—¶åˆ»ç›¯ç€å°å·çš„ä¸€ä¸¾ä¸€åŠ¨ï¼Œæ‰èƒ½ä¿è¯ä¸ä¼šæ¼è¿‡ä»»ä½•çž¬é—´ã€‚ç¨‹åºçš„è§‚å¯Ÿè€…æ¨¡å¼å’Œè¿™ç§çœŸæ­£çš„ã€Žè§‚å¯Ÿã€ç•¥æœ‰ä¸åŒï¼Œè§‚å¯Ÿè€…ä¸éœ€è¦æ—¶åˆ»ç›¯ç€è¢«è§‚å¯Ÿè€…ï¼ˆä¾‹å¦‚ A ä¸éœ€è¦æ¯è¿‡ 2ms å°±æ£€æŸ¥ä¸€æ¬¡ B çš„çŠ¶æ€ï¼‰ï¼Œè€Œæ˜¯é‡‡ç”¨æ³¨å†Œ(Register)æˆ–è€…ç§°ä¸ºè®¢é˜…(Subscribe)çš„æ–¹å¼ï¼Œå‘Šè¯‰è¢«è§‚å¯Ÿè€…ï¼šæˆ‘éœ€è¦ä½ çš„æŸæŸçŠ¶æ€ï¼Œä½ è¦åœ¨å®ƒå˜åŒ–çš„æ—¶å€™é€šçŸ¥æˆ‘ã€‚ Android å¼€å‘ä¸­ä¸€ä¸ªæ¯”è¾ƒå…¸åž‹çš„ä¾‹å­æ˜¯ç‚¹å‡»ç›‘å¬å™¨ OnClickListener ã€‚å¯¹è®¾ç½® OnClickListener æ¥è¯´ï¼Œ View æ˜¯è¢«è§‚å¯Ÿè€…ï¼Œ OnClickListener æ˜¯è§‚å¯Ÿè€…ï¼ŒäºŒè€…é€šè¿‡ setOnClickListener() æ–¹æ³•è¾¾æˆè®¢é˜…å…³ç³»ã€‚è®¢é˜…ä¹‹åŽç”¨æˆ·ç‚¹å‡»æŒ‰é’®çš„çž¬é—´ï¼ŒAndroid Framework å°±ä¼šå°†ç‚¹å‡»äº‹ä»¶å‘é€ç»™å·²ç»æ³¨å†Œçš„ OnClickListener ã€‚é‡‡å–è¿™æ ·è¢«åŠ¨çš„è§‚å¯Ÿæ–¹å¼ï¼Œæ—¢çœåŽ»äº†åå¤æ£€ç´¢çŠ¶æ€çš„èµ„æºæ¶ˆè€—ï¼Œä¹Ÿèƒ½å¤Ÿå¾—åˆ°æœ€é«˜çš„åé¦ˆé€Ÿåº¦ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå¾—ç›ŠäºŽæˆ‘ä»¬å¯ä»¥éšæ„å®šåˆ¶è‡ªå·±ç¨‹åºä¸­çš„è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ï¼Œè€Œè­¦å¯Ÿå”å”æ˜Žæ˜¾æ— æ³•è¦æ±‚å°å·ã€Žä½ åœ¨ä½œæ¡ˆçš„æ—¶å€™åŠ¡å¿…é€šçŸ¥æˆ‘ã€ã€‚ OnClickListener çš„æ¨¡å¼å¤§è‡´å¦‚ä¸‹å›¾ï¼š ä¸Šè¿°æè¿°åŠå›¾ç‰‡å‡æ¥è‡ª ç»™ Android å¼€å‘è€…çš„ RxJava è¯¦è§£ å› æ­¤åœ¨ç”Ÿå‘½å‘¨æœŸç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‘ç”Ÿå˜åŒ–æ—¶å‘Šè¯‰è§‚å¯Ÿè€…ï¼Œå†…éƒ¨ç»„ä»¶å³å¯æ„ŸçŸ¥å¤–éƒ¨çš„ç”Ÿå‘½å‘¨æœŸ å¼•å…¥ Lifecycle åŽ12345678910111213public class MyObserver implements LifecycleObserver &#123; @OnLifecycleEvent(Lifecycle.Event.ON_RESUME) public void connectListener() &#123; ... &#125; @OnLifecycleEvent(Lifecycle.Event.ON_PAUSE) public void disconnectListener() &#123; ... &#125;&#125;myLifecycleOwner.getLifecycle().addObserver(new MyObserver()); æºç ç»“æž„ è¿™æ˜¯ Lifecycle çš„ç»“æž„ï¼ŒæŠ½è±¡ç±»ï¼Œå…¶å†…éƒ¨æœ‰ä¸¤ä¸ªæžšä¸¾ï¼Œåˆ†åˆ«ä»£è¡¨ç€ã€Œäº‹ä»¶ã€å’Œã€ŒçŠ¶æ€ã€ï¼Œæ­¤å¤–è¿˜æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œæ·»åŠ /ç§»é™¤è§‚å¯Ÿè€…ï¼ŒèŽ·å–å½“å‰çŠ¶æ€ æ³¨æ„ï¼Œè¿™é‡Œ State ä¸­çš„æžšä¸¾é¡ºåºæ˜¯æœ‰æ„ä¹‰çš„ï¼ŒåŽæ–‡è¯¦ç»†ä»‹ç» å…¶å®žçŽ°ç±»ä¸º LifecycleRegistry ï¼Œå¯ä»¥å¤„ç†å¤šä¸ªè§‚å¯Ÿè€… å…¶å†…éƒ¨æŒæœ‰å½“å‰çš„çŠ¶æ€ mState ï¼ŒLifecycleOwner ä»¥åŠè§‚å¯Ÿè€…çš„è‡ªå®šä¹‰åˆ—è¡¨ï¼ŒåŒæ—¶é‡å†™äº†çˆ¶ç±»çš„æ·»åŠ /åˆ é™¤è§‚å¯Ÿè€…çš„æ–¹æ³• LifecycleOwner ï¼Œå…·æœ‰ Android çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®šåˆ¶ç»„ä»¶å¯ä»¥ä½¿ç”¨è¿™äº›äº‹ä»¶æ¥å¤„ç†ç”Ÿå‘½å‘¨æœŸæ›´æ”¹ï¼Œè€Œæ— éœ€åœ¨ Activity æˆ– Fragment ä¸­å®žçŽ°ä»»ä½•ä»£ç  LifecycleObserver ï¼Œå°†ä¸€ä¸ªç±»æ ‡è®°ä¸º LifecycleObserverã€‚ å®ƒæ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œè€Œæ˜¯ä¾èµ–äºŽ OnLifecycleEvent æ³¨è§£çš„æ–¹æ³• LifecycleEventObserver ï¼Œå¯ä»¥æŽ¥æ”¶ä»»ä½•ç”Ÿå‘½å‘¨æœŸæ›´æ”¹å¹¶å°†å…¶åˆ†æ´¾ç»™æŽ¥æ”¶æ–¹ã€‚ å¦‚æžœä¸€ä¸ªç±»å®žçŽ°æ­¤æŽ¥å£å¹¶åŒæ—¶ä½¿ç”¨ OnLifecycleEventï¼Œåˆ™æ³¨è§£å°†è¢«å¿½ç•¥ DefaultLifecycleObserver ï¼Œç”¨äºŽç›‘å¬ LifecycleOwner çŠ¶æ€æ›´æ”¹çš„å›žè°ƒæŽ¥å£ã€‚ å¦‚æžœä¸€ä¸ªç±»åŒæ—¶å®žçŽ°äº†æ­¤æŽ¥å£å’Œ LifecycleEventObserverï¼Œåˆ™å°†é¦–å…ˆè°ƒç”¨DefaultLifecycleObserver çš„æ–¹æ³•ï¼Œç„¶åŽå†è°ƒç”¨LifecycleEventObserver.onStateChangedï¼ˆLifecycleOwnerï¼ŒLifecycle.Eventï¼‰ æ³¨æ„ï¼šä½¿ç”¨ DefaultLifecycleObserver éœ€å¼•å…¥ implementation â€œandroidx.lifecycle:lifecycle-common-java8:$lifecycle_versionâ€ ç®€å•çš„æºç åˆ†æžactivity ç”Ÿå‘½å‘¨æœŸå¤„ç†é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ androidx.activity.ComponentActivity ï¼Œè¿™ä¸ªç±»æˆ‘ä»¬è¿™ä¸ªç³»åˆ—çš„æ–‡ç« é‡Œæåˆ°å¤šæ¬¡ï¼Œç¬¬ä¸€æ¬¡æåŠæ˜¯åœ¨ ã€èƒŒä¸ŠJetpackã€‘ç»ä¸ä¸¢å¤±çš„çŠ¶æ€ androidx SaveState ViewModel-SaveState åˆ†æž ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹ã€‚ å…¶å®žçŽ°çš„æŽ¥å£å¤§å¤šæ•°æˆ‘ä»¬éƒ½å·²ç»æŽ¢è®¨è¿‡äº†ï¼Œä»Šå¤©æˆ‘ä»¬æ¥çœ‹çœ‹ LifecycleOwner ActivityResultCaller ä¸º activity 1.2.0-alpha02 æŽ¨å‡ºçš„ï¼Œæ—¨åœ¨ç»Ÿä¸€ onActivityResult ï¼Œè¿™é‡Œæš‚æ—¶ä¸è®¨è®ºå®ƒ æ—¢ç„¶å®žçŽ°äº† LifecycleOwner æŽ¥å£ï¼Œå¿…å®šé‡å†™ getLifecycle() æ–¹æ³• 1234567// androidx.activity.ComponentActivity.javaprivate final LifecycleRegistry mLifecycleRegistry = new LifecycleRegistry(this);@Overridepublic Lifecycle getLifecycle() &#123; return mLifecycleRegistry;&#125; å…¶è¿”å›žçš„ Lifecycle ä¸º å®žçŽ°ç±» LifecycleRegistry çš„å®žä¾‹ è€Œ activity æ“ä½œç”Ÿå‘½å‘¨æœŸæ˜¯é€šè¿‡ ReportFragment å¤„ç†çš„ 1234567891011121314151617181920// androidx.activity.ComponentActivity.javaprotected void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); ReportFragment.injectIfNeededIn(this); //...&#125;// ReportFragmentpublic static void injectIfNeededIn(Activity activity) &#123; if (Build.VERSION.SDK_INT &gt;= 29) &#123; // api 29 åŠä»¥ä¸Š ç›´æŽ¥æ³¨å†Œæ­£ç¡®çš„ç”Ÿå‘½å‘¨æœŸå›žè°ƒ activity.registerActivityLifecycleCallbacks( new LifecycleCallbacks()); &#125; android.app.FragmentManager manager = activity.getFragmentManager(); if (manager.findFragmentByTag(REPORT_FRAGMENT_TAG) == null) &#123; manager.beginTransaction().add(new ReportFragment(), REPORT_FRAGMENT_TAG).commit(); manager.executePendingTransactions(); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950// ReportFragment.javastatic void dispatch(@NonNull Activity activity, @NonNull Lifecycle.Event event) &#123; if (activity instanceof LifecycleRegistryOwner) &#123; ((LifecycleRegistryOwner) activity).getLifecycle().handleLifecycleEvent(event); return; &#125; if (activity instanceof LifecycleOwner) &#123; Lifecycle lifecycle = ((LifecycleOwner) activity).getLifecycle(); if (lifecycle instanceof LifecycleRegistry) &#123; ((LifecycleRegistry) lifecycle).handleLifecycleEvent(event); &#125; &#125;&#125;private void dispatch(@NonNull Lifecycle.Event event) &#123; if (Build.VERSION.SDK_INT &lt; 29) &#123; dispatch(getActivity(), event); &#125;&#125;@Overridepublic void onActivityCreated(Bundle savedInstanceState) &#123; super.onActivityCreated(savedInstanceState); dispatch(Lifecycle.Event.ON_CREATE);&#125;@Overridepublic void onStart() &#123; super.onStart(); dispatch(Lifecycle.Event.ON_START);&#125;@Overridepublic void onResume() &#123; super.onResume(); dispatch(Lifecycle.Event.ON_RESUME);&#125;@Overridepublic void onPause() &#123; super.onPause(); dispatch(Lifecycle.Event.ON_PAUSE);&#125;@Overridepublic void onStop() &#123; super.onStop(); dispatch(Lifecycle.Event.ON_STOP);&#125;@Overridepublic void onDestroy() &#123; super.onDestroy(); dispatch(Lifecycle.Event.ON_DESTROY);&#125; 123456789101112131415161718192021222324252627282930313233// LifecycleCallbacksstatic class LifecycleCallbacks implements Application.ActivityLifecycleCallbacks &#123; @Override public void onActivityPostCreated(@NonNull Activity activity, @Nullable Bundle savedInstanceState) &#123; dispatch(activity, Lifecycle.Event.ON_CREATE); &#125; @Override public void onActivityPostStarted(@NonNull Activity activity) &#123; dispatch(activity, Lifecycle.Event.ON_START); &#125; @Override public void onActivityPostResumed(@NonNull Activity activity) &#123; dispatch(activity, Lifecycle.Event.ON_RESUME); &#125; @Override public void onActivityPrePaused(@NonNull Activity activity) &#123; dispatch(activity, Lifecycle.Event.ON_PAUSE); &#125; @Override public void onActivityPreStopped(@NonNull Activity activity) &#123; dispatch(activity, Lifecycle.Event.ON_STOP); &#125; @Override public void onActivityPreDestroyed(@NonNull Activity activity) &#123; dispatch(activity, Lifecycle.Event.ON_DESTROY); &#125; //...&#125; åœ¨ activity çš„ onCreate æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº† ReportFragment ä¸­çš„é™æ€æ–¹æ³• injectIfNeededIn() ã€‚è€Œå…¶å†…éƒ¨ï¼Œå¦‚æžœ api 29 åŠä»¥ä¸Šçš„è®¾å¤‡ä¸Šç›´æŽ¥æ³¨å†Œæ­£ç¡®çš„ç”Ÿå‘½å‘¨æœŸå›žè°ƒï¼Œä½Žç‰ˆæœ¬é€šè¿‡å¯åŠ¨ ReportFragment ï¼Œå€ŸåŠ© fragment å„ä¸ªç”Ÿå‘½å‘¨æœŸæ¥å¤„ç†ç”Ÿå‘½å‘¨æœŸå›žè°ƒ fragment ç”Ÿå‘½å‘¨æœŸå¤„ç†åœ¨ fragment å†…éƒ¨ï¼Œæ¯ä¸ªç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹è°ƒç”¨ handleLifecycleEvent æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243// Fragment.javapublic Fragment() &#123; initLifecycle();&#125;private void initLifecycle() &#123; mLifecycleRegistry = new LifecycleRegistry(this);&#125;@Overridepublic Lifecycle getLifecycle() &#123; return mLifecycleRegistry;&#125;void performCreate(Bundle savedInstanceState) &#123; onCreate(savedInstanceState); mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_CREATE); &#125;void performStart() &#123; onStart(); mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_START);&#125;void performResume() &#123; onResume(); mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_RESUME); &#125;void performPause() &#123; mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_PAUSE); onPause();&#125;void performStop() &#123; mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_STOP); onStop();&#125;void performDestroy() &#123; mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_DESTROY); onDestroy();&#125; Lifecycle State å¤§å°æ¯”è¾ƒLifecycle.State ä¸­æœ‰ä¸€ä¸ª isAtLeast æ–¹æ³•ï¼Œç”¨äºŽåˆ¤æ–­å½“å‰çŠ¶æ€æ˜¯å¦ä¸å°äºŽä¼ å…¥çš„çŠ¶æ€ 1234// Lifecycle.Statepublic boolean isAtLeast(@NonNull State state) &#123; return compareTo(state) &gt;= 0;&#125; æžšä¸¾çš„ compareTo æ–¹æ³•å…¶å®žæ˜¯æ¯”è¾ƒçš„æžšä¸¾å£°æ˜Žçš„é¡ºåº è€Œ State çš„é¡ºåºä¸º DESTROYED -&gt; INITIALIZED -&gt; CREATED -&gt; STARTED -&gt; RESUMED å¦‚æžœä¼ å…¥çš„ state ä¸º STARTEDï¼Œåˆ™å½“å‰çŠ¶æ€ä¸º STARTED æˆ– RESUMED æ—¶è¿”å›ž true ï¼Œå¦åˆ™è¿”å›ž false LiveData ç¯‡ä¼šç”¨åˆ°è¿™ä¸ªçŸ¥è¯†ç‚¹ å…³äºŽæˆ‘ æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€èƒŒä¸ŠJetpackä¹‹ViewModelã€‘å³ä½¿æ‚¨ä¸ä½¿ç”¨MVVMä¹Ÿè¦äº†è§£ViewModel ViewModelçš„èŒèƒ½è¾¹ç•Œ]]></title>
    <url>%2F2020%2F03%2F23%2FJetpack-ViewModel%2F</url>
    <content type="text"><![CDATA[å‰è¨€ Android å¼€å‘æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ activity å’Œ fragment ä½œä¸ºè§†å›¾æŽ§åˆ¶å™¨ï¼Œ å¯èƒ½è¿˜ä¼šä½¿ç”¨æœ‰ä¸€äº›ç±»å¯ä»¥å­˜å‚¨å’Œæä¾› UI æ•°æ®ï¼ˆä¾‹å¦‚MVPä¸­çš„ Presenter ï¼‰ ä½†æ˜¯ å½“é…ç½®æ›´æ”¹æ—¶ï¼ˆå¦‚æ—‹è½¬å±å¹•ï¼‰ï¼Œactivity ä¼šé‡å»ºï¼Œä½†å¯¹äºŽ UI æ•°æ®çš„æŒæœ‰è€…å‘¢ï¼Ÿ å¼€å‘è€…éœ€è¦é‡æ–°ä¿å­˜ç›¸å…³çš„ä¿¡æ¯å¹¶ä¼ é€’ç»™é‡å»ºçš„ activity ï¼Œå¦åˆ™å¼€å‘è€…å¿…é¡»å†æ¬¡èŽ·å–æ•°æ®ï¼ˆé€šè¿‡ç½‘ç»œè¯·æ±‚æˆ–æœ¬åœ°æ•°æ®åº“ï¼‰ ç”±äºŽ UI æ•°æ®çš„æŒæœ‰è€…çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½æ¯” activity é•¿ï¼Œå› æ­¤å¼€å‘è€…è¿˜éœ€è¦é¿å…å‡ºçŽ°å†…å­˜æ³„æ¼çš„é—®é¢˜ å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜ï¼ŸViewModel æœ¬æ–‡é‡ç‚¹ä»‹ç» ViewModel çš„èŒè´£ï¼ˆwhatï¼‰ä»¥åŠé‡ç‚¹åŠŸèƒ½çš„å®žçŽ°åŽŸç†ï¼ˆhowï¼‰ï¼Œå³ä½¿æ‚¨ä¸ä½¿ç”¨ Jetpack MVVM æž¶æž„ï¼Œä¹Ÿè¦äº†è§£ä¸€ä¸‹ ViewModel ViewModel çš„åŽŸç†éƒ¨åˆ†è¦æ±‚æ‚¨äº†è§£ activity çš„å¯åŠ¨æµç¨‹ï¼Œè¿™éƒ¨åˆ†å†…å®¹ç½‘ä¸Šæ–‡ç« å¾ˆå¤šï¼Œæœ¬æ–‡ä¸å†èµ˜è¿° ViewModel çš„èŒè´£æˆ‘å…ˆä¸Šä¸ª è§†é¢‘ ï¼Œè¿™ä¸ªå°å§å§è¡¨è¿°çš„æ¯”æ–‡å­—æ›´å½¢è±¡ ViewModel ä¸»è¦ç”¨äºŽå­˜å‚¨ UI æ•°æ®ä»¥åŠç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„æ•°æ® å›¾ç‰‡æ¥è‡ª Android Architecture Components: ViewModel ViewModel çš„ç”Ÿå‘½å‘¨æœŸ ï¼Œå›¾ç‰‡æ¥è‡ª å®˜æ–¹æ–‡æ¡£ ä½œä¸ºæ•°æ®æŒæœ‰è€…ViewModel èƒ½å¤Ÿå®žæ—¶è¿›è¡Œé…ç½®æ›´æ”¹ã€‚ è¿™æ„å‘³ç€å³ä½¿åœ¨æ‰‹æœºæ—‹è½¬åŽé”€æ¯å¹¶é‡æ–°åˆ›å»º activity ä¹‹åŽï¼Œæ‚¨ä»ç„¶æ‹¥æœ‰ç›¸åŒçš„ ViewModel å’Œç›¸åŒçš„æ•°æ®ã€‚ å› æ­¤ï¼š æ‚¨æ— éœ€æ‹…å¿ƒ UI æ•°æ®æŒæœ‰è€…çš„ç”Ÿå‘½å‘¨æœŸã€‚ ViewModel å°†ç”±å·¥åŽ‚è‡ªåŠ¨åˆ›å»ºï¼Œæ‚¨æ— éœ€è‡ªè¡Œåˆ›å»ºå’Œé”€æ¯ æ•°æ®å°†å§‹ç»ˆæ›´æ–°ï¼Œæ—‹è½¬æ‰‹æœºåŽï¼Œæ‚¨å°†èŽ·å¾—ä¸Žä»¥å‰ç›¸åŒçš„æ•°æ®ã€‚ å› æ­¤ï¼Œæ‚¨æ— éœ€æ‰‹åŠ¨å°†æ•°æ®ä¼ é€’ç»™æ–°çš„ activity å®žä¾‹æˆ–å†æ¬¡è°ƒç”¨ç½‘ç»œæˆ–æ•°æ®åº“æ¥èŽ·å–æ•°æ®ã€‚ Fragment é—´å…±äº«æ•°æ®ä¸€ä¸ª activity ä¸­çš„ä¸¤ä¸ªæˆ–æ›´å¤š fragment éœ€è¦ç›¸äº’é€šä¿¡æ˜¯å¾ˆå¸¸è§çš„ã€‚ä¾‹å¦‚æ‚¨æœ‰ä¸€ä¸ªç‰‡æ®µï¼Œç”¨æˆ·åœ¨å…¶ä¸­ä»Žåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ª itemï¼Œå¦ä¸€ä¸ªç‰‡æ®µæ˜¾ç¤ºäº†æ‰€é€‰ item çš„å†…å®¹ã€‚ ä¼ ç»Ÿåšæ³•ä¸¤ä¸ª fragment éƒ½éœ€è¦å®šä¹‰ä¸€äº›æŽ¥å£ï¼Œå¹¶ä¸”å®¿ä¸» activity å¿…é¡»å°†ä¸¤è€…ç»‘å®šåœ¨ä¸€èµ·ã€‚ æ­¤å¤–ï¼Œä¸¤ä¸ª fragment éƒ½å¿…é¡»å¤„ç†å¦ä¸€ä¸ª fragment å°šæœªåˆ›å»ºæˆ–ä¸å¯è§çš„æƒ…å†µã€‚ å¯ä»¥é€šè¿‡ä½¿ç”¨ ViewModel å¯¹è±¡è§£å†³æ­¤é—®é¢˜ã€‚ è¿™äº› fragment å¯ä»¥ä½¿ç”¨ activity èŒƒå›´å†…å…±äº«ä¸€ä¸ª ViewModel æ¥å¤„ç†æ­¤é€šä¿¡ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹ä»£ç æ‰€ç¤ºï¼š 1234567891011121314151617181920212223242526272829303132333435public class SharedViewModel extends ViewModel &#123; private final MutableLiveData&lt;Item&gt; selected = new MutableLiveData&lt;Item&gt;(); public void select(Item item) &#123; selected.setValue(item); &#125; public LiveData&lt;Item&gt; getSelected() &#123; return selected; &#125;&#125;public class MasterFragment extends Fragment &#123; private SharedViewModel model; public void onViewCreated(@NonNull View view, Bundle savedInstanceState) &#123; super.onViewCreated(view, savedInstanceState); model = new ViewModelProvider(requireActivity()).get(SharedViewModel.class); itemSelector.setOnClickListener(item -&gt; &#123; model.select(item); &#125;); &#125;&#125;public class DetailFragment extends Fragment &#123; public void onViewCreated(@NonNull View view, Bundle savedInstanceState) &#123; super.onViewCreated(view, savedInstanceState); SharedViewModel model = new ViewModelProvider(requireActivity()).get(SharedViewModel.class); model.getSelected().observe(getViewLifecycleOwner(), &#123; item -&gt; // Update the UI. &#125;); &#125;&#125; ç”±äºŽ ä¸¤ä¸ª fragment ä½¿ç”¨çš„éƒ½æ˜¯ activity èŒƒå›´çš„ ViewModel ï¼ˆViewModelProvider æž„é€ å™¨ä¼ å…¥çš„ activity ï¼‰ï¼Œå› æ­¤å®ƒä»¬èŽ·å¾—äº†ç›¸åŒçš„ ViewModel å®žä¾‹ï¼Œè‡ªç„¶å…¶æŒæœ‰çš„æ•°æ®ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œè¿™ä¹Ÿ ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ è¿™ç§æ–¹æ³•å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š å®¿ä¸» activity æ— éœ€æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä¹Ÿæ— éœ€äº†è§£æ­¤é€šä¿¡ã€‚ é™¤ SharedViewModel å¤–ï¼Œfragment ä¸éœ€è¦å½¼æ­¤äº†è§£ã€‚ å¦‚æžœå…¶ä¸­ä¸€ä¸ª fragment æ¶ˆå¤±äº†ï¼Œåˆ™å¦ä¸€ä¸ªç»§ç»­ç…§å¸¸å·¥ä½œã€‚ æ¯ä¸ª fragment éƒ½æœ‰å…¶è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”ä¸å—å¦ä¸€ä¸ª fragment çš„ç”Ÿå‘½å‘¨æœŸå½±å“ã€‚ å¦‚æžœä¸€ä¸ª fragment æ›¿æ¢äº†å¦ä¸€ä¸ª fragmentï¼Œåˆ™ UI å¯ä»¥ç»§ç»­æ­£å¸¸å·¥ä½œè€Œä¸ä¼šå‡ºçŽ°ä»»ä½•é—®é¢˜ã€‚ ä»£æ›¿ LoaderCursorLoader è¿™æ ·çš„ Loader ç±»ç»å¸¸ç”¨äºŽä½¿åº”ç”¨ç¨‹åº UI ä¸­çš„æ•°æ®ä¸Žæ•°æ®åº“ä¿æŒåŒæ­¥ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ ViewModel å’Œå…¶ä»–ä¸€äº›ç±»æ¥æ›¿æ¢ Loaderã€‚ ä½¿ç”¨ ViewModel å¯å°†è§†å›¾æŽ§åˆ¶å™¨ä¸Žæ•°æ®åŠ è½½æ“ä½œåˆ†å¼€ï¼Œè¿™æ„å‘³ç€æ‚¨åœ¨ç±»ä¹‹é—´çš„å¼ºå¼•ç”¨è¾ƒå°‘ã€‚ åœ¨ä½¿ç”¨ Loader çš„ä¸€ç§å¸¸è§æ–¹æ³•ä¸­ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šä½¿ç”¨ CursorLoader æ¥è§‚å¯Ÿæ•°æ®åº“çš„å†…å®¹ã€‚ å½“æ•°æ®åº“ä¸­çš„å€¼æ›´æ”¹æ—¶ï¼ŒåŠ è½½ç¨‹åºä¼šè‡ªåŠ¨è§¦å‘æ•°æ®çš„é‡æ–°åŠ è½½å¹¶æ›´æ–° UI å›¾ç‰‡æ¥è‡ª å®˜æ–¹æ–‡æ¡£ ViewModel ä¸Ž Room å’Œ LiveData ä¸€èµ·ä½¿ç”¨ä»¥æ›¿æ¢ Loaderã€‚ ViewModel ç¡®ä¿æ•°æ®åœ¨è®¾å¤‡é…ç½®æ›´æ”¹åŽä»ç„¶å­˜åœ¨ã€‚ å½“æ•°æ®åº“å‘ç”Ÿæ›´æ”¹æ—¶ï¼ŒRoom ä¼šé€šçŸ¥ LiveData ï¼Œç„¶åŽ LiveData ä¼šä½¿ç”¨ä¿®æ”¹åŽçš„æ•°æ®æ›´æ–° UI å›¾ç‰‡æ¥è‡ª å®˜æ–¹æ–‡æ¡£ æ€»ç»“ ViewModel å¯ä½œä¸º UI æ•°æ®çš„æŒæœ‰è€…ï¼Œåœ¨ activity/fragment é‡å»ºæ—¶ ViewModel ä¸­çš„æ•°æ®ä¸å—å½±å“ï¼ŒåŒæ—¶å¯ä»¥é¿å…å†…å­˜æ³„æ¼ å¯ä»¥é€šè¿‡ ViewModel æ¥è¿›è¡Œ activity å’Œ fragment ï¼Œfragment å’Œ fragment ä¹‹é—´çš„é€šä¿¡ï¼Œæ— éœ€å…³å¿ƒé€šä¿¡çš„å¯¹æ–¹æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨ application èŒƒå›´çš„ ViewModel å¯ä»¥è¿›è¡Œå…¨å±€é€šä¿¡ å¯ä»¥ä»£æ›¿ Loader ViewModel æºç åˆ†æžåˆ†æžæºç æ—¶æˆ‘ä»¬å¯ä»¥ä¸è®¡è¾ƒç»†æžæœ«èŠ‚ï¼Œåªåˆ†æžä¸»è¦çš„é€»è¾‘å³å¯ã€‚å› æ­¤æˆ‘ä»¬æ¥æ€è€ƒå‡ ä¸ªé—®é¢˜ï¼Œå¹¶ä»Žæºç ä¸­å¯»æ‰¾ç­”æ¡ˆ å¦‚ä½•åšåˆ° activity é‡å»ºåŽ ViewModel ä»ç„¶å­˜åœ¨ï¼Ÿ å¦‚ä½•åšåˆ° fragment é‡å»ºåŽ ViewModel ä»ç„¶å­˜åœ¨ï¼Ÿ å¦‚ä½•æŽ§åˆ¶ä½œç”¨åŸŸï¼Ÿï¼ˆå³ä¿è¯ç›¸åŒä½œç”¨åŸŸèŽ·å–çš„ ViewModel å®žä¾‹ç›¸åŒï¼‰ å¦‚ä½•é¿å…å†…å­˜æ³„æ¼ï¼Ÿ ç»´æŒæˆ‘ä»¬ä¸€è´¯çš„é£Žæ ¼ï¼Œæˆ‘ä»¬å…ˆæ¥å¤§èƒ†åœ°çŒœä¸€çŒœ å¯¹äºŽé—®é¢˜1 ï¼šactivity æœ‰ç€ saveInstanceState æœºåˆ¶ï¼Œå› æ­¤å¯èƒ½é€šè¿‡è¯¥æœºåˆ¶æ¥å¤„ç†ï¼ˆäº‹å®žè¯æ˜Žä¸æ˜¯ï¼‰ å¯¹äºŽé—®é¢˜2ï¼šå¯èƒ½ fragment é€šè¿‡ å®¿ä¸» activity æˆ– çˆ¶ fragment çš„å¸®åŠ©æ¥ç¡®ä¿ ViewModel å®žä¾‹åœ¨é‡å»ºåŽä»ç„¶å­˜åœ¨ å¯¹äºŽé—®é¢˜3ï¼šå®žçŽ°ä¸€ä¸ªç±»ä¼¼å•ä¾‹çš„æ•ˆæžœï¼Œç›¸åŒä½œç”¨åŸŸèŽ·å–çš„å¯¹è±¡æ˜¯ç›¸åŒçš„ å¯¹äºŽé—®é¢˜4ï¼šé¿å… ViewModel æŒæœ‰ view æˆ– context çš„å¼•ç”¨ é¦–å…ˆæˆ‘ä»¬è¦å…ˆäº†è§£ä¸€ä¸‹ ViewModel çš„ç»“æž„ ViewModelï¼šæŠ½è±¡ç±»ï¼Œä¸»è¦æœ‰ clear æ–¹æ³•ï¼Œå®ƒæ˜¯ final çº§ï¼Œä¸å¯ä¿®æ”¹ï¼Œclear æ–¹æ³•ä¸­åŒ…å« onClear é’©å­ï¼Œå¼€å‘è€…å¯é‡å†™ onClear æ–¹æ³•æ¥è‡ªå®šä¹‰æ•°æ®çš„æ¸…ç©º ViewModelStoreï¼šå†…éƒ¨ç»´æŠ¤ä¸€ä¸ª HashMap ä»¥ç®¡ç† ViewModel ViewModelStoreOwnerï¼šæŽ¥å£ï¼ŒViewModelStore çš„ä½œç”¨åŸŸï¼Œå®žçŽ°ç±»ä¸º ComponentActivity å’Œ Fragmentï¼Œæ­¤å¤–è¿˜æœ‰ FragmentActivity.HostCallbacks ViewModelProviderï¼šç”¨äºŽåˆ›å»º ViewModelï¼Œå…¶æž„é€ æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ ViewModelStoreOwner ï¼Œç¡®å®šäº† ViewModelStore çš„ä½œç”¨åŸŸï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º ViewModelProvider.Factoryï¼Œç”¨äºŽåˆå§‹åŒ– ViewModel å¯¹è±¡ï¼Œé»˜è®¤ä¸º getDefaultViewModelProviderFactory() æ–¹æ³•èŽ·å–çš„ factory ç®€å•æ¥è¯´ ViewModelStoreOwner æŒæœ‰ ViewModelStore æŒæœ‰ ViewModel 1. å¦‚ä½•åšåˆ° activity é‡å»ºåŽ ViewModel ä»ç„¶å­˜åœ¨ï¼Ÿåœ¨ ã€èƒŒä¸ŠJetpackã€‘ç»ä¸ä¸¢å¤±çš„çŠ¶æ€ androidx SaveState ViewModel-SaveState åˆ†æž ä¸­æˆ‘ä»¬æåˆ°äº† androidx.core.app.ComponentActivity çš„å¼•å…¥å¹¶æŽ¢è®¨äº†å…¶ä½œä¸ºä¸­é—´å±‚çš„ä½œç”¨ æˆ‘ä»¬å·²ç»è®²è¿‡ SavedStateRegistryOwner å’Œ OnBackPressedDispatcherOwner è¿™ä¸¤ç§è§’è‰²ï¼Œè€Œä»Šå¤©æˆ‘ä»¬æ¥èŠä¸€ä¸‹ ViewModelStoreOwner å’Œ HasDefaultViewModelProviderFactory ã€‚å…¶ä¸­å‰è€…ä»£è¡¨ç€ ViewModelStore çš„ä½œç”¨åŸŸï¼ŒåŽè€…æ¥æ ‡è®° ViewModelStoreOwner æ‹¥æœ‰é»˜è®¤çš„ ViewModelProvider.Factory é‚£ä¹ˆ ViewModel çš„é€»è¾‘è‚¯å®šå°±åœ¨è¯¥ç±»äº† ComponentActivity å®žçŽ°äº† ViewModelStoreOwner æŽ¥å£ï¼Œæ„å‘³ç€éœ€è¦é‡å†™ getViewModelStore() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸º ComponentActivity çš„ mViewModelStore å˜é‡èµ‹å€¼ã€‚activity é‡å»ºåŽ ViewModel ä»ç„¶å­˜åœ¨ï¼Œåªè¦ä¿è¯ activity é‡å»ºåŽ mViewModelStore å˜é‡å€¼ä¸å˜å³å¯ é¡ºç€è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ getViewModelStore() çš„å®žçŽ° 1234567891011121314public ViewModelStore getViewModelStore() &#123; if (mViewModelStore == null) &#123; NonConfigurationInstances nc = (NonConfigurationInstances) getLastNonConfigurationInstance(); if (nc != null) &#123; //æ ¸å¿ƒï¼Œåœ¨è¯¥ä½ç½®é‡ç½® mViewModelStore mViewModelStore = nc.viewModelStore; &#125; if (mViewModelStore == null) &#123; mViewModelStore = new ViewModelStore(); &#125; &#125; return mViewModelStore;&#125; å³ mViewModelStore çš„å€¼ç”± getLastNonConfigurationInstance() è¿”å›žçš„ NonConfigurationInstances å¯¹è±¡ä¸­çš„ viewModelStore èµ‹å€¼ï¼Œå¦‚æžœæ­¤æ—¶è¿˜ä¸ºç©ºæ‰åŽ» new ViewModelStore å¯¹è±¡ã€‚å› æ­¤æˆ‘ä»¬åªéœ€æ‰¾åˆ° getLastNonConfigurationInstance ä¸­çš„ NonConfigurationInstances åœ¨å“ªé‡Œä¿å­˜çš„å³å¯ getLastNonConfigurationInstance ä¸ºå¹³å° activity ä¸­çš„æ–¹æ³•ï¼Œè¿”å›ž mLastNonConfigurationInstances.activity 1234public Object getLastNonConfigurationInstance() &#123; return mLastNonConfigurationInstances != null ? mLastNonConfigurationInstances.activity : null;&#125; é‚£ä¹ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ mLastNonConfigurationInstances çš„èµ‹å€¼ä½ç½® 12345//çœç•¥å…¶ä»–å‚æ•°final void attach(NonConfigurationInstances lastNonConfigurationInstances)&#123; mLastNonConfigurationInstances = lastNonConfigurationInstances; //...&#125; äº†è§£è¿‡ activity çš„å¯åŠ¨æµç¨‹çš„å°ä¼™ä¼´è‚¯å®šçŸ¥é“ï¼Œè¿™ä¸ª attach æ–¹æ³•æ˜¯ ActivityThread ä¸­çš„ performLaunchActivity è°ƒç”¨çš„ 1234567private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123; Activity activity = mInstrumentation.newActivity(cl, component.getClassName(), r.intent); //çœç•¥å…¶ä»–å‚æ•° activity.attach(r.lastNonConfigurationInstances); r.lastNonConfigurationInstances = null; //...&#125; æ·±å…¥è¿½è¸ªæºç æˆ‘ä»¬æ•´ç†ä¸€ä¸‹è°ƒç”¨æµç¨‹ ç”±äºŽ ActivityThread ä¸­çš„ ActivityClientRecord ä¸å— activity é‡å»ºçš„å½±å“ï¼Œæ‰€ä»¥ activity é‡å»ºæ—¶ mLastNonConfigurationInstances èƒ½å¤Ÿå¾—åˆ°ä¸Šä¸€æ¬¡çš„å€¼ï¼Œä½¿å¾— ViewModelStore å€¼ä¸å˜ ï¼Œé—®é¢˜1å°±è§£å†³äº† 2. å¦‚ä½•åšåˆ° fragment é‡å»ºåŽ ViewModel ä»ç„¶å­˜åœ¨ï¼Ÿå¯¹äºŽé—®é¢˜2ï¼Œæœ‰äº†ä¸Šé¢çš„æ€è·¯æˆ‘ä»¬å¯ä»¥è®¤å®š fragment é‡å»ºåŽå…¶å†…éƒ¨çš„ getViewModelStore() æ–¹æ³•è¿”å›žçš„å¯¹è±¡æ˜¯ç›¸åŒçš„ã€‚ 1234// Fragment.javapublic ViewModelStore getViewModelStore() &#123; return mFragmentManager.getViewModelStore(this);&#125; å¯ä»¥çœ‹åˆ° getViewModelStore() å†…éƒ¨è°ƒç”¨çš„æ˜¯ mFragmentManagerï¼ˆæ™®é€šfragment å¯¹åº” activity ä¸­çš„ FragmentManagerï¼Œå­ fragment åˆ™å¯¹åº”çˆ¶ fragment çš„ childFragmentManagerï¼‰çš„ getViewModelStore() æ–¹æ³• 123456// FragmentManager.javaprivate FragmentManagerViewModel mNonConfig;ViewModelStore getViewModelStore(@NonNull Fragment f) &#123; return mNonConfig.getViewModelStore(f);&#125; è€Œ FragmentManager ä¸­çš„ getViewModelStore ä½¿ç”¨çš„æ˜¯ mNonConfig ï¼ŒmNonConfig ç«Ÿç„¶æ˜¯ä¸ª ViewModelï¼ 123// FragmentManagerViewModel.javaprivate final HashMap&lt;String, FragmentManagerViewModel&gt; mChildNonConfigs = new HashMap&lt;&gt;();private final HashMap&lt;String, ViewModelStore&gt; mViewModelStores = new HashMap&lt;&gt;(); FragmentManagerViewModel ç®¡ç†ç€å†…éƒ¨çš„ ViewModelStore å’Œ child çš„ FragmentManagerViewModel ã€‚å› æ­¤ä¿è¯ mNonConfig å€¼ä¸å˜å³èƒ½ç¡®ä¿ fragment ä¸­çš„ getViewModelStore() ä¸å˜ã€‚é‚£ä¹ˆçœ‹çœ‹ mNonConfig èµ‹å€¼çš„ä½ç½® 12345678910111213141516171819202122// FragmentManager.javavoid attachController(@NonNull FragmentHostCallback&lt;?&gt; host, @NonNull FragmentContainer container, @Nullable final Fragment parent) &#123; //... if (parent != null) &#123; // åµŒå¥— fragment çš„æƒ…å†µï¼Œæœ‰çˆ¶ fragment mNonConfig = parent.mFragmentManager.getChildNonConfig(parent); &#125; else if (host instanceof ViewModelStoreOwner) &#123; // host æ˜¯ FragmentActivity.HostCallbacks ViewModelStore viewModelStore = ((ViewModelStoreOwner) host).getViewModelStore(); mNonConfig = FragmentManagerViewModel.getInstance(viewModelStore); &#125; else &#123; mNonConfig = new FragmentManagerViewModel(false); &#125;&#125;// FragmentManagerViewModel.javastatic FragmentManagerViewModel getInstance(ViewModelStore viewModelStore) &#123; ViewModelProvider viewModelProvider = new ViewModelProvider(viewModelStore, FACTORY); return viewModelProvider.get(FragmentManagerViewModel.class);&#125; æˆ‘ä»¬å…ˆçœ‹ fragment çš„ç›´æŽ¥å®¿ä¸»æ˜¯ activity ï¼ˆå³æ²¡æœ‰åµŒå¥—ï¼‰çš„æƒ…å†µï¼ŒmNonConfig ç”±FragmentManagerViewModel.getInstance(viewModelStore) èµ‹å€¼ï¼Œè€Œ getInstance ä¸­ä½¿ç”¨çš„æ˜¯ ViewModelProvider èŽ·å– ViewModel ï¼Œæ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„åˆ†æžï¼Œåªè¦ä¿è¯ä½œç”¨åŸŸï¼ˆviewModelStoreï¼‰ç›¸åŒï¼Œå³å¯èŽ·å–ç›¸åŒçš„ ViewModel å®žä¾‹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹ host çš„ getViewModelStore æ–¹æ³•ã€‚ç»è¿‡ä¸€ç•ªå¯»æ‰¾ï¼Œhost æ˜¯ FragmentActivity.HostCallbacks 1234567// FragmentActivity.java å†…éƒ¨ç±»class HostCallbacks extends FragmentHostCallback&lt;FragmentActivity&gt; implements ViewModelStoreOwner, OnBackPressedDispatcherOwner &#123; public ViewModelStore getViewModelStore() &#123; // å®¿ä¸» activity çš„ getViewModelStore return FragmentActivity.this.getViewModelStore(); &#125;&#125; host çš„ getViewModelStore æ–¹æ³•è¿”å›žçš„æ˜¯å®¿ä¸» activity çš„ getViewModelStore() ï¼Œè€Œ activity é‡å»ºåŽå…¶å†…éƒ¨çš„ mViewModelStore æ˜¯ä¸å˜çš„ï¼Œå› æ­¤å³ä½¿ activity é‡å»ºï¼Œå…¶å†…éƒ¨çš„ FragmentManager å¯¹è±¡å˜åŒ–ï¼Œä½† FragmentManager å†…éƒ¨çš„ FragmentManagerViewModel çš„å®žä¾‹ï¼ˆmNonConfigï¼‰ä¸å˜ï¼ŒmNonConfig.getViewModelStore ä¸å˜ï¼Œfragment çš„ getViewModelStore() äº¦ä¸å˜ï¼Œfragment é‡å»ºåŽå…¶å†…éƒ¨çš„ ViewModel ä»ç„¶å­˜åœ¨ å¯¹äºŽåµŒå¥— fragment ï¼ŒmNonConfig é€šè¿‡ parent.mFragmentManager.getChildNonConfig(parent) èŽ·å– 1234// FragmentManager.javaprivate FragmentManagerViewModel getChildNonConfig(@NonNull Fragment f) &#123; return mNonConfig.getChildNonConfig(f);&#125; ä¸Šæ–‡æåˆ° FragmentManagerViewModel ç®¡ç†ç€ mChildNonConfigs Mapï¼Œå› æ­¤å­ fragment é‡ç½®åŽå…¶å†…éƒ¨çš„ mNonConfig å¯¹è±¡ä¹Ÿæ˜¯ç›¸åŒçš„ è‡³æ­¤é—®é¢˜ 2 å°±è§£å†³äº† 3. å¦‚ä½•æŽ§åˆ¶ä½œç”¨åŸŸï¼Ÿå¯¹äºŽé—®é¢˜3ï¼Œæˆ‘ä»¬çŸ¥é“ ViewModelStoreOwner ä»£è¡¨ç€ä½œç”¨åŸŸï¼Œå…¶å†…éƒ¨å”¯ä¸€çš„æ–¹æ³•è¿”å›ž ViewModelStore å¯¹è±¡ï¼Œä¹Ÿå³ä¸åŒçš„ä½œç”¨åŸŸå¯¹åº”ä¸åŒçš„ ViewModelStore ï¼Œè€Œ ViewModelStore å†…éƒ¨ç»´æŠ¤ç€ ViewModel çš„ HashMap ï¼Œå› æ­¤åªè¦ä¿è¯ç›¸åŒä½œç”¨åŸŸçš„ ViewModelStore å¯¹è±¡ç›¸åŒå°±èƒ½ä¿è¯ç›¸åŒä½œç”¨åŸŸèŽ·å–åˆ°ç›¸åŒçš„ ViewModel å¯¹è±¡ï¼Œè€Œé—®é¢˜1æˆ‘ä»¬å·²ç»è§£é‡Šäº†é‡å»ºæ—¶å¦‚ä½•ä¿è¯ ViewModelStore å¯¹è±¡ä¸å˜ã€‚ å› æ­¤é—®é¢˜3ä¹Ÿè§£å†³äº†ã€‚ 4. å¦‚ä½•é¿å…å†…å­˜æ³„æ¼ï¼Ÿå¯¹äºŽé—®é¢˜4ï¼Œç”±äºŽ ViewModel çš„è®¾è®¡ï¼Œä½¿å¾— activity/fragment ä¾èµ–å®ƒï¼Œè€Œ ViewModel ä¸ä¾èµ–è§†å›¾æŽ§åˆ¶å™¨ã€‚å› æ­¤åªè¦ä¸è®© ViewModel æŒæœ‰ context æˆ– view çš„å¼•ç”¨ï¼Œå°±ä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ æ€»ç»“ç®€å•çš„æ€»ç»“ä¸€ä¸‹ï¼š activity é‡å»ºåŽ mViewModelStore é€šè¿‡ ActivityThread çš„ä¸€ç³»åˆ—æ–¹æ³•èƒ½å¤Ÿä¿æŒä¸å˜ï¼Œä»Žè€Œå½“ activity é‡å»ºæ—¶ ViewModel ä¸­çš„æ•°æ®ä¸å—å½±å“ é€šè¿‡å®¿ä¸» activity èŒƒå›´å†…å…±äº«çš„ FragmentManagerViewModel æ¥å­˜å‚¨ fragment çš„ ViewModelStore å’Œå­fragment çš„ FragmentManagerViewModel ï¼Œè€Œ activity é‡å»ºåŽ FragmentManagerViewModel ä¸­çš„æ•°æ®ä¸å—å½±å“ï¼Œå› æ­¤ fragment å†…éƒ¨çš„ ViewModel çš„æ•°æ®ä¹Ÿä¸å—å½±å“ é€šè¿‡åŒä¸€ ViewModelStoreOwner èŽ·å–çš„ ViewModelStore ç›¸åŒï¼Œä»Žè€Œä¿è¯åŒä¸€ä½œç”¨åŸŸé€šè¿‡ ViewModelProvider èŽ·å–çš„ViewModel å¯¹è±¡æ˜¯ç›¸åŒçš„ é€šè¿‡å•å‘ä¾èµ–ï¼ˆè§†å›¾æŽ§åˆ¶å™¨æŒæœ‰ ViewModel ï¼‰æ¥è§£å†³å†…å­˜æ³„æ¼çš„é—®é¢˜ ViewModel å’Œ onSaveInstanceStateViewModel å’Œ onSaveInstanceState çš„åŠŸèƒ½æœ‰äº›ç±»ä¼¼ï¼Œä½†å®ƒä»¬ä¹Ÿæœ‰å¾ˆå¤šå·®å¼‚ ä»Žå­˜å‚¨ä½ç½®ä¸Šæ¥è¯´ï¼ŒViewModel æ˜¯åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤å…¶è¯»å†™é€Ÿåº¦æ›´å¿«ï¼Œä½†å½“è¿›ç¨‹è¢«ç³»ç»Ÿæ€æ­»åŽï¼ŒViewModel ä¸­çš„æ•°æ®ä¹Ÿä¸å­˜åœ¨äº†ã€‚ä»Žæ•°æ®å­˜å‚¨çš„ç±»åž‹ä¸Šæ¥çœ‹ï¼ŒViewModel é€‚åˆå­˜å‚¨ç›¸å¯¹è¾ƒé‡çš„æ•°æ®ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚åˆ°çš„ list æ•°æ®ï¼Œè€Œ onSaveInstanceState é€‚åˆå­˜å‚¨è½»é‡å¯åºåˆ—åŒ–çš„æ•°æ® é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ viewmodel-savedstate åº“ï¼Œè¯¦æƒ…å‚è€ƒ ã€èƒŒä¸ŠJetpackã€‘ç»ä¸ä¸¢å¤±çš„çŠ¶æ€ androidx SaveState ViewModel-SaveState åˆ†æž å…³äºŽæˆ‘ æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€èƒŒä¸ŠJetpackä¹‹ViewModelã€‘ç»ä¸ä¸¢å¤±çš„çŠ¶æ€ androidx SaveState ViewModel-SaveState åˆ†æž]]></title>
    <url>%2F2020%2F03%2F19%2FJetpack-ViewModel-SaveState%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å¤§å®¶éƒ½çŸ¥é“ activity æœ‰ç€ä¸€å¥— onSaveInstanceState-onRestoreInstanceState çŠ¶æ€ä¿å­˜æœºåˆ¶ï¼Œæ—¨åœ¨ã€Œç³»ç»Ÿèµ„æºå›žæ”¶ã€æˆ–ã€Œé…ç½®å‘ç”Ÿå˜åŒ–ã€ä¿å­˜çŠ¶æ€ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„ä½“éªŒ åœ¨ androidx ä¸‹ï¼Œæä¾›äº† SavedState åº“å¸®åŠ© activity å’Œ fragment å¤„ç†çŠ¶æ€ä¿å­˜å’Œæ¢å¤ æœ¬æ–‡é»˜è®¤æ‚¨å¯¹çŠ¶æ€ä¿å­˜æœºåˆ¶æœ‰ä¸€å®šäº†è§£ï¼Œè¿™éƒ¨åˆ†å†…å®¹è¯·ç§»æ­¥ Saving UI States æ­¤å¤–ï¼Œå…³äºŽ android ä¸‹çš„è¿›ç¨‹ç®¡ç†ï¼ŒæŽ¨è Ian Lake çš„ Who lives and who dies? Process priorities on Android æœ¬æ–‡ä»‹ç»äº† androidx ä¸‹ SavedState å¦‚ä½•å¸®åŠ© activity å’Œ fragment å¤„ç†çŠ¶æ€çš„ä¿å­˜å’Œæ¢å¤ï¼ŒåŒæ—¶ä»‹ç» viewmodel-savedstate åº“ï¼Œä»¥åŠåœ¨å¼€å‘è¿‡ç¨‹ä¸­æ­£ç¡®ä½¿ç”¨çŠ¶æ€ä¿å­˜çš„å§¿åŠ¿ è½¯ä»¶å·¥ç¨‹ä¸­æ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸­é—´å±‚è§£å†³ä¸äº†çš„åœ¨åˆ†æž SavedState åº“ä¹‹å‰æˆ‘ä»¬éœ€è¦ç®€å•èŠä¸€èŠ ComponentActivity androidx activity 1.0.0 æ—¶ï¼ŒComponentActivity æˆä¸ºäº† FragmentActivity å’Œ AppCompatActivity çš„åŸºç±»ã€‚ ä¿—è¯è¯´ã€Œç™¾å› å¿…æœ‰æžœã€ï¼Œå¸¦ç€å¼ºçƒˆçš„å¥½å¥‡å¿ƒï¼Œæˆ‘æŸ¥äº†ä¸€ä¸‹ ComponentActivity å¼•å…¥çš„åŽŸå› ã€‚ å¯ä»¥çœ‹åˆ° ComponentActivity ç»§æ‰¿äº† androidx.core.app.ComponentActivity(åœ¨fragmentåº“ä¸­)ï¼Œå¹¶ä¸”æœ€åˆä»…å®žçŽ°äº†LifecycleOwner æŽ¥å£ æˆ‘ä»¬åˆ›å»ºçš„ activity çš„ç»§æ‰¿å…³ç³»çŽ°åœ¨å˜æˆäº†è¿™æ ·ï¼š é‚£ä¹ˆå›žåˆ°æœ€åˆçš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦å¼•å…¥ ComponentActivity ï¼Ÿå…¶å®žçœ‹çœ‹çŽ°åœ¨ ComponentActivity çš„ç±»ç»“æž„ç­”æ¡ˆå°±å¾ˆæ¸…æ¥šäº† ComponentActivity å®žçŽ°äº†äº”ä¸ªæŽ¥å£ï¼Œä»£è¡¨ç€å…¶é™¤äº† activity è¿˜å……å½“ç€äº”ç§è§’è‰²ã€‚æœ¬ç€èŒèƒ½å•ä¸€åŽŸåˆ™ï¼Œå®˜æ–¹é€šè¿‡å»ºç«‹ä¸€ä¸ªä¸­é—´å±‚å°†éƒ¨åˆ†åŠŸèƒ½åˆ†åˆ«äº¤äºŽä¸“é—¨çš„ç±»æ¥è´Ÿè´£ï¼ŒOnBackPressedDispatcherOwner å°±æ˜¯æˆ‘ä»¬è®² fragment è¿”å›žæ ˆï¼ˆã€èƒŒä¸ŠJetpackä¹‹OnBackPressedDispatcherã€‘Fragment è¿”å›žæ ˆé¢„å¤‡ç¯‡ï¼‰æ—¶æåˆ°çš„ç»“æž„ï¼Œè€Œå…¶ä¸­çš„ SavedStateRegistryOwner åˆ™æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®²çš„ä¸»è§’ SavedState ä¸­çš„æˆå‘˜ SavedStateå¼•å…¥ SavedState 1implementation "androidx.savedstate:savedstate:1.0.0" å…¶å®žæ‚¨ä¸éœ€è¦æ˜¾ç¤ºåœ°å£°æ˜Žï¼Œå› ä¸º activity åº“å†…éƒ¨å·²ç»å¼•å…¥äº†ã€‚jetpack ç»„ä»¶ä¾èµ–å…³ç³»å¯å‚è€ƒ ã€èƒŒä¸ŠJetpackã€‘Jetpack ä¸»è¦ç»„ä»¶çš„ä¾èµ–åŠä¼ é€’å…³ç³» è¿™æ˜¯ä¸€ä¸ªå¾ˆå°çš„åº“ å›¾ç‰‡æ¥è‡ª Android ViewModels: State persistence â€” SavedState SavedStateProviderä¿å­˜çŠ¶æ€çš„ç»„ä»¶ï¼Œæ­¤çŠ¶æ€å°†åœ¨ä»¥åŽæ¢å¤å¹¶ä½¿ç”¨ 1234public interface SavedStateProvider &#123; @NonNull Bundle saveState();&#125; SavedStateRegistryç®¡ç† SavedStateProvider åˆ—è¡¨çš„ç»„ä»¶ï¼Œæ­¤æ³¨å†Œè¡¨ç»‘å®šäº†å…¶æ‰€æœ‰è€…çš„ç”Ÿå‘½å‘¨æœŸï¼ˆå³ activity æˆ– fragmentï¼‰ã€‚æ¯æ¬¡åˆ›å»ºç”Ÿå‘½å‘¨æœŸæ‰€æœ‰è€…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®žä¾‹ åˆ›å»ºæ³¨å†Œè¡¨çš„æ‰€æœ‰è€…åŽï¼ˆä¾‹å¦‚ï¼Œåœ¨è°ƒç”¨ activity çš„ onCreate(savedInstanceState) æ–¹æ³•ä¹‹åŽï¼‰ï¼Œå°†è°ƒç”¨å…¶ performRestore(state) æ–¹æ³•ï¼Œä»¥æ¢å¤ç³»ç»Ÿæ€æ­»å…¶æ‰€æœ‰è€…ä¹‹å‰ä¿å­˜çš„ä»»ä½•çŠ¶æ€ã€‚ 1234567void performRestore(@NonNull Lifecycle lifecycle, @Nullable Bundle savedState) &#123; // ... if (savedState != null) &#123; mRestoredState = savedState.getBundle(SAVED_COMPONENTS_KEY); &#125; // ...&#125; æ¯ä¸ªæ³¨å†Œè¡¨çš„ SavedStateProvider éƒ½ç”±ç”¨äºŽæ³¨å†Œå®ƒçš„å”¯ä¸€å¯†é’¥æ ‡è¯† 123456789101112private SafeIterableMap&lt;String, SavedStateProvider&gt; mComponents = new SafeIterableMap&lt;&gt;();public void registerSavedStateProvider(@NonNull String key, @NonNull SavedStateProvider provider) &#123; SavedStateProvider previous = mComponents.putIfAbsent(key, provider); if (previous != null) &#123; throw new IllegalArgumentException("SavedStateProvider with the given key is already registered"); &#125;&#125;public void unregisterSavedStateProvider(@NonNull String key) &#123; mComponents.remove(key);&#125; ä¸€æ—¦å®Œæˆæ³¨å†Œï¼Œå°±å¯ä»¥é€šè¿‡consumeRestoredStateForKey(key) æ¥ä½¿ç”¨ç‰¹å®šå¯†é’¥çš„è¿˜åŽŸçŠ¶æ€ 123456789101112public Bundle consumeRestoredStateForKey(@NonNull String key) &#123; if (mRestoredState != null) &#123; Bundle result = mRestoredState.getBundle(key); //è°ƒç”¨åŽå°±ä¼šæ¸…ç©ºï¼Œç¬¬äºŒæ¬¡è°ƒç”¨è¿”å›žnull mRestoredState.remove(key); if (mRestoredState.isEmpty()) &#123; mRestoredState = null; &#125; return result; &#125; return null;&#125; è¯·æ³¨æ„ï¼Œæ­¤æ–¹æ³•æ£€ç´¢ä¿å­˜çš„çŠ¶æ€ï¼Œç„¶åŽæ¸…é™¤å…¶å†…éƒ¨å¼•ç”¨ï¼Œè¿™æ„å‘³ç€ç”¨ç›¸åŒçš„é”®è°ƒç”¨å®ƒä¸¤æ¬¡å°†åœ¨ç¬¬äºŒæ¬¡è°ƒç”¨ä¸­è¿”å›ž null ä¸€æ—¦æ³¨å†Œè¡¨æ¢å¤äº†å…¶ä¿å­˜çŠ¶æ€ï¼Œåˆ™ç”±æä¾›è€…å†³å®šæ˜¯å¦è¦æ±‚å…¶æ¢å¤çš„æ•°æ®ã€‚ å¦‚æžœæ²¡æœ‰ï¼Œä¸‹æ¬¡æ³¨å†Œè¡¨çš„æ‰€æœ‰è€…è¢«ç³»ç»Ÿæ€æ­»æ—¶ï¼Œæœªä½¿ç”¨çš„è¿˜åŽŸæ•°æ®å°†å†æ¬¡ä¿å­˜åˆ°ä¿å­˜çŠ¶æ€ å·²æ³¨å†Œçš„ provider èƒ½å¤Ÿåœ¨å…¶æ‰€æœ‰è€…è¢«ç³»ç»Ÿæ€æ­»ä¹‹å‰ä¿å­˜çŠ¶æ€ã€‚ å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œå°†è°ƒç”¨å…¶ Bundle saveState() æ–¹æ³•ã€‚ å¯¹äºŽæ¯ä¸ªå·²æ³¨å†Œçš„ SavedStateProviderï¼Œéƒ½å¯ä»¥åƒè¿™æ ·ä¿å­˜çŠ¶æ€ã€‚ 1savedState.putBundle(savedStateProviderKey, savedStateProvider.saveState()); performSave(outBundle) æ–¹æ³•çš„æºç å¦‚ä¸‹ 1234567891011121314151617void performSave(@NonNull Bundle outBundle) &#123; Bundle components = new Bundle(); // 1.ä¿å­˜æœªä½¿ç”¨çš„çŠ¶æ€ if (mRestoredState != null) &#123; components.putAll(mRestoredState); &#125; // 2. é€šè¿‡ SavedStateProvider ä¿å­˜çŠ¶æ€ for (Iterator&lt;Map.Entry&lt;String, SavedStateProvider&gt;&gt; it = mComponents.iteratorWithAdditions(); it.hasNext(); ) &#123; Map.Entry&lt;String, SavedStateProvider&gt; entry1 = it.next(); components.putBundle(entry1.getKey(), entry1.getValue().saveState()); &#125; // 3. å°†bundle ä¿å­˜åˆ° outBundle å¯¹è±¡ä¸­ outBundle.putBundle(SAVED_COMPONENTS_KEY, components);&#125; æ‰§è¡ŒçŠ¶æ€ä¿å­˜å°†æ‰€æœ‰æœªä½¿ç”¨çš„çŠ¶æ€ä¸Žæ³¨å†Œè¡¨æä¾›çš„çŠ¶æ€åˆå¹¶ã€‚ æ­¤ outBundle æ˜¯ activity çš„ onSaveInstanceState ä¸­ä¼ å…¥çš„ bundle ã€‚ SavedStateRegistryControllerä¸€ä¸ªåŒ…è£… SavedStateRegistry å¹¶å…è®¸é€šè¿‡å…¶2ä¸ªä¸»è¦æ–¹æ³•å¯¹å…¶è¿›è¡ŒæŽ§åˆ¶çš„ç»„ä»¶ï¼šperformRestore(savedState) å’Œ performSave(outBundle )ã€‚ è¿™ä¸¤ä¸ªæ–¹æ³•å°†å†…éƒ¨é€šè¿‡ SavedStateRegistry ä¸­çš„æ–¹æ³•å¤„ç† ã€‚ 12345678910111213public final class SavedStateRegistryController &#123; private final SavedStateRegistryOwner mOwner; private final SavedStateRegistry mRegistry; public void performRestore(@Nullable Bundle savedState) &#123; // ... mRegistry.performRestore(lifecycle, savedState); &#125; public void performSave(@NonNull Bundle outBundle) &#123; mRegistry.performSave(outBundle); &#125;&#125; SavedStateRegistryOwneræŒæœ‰ SavedStateRegistry çš„ç»„ä»¶ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œandroidx åŒ…ä¸­çš„ComponentActivity å’Œ Fragment éƒ½å®žçŽ°æ­¤æŽ¥å£ã€‚ 1234public interface SavedStateRegistryOwner extends LifecycleOwner &#123; @NonNull SavedStateRegistry getSavedStateRegistry();&#125; Activity çš„çŠ¶æ€ä¿å­˜è¿™é‡Œæˆ‘ä»¬è¦æ˜Žç¡®ä¸€ä»¶äº‹æƒ…ï¼Œactivity ä¿å­˜çš„çŠ¶æ€ç©¶ç«Ÿéƒ½æœ‰ä»€ä¹ˆï¼Ÿ è¿™éƒ¨åˆ†å†…å®¹å¯ä»¥å‚è§ å®˜æ–¹æ–‡æ¡£ ç®€å•æ¥è¯´ï¼Œactivity çš„çŠ¶æ€ä¿å­˜åˆ†ä¸º view çŠ¶æ€å’Œæˆå‘˜çŠ¶æ€ é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä½¿ç”¨ Bundle å®žä¾‹çŠ¶æ€æ¥ä¿å­˜æœ‰å…³ activity å¸ƒå±€ä¸­æ¯ä¸ª View å¯¹è±¡çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œè¾“å…¥åˆ° EditText ä¸­çš„æ–‡æœ¬å€¼æˆ– recyclerview çš„æ»šåŠ¨ä½ç½®ï¼‰ã€‚ å› æ­¤ï¼Œå¦‚æžœ activity å®žä¾‹è¢«é”€æ¯å¹¶é‡æ–°åˆ›å»ºï¼Œåˆ™å¸ƒå±€çŠ¶æ€å°†æ¢å¤ä¸ºä¹‹å‰çš„çŠ¶æ€ï¼Œè€Œæ— éœ€æ‚¨æ‰§è¡Œä»»ä½•ä»£ç ã€‚ï¼ˆæ³¨æ„ï¼Œéœ€è¦æ¢å¤çŠ¶æ€çš„ view éœ€è¦é…ç½® id ï¼‰ è¿™éƒ¨åˆ†é€»è¾‘åœ¨ activity ä¸­çš„ onSaveInstanceState æ–¹æ³•å†…å®žçŽ° ä¸åŒå¹³å° onSaveInstanceState æ–¹æ³•çš„æ‰§è¡Œæ—¶æœºç¨æœ‰ä¸åŒï¼Œandroid P ä¹‹å‰ onSaveInstanceState æ‰§è¡Œåœ¨ onStop ä¹‹å‰ï¼Œä½†ä¸é™äºŽåœ¨ onPause ä¹‹å‰æˆ–ä¹‹åŽã€‚android P åŠä¹‹åŽè¯¥æ–¹æ³•åœ¨ onStop åŽæ‰§è¡Œ å‰é¢æˆ‘ä»¬æåˆ° ComponentActivity å®žçŽ°äº† SavedStateRegistryOwner ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ activity å¦‚ä½•åˆ©ç”¨è¯¥åº“æ¥å®žçŽ°çŠ¶æ€çš„ä¿å­˜ä¸Žæ¢å¤ 12345678910111213141516171819202122232425public class ComponentActivity extends androidx.core.app.ComponentActivity implements SavedStateRegistryOwner &#123; private final SavedStateRegistryController mSavedStateRegistryController = SavedStateRegistryController.create(this); @Override protected void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); mSavedStateRegistryController.performRestore(savedInstanceState); // ... &#125; @Override protected void onSaveInstanceState(@NonNull Bundle outState) &#123; // ... //è¿™é‡Œå…ˆè°ƒç”¨çˆ¶ç±»çš„ onSaveInstanceState ä¿å­˜ view çŠ¶æ€ super.onSaveInstanceState(outState); mSavedStateRegistryController.performSave(outState); &#125; @NonNull @Override public final SavedStateRegistry getSavedStateRegistry() &#123; return mSavedStateRegistryController.getSavedStateRegistry(); &#125;&#125; å…¶å†…éƒ¨æŒæœ‰ SavedStateRegistryController çš„å®žä¾‹ mSavedStateRegistryController ï¼Œåœ¨ activity çš„ onCreate æ–¹æ³•ä¸­ é€šè¿‡ controller çš„ performRestore æ–¹æ³•æ¥æŸ¥è¯¢å·²ä¿å­˜çš„çŠ¶æ€ï¼Œåœ¨ onSaveInstanceState ä¸­ ä½¿ç”¨ controller çš„ performSave æ–¹æ³•æ¥ä¿å­˜çŠ¶æ€ é™¤äº† view çŠ¶æ€å’Œæˆå‘˜çŠ¶æ€ï¼Œactivity è¿˜è´Ÿè´£ä¿å­˜å…¶å†…éƒ¨çš„ fragment çš„çŠ¶æ€ã€‚FragmentActivity çš„ onSaveInstanceState æ–¹æ³•æœ‰å¯¹å…¶å†…éƒ¨ fragment çš„çŠ¶æ€è¿›è¡Œä¿å­˜ï¼Œå¹¶åœ¨ onCreate æ–¹æ³•ä¸­å¯¹å·²ä¿å­˜çš„ fragment è¿›è¡Œæ¢å¤ã€‚è¿™è§£é‡Šäº†å¦‚æžœæ“ä½œä¸å½“ä¼šå¯¼è‡´ fragment é‡å çš„é—®é¢˜ Fragment çš„çŠ¶æ€ä¿å­˜androidx fragment ä½¿ç”¨ FragmentStateManager æ¥å¤„ç† fragment çš„çŠ¶æ€ä¿å­˜ å…¶å†…éƒ¨æœ‰å››ä¸ªä¿å­˜ç›¸å…³çš„æ–¹æ³• saveState saveBasicState saveViewState saveInstanceState å…¶è°ƒç”¨é“¾ä¸º activity é€šè¿‡ FragmentController é—´æŽ¥ è°ƒç”¨ FragmentManager çš„ saveAllStateï¼ŒæŽ¥ç€ä¾æ¬¡è°ƒç”¨åŽé¢çš„save æ–¹æ³• Fragment çš„çŠ¶æ€ä¿å­˜å¯åˆ†ä¸º view çŠ¶æ€ï¼Œæˆå‘˜çŠ¶æ€ï¼Œchild fragment çŠ¶æ€ å…³äºŽ view çŠ¶æ€ , FragmentStateManager æä¾›äº† saveViewSate æ–¹æ³•ï¼Œå®ƒçš„è°ƒç”¨æœ‰ä¸¤å¤„ï¼š åœ¨ activity æˆ–çˆ¶ fragment è§¦å‘çŠ¶æ€ä¿å­˜æ—¶è°ƒç”¨ï¼Œå³ä¸Šè¿°æµç¨‹ åœ¨ fragment å³å°†è¿›å…¥ onDestroyView ç”Ÿå‘½å‘¨æœŸæ—¶è°ƒç”¨ï¼Œå…¶ä½ç½®åœ¨ FragmentManager moveToState æ–¹æ³•å†…éƒ¨ï¼Œè¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆåŠ å…¥è¿”å›žæ ˆçš„ replace æ“ä½œåœ¨è¿”å›žæ—¶ view çŠ¶æ€å¯ä»¥è‡ªåŠ¨æ¢å¤ å…³äºŽæˆå‘˜çŠ¶æ€ï¼Œç”± activity ä¸­çš„çŠ¶æ€æœºåˆ¶å¤„ç†ï¼Œå³ä¸ŠèŠ‚å†…å®¹ å…³äºŽ child fragment çŠ¶æ€ï¼Œfragment çš„ onCreate æ–¹æ³•ä¼šè°ƒç”¨ restoreChildFragmentState æ¥æ¢å¤ child fragment çš„çŠ¶æ€ï¼Œå¹¶åœ¨ FragmentStateManager ä¸­çš„ saveBasicState æ–¹æ³•ä¸­ è°ƒç”¨ performSaveInstanceState æ¥ä¿å­˜ child fragment çš„çŠ¶æ€ Viewmodel-SavedState2020-01-22ï¼ŒViewModel-SavedState 1.0.0 æ­£å¼ç‰ˆå‘å¸ƒï¼Œ02-05 å‘å¸ƒäº† 2.2.0 æ­£å¼ç‰ˆ 1implementation "androidx.lifecycle:lifecycle-viewmodel-savedstate:2.2.0" æ‚¨ä¸éœ€è¦æ‰‹åŠ¨å¼•å…¥è¯¥åº“ï¼Œå› ä¸º fragment åº“ä»¥åŠå†…éƒ¨å¼•å…¥è¯¥åº“ Jetpack MVVM ä¸‹ UI State é€šå¸¸è¢« ViewModel æŒæœ‰å¹¶å­˜å‚¨ï¼Œå› æ­¤è¯¥æ¨¡å—å‡ºçŽ°äº†ï¼Œé…ç½®è¯¥æ¨¡å—åŽï¼ŒViewModel å¯¹è±¡å°†é€šè¿‡å…¶æž„é€ å‡½æ•°æŽ¥æ”¶ SavedStateHandle å¯¹è±¡ï¼ˆé”®å€¼æ˜ å°„ï¼‰ï¼Œå¯è®©æ‚¨ä¿å­˜çŠ¶æ€å¹¶æŸ¥è¯¢å·²ä¿å­˜çš„çŠ¶æ€ã€‚ è¿™äº›å€¼å°†åœ¨ç³»ç»Ÿç»ˆæ­¢è¿›ç¨‹åŽç»§ç»­å­˜åœ¨ï¼Œå¹¶å¯ä»¥é€šè¿‡åŒä¸€å¯¹è±¡ä½¿ç”¨ã€‚ å›¾ç‰‡æ¥è‡ª Android ViewModels: State persistence â€” SavedState SavedStateHandleå†…éƒ¨æŒæœ‰å·²ä¿å­˜çŠ¶æ€ key-value çš„ mapï¼Œå…è®¸è¯»å–å’Œå†™å…¥çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€åœ¨åº”ç”¨è¿›ç¨‹è¢«æ€æ­»åŽä»ç„¶å­˜åœ¨ SavedStateHandle é€šè¿‡ ViewModel çš„æž„é€ å™¨ä¼ å…¥ï¼Œä¸‹é¢æ˜¯å…¶ä¸»è¦çš„ä¸»è¦çš„å‡ ä¸ªæ–¹æ³• T get(String key) MutableLiveData getLiveData(String key) void set(String key, T value) SavedStateHandle è¿˜åŒ…å« SavedStateProvider çš„å®žä¾‹ï¼Œç”¨äºŽå¸®åŠ© ViewModel çš„ owner ä¿å­˜çŠ¶æ€ AbstractSavedStateViewModelFactoryä¸€ä¸ªå®žçŽ° ViewModelFactory.KeyedFactory çš„ ViewModel Factoryï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªä¸Žå®žä¾‹åŒ–çš„è¯·æ±‚çš„ ViewModel å…³è”çš„ SavedStateHandle 12345678910111213141516171819202122232425public abstract class AbstractSavedStateViewModelFactory extends ViewModelProvider.KeyedFactory &#123; private final SavedStateRegistry mSavedStateRegistry; // Default state used when the saved state is empty private final Bundle mDefaultArgs; @Override public final &lt;T extends ViewModel&gt; T create(@NonNull String key, @NonNull Class&lt;T&gt; modelClass) &#123; // è¯»å–ä¿å­˜çš„çŠ¶æ€ Bundle restoredState = mSavedStateRegistry.consumeRestoredStateForKey(key); // åˆ›å»ºä¿å­˜çŠ¶æ€çš„ handle SavedStateHandle handle = SavedStateHandle.createHandle(restoredState, mDefaultArgs); // ... // åˆ›å»º viewModel T viewmodel = create(key, modelClass, handle); // ... return viewmodel; &#125;&#125; SavedStateViewModelFactoryAbstractSavedStateViewModelFactory çš„å…·ä½“å®žçŽ° 1234567891011121314151617181920212223242526272829303132333435363738394041public final class SavedStateViewModelFactory extends AbstractSavedStateVMFactory &#123; public SavedStateViewModelFactory(@NonNull Application application, @NonNull SavedStateRegistryOwner owner) &#123; this(application, owner, null); &#125; public SavedStateViewModelFactory(@NonNull Application application, @NonNull SavedStateRegistryOwner owner, @Nullable Bundle defaultArgs) &#123; mSavedStateRegistry = owner.getSavedStateRegistry(); mLifecycle = owner.getLifecycle(); mDefaultArgs = defaultArgs; mApplication = application; mFactory = ViewModelProvider.AndroidViewModelFactory.getInstance(application); &#125; public &lt;T extends ViewModel&gt; T create(@NonNull String key, @NonNull Class&lt;T&gt; modelClass) &#123; boolean isAndroidViewModel = AndroidViewModel.class.isAssignableFrom(modelClass); Constructor&lt;T&gt; constructor; if (isAndroidViewModel) &#123; constructor = findMatchingConstructor(modelClass, ANDROID_VIEWMODEL_SIGNATURE); &#125; else &#123; constructor = findMatchingConstructor(modelClass, VIEWMODEL_SIGNATURE); &#125; // doesn't need SavedStateHandle if (constructor == null) &#123; return mFactory.create(modelClass); &#125; SavedStateHandleController controller = SavedStateHandleController.create( mSavedStateRegistry, mLifecycle, key, mDefaultArgs); T viewmodel; if (isAndroidViewModel) &#123; viewmodel = constructor.newInstance(mApplication, controller.getHandle()); &#125; else &#123; viewmodel = constructor.newInstance(controller.getHandle()); &#125; viewmodel.setTagIfAbsent(TAG_SAVED_STATE_HANDLE_CONTROLLER, controller); return viewmodel; //... &#125;&#125; å·¥ä½œæµç¨‹ 1ViewModelProvider(this).get(MyViewModel::class.java) åœ¨ activity ä¸­åˆ›å»º ViewModel å®žä¾‹ï¼Œä¼ å…¥ this ï¼ˆSavedStateRegistryOwner ï¼‰ä½œä¸ºå‚æ•°ï¼Œè¯¥å‚æ•°å¯ä»¥è®¿é—®å…¶ SavedStateRegistryï¼Œå¦‚æžœæ²¡æœ‰ä¼ å…¥ factory ä¼šé€šè¿‡ activity é‡å†™çš„ getDefaultViewModelProviderFactory æ–¹æ³•æ¥èŽ·å–é»˜è®¤çš„ factory ã€‚ç„¶åŽ factory å°†ä½¿ç”¨ä¿å­˜çš„çŠ¶æ€ï¼Œ å°†å…¶åŒ…è£…åœ¨ SavedStateHandle ä¸­ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ ViewModelã€‚ ViewModel å¯ä»¥è¯»å–å’Œå†™å…¥è¯¥ handle å½“ activity çš„ onSaveInstanceState(outState) æ–¹æ³•è¢«è°ƒç”¨ï¼Œå…¶ SavedStateRegistry çš„ performSave(outState) æ–¹æ³•å°†è¢«æ‰§è¡Œï¼Œå…¶å†…éƒ¨çš„æ‰€æœ‰ SavedStateProvider çš„ saveState æ–¹æ³•å‡è¢«æ‰§è¡Œï¼Œä¸€æ—¦æ‰§è¡Œå®Œæ¯•ï¼ŒoutState å°±åŒ…å«äº†å·²ä¿å­˜çš„çŠ¶æ€ å½“ app è¢«é‡å¯åŽï¼Œactivity å’Œæ–°çš„ registry å°†è¢«åˆ›å»ºï¼Œactivity çš„ onCreate(savedInstanceState) æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œç„¶åŽ registry çš„ performRestore(savedInstanceState) å°†è¢«è°ƒç”¨ä»¥ä¾¿æ¢å¤ä¹‹å‰ä¿å­˜çš„çŠ¶æ€ çŠ¶æ€ä¿å­˜çš„æ­£ç¡®å§¿åŠ¿ViewModel æž„é€ å™¨åŠ å…¥ SavedStateHandle å‚æ•°ï¼Œå¹¶å°†æƒ³è¦ä¿å­˜çš„æ•°æ®ä½¿ç”¨è¯¥ handle ä¿å­˜ 12345class WithSavedStateViewModel(private val state: SavedStateHandle) : ViewModel() &#123; private val key = "key" fun setValue(value: String) = state.set(key, value) fun getValue(): LiveData&lt;String&gt; = state.getLiveData(key)&#125; æ— éœ€é‡å†™ onSaveInstanceState/onRestoreInstanceState æ–¹æ³• Demo åœ°å€ SavedState ä»…é€‚åˆä¿å­˜è½»é‡çº§çš„æ•°æ®ï¼Œé‡é‡çº§æ“ä½œè¯·è€ƒè™‘æŒspï¼Œæ•°æ®åº“ç­‰æŒä¹…åŒ–æ–¹æ¡ˆ å…³äºŽæˆ‘ æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€èƒŒä¸ŠJetpackä¹‹Fragmentã€‘ä»Žæºç çš„è§’åº¦çœ‹Fragment è¿”å›žæ ˆ]]></title>
    <url>%2F2020%2F03%2F16%2FJetpack-fragment-back-stack%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ä¸Šä¸€ç¯‡ æˆ‘ä»¬ä»‹ç»äº† OnBackPressedDispather ï¼Œé‚£ä¹ˆä»Šå¤©æˆ‘ä»¬æ¥æ­£å¼åœ°ä»Žæºç çš„è§’åº¦çœ‹çœ‹ fragment çš„è¿”å›žæ ˆå§ã€‚ç”±äºŽå…¶ä¸»æµç¨‹å’Œç”Ÿå‘½å‘¨æœŸå·®ä¸å¤šï¼Œå› æ­¤æœ¬æ–‡å°†è¯¦ç»†åœ°åˆ†æžè¿”å›žæ ˆç›¸å…³çš„æºç ï¼Œå¹¶æ’å…¥å¤§é‡æºç ã€‚å»ºè®®å°†ç”Ÿå‘½å‘¨æœŸæµç¨‹ç†Ÿæ‚‰åŽé˜…è¯»æœ¬æ–‡ã€‚æ–‡æœ«æä¾›å•è¿”å›žæ ˆå’Œå¤šè¿”å›žæ ˆçš„ demo å¦‚æžœæ‚¨å¯¹ activity å¯¹ä»»åŠ¡æ ˆå’Œè¿”å›žæ ˆä¸æ˜¯å¾ˆäº†è§£ï¼Œå¯ä»¥ç§»æ­¥ Tasks and the Back Stack å°é—®å·ä½ æ˜¯å¦æœ‰å¾ˆå¤šæœ‹å‹ï¼Ÿåœ¨åˆ†æžæºç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ€è€ƒå‡ ä¸ªé—®é¢˜ã€‚ è¿”å›žæ ˆä¸­çš„å…ƒç´ æ˜¯ä»€ä¹ˆï¼Ÿ è°æ¥ç®¡ç† fragment çš„è¿”å›žæ ˆï¼Ÿ å¦‚ä½•è¿”å›žï¼Ÿ è¿”å›žæ ˆä¸­çš„å…ƒç´ æ˜¯ä»€ä¹ˆï¼Ÿè¿”å›žæ ˆï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸€ä¸ªæ ˆç»“æž„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æžæ¸…æ¥šï¼Œè¿™ä¸ªæ ˆç»“æž„åˆ°åº•å­˜çš„æ˜¯ä»€ä¹ˆã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œä½¿ç”¨ fragment çš„è¿”å›žæ ˆéœ€è¦è°ƒç”¨ addToBackStack(&quot;&quot;) æ–¹æ³• åœ¨ ä»Žæºç è§’åº¦çœ‹ Fragment ç”Ÿå‘½å‘¨æœŸ ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº† FragmentTransaction ï¼Œå®ƒæ˜¯ä¸€ä¸ªã€Œäº‹åŠ¡ã€çš„æ¨¡åž‹ï¼Œäº‹åŠ¡å¯ä»¥å›žæ»šåˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚æ‰€ä»¥å½“è§¦å‘è¿”å›žæ“ä½œæ—¶ï¼Œå°±æ˜¯å°†ä¹‹å‰æäº¤çš„äº‹åŠ¡è¿›è¡Œå›žæ»šã€‚ FragmentTransaction çš„å®žçŽ°ç±»ä¸º BackStackRecord ï¼Œæ‰€ä»¥ fragment çš„è¿”å›žæ ˆå…¶å®žå­˜æ”¾çš„å°±æ˜¯ BackStackRecord ä½œä¸ºè¿”å›žæ ˆçš„å…ƒç´ ï¼ŒBackStackRecord å®žçŽ°äº†FragmentManager.BackStackEntry æŽ¥å£ ä»Ž BackStackRecord çš„å®šä¹‰æˆ‘ä»¬å¯ä»¥å‘çŽ° BackStackRecord æœ‰ä¸‰ç§èº«ä»½ ç»§æ‰¿äº† FragmentTransactionï¼Œå³æ˜¯äº‹åŠ¡ï¼Œä¿å­˜äº†æ•´ä¸ªäº‹åŠ¡çš„å…¨éƒ¨æ“ä½œ å®žçŽ°äº† FragmentManager.BackStackEntry ï¼Œä½œä¸ºå›žé€€æ ˆçš„å…ƒç´  å®žçŽ°äº†OpGenerator ï¼Œå¯ä»¥ç”Ÿæˆ BackStackRecord åˆ—è¡¨ï¼ŒåŽæ–‡è¯¦ç»†ä»‹ç» è°æ¥ç®¡ç† fragment çš„è¿”å›žæ ˆï¼Ÿæˆ‘ä»¬å·²ç»çŸ¥é“ fragment çš„è¿”å›žæ ˆå…¶å®žå­˜æ”¾çš„æ˜¯ BackSrackRecord , é‚£ä¹ˆè°æ¥ç®¡ç† fragment çš„è¿”å›žæ ˆï¼Ÿ FragmentManager ç”¨äºŽç®¡ç† fragment ï¼Œæ‰€ä»¥ fragment è¿”å›žæ ˆä¹Ÿåº”è¯¥ç”± FragmentManager ç®¡ç† 12//FragmentManager.javaArrayList&lt;BackStackRecord&gt; mBackStack; å…¶å®žè§¦å‘ fragment çš„è¿”å›žé€»è¾‘æœ‰ä¸¤ç§é€”å¾„ å¼€å‘ä¸»åŠ¨è°ƒç”¨ fragment çš„è¿”å›žæ–¹æ³• ç”¨æˆ·æŒ‰è¿”å›žé”®è§¦å‘ åŽæ–‡æˆ‘ä»¬ä¼šä»Žè¿™ä¸¤ä¸ªè§’åº¦åˆ†æžä¸€ä¸‹ fragment ä¸­çš„è¿”å›žæ ˆé€»è¾‘ç©¶ç«Ÿæ˜¯æ€Žæ ·çš„ å¦‚ä½•è¿”å›žï¼Ÿæˆ‘ä»¬å·²ç»çŸ¥é“è¿”å›žæ ˆä¸­çš„å…ƒç´ æ˜¯ BackStackRecord ï¼Œä¹Ÿæ¸…æ¥šäº†æ˜¯ FragmentManager æ¥ç®¡ç†è¿”å›žæ ˆã€‚é‚£ä¹ˆå¦‚æžœè®©æˆ‘ä»¬æ¥å®žçŽ°ã€Œè¿”å›žã€é€»è¾‘ï¼Œåº”è¯¥å¦‚ä½•åšï¼Ÿ é¦–å…ˆæˆ‘ä»¬è¦æ¸…æ¥šæ‰€è°“çš„ã€Œè¿”å›žã€æ˜¯å¯¹äº‹åŠ¡çš„å›žæ»šï¼Œå³ å¯¹ commit äº‹åŠ¡çš„å†…éƒ¨é€»è¾‘æ‰§è¡Œç›¸åº”çš„ã€Œé€†æ“ä½œã€ã€‚ ä¾‹å¦‚ addFragmentâ†â†’removeFragment showFragmentâ†â†’hideFragment attachFragmentâ†â†’detachFragment æœ‰çš„å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ replace å‘¢ï¼Ÿ expandReplaceOps æ–¹æ³•ä¼šæŠŠ replace æ›¿æ¢(ç›®æ ‡ fragment å·²ç»è¢« add )æˆç›¸åº”çš„ remove å’Œ add ä¸¤ä¸ªæ“ä½œï¼Œæˆ–è€…(ç›®æ ‡ fragment æ²¡æœ‰è¢« add )åªæ›¿æ¢æˆ add æ“ä½œ popBackStack ç³»åˆ—æ–¹æ³•FragmentManager ä¸­æä¾›äº†popBackStack ç³»åˆ—æ–¹æ³• æ˜¯å¦è§‰å¾—å¾ˆçœ¼ç†Ÿï¼Ÿæäº¤äº‹åŠ¡ä¹Ÿæœ‰ç±»ä¼¼çš„apiï¼Œcommit ç³»åˆ—æ–¹æ³• è¿™é‡Œåˆ†åˆ«æä¾›äº†åŒæ­¥å’Œå¼‚æ­¥çš„æ–¹æ³•ï¼Œå¯èƒ½æœ‰è¯»è€…ä¼šç–‘æƒ‘ï¼ŒåŒæ ·æ˜¯å¯¹äº‹åŠ¡çš„æ“ä½œï¼Œä¸€ä¸ªä¸ºæäº¤ï¼Œä¸€ä¸ªä¸ºå›žæ»šï¼Œä¸ºä»€ä¹ˆä¸€ä¸ªå°è£…åˆ°äº† FragmentManager ä¸­ï¼Œä¸€ä¸ªå´åœ¨ FragmentTransaction ä¸­ã€‚æ—¢ç„¶éƒ½æ˜¯å¯¹äº‹åŠ¡çš„æ“ä½œï¼Œåº”è¯¥éƒ½æ”¾åœ¨FragmentManager ä¸­ã€‚æˆ‘è®¤ä¸ºå¯èƒ½ä¸ºäº†apiä½¿ç”¨çš„æ–¹ä¾¿ï¼Œä½¿å¾— FragmentManager å¼€å¯äº‹åŠ¡çš„é“¾å¼è°ƒç”¨ä¸€æ°”å‘µæˆã€‚å„ä½æœ‰ä»€ä¹ˆæƒ³æ³•æ¬¢è¿Žåœ¨è¯„è®ºåŒºç•™è¨€ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»ä¸€ä¸‹ popBackStack(String name, int flag) name ä¸º addToBackStack(String name) çš„å‚æ•°ï¼Œé€šè¿‡ name èƒ½æ‰¾åˆ°å›žé€€æ ˆçš„ç‰¹å®šå…ƒç´ ï¼Œflagå¯ä»¥ä¸º 0 æˆ–è€…FragmentManager.POP_BACK_STACK_INCLUSIVEï¼Œ0 è¡¨ç¤ºåªå¼¹å‡ºè¯¥å…ƒç´ ä»¥ä¸Šçš„æ‰€æœ‰å…ƒç´ ï¼ŒPOP_BACK_STACK_INCLUSIVE è¡¨ç¤ºå¼¹å‡ºåŒ…å«è¯¥å…ƒç´ åŠä»¥ä¸Šçš„æ‰€æœ‰å…ƒç´ ã€‚è¿™é‡Œè¯´çš„å¼¹å‡ºæ‰€æœ‰å…ƒç´ åŒ…å«å›žé€€è¿™äº›äº‹åŠ¡ã€‚å¦‚æžœè¿™ä¹ˆè¯´æ¯”è¾ƒæŠ½è±¡çš„è¯ï¼Œçœ‹å›¾ 12//flag ä¼ å…¥0ï¼Œå¼¹å‡º â™¥2 ä¸Šçš„æ‰€æœ‰å…ƒç´ childFragmentManager.popBackStack("â™¥", 0) 12//flag ä¸º POP_BACK_STACK_INCLUSIVE å¼¹å‡ºåŒ…æ‹¬è¯¥å…ƒç´ åŠåŠä»¥ä¸Šçš„å…ƒç´ childFragmentManager.popBackStack("â™¥", androidx.fragment.app.FragmentManager.POP_BACK_STACK_INCLUSIVE) èµ°è¿›æºç 1. popBackStack() é€»è¾‘åœ¨åˆ†æžè¿”å›žæ ˆæºç ä¹‹å‰æˆ‘ä»¬å›žé¡¾ä¸€ä¸‹ FragmentManager æäº¤äº‹åŠ¡åˆ° fragment å„ä¸ªç”Ÿå‘½å‘¨æœŸçš„æµç¨‹ ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ popBackStack çš„æºç  ç­‰ç­‰ï¼Œè¿™ä¸ª enqueueAction æœ‰äº›çœ¼ç†Ÿâ€¦ çœ‹æ¥æäº¤äº‹åŠ¡å’Œå›žæ»šäº‹åŠ¡çš„æµç¨‹åŸºæœ¬æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯ä¼ é€’çš„ action ä¸åŒ ç”±æºç å¯çŸ¥ï¼ŒOpGenerator æ˜¯ä¸€ä¸ªæŽ¥å£ï¼Œå…¶å†…åªæœ‰ä¸€ä¸ª generateOps æ–¹æ³•ï¼Œç”¨äºŽç”Ÿæˆäº‹åŠ¡åˆ—è¡¨ä»¥åŠå¯¹åº”çš„è¯¥äº‹åŠ¡æ˜¯å¦æ˜¯å¼¹å‡ºçš„ã€‚æœ‰ä¸¤ä¸ªå®žçŽ°ç±» ç”±æ­¤å¯è§ commit è°ƒç”¨çš„ä¸º BackStackRecord çš„ generateOps æ–¹æ³•ï¼ŒpopBackStack è°ƒç”¨çš„æ˜¯ PopBackStackState ä¸­çš„ generateOps å‰è€…çš„é€»è¾‘å¾ˆç®€å•ï¼Œå‘ records list ä¸­æ·»åŠ æ•°æ®ï¼Œ isRecordPop list å…¨éƒ¨ä¼ å…¥ false 12records.add(this);isRecordPop.add(false); åŽè€…çš„é€»è¾‘ç¨å¾®å¤æ‚äº›ï¼Œå…¶å†…éƒ¨è°ƒç”¨äº† popBackStackState æ–¹æ³• å¦‚æžœæ˜¯ popBackStack æ–¹æ³• ï¼Œåˆ™å°† FragmentManager çš„è¿”å›žæ ˆåˆ—è¡¨ï¼ˆmBackStackï¼‰çš„æ ˆé¡¶ç§»é™¤ï¼Œ isRecordPop list å…¨éƒ¨ä¼ å…¥ true 123int last = mBackStack.size() - 1;records.add(mBackStack.remove(last));isRecordPop.add(true); å¦‚æžœä¼ å…¥çš„ name æˆ– id æœ‰å€¼ï¼Œä¸” flag ä¸º 0ï¼Œåˆ™æ‰¾åˆ°è¿”å›žæ ˆï¼ˆå€’åºéåŽ†ï¼‰ä¸­ç¬¬ä¸€ä¸ªç¬¦åˆ name æˆ– id çš„ä½ç½®ï¼Œå¹¶å°†è¯¥ä½ç½®ä¸Šæ–¹çš„æ‰€æœ‰ BackStackRecord å¹¶æ·»åŠ åˆ° record list ä¸­ï¼ŒåŒæ—¶ isRecordPop list å…¨éƒ¨ä¼ å…¥ true 12345678910111213141516index = mBackStack.size() - 1;while (index &gt;= 0) &#123; BackStackRecord bss = mBackStack.get(index); if (name != null &amp;&amp; name.equals(bss.getName())) &#123; break; &#125; if (id &gt;= 0 &amp;&amp; id == bss.mIndex) &#123; break; &#125; index--;&#125;for (int i = mBackStack.size() - 1; i &gt; index; i--) &#123; records.add(mBackStack.remove(i)); isRecordPop.add(true);&#125; å¦‚æžœä¼ å…¥çš„ name æˆ– id æœ‰å€¼ï¼Œä¸” flag ä¸º POP_BACK_STACK_INCLUSIVEï¼Œåˆ™åœ¨ä¸Šä¸€æ¡èŽ·å–ä½ç½®çš„åŸºç¡€ä¸Šç»§ç»­éåŽ†ï¼Œç›´è‡³æ ˆåº•æˆ–è€…é‡åˆ°ä¸åŒ¹é…çš„è·³å‡ºå¾ªçŽ¯ï¼ŒæŽ¥ç€å‡ºæ ˆæ‰€æœ‰ BackStackRecord 123456789101112131415//index æ“ä½œä¸Žä¸Šæ–¹ç›¸åŒï¼Œå…ˆæ‰¾åˆ°è¿”å›žæ ˆï¼ˆå€’åºéåŽ†ï¼‰ä¸­ç¬¬ä¸€ä¸ªç¬¦åˆ name æˆ– id çš„ä½ç½®if ((flags &amp; POP_BACK_STACK_INCLUSIVE) != 0) &#123; index--; // ç»§ç»­éåŽ† mBackStack ç›´è‡³æ ˆåº•æˆ–è€…é‡åˆ°ä¸åŒ¹é…çš„è·³å‡ºå¾ªçŽ¯ while (index &gt;= 0) &#123; BackStackRecord bss = mBackStack.get(index); if ((name != null &amp;&amp; name.equals(bss.getName())) || (id &gt;= 0 &amp;&amp; id == bss.mIndex)) &#123; index--; continue; &#125; break; &#125;&#125;//åŽç»­å‡ºæ ˆé€»è¾‘ä¸Žä¸Šæ–¹ç›¸åŒ å¯ä»¥é…åˆä¸Šé¢çš„åŠ¨å›¾ç†è§£ å…¥æ ˆå’Œå‡ºæ ˆåŽç»­çš„é€»è¾‘å¤§ä½“æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯æ ¹æ® isPop çš„æ­£è´Ÿå‡ºçŽ°äº†åˆ†æ”¯ï¼Œå‡ºæ ˆè°ƒç”¨çš„æ˜¯ executePopOps ä¸Šæ–‡æˆ‘ä»¬æœ‰æåˆ°ï¼Œã€Œè¿”å›žã€é€»è¾‘å®žé™…ä¸Šå°±æ˜¯æ‰§è¡Œæäº¤äº‹åŠ¡å†…éƒ¨æ“ä½œé€»è¾‘çš„ã€Œé€†æ“ä½œã€ é‚£ä¹ˆæŽ¥ä¸‹çš„é€»è¾‘å°±å¾ˆæ¸…æ™°äº†ï¼Œæ ¹æ®ä¸åŒçš„ mCmd æ‰§è¡Œç›¸åº”çš„é€†æ“ä½œ 12345678910111213141516171819202122232425262728293031323334353637383940414243void executePopOps(boolean moveToState) &#123; for (int opNum = mOps.size() - 1; opNum &gt;= 0; opNum--) &#123; final Op op = mOps.get(opNum); Fragment f = op.mFragment; switch (op.mCmd) &#123; case OP_ADD: mManager.removeFragment(f); break; case OP_REMOVE: mManager.addFragment(f); break; case OP_HIDE: mManager.showFragment(f); break; case OP_SHOW: mManager.hideFragment(f); break; case OP_DETACH: mManager.attachFragment(f); break; case OP_ATTACH: mManager.detachFragment(f); break; case OP_SET_PRIMARY_NAV: mManager.setPrimaryNavigationFragment(null); break; case OP_UNSET_PRIMARY_NAV: mManager.setPrimaryNavigationFragment(f); break; case OP_SET_MAX_LIFECYCLE: mManager.setMaxLifecycle(f, op.mOldMaxState); break; default: throw new IllegalArgumentException("Unknown cmd: " + op.mCmd); &#125; if (!mReorderingAllowed &amp;&amp; op.mCmd != OP_REMOVE &amp;&amp; f != null) &#123; mManager.moveFragmentToExpectedState(f); &#125; &#125; if (!mReorderingAllowed &amp;&amp; moveToState) &#123; mManager.moveToState(mManager.mCurState, true); &#125;&#125; åŽé¢çš„é€»è¾‘å°±å®Œå…¨ä¸€æ ·äº† 2. fragment æ˜¯æ€Žæ ·æ‹¦æˆª activity çš„è¿”å›žé€»è¾‘çš„ï¼Ÿåœ¨ ã€èƒŒä¸ŠJetpackä¹‹OnBackPressedDispatcherã€‘Fragment è¿”å›žæ ˆé¢„å¤‡ç¯‡ ä¸€æ–‡ä¸­æˆ‘ä»¬ä»‹ç»äº† OnBackPressedDispatcher activity çš„ onBackPressed çš„é€»è¾‘ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåˆ¤æ–­æ‰€æœ‰æ³¨å†Œçš„ OnBackPressedCallback æ˜¯å¦æœ‰ enabled çš„ï¼Œå¦‚æžœæœ‰åˆ™æ‹¦æˆªï¼Œä¸æ‰§è¡ŒåŽç»­é€»è¾‘ï¼› å¦åˆ™ç€æ‰§è¡Œ mFallbackOnBackPressed.run() ï¼Œå…¶å†…éƒ¨é€»è¾‘ä¸ºè°ƒç”¨ ComponentActivity çˆ¶ç±»çš„ onBackPressed æ–¹æ³• æ‰€ä»¥æˆ‘ä»¬åªéœ€çœ‹ mOnBackPressedCallbacksï¼ˆArrayDeque&lt;OnBackPressedCallbackï¼‰ æ˜¯æ€Žæ ·è¢«æ·»åŠ çš„ä»¥åŠ isEnabled ä½•æ—¶èµ‹å€¼ä¸º true ç»è¿‡æŸ¥æ‰¾æˆ‘ä»¬å‘çŽ°å®ƒæ˜¯åœ¨ FragmentManager çš„ attachController è°ƒç”¨ addCallback 1mOnBackPressedDispatcher.addCallback(owner,mOnBackPressedCallback) è¿›è€Œæ‰§è¡Œäº† è€Œ mOnBackPressedCallback åœ¨åˆå§‹åŒ–æ—¶ enabled èµ‹å€¼ä¸º false isEnadbled ä¼šåœ¨è¿”å›žæ ˆæ•°é‡å¤§äºŽ 0 ä¸”å…¶ mParent ä¸º PrimaryNavigation æ—¶èµ‹å€¼ä¸ºtrue è€Œè¿”å›žæ ˆï¼ˆmBackStackï¼‰çš„èµ‹å€¼åœ¨ BackStackRecord çš„ generateOps æ–¹æ³•ä¸­ï¼Œä¸”æ˜¯å¦æ·»åŠ åˆ°è¿”å›žæ ˆç”± mAddToBackStack è¿™ä¸ªå¸ƒå°”ç±»åž‹çš„å±žæ€§æŽ§åˆ¶ mAddToBackStack çš„èµ‹å€¼åœ¨ addToBackStack æ–¹æ³•ä¸­ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä½•è°ƒç”¨ addToBackStack æ–¹æ³•å°±èƒ½å°†äº‹åŠ¡åŠ å…¥è¿”å›žæ ˆ æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼Œfragment æ‹¦æˆª activity è¿”å›žæ ˆæ˜¯é€šè¿‡ OnBackPressedDispatcher å®žçŽ°çš„ï¼Œå¦‚æžœå¼€å¯äº‹åŠ¡è°ƒç”¨äº† addToBackStack æ–¹æ³•ï¼Œåˆ™ mOnBackPressedCallback çš„ isEnabled å±žæ€§ä¼šèµ‹å€¼ä¸º trueï¼Œè¿›è€Œèµ·åˆ°æ‹¦æˆª activity è¿”å›žé€»è¾‘çš„ä½œç”¨ã€‚æ‹¦æˆªåŽæ‰§è¡Œ popBackStackImmediate æ–¹æ³• è€Œ popBackStackç³»åˆ—æ–¹æ³•ä¼šè°ƒç”¨ popBackStackState æž„é€  records å’Œ isRecordPop åˆ—è¡¨ï¼ŒisRecordPop çš„å†…éƒ¨å…ƒç´ çš„å€¼å‡ä¸ºtrue åŽç»­æµç¨‹å’Œæäº¤äº‹åŠ¡æ˜¯ä¸€æ ·çš„ï¼Œæ ¹æ® isRecordPop å€¼çš„ä¸åŒé€‰æ‹©æ‰§è¡Œ executePopOps æˆ– executeOps æ–¹æ³• å•è¿”å›žæ ˆå’Œå¤šè¿”å›žæ ˆçš„å®žçŽ°Ian Lake åœ¨ Fragments: Past, Present, and Future (Android Dev Summit â€˜19) æœ‰æåˆ°æœªæ¥ä¼šæä¾›å¤šè¿”å›žæ ˆçš„ api é‚£ä¹ˆä»¥çŽ°æœ‰çš„ api å¦‚ä½•å®žçŽ°å¤šè¿”å›žæ ˆå‘¢ï¼Ÿ é¦–å…ˆæˆ‘è¦å¼„æ¸…æ¥šæ€Žæ ·æ‰ä¼šæœ‰å¤šè¿”å›žæ ˆï¼Œæ ¹æ®ä¸Šæ–‡æˆ‘ä»¬çŸ¥é“ FragmentManager å†…éƒ¨æŒæœ‰mBackStack listï¼Œè¿™å¯¹åº”ç€ä¸€ä¸ªè¿”å›žæ ˆï¼Œå¦‚æžœæƒ³è¦å®žçŽ°å¤šè¿”å›žæ ˆï¼Œåˆ™éœ€è¦å¤šä¸ª FragmentManagerï¼Œè€Œå¤š FragmentManager åˆ™å¯¹åº”å¤šä¸ª fragment å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªå®¿ä¸» frament ä½œä¸ºå¯¼èˆª fragment è¿™æ ·å°±å¯ä»¥ç”¨ä¸åŒçš„å®¿ä¸» fragment çš„ ç‹¬ç«‹çš„FragmentManager åˆ†åˆ«ç®¡ç†å„è‡ªçš„è¿”å›žæ ˆï¼Œå¦‚æžœè¿™æ ·è¯´æ¯”è¾ƒæŠ½è±¡ï¼Œå¯ä»¥å‚è€ƒä¸‹å›¾ å›¾ä¸­æœ‰å››ä¸ªè¿”å›žæ ˆï¼Œå…¶ä¸­æœ€å¤–éƒ¨æœ‰ä¸€ä¸ªå®¿ä¸» fragment ï¼Œå†…éƒ¨æœ‰å››ä¸ªè´Ÿè´£å¯¼èˆªçš„ fragment ç®¡ç†å…¶å†…éƒ¨çš„è¿”å›žæ ˆï¼Œå¤–éƒ¨çš„å®¿ä¸»è´Ÿè´£åè°ƒå„ä¸ªè¿”å›žæ ˆä¸ºç©ºåŽå¦‚ä½•åˆ‡æ¢è‡³å…¶ä»–è¿”å›žæ ˆ å•è¿”å›žæ ˆå°±å¾ˆå®¹æ˜“äº†ï¼Œæˆ‘ä»¬åªéœ€åœ¨åŒä¸€ä¸ª FragmentManager ä¸Šæ·»åŠ è¿”å›žæ ˆå³å¯ è¯¦æƒ…å‚ç…§ demo å…³äºŽæˆ‘ æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€èƒŒä¸ŠJetpackã€‘Fragmentè¿”å›žæ ˆé¢„å¤‡ç¯‡ OnBackPressedDispatcher]]></title>
    <url>%2F2020%2F03%2F14%2FJetpack-OnBackPressedDispatcher%2F</url>
    <content type="text"><![CDATA[è¿™ä¸¤å¤©åœ¨å‡†å¤‡å†™ fragment è¿”å›žæ ˆçš„æ–‡ç« ï¼Œä½†æ˜¯å‘çŽ°å¿…é¡»å…ˆä»‹ç»ä¸€ä¸‹ OnBackPressedDispatcher ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ç¯‡ä»‹ç» what çš„æ–‡ç« ï¼Œå–œæ¬¢ä¸€æ‰‹èµ„æ–™çš„å¯ä»¥ç§»æ­¥ å®˜æ–¹æ–‡æ¡£ ç³»åˆ—æ–‡ç«  ã€èƒŒä¸ŠJetpackã€‘Jetpack ä¸»è¦ç»„ä»¶çš„ä¾èµ–åŠä¼ é€’å…³ç³» ã€èƒŒä¸ŠJetpackã€‘AdroidXä¸‹ä½¿ç”¨Activityå’ŒFragmentçš„å˜åŒ– ã€èƒŒä¸ŠJetpackä¹‹Fragmentã€‘ä½ çœŸçš„ä¼šç”¨Fragmentå—ï¼ŸFragmentå¸¸è§é—®é¢˜ä»¥åŠandroidxä¸‹Fragmentçš„ä½¿ç”¨æ–°å§¿åŠ¿ ã€èƒŒä¸ŠJetpackä¹‹Fragmentã€‘ä»Žæºç è§’åº¦çœ‹ Fragment ç”Ÿå‘½å‘¨æœŸ AndroidX Fragment1.2.2æºç åˆ†æž WhenOnBackPressedDispatcher åœ¨ androidx activity 1.0.0 åŠ å…¥ï¼Œæ—¨åœ¨å¤„ç†è¿”å›žé€»è¾‘ã€‚æ‚¨ä¸ä»…å¯ä»¥èŽ·å¾—åœ¨ Activity ä¹‹å¤–å¤„ç†è¿”å›žé”®çš„ä¾¿æ·æ–¹å¼ã€‚ æ ¹æ®æ‚¨çš„éœ€è¦ï¼Œæ‚¨å¯ä»¥åœ¨ä»»æ„ä½ç½®å®šä¹‰ OnBackPressedCallbackï¼Œä½¿å…¶å¯å¤ç”¨ï¼Œæˆ–æ ¹æ®åº”ç”¨ç¨‹åºçš„æž¶æž„è¿›è¡Œä»»ä½•æ“ä½œã€‚ æ‚¨ä¸å†éœ€è¦é‡å†™Activity ä¸­çš„ onBackPressed æ–¹æ³•ï¼Œä¹Ÿä¸å¿…æä¾›è‡ªå·±çš„æŠ½è±¡çš„æ¥å®žçŽ°éœ€æ±‚çš„ä»£ç ã€‚ WhatComponentActivity æ˜¯ FragmentActivity å’Œ AppCompatActivity çš„åŸºç±»ï¼Œå®ƒä½¿æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨å…¶ OnBackPressedDispatcherï¼ˆå¯ä»¥é€šè¿‡è°ƒç”¨ getOnBackPressedDispatcher() ï¼‰æ¥æŽ§åˆ¶è¿”å›žæŒ‰é’®çš„è¡Œä¸ºã€‚ OnBackPressedDispatcher æŽ§åˆ¶å¦‚ä½•å°†è¿”å›žæŒ‰é’®äº‹ä»¶åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ªOnBackPressedCallback å¯¹è±¡ã€‚ OnBackPressedCallback çš„æž„é€ å‡½æ•°å°†å¸ƒå°”å€¼ç”¨äºŽåˆå§‹å¯ç”¨çŠ¶æ€ã€‚ ä»…å½“å¯ç”¨äº†å›žè°ƒï¼ˆå³ isEnabled() è¿”å›žtrueï¼‰æ—¶ï¼Œè°ƒåº¦ç¨‹åºæ‰ä¼šè°ƒç”¨å›žè°ƒçš„handleOnBackPressed() æ¥å¤„ç†è¿”å›žæŒ‰é’®äº‹ä»¶ã€‚ æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ setEnabled() æ¥æ›´æ”¹å¯ç”¨çŠ¶æ€ã€‚ å›žè°ƒæ˜¯é€šè¿‡ addCallback æ–¹æ³•æ·»åŠ çš„ã€‚ å¼ºçƒˆå»ºè®®ä½¿ç”¨é‡‡ç”¨ LifecycleOwner çš„addCallback() æ–¹æ³•ã€‚ è¿™æ ·å¯ä»¥ç¡®ä¿ä»…åœ¨ LifecycleOwner ä¸º Lifecycle.State.STARTED æ—¶æ‰æ·»åŠ OnBackPressedCallbackã€‚ å½“å…³è”çš„ LifecycleOwner è¢«é”€æ¯æ—¶ï¼Œè¯¥ activity ä¼šåˆ é™¤å·²æ³¨å†Œçš„å›žè°ƒï¼Œä»¥é˜²æ­¢å†…å­˜æ³„æ¼ï¼Œå¹¶ä½¿å…¶é€‚ç”¨äºŽå¯¿å‘½æ¯”è¯¥ activity çŸ­çš„ fragment æˆ–å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ‰€æœ‰è€…ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ 1234567891011121314class MyFragment : Fragment() &#123; override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) //æ­¤ callback ä»…å½“ MyFragment è‡³å°‘æ˜¯ Started çŠ¶æ€ä¸‹è°ƒç”¨ val callback = requireActivity().onBackPressedDispatcher.addCallback(this) &#123; //æ‹¦æˆªè¿”å›žäº‹ä»¶ &#125; //æ­¤ callback å¯ä»¥åœ¨è¿™é‡Œæˆ–è€…ä¸Šé¢çš„ lambda ä¸­å¼€å¯å’Œå…³é—­ &#125; ...&#125; æ‚¨å¯ä»¥é€šè¿‡ addCallback() æä¾›å¤šä¸ªå›žè°ƒã€‚ è¿™æ ·åšæ—¶ï¼Œå°†æŒ‰ç…§æ·»åŠ å›žè°ƒçš„ç›¸åé¡ºåºè°ƒç”¨å›žè°ƒï¼Œå³æœ€åŽæ·»åŠ çš„å›žè°ƒæ˜¯ç¬¬ä¸€ä¸ªç»™äºˆå¤„ç†è¿”å›žæŒ‰é’®äº‹ä»¶çš„æœºä¼šçš„å›žè°ƒã€‚ ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨ä¾æ¬¡æ·»åŠ äº†ä¸‰ä¸ªåˆ†åˆ«åä¸º1ã€2å’Œ3çš„å›žè°ƒï¼Œåˆ™å°†åˆ†åˆ«ä»¥3ã€2å’Œ1çš„é¡ºåºè°ƒç”¨å®ƒä»¬ã€‚ å›žè°ƒéµå¾ªâ€œè´£ä»»é“¾â€æ¨¡å¼ã€‚ ä»…å½“æœªå¯ç”¨å‰ä¸€ä¸ªå›žè°ƒæ—¶ï¼Œæ‰è°ƒç”¨é“¾ä¸­çš„æ¯ä¸ªå›žè°ƒã€‚ è¿™æ„å‘³ç€åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œä»…å½“æœªå¯ç”¨å›žè°ƒ3æ—¶ï¼Œæ‰ä¼šè°ƒç”¨å›žè°ƒ2ã€‚ ä»…å½“æœªå¯ç”¨å›žè°ƒ2æ—¶ï¼Œæ‰è°ƒç”¨å›žè°ƒ1ï¼Œä¾æ­¤ç±»æŽ¨ã€‚ è¯·æ³¨æ„ï¼Œé€šè¿‡ addCallback() æ·»åŠ å›žè°ƒæ—¶ï¼Œç›´åˆ° LifecycleOwner è¿›å…¥Lifecycle.State.STARTED çŠ¶æ€ï¼Œæ‰å°†å›žè°ƒæ·»åŠ åˆ°è´£ä»»é“¾ä¸­ã€‚ å¼ºçƒˆå»ºè®®æ›´æ”¹ OnBackPressedCallback çš„å¯ç”¨çŠ¶æ€ä»¥è¿›è¡Œä¸´æ—¶æ›´æ”¹(å³æ›´æ”¹ isEnabled çš„å€¼)ï¼Œå› ä¸ºå®ƒå¯ä»¥ä¿æŒä¸Šè¿°é¡ºåºï¼Œå¦‚æžœæ‚¨åœ¨å¤šä¸ªä¸åŒçš„åµŒå¥—ç”Ÿå‘½å‘¨æœŸæ‰€æœ‰è€…ä¸Šæ³¨å†Œäº†å›žè°ƒï¼Œè¿™å°¤å…¶é‡è¦ã€‚ ä½†æ˜¯ï¼Œå¦‚æžœè¦å®Œå…¨åˆ é™¤ OnBackPressedCallbackï¼Œåˆ™åº”è°ƒç”¨ remove()ã€‚ ä½†æ˜¯ï¼Œè¿™é€šå¸¸ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºåœ¨é”€æ¯å…³è”çš„ LifecycleOwner æ—¶ä¼šè‡ªåŠ¨åˆ é™¤å…¶å›žè°ƒã€‚ Activity onBackPressed()å¦‚æžœæ‚¨ä½¿ç”¨ onBackPressed() å¤„ç†è¿”å›žæŒ‰é’®äº‹ä»¶ï¼Œå»ºè®®æ‚¨æ”¹ç”¨ OnBackPressedCallback ã€‚ ä½†æ˜¯ï¼Œå¦‚æžœæ‚¨æ— æ³•è¿›è¡Œæ­¤æ›´æ”¹ï¼Œåˆ™é€‚ç”¨ä»¥ä¸‹è§„åˆ™ï¼š å½“æ‚¨è°ƒç”¨ super.onBackPressed() æ—¶ï¼Œå°†é€šè¿‡ addCallback æ³¨å†Œçš„æ‰€æœ‰å›žè°ƒã€‚ æ— è®º OnBackPressedCallback çš„ä»»ä½•æ³¨å†Œå®žä¾‹ï¼Œå§‹ç»ˆä¼šè°ƒç”¨ onBackPressedã€‚ Demoå…³äºŽ fragment è¿”å›žæ ˆçš„ demo å·²ç»å†™å¥½äº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ åœ¨è¿™ æ‰¾åˆ°å®ƒã€‚ æˆ‘ä»¬ä¸‹ä¸€ç¯‡å†è§ã€‚ å…³äºŽæˆ‘ æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€èƒŒä¸ŠJetpackä¹‹Fragmentã€‘ä»Žæºç è§’åº¦çœ‹Fragmentçš„å¯åŠ¨æµç¨‹åŠç”Ÿå‘½å‘¨æœŸ åŸºäºŽAndroidX Fragment1.2.2]]></title>
    <url>%2F2020%2F03%2F10%2FJetpack-fragment-lifecycle%2F</url>
    <content type="text"><![CDATA[ç¬”è€…çœ‹è¿‡ä¸å°‘æºç åˆ†æžç±»çš„æ–‡ç« ï¼ŒåŠ¨è¾„è´´ä¸Šå¤§æ®µä»£ç ï¼Œè¿™ç§æ–¹å¼å¾ˆå®¹æ˜“æ‰“æ–­è¯»è€…çš„æ€è·¯ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™çœ‹è¿‡è¿™ç±»æ–‡ç« æ„Ÿå¹å¥½æ–‡å¥½æ–‡ï¼Œå´æ„Ÿè§‰ä»€ä¹ˆéƒ½æ²¡è®°ä½ï¼Œäº¦æˆ–è€…é»˜é»˜åŠ å…¥æ”¶è—å´ä¸çŸ¥ä½•æ—¶èƒ½åŽ»ç»†å¿ƒåœ°ç ”è¯»ã€‚ æ‰€ä»¥æœ¬æ–‡ä¸ä¼šè¿‡å¤šä»‹ç»æºç çš„ç»†èŠ‚ï¼Œæ›´å¤šåœ°æ˜¯æŠ›ç –å¼•çŽ‰ï¼Œå¦‚æžœæ‚¨çœ‹è¿‡æœ¬æ–‡åŽèƒ½å¤Ÿè·Ÿç€æœ¬æ–‡çš„æ€è·¯è‡ªå·±ç¿»ä¸€ä¸‹æºç ç›¸ä¿¡æ‚¨å°±ä¸ä¼šæœ‰æˆ‘ä¸Šè¿°çš„ä½“éªŒäº†ã€‚ æœ¬æ–‡é»˜è®¤æ‚¨å·²å¯¹ fragment çš„ç”Ÿå‘½å‘¨æœŸæœ‰æ‰€äº†è§£ï¼Œå¹¶æ¸…æ¥šfragmentçš„ç¼˜èµ·ä¸ŽèŒè´£ã€‚è¿™éƒ¨åˆ†åŸºç¡€å†…å®¹å¯ç§»æ­¥ fragment å®˜æ–¹æ–‡æ¡£ ä¹Ÿå³æœ¬æ–‡ä¸ä¼šä»‹ç» â€œwhatâ€ï¼Œè€Œæ˜¯ä»‹ç» â€œhowâ€ å¹¶ä¸”æŽ¢è®¨ä¸€ä¸‹ â€œwhyâ€ è¿™é‡Œè´´ä¸€ä¸‹ androidx fragment æºç åœ°å€ androidx fragment å®˜æ–¹æºç åœ°å€ æœ¬æ–‡åŸºäºŽ androidx fragment 1.2.2 æºç åˆ†æž 1implementation "androidx.fragment:fragment-ktx:1.2.2" æœ¬æ–‡ä¸»è¦ä»‹ç»fragmentçš„å¯åŠ¨æµç¨‹ï¼Œå…¶ä»–å†…å®¹ä¾‹å¦‚è¿”å›žæ ˆï¼Œä¼šåŽç»­æ›´æ–°ï¼Œæ•¬è¯·å…³æ³¨ã€‚æ¬¢è¿Žåœ¨è¯„è®ºåŒºä¸‹è®¨è®ºã€‚æœ¬æ–‡demo æ—¢ç„¶æˆ‘ä»¬éƒ½çŸ¥é“ â€œwhatâ€ï¼Œä¸å¦¨æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹ â€œhowâ€ åˆ†æžå‰çš„æ€è€ƒè¯·å¤§å®¶æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çŸ¥é“fragment çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸Žå…¶å®¿ä¸» activity çš„ç”Ÿå‘½å‘¨æœŸæ¯æ¯ç›¸å…³çš„ï¼Œä¹Ÿå³ activity çš„æ¯æ¬¡ç”Ÿå‘½å‘¨æœŸå›žè°ƒéƒ½ä¼šå¼•å‘æ¯ä¸ªfragmentçš„ç±»ä¼¼å›žè°ƒã€‚ é‚£ä¹ˆï¼Œå¦‚æžœè®©æˆ‘ä»¬æ¥å®žçŽ°è¿™æ ·çš„æ“ä½œï¼Œåº”è¯¥æ€Žä¹ˆåšï¼Ÿ çŒœæµ‹ï¼šåœ¨activityæ¯ä¸ªç”Ÿå‘½å‘¨æœŸçš„èŠ‚ç‚¹ï¼ŒåŽ»æ“ä½œfragmentï¼Œè®©å…¶æ‰§è¡Œç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚ æ€è·¯æœ‰äº†ï¼Œä¸‹é¢è¿›è¡Œä¸€äº›ç»†èŠ‚çš„ç¡®è®¤ã€‚ activity è¦èƒ½æ“ä½œ fragmentï¼Œfragment äº¦å¯æ“ä½œ fragmentï¼Œæ‰€ä»¥éœ€è¦æŠ½è±¡å‡ºä¸€ä¸ªç®¡ç† fragment çš„æ¨¡åž‹ activity æ“ä½œ fragment çš„ä¸€ç³»åˆ—åŠ¨ä½œï¼Œåº”è¯¥æ˜¯äº’ä¸ºå¯é€†ä¸€ç»„æ“ä½œã€‚ä¾‹å¦‚æ·»åŠ  fragment åŽï¼Œä¹Ÿåº”èƒ½ç§»é™¤ fragment activity å¯¹ fragment çš„æ¯ç»„æ“ä½œä¸åº”æ˜¯å•ä¸€çš„ï¼Œä¾‹å¦‚å¯ä»¥åœ¨ä¸€æ¬¡æ“ä½œä¸­åœ¨ activity ä¸åŒä½ç½®æ·»åŠ ä¸¤ä¸ª fragmentï¼ŒåŒæ—¶è¯¥æ“ä½œè¿˜åº”æ»¡è¶³ 2 ï¼Œå…·æœ‰å¯é€†æ€§ å¯¹äºŽç¬¬ä¸€æ¡ï¼Œæˆ‘ä»¬æŠ½è±¡å‡ºä¸€ä¸ªå¯ä»¥ç®¡ç† fragment çš„æ¨¡åž‹ï¼ŒåŠ å…¥ä¸Šä¸‹çº§çš„å…³ç³»ï¼Œå³ activity å¯ç®¡ç†å…¶å†…éƒ¨çš„ fragmentï¼Œfragment äº¦å¯ç®¡ç†å…¶å†…éƒ¨çš„ fragmentã€‚å› æ­¤ fragment åŒæ—¶å……å½“ç€ç®¡ç†è€…ä¸Žè¢«ç®¡ç†è€…ä¸¤ç§è§’è‰² å¯¹äºŽåŽä¸¤æ¡ï¼Œç›¸ä¿¡åœ¨å¤§å­¦å­¦è¿‡æ•°æ®åº“çš„äººä¼šæƒ³åˆ°ä¸€ç§ç»“æž„ï¼šäº‹åŠ¡ï¼ˆTransactionï¼‰ äº‹åŠ¡æ˜¯æŒ‡ä¸€ç»„åŽŸå­æ€§çš„æ“ä½œï¼Œè¿™äº›æ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„æ•´ä½“ï¼Œè¦ä¹ˆå…¨å®Œæˆï¼Œè¦ä¹ˆå…¨ä¸å®Œæˆï¼Œå®ŒæˆåŽå¯ä»¥å›žæ»šåˆ°å®Œæˆå‰çš„çŠ¶æ€ å› æ­¤ï¼Œfragment ä¸­ä¸¤ä¸ªæœ€é‡è¦çš„æ¦‚å¿µå‡ºçŽ°äº†ï¼ŒFragmentManager å’Œ FragmentTransaction FragmentManager å°è£…ç€å¯¹ fragment æ“ä½œçš„å„ç§æ–¹æ³•ï¼ŒaddFragment removeFragment ç­‰ç­‰ï¼Œè€Œ FragmentActivity é€šè¿‡ FragmentController æ¥æ“ä½œ FragmentManager FragmentTransaction å°è£…å¯¹ fragment å®¹å™¨è¿›è¡Œçš„ fragment æ“ä½œï¼Œä¾‹å¦‚åœ¨å®¹å™¨1å†…æ·»åŠ ä¸€ä¸ª fragmentï¼ŒåŒæ—¶åœ¨å®¹å™¨2å†…æ›¿æ¢fragmentã€‚ å®ƒä»¬å‡ä¸ºæŠ½è±¡ç±»ï¼Œéœ€è¦å…·ä½“çš„å®žçŽ°ç±»ã€‚ FragmentManager çš„å®žçŽ°ç±»ä¸º FragmentManagerImplï¼Œå…¶å†…éƒ¨é€»è¾‘å·²å…¨éƒ¨ç§»è‡³ FragmentManager ä¸­ï¼Œæ˜¯ä¸ªç©ºå®žçŽ°ã€‚ FragmentTransaction çš„å®žçŽ°ç±»ä¸º BackStackRecord ï¼Œå…¶å†…éƒ¨å¼•ç”¨äº† FragmentManager çš„å®žä¾‹ ï¼ŒåŒæ—¶é‡å†™äº†çˆ¶ç±»çš„ å››ä¸ª commit ç›¸å…³çš„æ–¹æ³•ã€‚ çœ‹ä¼¼æœ€ç®€å•çš„å¯åŠ¨æµç¨‹çŽ°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€éƒ¨åˆ†ä»£ç ï¼Œå¹³æ—¶åœ¨activityä¸­æˆ‘ä»¬æ˜¯è¿™æ ·å¡«å……ä¸€ä¸ªfragmentçš„ 12345678910override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) //é¿å…æ—‹è½¬å±å¹•ç­‰åœºæ™¯ fragment é‡å çš„é—®é¢˜ if (savedInstanceState == null) &#123; supportFragmentManager//æ­¥éª¤1 .beginTransaction()//æ­¥éª¤2 .add(R.id.container, BlankFragment.newInstance())//æ­¥éª¤3 .commitNow()//æ­¥éª¤4 &#125;&#125; æ­¥éª¤1ï¼Œå®žä¾‹åŒ– FragmentManagerImpl å¯¹è±¡ (å†…éƒ¨ç»åŽ†äº†ä¸€äº›è½¬æ¢ï¼Œè¯¦æƒ…å‚è§æºç æˆ–æŸ¥çœ‹demoæ³¨é‡Š) æ­¥éª¤2ï¼Œå®žä¾‹åŒ– BackStackRecordå¯¹è±¡ï¼Œå¹¶åœ¨æž„é€ å™¨ä¸­ä¼ å…¥ FragmentManager å®žä¾‹ æ­¥éª¤3ï¼Œè°ƒç”¨äº‹åŠ¡æ–¹æ³•ï¼Œå¯¹ fragment å®¹å™¨è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œæœ¬ä¾‹è¡¨ç¤ºåœ¨ id ä¸º container å®¹å™¨å†…æ·»åŠ  BlankFragment æ­¥éª¤4ï¼Œæäº¤äº‹åŠ¡ï¼Œäº¤äºŽ FragmentManager å¤„ç† åœ¨ terminal æ•²å…¥ adb shell setprop log.tag.FragmentManager VERBOSE å¯å¼€å¯FragmentManagerçš„æ—¥å¿—åŠŸèƒ½ï¼Œè¿‡æ»¤ FragmentManager ï¼Œæ—¥å¿—å¦‚ä¸‹ï¼š ç»¿è‰²éƒ¨åˆ†ä¸ºç¬”è€…æ‰‹åŠ¨æ·»åŠ çš„logï¼Œç°è‰²å’Œè“è‰²éƒ¨åˆ†ä¸º fragment æºç ä¸­çš„log æ ¹æ®æ—¥å¿—æ˜¾ç¤ºçš„æµç¨‹ï¼Œæˆ‘ä»¬çš„çŒœæµ‹çœ‹ä¼¼æ˜¯æ­£ç¡®çš„ï¼Œâ€œåœ¨ activity æ¯ä¸ªç”Ÿå‘½å‘¨æœŸçš„èŠ‚ç‚¹ï¼ŒåŽ»æ“ä½œ fragment ï¼Œè®©å…¶æ‰§è¡Œç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•â€ å…¶å®žè¿™é‡Œæ˜¯æœ‰å¹²æ‰°çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨activity çš„ onCreate æ–¹æ³•é‡Œ åˆ›å»ºå¹¶æäº¤ FragmentTransaction ï¼Œå¦‚æžœåœ¨ onResume é‡Œè°ƒç”¨å‘¢ï¼Ÿ WTFï¼ æˆ–è®¸ï¼Œæˆ‘ä»¬çš„çŒœæµ‹æœ‰é—®é¢˜ï¼Ÿçœ‹ä¼¼è°ƒç”¨ commitNow åŽ fragment çš„ç”Ÿå‘½æµç¨‹æ˜¯è‡ªå‘è¿›è¡Œçš„ é‚£å¦‚æžœæˆ‘ä»¬æŠŠè°ƒç”¨æŒªåˆ° onPause å‘¢ï¼Ÿ æ‰“å¼€ activity å¹¶æŒ‰ä¸‹ home é”® æˆ‘çŸ¥é“å¥½å¥‡çš„è¯»è€…ä¼šå°è¯•åœ¨ onStop ä¸­å°è¯•ä¸€ä¸‹ï¼Œæœ‰æƒŠå–œã€‚æ‰‹åŠ¨æ»‘ç¨½ã€‚ ä»Žè¿™å‡ æ®µæ—¥å¿—ä¸Šæ¥çœ‹ï¼Œfragment åœ¨æäº¤äº‹åŠ¡åŽä¼šè‡ªå‘è¿›å…¥è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼Œè€Œå½“å…¶å®¿ä¸» activity ç”Ÿå‘½å‘¨æœŸå‘ç”Ÿå˜åŒ–æ—¶ï¼Œfragment çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿè·Ÿéšå˜åŒ–ã€‚ å¦‚æžœè¿™ä¹ˆè¯´æ¯”è¾ƒæŠ½è±¡çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åœ¨ onPause ä¸­æ˜¾ç¤ºfragment çš„æ—¥å¿—ï¼Œå½“ Fragment è¿›å…¥ onStart ç”Ÿå‘½å‘¨æœŸåŽï¼Œå¦‚æžœæ˜¯æ­£å¸¸æµç¨‹åº”è¯¥è¿›å…¥ onResumeï¼Œä½†ç”±äºŽæŒ‰ä¸‹ home é”® activityè¿›å…¥onStopï¼Œfragment ä¹Ÿè¿›å…¥äº† onStop çŠ¶æ€ å› æ­¤ï¼Œæˆ‘ä»¬å°†ä¹‹å‰çš„çŒœæµ‹è¿›è¡Œæ‰©å±•ï¼š åœ¨activityæ¯ä¸ªç”Ÿå‘½å‘¨æœŸçš„èŠ‚ç‚¹ï¼ŒåŽ»æ“ä½œfragmentï¼Œè®©å…¶æ‰§è¡Œç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³• FragmentTransaction è¢«æäº¤åŽ fragment ä¼šè¿›å…¥è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼Œä½†å— 1 çº¦æŸ é‚£ä¹ˆæˆ‘ä»¬çš„æºç è§£è¯»å°±ä»Žä¸¤ä¸ªæ–¹å‘å…¥æ‰‹ Activity æ“ä½œ Fragment ç”Ÿå‘½å‘¨æœŸactivity æ˜¯é€šè¿‡ FragmentController æ“ä½œ FragmentManager è¿›è€Œæ“ä½œ fragment çš„ã€‚ å…·ä½“ç‚¹å°±æ˜¯åœ¨ activity å„ä¸ªç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹é€šè¿‡è°ƒç”¨ FragmentController ä¸­çš„å„ä¸ª dispatch- æ–¹æ³•è¿›è€Œè°ƒç”¨ FragmentManager ä¸­çš„å„ä¸ª dispatch- æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334//FragmentActivity.javafinal FragmentController mFragments = FragmentController.createController(new HostCallbacks());//ä»¥ä¸‹ä»£ç çœç•¥éƒ¨åˆ†é€»è¾‘@Overrideprotected void onCreate(@Nullable Bundle savedInstanceState) &#123; mFragments.dispatchCreate();&#125;@Overrideprotected void onStart() &#123; mFragments.dispatchStart();&#125;//onResume å½»åº•æ‰§è¡Œå®Œæ¯•çš„å›žè°ƒ@Overrideprotected void onPostResume() &#123; mFragments.dispatchResume();&#125;@Overrideprotected void onPause() &#123; mFragments.dispatchPause();&#125;@Overrideprotected void onStop() &#123; mFragments.dispatchStop();&#125;@Overrideprotected void onDestroy() &#123; super.onDestroy(); mFragments.dispatchDestroy();&#125; è¿™æ ·çŒœæµ‹ 1 å°±è¢«è¯å®žäº† activity ä¼šåœ¨å„ä¸ªç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹é€šè¿‡ FragmentController é—´æŽ¥è°ƒç”¨ FragmentManager ä¸­çš„ å„ç§ dispatch- æ–¹æ³•ï¼Œè¿›è€Œå½±å“ fragment çš„ç”Ÿå‘½å‘¨æœŸ é‚£ä¹ˆåµŒå¥— fragment å‘¢ï¼Ÿ åµŒå¥— fragment ä¹Ÿåº”è¯¥æ˜¯å®¿ä¸»ä½¿ç”¨ FragmentManager ä¸­çš„å„ç§ dispatch- æ–¹æ³•ï¼ŒåŸºäºŽè¿™ä¸ªæƒ³æ³•æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ FragmentManager ä¸­ dispatch- æ–¹æ³•çš„è°ƒç”¨ å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸¤å¤„è°ƒç”¨ï¼Œç¬¬äºŒå¤„ä¸ºactivity é€šè¿‡ FragmentController é—´æŽ¥è°ƒç”¨ï¼Œç¬¬ä¸€å¤„ä½¿ç”¨çš„æ˜¯ mChildFragmentManager è¿™é‡Œå¼•å‡º fragment ä¸­å¦å¤–ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µï¼ŒgetParentFragmentManager() å’Œ getChildFragmentManager() æ³¨æ„ï¼šrequireFragmentManager() å’Œ getFragmentManager å·²å¼ƒç”¨ getChildFragmentManager()èŽ·å–çš„æ˜¯fragment ä¸­çš„ mChildFragmentManager getParentFragmentManager() èŽ·å–çš„æ˜¯fragment ä¸­çš„ mFragmentManager mChildFragmentManager ä¸ºfragmentå†…éƒ¨çš„ fragmentManager 123// Private fragment manager for child fragments inside of this one.@NonNullFragmentManager mChildFragmentManager = new FragmentManagerImpl(); mFragmentManager ç¨æ˜¾å¤æ‚ï¼Œ å¦‚æžœ fragment çš„ç›´æŽ¥å®¿ä¸»æ˜¯ activity ï¼Œåˆ™è¿”å›žçš„æ˜¯ activity ä¸­çš„getSupportFragmentManager() è¿”å›žçš„ fragmentManager å¦‚æžœ fragment çš„ç›´æŽ¥å®¿ä¸»æ˜¯ fragmentï¼Œå³è¯¥ fragment æ˜¯å…¶ä»– fragment çš„å­ fragmentï¼Œåˆ™è¿”å›žçš„æ˜¯å…¶çˆ¶ fragment çš„ getChildFragmentManager æ‰€ä»¥ åµŒå¥—fragment çš„ç”Ÿå‘½å‘¨æœŸæ˜¯çˆ¶ fragment åœ¨å„ä¸ªç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹ä¸Šé€šè¿‡ mChildFragmentManager è°ƒç”¨ dispatch- ä»¥å½±å“å…¶å­ fragment çš„ç”Ÿå‘½å‘¨æœŸ è¿™æ ·æˆ‘ä»¬ç¬¬ä¸€éƒ¨åˆ†çš„è§£è¯»å°±å‘Šä¸€æ®µè½äº†, è¿™é‡Œç‚¹åˆ°ä¸ºæ­¢,ä¸€äº›ç»†èŠ‚éœ€è¦æ‚¨è‡ªå·±äº²è‡ªçœ‹çœ‹æºç  Fragment çš„ç”Ÿå‘½å‘¨æœŸè‡ªæ²»åœ¨ çœ‹ä¼¼æœ€ç®€å•çš„å¯åŠ¨æµç¨‹ ä¸€èŠ‚ä¸­æˆ‘ä»¬åˆ†åˆ«åœ¨ activity çš„ onCreate ï¼ŒonResumeï¼ŒonPause ä¸­åˆ†åˆ«å¼€å¯å¹¶æäº¤äº‹åŠ¡ï¼Œæ¥è§‚å¯Ÿ fragment çš„ç”Ÿå‘½å‘¨æœŸæ—¥å¿—ã€‚ åœ¨æ²¡æœ‰ activity å¹²æ‰°çš„æƒ…å†µä¸‹ï¼Œfragment çš„ç”Ÿå‘½å‘¨æœŸæ˜¯è‡ªæ²»çš„ã€‚ é‚£ä¹ˆæˆ‘ä»¬ç»§ç»­æ€è€ƒä¸€ä¸ªé—®é¢˜ Fragment çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å¦‚ä½•ä¸€çŽ¯æ‰£ä¸€çŽ¯çš„æ‰§è¡Œçš„ï¼Ÿ ä»Žä¸Šé¢çš„æ—¥å¿—ï¼Œæˆ‘ä»¬çœ‹åˆ°å¾ˆå¤š â€œmoveto-â€ çš„æ—¥å¿—ï¼Œ æˆ‘ä»¬å¯ä»¥ç»§ç»­å¤§èƒ†åœ°çŒœæµ‹ï¼Œä¸€ä¸ªç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹ç»“æŸåŽè°ƒç”¨è¿›å…¥å¦ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹çš„æ–¹æ³• åŸºäºŽè¿™ä¸ªçŒœæµ‹ï¼Œæˆ‘ä»¬ç¡®è®¤ä¸€äº›ç»†èŠ‚ fragment åº”è¯¥æœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œå®ƒå¯èƒ½è‡ªå·±ç®¡ç†å†…éƒ¨çš„çŠ¶æ€ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰å°è£…ç€çŠ¶æ€è½¬ç§»çš„é€»è¾‘çš„ä¸“é—¨ç®¡ç†çŠ¶æ€çš„æŠ½è±¡ è¿™é‡Œå¼•å‡ºå¦å¤–ä¸€ä¸ªæ¦‚å¿µ FragmentStateManager FragmentStateManager ä¸­æŒæœ‰ fragment çš„å¼•ç”¨ mFragment ä»¥åŠ FragmentManager çš„çŠ¶æ€ mFragmentManagerState è¿™é‡Œfragmentçš„çŠ¶æ€å€¼ä¸ºï¼š 123456static final int INITIALIZING = -1; // Not yet attached.static final int ATTACHED = 0; // Attached to the host.static final int CREATED = 1; // Created.static final int ACTIVITY_CREATED = 2; // Fully created, not started.static final int STARTED = 3; // Created and started, not resumed.static final int RESUMED = 4; // Created started and resumed. FragmentStateManager è¿˜å°è£…ç€ fragment çŠ¶æ€è½¬ç§»çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š 123456789101112void activityCreated() &#123; if (FragmentManager.isLoggingEnabled(Log.DEBUG)) &#123; Log.d(TAG, "moveto ACTIVITY_CREATED: " + mFragment); &#125; mFragment.performActivityCreated(mFragment.mSavedFragmentState);&#125;void start() &#123; if (FragmentManager.isLoggingEnabled(Log.DEBUG)) &#123; Log.d(TAG, "moveto STARTED: " + mFragment); &#125; mFragment.performStart();&#125; fragment ç”Ÿå‘½å‘¨æœŸè‡ªæ²»çš„æ ¸å¿ƒé€»è¾‘å°è£…åœ¨ FragmentManager ä¸­çš„ void moveToState(@NonNull Fragment f, int newState) å†…ï¼Œä¸»è¦ä»£ç ä¸º(ç²¾ç®€åŽ)ï¼š 12345678910111213141516171819202122232425262728293031323334void moveToState(@NonNull Fragment f, int newState) &#123; FragmentStateManager fragmentStateManager = mFragmentStore.getFragmentStateManager(f.mWho); newState = Math.min(newState, fragmentStateManager.computeMaxState()); if (f.mState &lt;= newState) &#123; switch (f.mState) &#123; case Fragment.INITIALIZING: if (newState &gt; Fragment.INITIALIZING) &#123; fragmentStateManager.attach(mHost, this, mParent); &#125; case Fragment.ATTACHED: if (newState &gt; Fragment.ATTACHED) &#123; fragmentStateManager.create(); &#125; case Fragment.CREATED: if (newState &gt; Fragment.INITIALIZING) &#123; fragmentStateManager.ensureInflatedView(); &#125; if (newState &gt; Fragment.CREATED) &#123; fragmentStateManager.createView(mContainer); fragmentStateManager.activityCreated(); fragmentStateManager.restoreViewState(); &#125; case Fragment.ACTIVITY_CREATED: if (newState &gt; Fragment.ACTIVITY_CREATED) &#123; fragmentStateManager.start(); &#125; case Fragment.STARTED: if (newState &gt; Fragment.STARTED) &#123; fragmentStateManager.resume(); &#125; &#125; &#125;&#125; æ³¨æ„ï¼šè¿™é‡Œçš„switch æ²¡æœ‰ break ç»†å¿ƒçš„è¯»è€…å¯èƒ½å‘çŽ°äº†ï¼Œfragment ä¸­çš„çŠ¶æ€æ€Žä¹ˆåªåˆ° resume ï¼ŒåŽç»­çš„çŠ¶æ€å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ FragmentManager ä¸­çš„ dispatchPause æ–¹æ³• 123void dispatchPause() &#123; dispatchStateChange(Fragment.STARTED);&#125; ä¸ºä»€ä¹ˆ dispatch äº† STARTED çš„çŠ¶æ€ï¼Ÿå…¶å®žåˆšåˆš moveToState æ–¹æ³•æˆ‘ç²¾ç®€æŽ‰äº†ä¸€éƒ¨åˆ†ä»£ç ï¼Œç•™ä¸‹çš„åªæœ‰ f.mState &lt;= newState çš„é€»è¾‘ï¼Œå³ dispatch çš„æ–°çŠ¶æ€å¤§äºŽç­‰äºŽå½“å‰çš„çŠ¶æ€ è€ŒçŽ°åœ¨dispatch çš„æ–°çŠ¶æ€æ¯”å½“å‰çŠ¶æ€å€¼å°ï¼Œåˆ™èµ°äº†ä¸‹é¢çš„é€»è¾‘ï¼Œä¾‹å¦‚å½“å‰çŠ¶æ€ä¸º RESUMED ï¼Œæ–°ä¼ é€’çš„çŠ¶æ€ä¸º STARTEDï¼Œæ‰§è¡Œäº† fragmentStateManager.pause(); 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061void moveToState(@NonNull Fragment f, int newState) &#123; FragmentStateManager fragmentStateManager = mFragmentStore.getFragmentStateManager(f.mWho); newState = Math.min(newState, fragmentStateManager.computeMaxState()); if (f.mState &lt;= newState) &#123; //çœç•¥... &#125;else if (f.mState &gt; newState) &#123; switch (f.mState) &#123; case Fragment.RESUMED: if (newState &lt; Fragment.RESUMED) &#123; fragmentStateManager.pause(); &#125; case Fragment.STARTED: if (newState &lt; Fragment.STARTED) &#123; fragmentStateManager.stop(); &#125; case Fragment.ACTIVITY_CREATED: if (newState &lt; Fragment.ACTIVITY_CREATED) &#123; if (isLoggingEnabled(Log.DEBUG)) &#123; Log.d(TAG, "movefrom ACTIVITY_CREATED: " + f); &#125; if (f.mView != null) &#123; if (mHost.onShouldSaveFragmentState(f) &amp;&amp; f.mSavedViewState == null) &#123; fragmentStateManager.saveViewState(); &#125; &#125; if (mExitAnimationCancellationSignals.get(f) == null) &#123; destroyFragmentView(f); &#125; else &#123; f.setStateAfterAnimating(newState); &#125; &#125; case Fragment.CREATED: if (newState &lt; Fragment.CREATED) &#123; boolean beingRemoved = f.mRemoving &amp;&amp; !f.isInBackStack(); if (beingRemoved || mNonConfig.shouldDestroy(f)) &#123; makeInactive(fragmentStateManager); &#125; else &#123; if (f.mTargetWho != null) &#123; Fragment target = findActiveFragment(f.mTargetWho); if (target != null &amp;&amp; target.getRetainInstance()) &#123; f.mTarget = target; &#125; &#125; &#125; if (mExitAnimationCancellationSignals.get(f) != null) &#123; f.setStateAfterAnimating(newState); newState = Fragment.CREATED; &#125; else &#123; fragmentStateManager.destroy(mHost, mNonConfig); &#125; &#125; case Fragment.ATTACHED: if (newState &lt; Fragment.ATTACHED) &#123; fragmentStateManager.detach(mNonConfig); &#125; &#125; &#125;&#125; æ³¨æ„ï¼šè¿™é‡Œçš„switch è¿˜æ˜¯æ²¡æœ‰ break è¿™é‡Œæœ‰ä¸ªç»†èŠ‚ï¼Œç”±äºŽactivityæ²¡æœ‰ onDestroyView çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥ FragmentController ä¸­çš„ dispatchDestroyView æ˜¯æ²¡æœ‰è°ƒç”¨çš„ åœ¨ activity ä¸­çš„ destroy æ–¹æ³•ä¸­é€šè¿‡ fragmentController è°ƒç”¨äº† dispatchDestroy å†…éƒ¨è°ƒç”¨ dispatchStateChange(Fragment.INITIALIZING) ï¼Œè€Œæ­¤æ—¶çš„fragment çš„ mState ä¸º ACTIVITY_CREATEDï¼Œæ‰€ä»¥ moveToState æ–¹æ³•ä¼šèµ°åˆ° ACTIVITY_CREATED çš„ case å¹¶æ‰§è¡Œåˆ°åº• è¿™æ · fragment æœ€ç®€å•åœºæ™¯çš„ç”Ÿå‘½å‘¨æœŸå°±ç»“æŸäº† æ€»ç»“æˆ‘ä»¬åšä¸€ä¸ªæ€»ç»“ï¼šactivity å’Œ fragment ä¼šåœ¨å„ä¸ªç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹é€šè¿‡è¢«è°ƒç”¨ fragment çš„ parentFragmentManagerï¼ˆæˆ–è€…è¯´çˆ¶ fragment çš„ childFragmentManager å’Œ activity çš„ supportFragmentManagerï¼‰ä¸­çš„å„ç§ dispatch- æ–¹æ³•ä»¥å½±å“å­ fragment çš„ ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶å­ fragment ä¹Ÿæ‹¥æœ‰è‡ªå·±ç”Ÿå‘½å‘¨æœŸçš„è°ƒç”¨é“¾ï¼ˆä»ŽçŠ¶æ€Aè½¬ç§»è‡³çŠ¶æ€Bï¼‰ ä¸å¾—ä¸è¯´ fragment çš„å¾ˆå¤š API å¹¶ä¸æ˜¯å¾ˆå¥½ç”¨ï¼Œä»Ž androidx fragment çš„æ›´æ–°é¢‘çŽ‡ä¹Ÿå¯ä»¥çœ‹å‡ºã€‚æ¯”å¦‚ fragment ä¸­çš„ view å’Œ fragmentæœ¬èº«çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ä¸€è‡´çš„ï¼Œå­˜åœ¨onDestroyView ä½† fragmentæ²¡æœ‰é”€æ¯çš„æƒ…å†µ Ian Lake åœ¨ Fragments: Past, Present, and Future (Android Dev Summit â€˜19) ä¸­æåˆ°æœªæ¥å®˜æ–¹ä¼šå°†äºŒè€…åˆå¹¶ï¼Œå±Šæ—¶ fragment çš„ä½¿ç”¨ä¼šæ›´åŠ ç®€æ´ è¿™é‡Œå¼•ç”¨ The Android Lifecycle cheat sheet â€” part III : Fragments æ–‡ä¸­çš„å›¾ç‰‡ ï¼Œå’Œæˆ‘ç”»çš„commit FragmentTransaction çš„è„‘å›¾ï¼ˆç•¥ç®€é™‹ï¼‰ï¼Œå¸®æ‚¨æ›´å¥½çš„ç†è§£ å¼ºçƒˆå»ºè®®æ‚¨è‡ªå·±äº²è‡ªçœ‹ä¸€çœ‹æºç ï¼Œä¸ç„¶å°±å˜ä¸ºæˆ‘æ–‡ç« å¼€å¤´æ—¶è¯´çš„çŠ¶æ€äº†ã€‚ å…³äºŽæˆ‘ æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€èƒŒä¸ŠJetpackä¹‹Fragmentã€‘ä½ çœŸçš„ä¼šç”¨Fragmentå—ï¼ŸFragmentå¸¸è§é—®é¢˜ä»¥åŠandroidxä¸‹Fragmentçš„ä½¿ç”¨æ–°å§¿åŠ¿]]></title>
    <url>%2F2020%2F03%2F02%2FJetpack-fragment%2F</url>
    <content type="text"><![CDATA[åœ¨ Android Jetpack ç»„ä»¶ä¸­ï¼Œfragmentä½œä¸ºè§†å›¾æŽ§åˆ¶å™¨ä¹‹ä¸€å æœ‰å¾ˆé‡è¦çš„ä½ç½®ã€‚ä½†ç”±äºŽå…¶bugä¼—å¤šï¼Œæš—å‘æ— æ•°ï¼Œä»¥è‡³äºŽ Square æœ‰è¿™æ ·ä¸€ç¯‡åšå®¢ï¼šAdvocating Against Android Fragmentsã€‚githubä¸Šçš„ Fragmentation æœ‰ç€ 9.4k çš„starã€‚ è€ŒçŽ°åœ¨ï¼Œandroidx fragment ç¨³å®šç‰ˆå·²æ¥åˆ° 1.2.2ï¼Œè®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹fragmentæœ‰å“ªäº›å¸¸è§é—®é¢˜ä»¥åŠæœ‰å“ªäº›ä½¿ç”¨fragmentçš„æ–°å§¿åŠ¿ Fragment å¸¸è§çš„é—®é¢˜ getSupportFragmentManager ï¼Œ getParentFragmentManager å’Œ getChildFragmentManager FragmentStateAdapter å’Œ FragmentPagerAdapter add å’Œ replace observe LiveDataæ—¶ä¼ å…¥ this è¿˜æ˜¯ viewLifecycleOwner ä½¿ç”¨ simpleName ä½œä¸º fragment çš„ tag æœ‰ä½•é£Žé™©ï¼Ÿ åœ¨ BottomBarNavigation å’Œ drawer ä¸­å¦‚ä½•ä½¿ç”¨Fragmentå¤šæ¬¡æ·»åŠ ï¼Ÿ è¿”å›žæ ˆ getSupportFragmentManager , getParentFragmentManagerå’ŒgetChildFragmentManager FragmentManageræ˜¯ androidx.fragment.app(å·²å¼ƒç”¨çš„ä¸è€ƒè™‘)ä¸‹çš„æŠ½è±¡ç±»ï¼Œåˆ›å»ºç”¨äºŽ æ·»åŠ ï¼Œç§»é™¤ï¼Œæ›¿æ¢ fragment çš„äº‹åŠ¡ï¼ˆtransactionï¼‰ é¦–å…ˆè¦ç¡®è®¤ä¸€ä»¶äº‹ï¼ŒgetSupportFragmentManager()æ˜¯ FragmentActivityä¸‹çš„æ–¹æ³• getParentFragmentManager å’Œ getChildFragmentManager æ˜¯ androidx.fragment.app.Fragment ä¸‹çš„æ–¹æ³•ï¼Œå…¶ä¸­ androidx.fragment 1.2.0 åŽ getFragmentManager ä¸Ž requireFragmentManager å·²å¼ƒç”¨ æ˜Žç¡®äº†è¿™ä»¶äº‹ï¼ŒæŽ¥ä¸‹æ¥çš„å°±å¾ˆæ¸…æ™°äº† getSupportFragmentManagerä¸Ž activityå…³è”ï¼Œå¯ä»¥å°†å…¶è§†ä¸º activity çš„ FragmentManager getChildFragmentManager ä¸Ž fragmentå…³è”ï¼Œå¯ä»¥å°†å…¶è§†ä¸ºfragmentçš„FragmentManager getParentFragmentManageræƒ…å†µç¨å¾®å¤æ‚ï¼Œæ­£å¸¸æƒ…å†µè¿”å›žçš„æ˜¯è¯¥fragment ä¾é™„çš„activityçš„FragmentManagerã€‚å¦‚æžœè¯¥fragmentæ˜¯å¦ä¸€ä¸ªfragment çš„å­ fragmentï¼Œåˆ™è¿”å›žçš„æ˜¯å…¶çˆ¶fragmentçš„ getChildFragmentManager å¦‚æžœè¿™ä¹ˆè¯´è¿˜ä¸æ˜Žç™½çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªå®žè·µã€‚ åˆ›å»ºä¸€ä¸ª activity,ä¸€ä¸ªçˆ¶fragment ï¼Œä¸€ä¸ªå­fragment 1234567891011121314151617181920212223242526272829// activityclass MyActivity : AppCompatActivity(R.layout.activity_main) &#123; override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) supportFragmentManager.commit &#123; add&lt;ParentFragment&gt;(R.id.content) &#125; Log.i("MyActivity", "supportFragmentManager $supportFragmentManager") &#125;&#125;class ParentFragment : Fragment(R.layout.fragment_parent) &#123; override fun onViewCreated(view: View, savedInstanceState: Bundle?) &#123; super.onViewCreated(view, savedInstanceState) childFragmentManager.commit &#123; add&lt;ChildFragment&gt;(R.id.content) &#125; Log.i("ParentFragment", "parentFragmentManager $parentFragmentManager") Log.i("ParentFragment", "childFragmentManager $childFragmentManager") &#125;&#125;class ChildFragment : Fragment(R.layout.fragment_child) &#123; override fun onViewCreated(view: View, savedInstanceState: Bundle?) &#123; super.onViewCreated(view, savedInstanceState) Log.i("ChildFragment", "parentFragmentManager $parentFragmentManager") Log.i("ChildFragment", "childFragmentManager $childFragmentManager") &#125;&#125; 123456//logI/MyActivity: supportFragmentManager FragmentManager&#123;825dcef in HostCallbacks&#123;14a13fc&#125;&#125;&#125;I/ParentFragment: parentFragmentManager FragmentManager&#123;825dcef in HostCallbacks&#123;14a13fc&#125;&#125;&#125;I/ParentFragment: childFragmentManager FragmentManager&#123;df5de83 in ParentFragment&#123;7cdd800&#125;&#125;&#125;I/ChildFragment: parentFragmentManager FragmentManager&#123;df5de83 in ParentFragment&#123;7cdd800&#125;&#125;&#125;I/ChildFragment: childFragmentManager FragmentManager&#123;aba9afb in ChildFragment&#123;5cea718&#125;&#125;&#125; å› æ­¤ åœ¨ activity ä¸­ä½¿ç”¨ ViewPagerï¼ŒBottomSheetFragment å’ŒDialogFragment æ—¶ï¼Œéƒ½åº”ä½¿ç”¨ getSupportFragmentManager åœ¨fragment ä¸­ä½¿ç”¨ ViewPager æ—¶åº”è¯¥ä½¿ç”¨getChildFragmentManager é”™è¯¯çš„åœ¨ fragment ä¸­ä½¿ç”¨ activity çš„ FragmentManager ä¼šå¼•å‘å†…å­˜æ³„éœ²ã€‚ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå‡å¦‚æ‚¨çš„fragmentä¸­æœ‰ä¸€äº›ä¾é  ViewPager ç®¡ç†çš„å­ fragmentï¼Œå¹¶ä¸”æ‰€æœ‰è¿™äº› fragment éƒ½åœ¨ activity ä¸­ï¼Œå› ä¸ºæ‚¨ä½¿ç”¨çš„æ˜¯activity çš„FragmentManager ã€‚ çŽ°åœ¨ï¼Œå¦‚æžœå…³é—­æ‚¨çš„çˆ¶fragmentï¼Œå®ƒå°†è¢«å…³é—­ï¼Œä½†ä¸ä¼šè¢«é”€æ¯ï¼Œå› ä¸ºæ‰€æœ‰å­fragmentéƒ½å¤„äºŽæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”å®ƒä»¬ä»åœ¨å†…å­˜ä¸­ï¼Œä»Žè€Œå¯¼è‡´æ³„æ¼ã€‚ å®ƒä¸ä»…ä¼šæ³„æ¼çˆ¶fragmentï¼Œè¿˜ä¼šæ³„æ¼æ‰€æœ‰å­fragmentï¼Œå› ä¸ºå®ƒä»¬éƒ½æ— æ³•ä»Žå †å†…å­˜ä¸­æ¸…é™¤ã€‚ FragmentStateAdapter å’Œ FragmentPagerAdapterFragmentPagerAdapterå°†æ•´ä¸ª fragmentå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¦‚æžœViewPagerä¸­ä½¿ç”¨äº†å¤§é‡ fragmentï¼Œåˆ™å¯èƒ½å¯¼è‡´å†…å­˜å¼€é”€å¢žåŠ ã€‚ FragmentStatePagerAdapterä»…å­˜å‚¨ç‰‡æ®µçš„savedInstanceStateï¼Œå¹¶åœ¨å¤±åŽ»ç„¦ç‚¹æ—¶é”€æ¯æ‰€æœ‰ fragmentã€‚ è®©æˆ‘ä»¬çœ‹çœ‹å¸¸è§çš„ä¸¤ä¸ªé—®é¢˜ 1. åˆ·æ–°ViewPagerä¸ç”Ÿæ•ˆViewPager ä¸­çš„ fragment æ˜¯é€šè¿‡ activityæˆ– fragmentçš„ FragmentManager ç®¡ç†çš„ï¼ŒFragmentManager åŒ…å«äº†viewpagerçš„æ‰€æœ‰fragmentçš„å®žä¾‹ å› æ­¤ï¼Œå½“ViewPageræ²¡æœ‰åˆ·æ–°æ—¶ï¼Œå®ƒåªæ˜¯FragmentManagerä»ä¿ç•™çš„æ—§ fragment å®žä¾‹ã€‚ æ‚¨éœ€è¦æ‰¾å‡ºä¸ºä»€ä¹ˆFragmentMangeræŒæœ‰fragmentå®žä¾‹çš„åŽŸå› ã€‚ 2. åœ¨Viewpagerä¸­è®¿é—®å½“å‰fragmentè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é‡åˆ°çš„ä¸€ä¸ªéžå¸¸æ™®éçš„é—®é¢˜ã€‚ å¦‚æžœé‡åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨ adapter å†…éƒ¨åˆ›å»º fragment çš„æ•°ç»„åˆ—è¡¨ï¼Œæˆ–è€…å°è¯•ä½¿ç”¨æŸäº›æ ‡ç­¾è®¿é—®fragmentã€‚ ä¸è¿‡è¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ã€‚ FragmentStateAdapter å’ŒFragmentPagerAdapteréƒ½æä¾›æ–¹æ³•setPrimaryItemã€‚ å¯ä»¥ç”¨æ¥è®¾ç½®å½“å‰fragmentï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910 var fragment: ChildFragment? = null override fun setPrimaryItem(container: ViewGroup, position: Int, any: Any) &#123; if (getChildFragment() != any) fragment = any as ChildFragment super.setPrimaryItem(container, position, any) &#125; fun getChildFragment(): ChildFragment? = fragment//usemAapter.getChildFragment() add å’Œ replace å¦‚ä½•é€‰æ‹©ï¼Ÿåœ¨æˆ‘ä»¬çš„activityä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå®¹å™¨ï¼Œå…¶ä¸­è£…æœ‰fragmentã€‚ addåªä¼šå°†ä¸€ä¸ªfragmentæ·»åŠ åˆ°å®¹å™¨ä¸­ã€‚ å‡è®¾æ‚¨å°†FragmentAå’ŒFragmentBæ·»åŠ åˆ°å®¹å™¨ä¸­ã€‚ å®¹å™¨å°†å…·æœ‰FragmentAå’ŒFragmentBï¼Œå¦‚æžœå®¹å™¨æ˜¯FrameLayoutï¼Œåˆ™å°†fragmentä¸€ä¸ªæ·»åŠ åœ¨å¦ä¸€ä¸ªä¹‹ä¸Šã€‚ replaceå°†ç®€å•åœ°æ›¿æ¢å®¹å™¨é¡¶éƒ¨çš„ä¸€ä¸ªfragmentï¼Œå› æ­¤ï¼Œå¦‚æžœæˆ‘åˆ›å»ºäº† FragmentCå¹¶ replace é¡¶éƒ¨çš„ FragmentBï¼Œåˆ™FragmentBå°†è¢«ä»Žå®¹å™¨ä¸­åˆ é™¤ï¼ˆæ‰§è¡ŒonDestroyï¼Œé™¤éžæ‚¨è°ƒç”¨addToBackStackï¼Œä»…æ‰§è¡ŒonDestroyViewï¼‰ï¼Œè€ŒFragmentCå°†ä½äºŽé¡¶éƒ¨ã€‚ é‚£ä¹ˆå¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ replaceåˆ é™¤çŽ°æœ‰fragmentå¹¶æ·»åŠ ä¸€ä¸ªæ–°fragmentã€‚ è¿™æ„å‘³ç€å½“æ‚¨æŒ‰ä¸‹è¿”å›žæŒ‰é’®æ—¶ï¼Œå°†åˆ›å»ºè¢«æ›¿æ¢çš„fragmentï¼Œå¹¶è°ƒç”¨å…¶onCreateViewã€‚ å¦ä¸€æ–¹é¢ï¼Œaddä¿ç•™çŽ°æœ‰fragmentï¼Œå¹¶æ·»åŠ ä¸€ä¸ªæ–°fragmentï¼Œè¿™æ„å‘³ç€çŽ°æœ‰fragmentå°†å¤„äºŽæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”å®ƒä»¬ä¸ä¼šå¤„äºŽ â€œpausedâ€ çŠ¶æ€ã€‚ å› æ­¤ï¼ŒæŒ‰ä¸‹è¿”å›žæŒ‰é’®æ—¶ï¼ŒçŽ°æœ‰fragmentï¼ˆæ·»åŠ æ–°fragmentä¹‹å‰çš„fragmentï¼‰ä¸ä¼šè°ƒç”¨onCreateViewã€‚ å°±fragmentçš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶è€Œè¨€ï¼Œåœ¨replaceçš„æƒ…å†µä¸‹å°†è°ƒç”¨onPauseï¼ŒonResumeï¼ŒonCreateViewå’Œå…¶ä»–ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œåœ¨addçš„æƒ…å†µä¸‹åˆ™ä¸ä¼šã€‚ å¦‚æžœä¸éœ€è¦é‡æ–°è®¿é—®å½“å‰fragmentå¹¶ä¸”ä¸å†éœ€è¦å½“å‰fragmentï¼Œè¯·ä½¿ç”¨replaceã€‚ å¦å¤–ï¼Œå¦‚æžœæ‚¨çš„åº”ç”¨æœ‰å†…å­˜é™åˆ¶ï¼Œè¯·è€ƒè™‘ä½¿ç”¨replaceã€‚ observe LiveDataæ—¶ä¼ å…¥ this è¿˜æ˜¯ viewLifecycleOwnerandroidx fragment 1.2.0 èµ·ï¼Œæ·»åŠ äº†æ–°çš„ Lint æ£€æŸ¥ï¼Œä»¥ç¡®ä¿æ‚¨åœ¨ä»Ž onCreateView()ã€onViewCreated() æˆ– onActivityCreated() è§‚å¯Ÿ LiveData æ—¶ä½¿ç”¨ getViewLifecycleOwner() ä½¿ç”¨ simpleName ä½œä¸º fragment çš„ tag æœ‰ä½•é£Žé™©ï¼Ÿä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šä½¿ç”¨calssçš„simpleName ä½œä¸ºfragment çš„tag 12345supportFragmentManager.commit &#123; replace(R.id.content,MyFragment.newInstance("Fragment"), MyFragment::class.java.simpleName) addToBackStack(null)&#125; è¿™æ ·åšä¸ä¼šå‡ºçŽ°ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯â€¦ 1val fragment = supportFragmentManager.findFragmentByTag(tag) è¿™æ ·èŽ·å–åˆ°çš„fragmentå¯èƒ½ä¸æ˜¯æƒ³è¦çš„ç»“æžœã€‚ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ åŠ å…¥æœ‰ä¸¤ä¸ª fragmentï¼Œç»è¿‡æ··æ·†ï¼Œå®ƒä»¬å˜æˆ 12com.mypackage.FragmentA â†’ com.mypackage.c.acom.mypackage.FragmentB â†’ com.mypackage.c.a.a ä¸Šé¢æ˜¯æ··æ·†äº† full nameï¼Œå¦‚æžœæ˜¯simpleName å‘¢ï¼Ÿ 12com.mypackage.FragmentA â†’ acom.mypackage.FragmentB â†’ a WTFï¼ æ‰€ä»¥åœ¨è®¾ç½®tagæ—¶å°½é‡ç”¨å…¨åæˆ–è€…å¸¸é‡ åœ¨ BottomBarNavigation å’Œ drawer ä¸­å¦‚ä½•ä½¿ç”¨Fragmentå¤šæ¬¡æ·»åŠ ï¼Ÿå½“æˆ‘ä»¬ä½¿ç”¨BottomBarNavigationå’Œ NavigationDraweræ—¶ï¼Œé€šå¸¸ä¼šçœ‹åˆ°è¯¸å¦‚fragment é‡å»ºæˆ–å¤šæ¬¡æ·»åŠ ç›¸åŒfragmentä¹‹ç±»çš„é—®é¢˜ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨show / hide è€Œä¸æ˜¯ add æˆ– replaceã€‚ è¿”å›žæ ˆå¦‚æžœæ‚¨æƒ³åœ¨fragmentçš„ä¸€ç³»åˆ—è·³è½¬ä¸­æŒ‰è¿”å›žé”®è¿”å›žä¸Šä¸€ä¸ªfragmentï¼Œåº”è¯¥åœ¨commit transactionä¹‹å‰è°ƒç”¨addToBackStackæ–¹æ³• 12345//ä½¿ç”¨è¯¥æ‰©å±• androidx.fragment:fragment-ktx:1.2.0 ä»¥ä¸ŠparentFragmentManager.commit &#123; addToBackStack(null) add&lt;SecondFragment&gt;(R.id.content)&#125; Fragmentçš„ä½¿ç”¨æ–°å§¿åŠ¿ fragment-ktx æœ‰å“ªäº›å¥½ç”¨çš„æ‰©å±•å‡½æ•° fragment ä¹‹é—´å’Œä¸Ž activity é€šä¿¡ ä½¿ç”¨ FragmentContainerView ä½œä¸º fragment å®¹å™¨ FragmentFactory çš„ä½¿ç”¨ Fragment è¿”å›žé”®æ‹¦æˆª Fragment ä½¿ç”¨ ViewBinding Fragment ä½¿ç”¨ ViewPager2 ä¸éœ€è¦é‡å†™ onCreateView äº†ï¼Ÿ ä½¿ç”¨require_()æ–¹æ³• fragment-ktx æœ‰å“ªäº›å¥½ç”¨çš„æ‰©å±•å‡½æ•°1. FragmentManagerKt12345678910//beforesupportFragmentManager .beginTransaction() .add(R.id.content,Fragment1()) .commit()//aftersupportFragmentManager.commit &#123; add&lt;Fragment1&gt;(R.id.content)&#125; 2. FragmentViewModelLazyKt1234567891011//before//å…±äº«èŒƒå›´activityval mViewMode1l = ViewModelProvider(requireActivity()).get(UpdateAppViewModel::class.java)//å…±äº«èŒƒå›´fragment å†…éƒ¨val mViewMode1l = ViewModelProvider(this).get(UpdateAppViewModel::class.java)//after//å…±äº«èŒƒå›´activityprivate val mViewModel by activityViewModels&lt;MyViewModel&gt;()//å…±äº«èŒƒå›´fragment å†…éƒ¨private val mViewModel by viewModel&lt;MyViewModel&gt;() æ³¨æ„ï¼šViewModelProviders.of(this).get(MyViewModel.class); çš„æ–¹å¼å·²å¼ƒç”¨ lifecycle-extensions ä¾èµ–åŒ…å·²å¼ƒç”¨ fragment ä¹‹é—´å’Œä¸Ž activity é€šä¿¡fragment å’Œ fragmentä¹‹é—´ï¼Œfragment å’Œ activity ä¹‹é—´çš„é€šä¿¡æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œandroid jetpack æŽ¨èæˆ‘ä»¬ä½¿ç”¨ ViewModel + LiveData å¤„ç† åŒä¸€ä¸ªactivity å†…çš„ fragment ä¹‹é—´é€šä¿¡ï¼Œå¯ä»¥ä½¿ç”¨ä½œç”¨èŒƒå›´ä¸ºactivityçš„ViewModelï¼Œactivityä¸Ž fragmenté€šä¿¡åŒç†ã€‚è¯¦æƒ…å¯ç§»æ­¥ Androidå®˜æ–¹åº”ç”¨æž¶æž„æŒ‡å— ä½¿ç”¨ FragmentContainerView ä½œä¸º fragment å®¹å™¨è¿‡åŽ»æˆ‘ä»¬ä½¿ç”¨ FrameLayout ä½œä¸º Fragment çš„å®¹å™¨ï¼Œåœ¨ AndroidX Fragment 1.2.0 åŽï¼Œå¯ä»¥ä½¿ç”¨ FragmentContainerView ä»£æ›¿ Fragment ã€‚ å®ƒä¿®å¤äº†ä¸€äº›åŠ¨ç”» zè½´ç´¢å¼•é¡ºåºé—®é¢˜å’Œçª—å£æ’å…¥è°ƒåº¦ï¼Œè¿™æ„å‘³ç€ä¸¤ä¸ªfragmentä¹‹é—´çš„é€€å‡ºå’Œè¿›å…¥è¿‡æ¸¡ä¸ä¼šäº’ç›¸é‡å ã€‚ä½¿ç”¨FragmentContainerViewå°†å…ˆå¼€å¯é€€å‡ºåŠ¨ç”»ç„¶åŽæ‰æ˜¯è¿›å…¥åŠ¨ç”»ã€‚ FragmentContainerView æ˜¯ä¸“é—¨ä¸º fragmentè®¾è®¡çš„è‡ªå®šä¹‰Viewï¼Œå®ƒç»§æ‰¿è‡ª FrameLayout android:name å±žæ€§å…è®¸æ‚¨æ·»åŠ fragmentï¼Œandroid:tag å±žæ€§å¯ä»¥ä¸ºfragmentè®¾ç½®tag 123456789&lt;androidx.fragment.app.FragmentContainerView xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/apk/res-auto" android:id="@+id/fragment_container_view" android:layout_width="match_parent" android:layout_height="match_parent" android:name="com.example.MyFragment" android:tag="my_tag"&gt;&lt;/androidx.fragment.app.FragmentContainerView&gt; FragmentFactory çš„ä½¿ç”¨è¿‡åŽ»ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨å…¶é»˜è®¤çš„ç©ºæž„é€ å‡½æ•°å®žä¾‹åŒ–Fragmentå®žä¾‹ã€‚ è¿™æ˜¯å› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚é…ç½®æ›´æ”¹å’Œåº”ç”¨ç¨‹åºçš„æµç¨‹é‡æ–°åˆ›å»ºï¼Œç³»ç»Ÿéœ€è¦é‡æ–°åˆå§‹åŒ–ã€‚ å¦‚æžœä¸æ˜¯é»˜è®¤çš„æž„é€ æ–¹æ³•ï¼Œç³»ç»Ÿå°†ä¸çŸ¥é“å¦‚ä½•é‡æ–°åˆå§‹åŒ–Fragmentå®žä¾‹ã€‚ åˆ›å»ºFragmentFactoryæ¥è§£å†³æ­¤é™åˆ¶ã€‚ é€šè¿‡å‘å…¶æä¾›å®žä¾‹åŒ–Fragmentæ‰€éœ€çš„å¿…è¦å‚æ•°/ä¾èµ–å…³ç³»ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç³»ç»Ÿåˆ›å»ºFragmentå®žä¾‹ã€‚ è¿‡åŽ»æˆ‘ä»¬å®žä¾‹åŒ–fragmentå¹¶ä¼ é€’å‚æ•°ä¼šä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„ä»£ç  123456789101112131415161718class MyFragment : Fragment() &#123; private lateinit var arg: String override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) arguments?.getString(ARG) ?: "" &#125; companion object &#123; fun newInstance(arg: String) = MyFragment().apply &#123; arguments = Bundle().apply &#123; putString(ARG, arg) &#125; &#125; &#125;&#125;//useval fragment = MyFragment.newInstance("my argument") å¦‚æžœæ‚¨çš„Fragmentæœ‰ä¸€ä¸ªéžç©ºçš„æž„é€ å‡½æ•°ï¼Œåˆ™éœ€è¦åˆ›å»ºä¸€ä¸ªFragmentFactoryæ¥å¤„ç†å®ƒçš„åˆå§‹åŒ–ã€‚ 12345678class MyFragmentFactory(private val arg: String) : FragmentFactory() &#123; override fun instantiate(classLoader: ClassLoader, className: String): Fragment &#123; if (className == MyFragment::class.java.name) &#123; return MyFragment(arg) &#125; return super.instantiate(classLoader, className) &#125;&#125; fragmentç”±FragmentManager ç®¡ç†ï¼Œå› æ­¤å¾ˆè‡ªç„¶ï¼ŒFragmentFactoryéœ€è¦æ·»åŠ åˆ°FragmentManageræ‰èƒ½ä½¿ç”¨ã€‚ é‚£ä¹ˆä»€ä¹ˆæ—¶å€™æŠŠFragmentFactory æ·»åŠ åˆ°FragmentManagerå‘¢ï¼Ÿ çˆ¶ç±»è°ƒç”¨ Activity#onCreate() å’Œ Fragment#onCreate()ä¹‹å‰ 12345678910111213141516171819class HostActivity : AppCompatActivity() &#123; private val customFragmentFactory = CustomFragmentFactory(Dependency()) override fun onCreate(savedInstanceState: Bundle?) &#123; supportFragmentManager.fragmentFactory = customFragmentFactory super.onCreate(savedInstanceState) // ... &#125;&#125;class ParentFragment : Fragment() &#123; private val customFragmentFactory = CustomFragmentFactory(Dependency()) override fun onCreate(savedInstanceState: Bundle?) &#123; childFragmentManager.fragmentFactory = customFragmentFactory super.onCreate(savedInstanceState) // ... &#125;&#125; å¦‚æžœæ‚¨çš„Fragmentå…·æœ‰é»˜è®¤çš„ç©ºæž„é€ å‡½æ•°ï¼Œåˆ™æ— éœ€ä½¿ç”¨FragmentFactoryã€‚ ä½†æ˜¯ï¼Œå¦‚æžœæ‚¨çš„Fragmentåœ¨å…¶æž„é€ å‡½æ•°ä¸­æŽ¥å—å‚æ•°ï¼Œåˆ™å¿…é¡»ä½¿ç”¨FragmentFactoryï¼Œå¦åˆ™å°†æŠ›å‡ºFragment.InstantiationExceptionï¼Œå› ä¸ºå°†ä½¿ç”¨çš„é»˜è®¤FragmentFactoryå°†ä¸çŸ¥é“å¦‚ä½•å®žä¾‹åŒ–Fragmentçš„å®žä¾‹ã€‚ Fragment è¿”å›žé”®æ‹¦æˆªæœ‰æ—¶å€™ï¼Œæ‚¨éœ€è¦é˜»æ­¢ç”¨æˆ·è¿”å›žä¸Šä¸€çº§ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦åœ¨ Activity ä¸­é‡å†™ onBackPressed() æ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œå½“æ‚¨ä½¿ç”¨ Fragment æ—¶ï¼Œæ²¡æœ‰ç›´æŽ¥çš„æ–¹æ³•æ¥æ‹¦æˆªè¿”å›žã€‚ åœ¨ Fragment ç±»ä¸­æ²¡æœ‰å¯ç”¨çš„ onBackPressed() æ–¹æ³•ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢åŒæ—¶å­˜åœ¨å¤šä¸ª Fragment æ—¶å‘ç”Ÿæ„å¤–è¡Œä¸ºã€‚ ä½†æ˜¯ï¼Œä»Ž AndroidX Activity 1.0.0 å¼€å§‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ OnBackPressedDispatcher åœ¨æ‚¨å¯ä»¥è®¿é—®è¯¥ Activity çš„ä»£ç çš„ä»»ä½•ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œåœ¨ Fragment ä¸­ï¼‰æ³¨å†Œ OnBackPressedCallbackã€‚ 1234567891011class MyFragment : Fragment() &#123; override fun onAttach(context: Context) &#123; super.onAttach(context) val callback = object : OnBackPressedCallback(true) &#123; override fun handleOnBackPressed() &#123; // Do something &#125; &#125; requireActivity().onBackPressedDispatcher.addCallback(this, callback) &#125;&#125; Fragment ä½¿ç”¨ ViewBindingAndroid Studio 3.6.0 åŽæä¾›äº† ViewBindindçš„æ”¯æŒï¼Œå®Œæ•´ä½¿ç”¨æµç¨‹å‚è§ [è¯‘]æ·±å…¥ç ”ç©¶ViewBinding åœ¨ include, merge, adapter, fragment, activity ä¸­ä½¿ç”¨ 123456789101112class HomeFragment : Fragment() &#123; private var _binding: FragmentHomeBinding? = null private val binding get() = _binding!! override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? &#123; _binding = FragmentHomeBinding.inflate(inflater, container, false) return binding.root &#125; override fun onDestroyView() &#123; _binding = null &#125;&#125; Fragment ä½¿ç”¨ ViewPager2ViewPagerä½¿ç”¨äº†ä¸‰ä¸ªadapterçš„æŠ½è±¡ç±»ï¼Œè€ŒViewPager2ä¸­åªæœ‰ä¸¤ä¸ª ViewPager ä¸­ä½¿ç”¨ PagerAdaperï¼ŒViewPager2 ä¸­ä½¿ç”¨ Recyclerview.Adapter ViewPager ä¸­ä½¿ç”¨ FragmentPagerAdapter ï¼ŒViewPager2ä¸­ä½¿ç”¨ FragmentStateAdapter ViewPager ä¸­ä½¿ç”¨ FragmentStatePagerAdapter ï¼ŒViewPager2ä¸­ä½¿ç”¨ FragmentStateAdapter 12345678910111213// A simple ViewPager adapter class for paging through fragmentsclass ScreenSlidePagerAdapter(fm: FragmentManager) : FragmentStatePagerAdapter(fm) &#123; override fun getCount(): Int = NUM_PAGES override fun getItem(position: Int): Fragment = ScreenSlidePageFragment()&#125;// An equivalent ViewPager2 adapter classclass ScreenSlidePagerAdapter(fa: FragmentActivity) : FragmentStateAdapter(fa) &#123; override fun getItemCount(): Int = NUM_PAGES override fun createFragment(position: Int): Fragment = ScreenSlidePageFragment()&#125; ä½¿ç”¨ TabLayoutçš„å˜åŒ–ï¼ŒTabLayout å·²ä»ŽViewPager2ä¸­è§£è€¦ï¼Œå¦‚æžœä½¿ç”¨TabLayoutï¼Œéœ€è¦å¼•å…¥ä¾èµ– 1implementation "com.google.android.material:material:1.1.0" å¯¹äºŽViewPager2 ï¼ŒTabLayoutå¸ƒå±€åº”ä¸ŽViewPager2åœ¨åŒä¸€çº§åˆ« 1234567891011121314151617181920212223242526272829303132&lt;!-- A ViewPager element with a TabLayout --&gt;&lt;androidx.viewpager.widget.ViewPager xmlns:android="http://schemas.android.com/apk/res/android" android:id="@+id/pager" android:layout_width="match_parent" android:layout_height="match_parent"&gt; &lt;com.google.android.material.tabs.TabLayout android:id="@+id/tab_layout" android:layout_width="match_parent" android:layout_height="wrap_content" /&gt;&lt;/androidx.viewpager.widget.ViewPager&gt;&lt;!-- A ViewPager2 element with a TabLayout --&gt;&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="match_parent" android:orientation="vertical"&gt; &lt;com.google.android.material.tabs.TabLayout android:id="@+id/tab_layout" android:layout_width="match_parent" android:layout_height="wrap_content" /&gt; &lt;androidx.viewpager2.widget.ViewPager2 android:id="@+id/pager" android:layout_width="match_parent" android:layout_height="0dp" android:layout_weight="1" /&gt;&lt;/LinearLayout&gt; ä½¿ç”¨ViewPageræ—¶ï¼ŒTabLayoutä¸ŽViewPagerè”åŠ¨éœ€è¦è°ƒç”¨ setupWithViewPagerï¼Œå¹¶é‡å†™getPageTitleæ–¹æ³•ï¼Œè€ŒViewPager2æ”¹ä¸ºä½¿ç”¨TabLayoutMediatorå¯¹è±¡ 12345678910111213141516171819202122232425262728293031// Integrating TabLayout with ViewPagerclass CollectionDemoFragment : Fragment() &#123; ... override fun onViewCreated(view: View, savedInstanceState: Bundle?) &#123; val tabLayout = view.findViewById(R.id.tab_layout) tabLayout.setupWithViewPager(viewPager) &#125; ...&#125;class DemoCollectionPagerAdapter(fm: FragmentManager) : FragmentStatePagerAdapter(fm) &#123; override fun getCount(): Int = 4 override fun getPageTitle(position: Int): CharSequence &#123; return "OBJECT $&#123;(position + 1)&#125;" &#125; ...&#125;// Integrating TabLayout with ViewPager2class CollectionDemoFragment : Fragment() &#123; ... override fun onViewCreated(view: View, savedInstanceState: Bundle?) &#123; val tabLayout = view.findViewById(R.id.tab_layout) TabLayoutMediator(tabLayout, viewPager) &#123; tab, position -&gt; tab.text = "OBJECT $&#123;(position + 1)&#125;" &#125;.attach() &#125; ...&#125; ä¸éœ€è¦é‡å†™ onCreateView äº†ï¼Ÿandroidx fragment 1.1.0 åŽï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å°† layoutId ä½œä¸ºå‚æ•°çš„æž„é€ å‡½æ•°ï¼Œè¿™æ ·å°±æ— éœ€é‡å†™ onCreateView æ–¹æ³•äº† 123class MyActivity : AppCompatActivity(R.layout.my_activity)class MyFragmentActivity: FragmentActivity(R.layout.my_fragment_activity)class MyFragment : Fragment(R.layout.my_fragment) ä½¿ç”¨require_()æ–¹æ³•androidx fragment 1.2.2 èµ·ï¼Œæ–°å¢žäº†ä¸€é¡¹lintæ£€æŸ¥ï¼Œfragment å»ºè®®ä½¿ç”¨å…³è”çš„require_()æ–¹æ³•èŽ·å–æ›´å¤šæè¿°æ€§é”™è¯¯æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯ä½¿ç”¨checkNotNull(get_())ï¼ŒrequireNonNull(get_()) æˆ–get()ï¼ é€‚ç”¨äºŽæ‰€æœ‰åŒ…å« get å’Œ require Fragment API ä¾‹å¦‚ï¼šä½¿ç”¨ requireActivity() æ›¿ä»£ getActivity()]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€èƒŒä¸ŠJetpackã€‘Jetpack ä¸»è¦ä¾èµ–å…³ç³»]]></title>
    <url>%2F2020%2F03%2F01%2FJetpack-dependencies%2F</url>
    <content type="text"><![CDATA[åœ¨å­¦ä¹ å’Œä½¿ç”¨ jetpack ç»„ä»¶æ—¶ï¼Œæ€»æ˜¯è¢«å…¶ gradle ä¾èµ–æžçš„æ™•å¤´è½¬å‘ï¼Œæ•…åœ¨æ­¤æ•´ç† jetpack ä¸»è¦ç»„ä»¶çš„ä¾èµ–ï¼ŒåŠä¼ é€’å…³ç³» jetpcak ç»„ä»¶æºç åœ°å€ æŸ¥è¯¢ jetpcak ç»„ä»¶ ç‰ˆæœ¬: Googleâ€™s Maven Repository æŸ¥çœ‹ä¾èµ–æ ‘ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ./gradlew :app:dependencies å¯ç›´æŽ¥è·³è¿‡åŽç»­å†…å®¹å‰å¾€æœ€åŽä¸€èŠ‚æŸ¥çœ‹æ€»ç»“ å…³äºŽ androidxä¸‹ fragment/activityçš„å˜åŒ–ï¼Œå¯æŸ¥çœ‹è¯¥æ–‡, ã€è¯‘ã€‘AdroidXä¸‹ä½¿ç”¨Activityå’ŒFragmentçš„å˜åŒ– Appcompatå¼•å…¥1234567dependencies &#123; def appcompat_version = "1.1.0" implementation "androidx.appcompat:appcompat:$appcompat_version" // For loading and tinting drawables on older versions of the platform implementation "androidx.appcompat:appcompat-resources:$appcompat_version"&#125; ä¾èµ–æ ‘ ä¼ é€’ä¾èµ–androidx.annotation:annotation:1.1.0 androidx.core:core:1.1.0 androidx.cursoradapter:cursoradapter:1.0.0 androidx.fragment:fragment:1.1.0 androidx.appcompat:appcompat-resources:1.1.0 androidx.drawerlayout:drawerlayout:1.0.0 androidx.collection:collection:1.0.0 appcompat ä¸­é»˜è®¤å¼•å…¥äº† fragment åº“ï¼Œå¦‚æžœæƒ³ä½¿ç”¨æ›´æ–°ç‰ˆæœ¬çš„ fragment åº“ï¼Œå¯ä»¥å•ç‹¬å¼•ç”¨ appcompat build.gradle æºç åœ°å€ Fragmentå¼•å…¥12345678910dependencies &#123; def fragment_version = "1.2.2" // Java language implementation implementation "androidx.fragment:fragment:$fragment_version" // Kotlin implementation "androidx.fragment:fragment-ktx:$fragment_version" // Testing Fragments in Isolation implementation "androidx.fragment:fragment-testing:$fragment_version"&#125; âš ï¸ Note: The Kotlin dependant libraries of this version (fragment-ktx,fragment-testing) target Java 8 programming language bytecode. Please read Use Java 8 language features to learn how to use it in your project. ä¾èµ–æ ‘ ä¼ é€’ä¾èµ–org.jetbrains.kotlin:kotlin-stdlib:1.3.50 androidx.activity:activity-ktx:1.1.0 androidx.core:core-ktx:1.1.0 androidx.collection:collection-ktx:1.1.0 androidx.lifecycle:lifecycle-livedata-core-ktx:2.2.0 androidx.lifecycle:lifecycle-viewmodel-ktx:2.2.0 fragment åº“é»˜è®¤å¼•å…¥äº† activity core-ktx lifecycle-livedata-core-ktx lifecycle-viewmodel-ktx åº“ fragment build.grdle æºç åœ°å€ Activityå¼•å…¥12345678dependencies &#123; def activity_version = "1.1.0" // Java language implementation implementation "androidx.activity:activity:$activity_version" // Kotlin implementation "androidx.activity:activity-ktx:$activity_version"&#125; âš ï¸ Note: The Kotlin dependant libraries of this version (activity-ktx) target Java 8 programming language bytecode. Please read Use Java 8 language features to learn how to use it in your project. ä¾èµ–æ ‘ ä¾èµ–ä¼ é€’org.jetbrains.kotlin:kotlin-stdlib:1.3.50 androidx.core:core-ktx:1.1.0 androidx.lifecycle:lifecycle-runtime-ktx:2.2.0 androidx.lifecycle:lifecycle-viewmodel-ktx:2.2.0 activity build.gradle æºç åœ°å€ Coreå¼•å…¥1234567891011dependencies &#123; def core_version = "1.2.0" // Java language implementation implementation "androidx.core:core:$core_version" // Kotlin implementation "androidx.core:core-ktx:$core_version" // To use RoleManagerCompat implementation "androidx.core:core-role:1.0.0-alpha01"&#125; ä¾èµ–æ ‘ Lifecycleå¼•å…¥12345678910111213141516171819202122232425262728293031dependencies &#123; def lifecycle_version = "2.2.0" def arch_version = "2.1.0" // ViewModel implementation "androidx.lifecycle:lifecycle-viewmodel-ktx:$lifecycle_version" // LiveData implementation "androidx.lifecycle:lifecycle-livedata-ktx:$lifecycle_version" // Lifecycles only (without ViewModel or LiveData) implementation "androidx.lifecycle:lifecycle-runtime-ktx:$lifecycle_version" // Saved state module for ViewModel implementation "androidx.lifecycle:lifecycle-viewmodel-savedstate:$lifecycle_version" // Annotation processor kapt "androidx.lifecycle:lifecycle-compiler:$lifecycle_version" // alternately - if using Java8, use the following instead of lifecycle-compiler implementation "androidx.lifecycle:lifecycle-common-java8:$lifecycle_version" // optional - helpers for implementing LifecycleOwner in a Service implementation "androidx.lifecycle:lifecycle-service:$lifecycle_version" // optional - ProcessLifecycleOwner provides a lifecycle for the whole application process implementation "androidx.lifecycle:lifecycle-process:$lifecycle_version" // optional - ReactiveStreams support for LiveData implementation "androidx.lifecycle:lifecycle-reactivestreams-ktx:$lifecycle_version" // optional - Test helpers for LiveData testImplementation "androidx.arch.core:core-testing:$arch_version"&#125; âš ï¸ lifecycle-extensions å·²åºŸå¼ƒï¼Œå¦‚æžœä½¿ç”¨ LifecycleService è¯·ä¾èµ– lifecycle-serviceï¼›å¦‚æžœä½¿ç”¨ ProcessLifecycleOwner è¯·ä¾èµ– lifecycle-processã€‚lifecycle-extensionslä¸ä¼šæœ‰2.3.0ç‰ˆæœ¬ 2.1.0 åŽ ViewModelProviders.of() è¢«åºŸå¼ƒã€‚æ‚¨å¯ä»¥åœ¨ FragmentActivity æˆ–è€… Fragment ä½¿ç”¨ ViewModelProvider(ViewModelStoreOwner) æž„é€ å™¨æ¥å®žçŽ°ç›¸åŒçš„åŠŸèƒ½ã€‚ï¼ˆFragment åº“ 1.2.0ä»¥ä¸Šï¼‰ ä¾èµ–æ ‘ Navigationå¼•å…¥1234567891011121314151617dependencies &#123; def nav_version = "2.3.0-alpha02" // Java language implementation implementation "androidx.navigation:navigation-fragment:$nav_version" implementation "androidx.navigation:navigation-ui:$nav_version" // Kotlin implementation "androidx.navigation:navigation-fragment-ktx:$nav_version" implementation "androidx.navigation:navigation-ui-ktx:$nav_version" // Dynamic Feature Module Support implementation "androidx.navigation:navigation-dynamic-features-fragment:$nav_version" // Testing Navigation androidTestImplementation "androidx.navigation:navigation-testing:$nav_version"&#125; ä¾èµ–æ ‘ Pagingå¼•å…¥1234567891011dependencies &#123; def paging_version = "2.1.1" implementation "androidx.paging:paging-runtime:$paging_version" // For Kotlin use paging-runtime-ktx // alternatively - without Android dependencies for testing testImplementation "androidx.paging:paging-common:$paging_version" // For Kotlin use paging-common-ktx // optional - RxJava support implementation "androidx.paging:paging-rxjava2:$paging_version" // For Kotlin use paging-rxjava2-ktx&#125; ä¾èµ–æ ‘ Roomå¼•å…¥123456789101112131415161718dependencies &#123; def room_version = "2.2.4" implementation "androidx.room:room-runtime:$room_version" annotationProcessor "androidx.room:room-compiler:$room_version" // For Kotlin use kapt instead of annotationProcessor // optional - Kotlin Extensions and Coroutines support for Room implementation "androidx.room:room-ktx:$room_version" // optional - RxJava support for Room implementation "androidx.room:room-rxjava2:$room_version" // optional - Guava support for Room, including Optional and ListenableFuture implementation "androidx.room:room-guava:$room_version" // Test helpers testImplementation "androidx.room:room-testing:$room_version"&#125; âš ï¸ Note: For Kotlin-based apps, make sure you use kapt instead of annotationProcessor. You should also add the kotlin-kapt plugin. ä¾èµ–æ ‘ æ€»ç»“ç‰ˆæœ¬è¯´æ˜Ž androidxåº“éµå¾ªä¸¥æ ¼çš„è¯­ä¹‰ç‰ˆæœ¬æŽ§åˆ¶ã€‚ç‰ˆæœ¬å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ 1.0.1-beta02ï¼‰åŒ…å«ä¸‰ä¸ªæ•°å­—ï¼Œåˆ†åˆ«ä»£è¡¨ major çº§åˆ«ã€minor çº§åˆ«å’Œé—®é¢˜ä¿®å¤çº§åˆ«ã€‚é¢„å‘å¸ƒç‰ˆæœ¬ä¹Ÿæœ‰ä¸€ä¸ªåŽç¼€ï¼Œç”¨äºŽæŒ‡å®šé¢„å‘å¸ƒé˜¶æ®µï¼ˆAlpha ç‰ˆã€Beta ç‰ˆã€å€™é€‰ç‰ˆæœ¬ï¼‰å’Œç‰ˆæœ¬å·ï¼ˆ01ã€02 ç­‰ï¼‰ã€‚ åº“çš„æ¯ä¸ªç‰ˆæœ¬éƒ½è¦ç»åŽ†ä¸‰ä¸ªé¢„å‘å¸ƒé˜¶æ®µï¼Œæ‰èƒ½æˆä¸ºç¨³å®šç‰ˆæœ¬ã€‚å„é¢„å‘å¸ƒé˜¶æ®µçš„æ ‡å‡†å¦‚ä¸‹ï¼š Alpha ç‰ˆ Alpha ç‰ˆåŠŸèƒ½ç¨³å®šï¼Œä½†åŠŸèƒ½å¯èƒ½ä¸å®Œæ•´ã€‚ åœ¨ç‰ˆæœ¬å¤„äºŽ Alpha ç‰ˆçŠ¶æ€æ—¶ï¼Œå¯ä»¥æ·»åŠ ã€ç§»é™¤æˆ–æ›´æ”¹ APIã€‚ Beta ç‰ˆ Beta ç‰ˆåŠŸèƒ½ç¨³å®šï¼Œå¹¶ä¸”å…·æœ‰åŠŸèƒ½å®Œæ•´çš„ API Surfaceã€‚å®ƒä»¬å¯ä»¥æŠ•å…¥å®žé™…ä½¿ç”¨ï¼Œä½†å¯èƒ½åŒ…å«é”™è¯¯ã€‚ Beta ç‰ˆæ— æ³•ä½¿ç”¨å®žéªŒæ€§ç¼–è¯‘å™¨åŠŸèƒ½ï¼ˆä¾‹å¦‚ @UseExperimentalï¼‰ã€‚ å…¶ä»–åº“çš„ä¾èµ–é¡¹å¿…é¡»ä¸º Beta ç‰ˆã€RC ç‰ˆæˆ–ç¨³å®šç‰ˆã€‚ä¸å…è®¸ä½¿ç”¨ Alpha ç‰ˆä¾èµ–é¡¹ã€‚ å€™é€‰ç‰ˆæœ¬ (RC) å€™é€‰ç‰ˆæœ¬æ˜¯æœªæ¥çš„ç¨³å®šç‰ˆã€‚ æ­¤ç‰ˆæœ¬å¯èƒ½åŒ…å«åœ¨æœ€åŽä¸€åˆ»æä¾›çš„é‡è¦ä¿®å¤ã€‚ æ­¤ç‰ˆæœ¬çš„ API Surface æ— æ³•æ›´æ”¹ã€‚ å…¶ä»–åº“çš„ä¾èµ–é¡¹åªèƒ½æ˜¯ RC ç‰ˆæˆ–ç¨³å®šç‰ˆã€‚ ä¸€ä¸ªåº“å¯ä»¥åŒæ—¶å…·æœ‰å¤šä¸ªç‰ˆæœ¬ã€‚æ¯ä¸ªç‰ˆæœ¬éƒ½å…·æœ‰ä¸åŒçš„å‘å¸ƒé˜¶æ®µã€‚ä¾‹å¦‚ï¼Œè™½ç„¶ androidx.activity çš„ç¨³å®šç‰ˆå¯ä»¥æ˜¯ 1.0.0ï¼Œä½†ä¹Ÿå¯èƒ½è¿˜æœ‰ 1.1.0-beta02 ç‰ˆæœ¬ä»¥åŠ 2.0.0-alpha01 ç‰ˆæœ¬ã€‚ kotlin åç¨‹çš„ä½¿ç”¨ ViewModel LiveData Activity Fragment Serviceç­‰å‡å¯ä½¿ç”¨åç¨‹ å¯¹äºŽ ViewModelScopeï¼Œè¯·ä½¿ç”¨ androidx.lifecycle:lifecycle-viewmodel-ktx:2.1.0-beta01 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ å¯¹äºŽ LifecycleScopeï¼Œè¯·ä½¿ç”¨ androidx.lifecycle:lifecycle-runtime-ktx:2.2.0-alpha01 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ å¯¹äºŽ liveDataï¼Œè¯·ä½¿ç”¨ androidx.lifecycle:lifecycle-livedata-ktx:2.2.0-alpha01 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ 1234567class MyViewModel: ViewModel() &#123; init &#123; viewModelScope.launch &#123; // Coroutine that will be canceled when the ViewModel is cleared. &#125; &#125;&#125; 123456789101112class MyFragment : Fragment() &#123; override fun onViewCreated(view: View, savedInstanceState: Bundle?) &#123; super.onViewCreated(view, savedInstanceState) viewLifecycleOwner.lifecycleScope.launch &#123; val params = TextViewCompat.getTextMetricsParams(textView) val precomputedText = withContext(Dispatchers.Default) &#123; PrecomputedTextCompat.create(longTextContent, params) &#125; TextViewCompat.setPrecomputedText(textView, precomputedText) &#125; &#125;&#125; 1234val user: LiveData&lt;User&gt; = liveData &#123; val data = database.loadUser() // loadUser is a suspend function. emit(data)&#125; ä¾èµ–å…³ç³» å¸¦æœ‰-ktxçš„åº“æ‹¥æœ‰ kotlin çš„ç‰¹æ€§ï¼Œæœ‰å¾ˆå¤šå¸¸ç”¨çš„æ‰©å±•å‡½æ•° å¸¦æœ‰-ktxçš„åº“ä¾èµ– java ç‰ˆæœ¬ï¼Œ å¸¦æœ‰-ktxå’Œ java ç‰ˆæœ¬å„è‡ªå•ç‹¬ä½¿ç”¨å³å¯ appcompat åº“åŒ…å« fragmnet,fragment åŒ…å« activity ï¼Œå½“ä½ å¼•å…¥androidx appcompat åº“ä¾¿å¯ä»¥ä½¿ç”¨androidx fragment å’Œ androidx activity å—é™äºŽappcompat ç¨³å®šç‰ˆçš„æ›´æ–°é€Ÿåº¦ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å•ç‹¬ä½¿ç”¨androidx fragment/activity AppCompatActivity ç»§æ‰¿è‡ª FragmentActivityï¼Œ AppCompatActivityå¯ä»¥ç›´æŽ¥ä½¿ç”¨ fragment DataBinding ViewBinding ä¾èµ–äºŽ android build gradle æ’ä»¶ ,æ— éœ€å¼•å…¥å…¶ä»–ä¾èµ– androidx fragment/activityä¸‹å‡ä¾èµ–çš„ViewModelå’Œ LiveDataï¼Œæ‚¨å¯ä»¥ç›´æŽ¥ä½¿ç”¨ ä½¿ç”¨ViewModelå’Œ LiveDataå®Œæ•´åŠŸèƒ½éœ€è¦å•ç‹¬å¼•å…¥ï¼Œå®ƒä»¬éƒ½æ˜¯lifecycleå¤§å®¶æ—ä¸‹çš„ lifecycle-extensions å·²åºŸå¼ƒï¼Œä¸è¦ä½¿ç”¨å®ƒäº† å¦‚æžœæƒ³ä½¿ç”¨å®žçŽ°LifecycleOwner çš„ Service ï¼Œéœ€è¦å¼•å…¥ lifecycle-service å…³äºŽæˆ‘æˆ‘æ˜¯ Flywith24ï¼Œæˆ‘çš„åšå®¢å†…å®¹å·²ç»åˆ†ç±»æ•´ç† åœ¨è¿™é‡Œï¼Œç‚¹å‡»å³ä¸Šè§’çš„ Watch å¯ä»¥åŠæ—¶èŽ·å–æˆ‘çš„æ–‡ç« æ›´æ–°å“¦ ðŸ˜‰ æŽ˜é‡‘ å°ä¸“æ  Github]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€èƒŒä¸ŠJetpackã€‘AdroidXä¸‹ä½¿ç”¨Activityå’ŒFragmentçš„å˜åŒ–]]></title>
    <url>%2F2020%2F02%2F29%2FJetpack-androidx-activity-fragment%2F</url>
    <content type="text"><![CDATA[åŽŸæ–‡ï¼šHow AndroidX changes the way we work with Activities and Fragments ä½œè€…ï¼šMiÅ‚osz Lewandowski è¯‘è€…ï¼šFly_with24 è¿‡åŽ»çš„ä¸€æ®µæ—¶é—´ï¼ŒAndroidX è½¯ä»¶åŒ…ä¸‹çš„ Activity/Fragmet çš„ API å‘ç”Ÿäº†å¾ˆå¤šå˜åŒ–ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•æå‡Android çš„å¼€å‘æ•ˆçŽ‡ä»¥åŠå¦‚ä½•é€‚åº”å½“ä¸‹æµè¡Œçš„ç¼–ç¨‹è§„åˆ™å’Œæ¨¡å¼ã€‚ æœ¬æ–‡ä¸­æè¿°çš„æ‰€æœ‰åŠŸèƒ½çŽ°åœ¨éƒ½å¯ä»¥åœ¨ç¨³å®šçš„ AndroidX è½¯ä»¶åŒ…ä¸­ä½¿ç”¨ï¼Œå®ƒä»¬åœ¨åŽ»å¹´å‡å·²å‘å¸ƒæˆ–ç§»è‡³ç¨³å®šç‰ˆæœ¬ã€‚ åœ¨æž„é€ å™¨ä¸­ä¼ å…¥å¸ƒå±€ IDä»Ž AndroidX AppCompat 1.1.0 å’Œ Fragment 1.1.0 ( è¯‘è€…æ³¨ï¼šAppCompat åŒ…å« Fragmentï¼Œä¸” Fragment åŒ…å« Activityï¼Œè¯¦æƒ…è§ã€æ•´ç†ã€‘Jetpack ä¸»è¦ç»„ä»¶çš„ä¾èµ–åŠä¼ é€’å…³ç³» )å¼€å§‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å°† layoutId ä½œä¸ºå‚æ•°çš„æž„é€ å‡½æ•°ï¼š 123class MyActivity : AppCompatActivity(R.layout.my_activity)class MyFragmentActivity: FragmentActivity(R.layout.my_fragment_activity)class MyFragment : Fragment(R.layout.my_fragment) è¿™ç§æ–¹æ³•å¯ä»¥å‡å°‘ Activity/Fragment ä¸­æ–¹æ³•é‡å†™çš„æ•°é‡ï¼Œå¹¶ä½¿ç±»æ›´å…·å¯è¯»æ€§ã€‚ æ— éœ€åœ¨ Activity ä¸­é‡å†™ onCreate() å³å¯è°ƒç”¨ setContentView() æ–¹æ³•ã€‚ å¦å¤–ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨Fragment ä¸­é‡å†™ onCreateView å³å¯æ‰‹åŠ¨è°ƒç”¨ Inflater æ¥æ‰©å±•è§†å›¾ã€‚ æ‰©å±• Activity/Fragment çš„çµæ´»æ€§å€ŸåŠ© AndroidX æ–°çš„ API ï¼Œå¯ä»¥å‡å°‘åœ¨ Activity/Fragment å¤„ç†æŸäº›åŠŸèƒ½çš„æƒ…å†µã€‚é€šå¸¸ï¼Œæ‚¨å¯ä»¥èŽ·å–æä¾›æŸäº›åŠŸèƒ½çš„å¯¹è±¡å¹¶å‘å…¶æ³¨å†Œæ‚¨çš„å¤„ç†é€»è¾‘ï¼Œè€Œä¸æ˜¯é‡å†™ Activity / Fragment ä¸­çš„æ–¹æ³•ã€‚ è¿™æ ·ï¼Œæ‚¨çŽ°åœ¨å¯ä»¥åœ¨å±å¹•ä¸Šç»„æˆå‡ ä¸ªç‹¬ç«‹çš„ç±»ï¼ŒèŽ·å¾—æ›´é«˜çš„çµæ´»æ€§ï¼Œå¤ç”¨ä»£ç ï¼Œå¹¶ä¸”é€šå¸¸åœ¨ä¸å¼•å…¥è‡ªå·±çš„æŠ½è±¡çš„æƒ…å†µä¸‹ï¼Œå¯¹ä»£ç ç»“æž„å…·æœ‰æ›´å¤šæŽ§åˆ¶ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è¿™åœ¨ä¸¤ä¸ªç¤ºä¾‹ä¸­å¦‚ä½•å·¥ä½œã€‚ 1. OnBackPressedDispatcheræœ‰æ—¶ï¼Œæ‚¨éœ€è¦é˜»æ­¢ç”¨æˆ·è¿”å›žä¸Šä¸€çº§ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦åœ¨ Activity ä¸­é‡å†™ onBackPressed() æ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œå½“æ‚¨ä½¿ç”¨ Fragment æ—¶ï¼Œæ²¡æœ‰ç›´æŽ¥çš„æ–¹æ³•æ¥æ‹¦æˆªè¿”å›žã€‚ åœ¨ Fragment ç±»ä¸­æ²¡æœ‰å¯ç”¨çš„ onBackPressed() æ–¹æ³•ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢åŒæ—¶å­˜åœ¨å¤šä¸ª Fragment æ—¶å‘ç”Ÿæ„å¤–è¡Œä¸ºã€‚ ä½†æ˜¯ï¼Œä»Ž AndroidX Activity 1.0.0 å¼€å§‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ OnBackPressedDispatcher åœ¨æ‚¨å¯ä»¥è®¿é—®è¯¥ Activity çš„ä»£ç çš„ä»»ä½•ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œåœ¨ Fragment ä¸­ï¼‰æ³¨å†Œ OnBackPressedCallbackã€‚ 1234567891011class MyFragment : Fragment() &#123; override fun onAttach(context: Context) &#123; super.onAttach(context) val callback = object : OnBackPressedCallback(true) &#123; override fun handleOnBackPressed() &#123; // Do something &#125; &#125; requireActivity().onBackPressedDispatcher.addCallback(this, callback) &#125;&#125; æ‚¨å¯èƒ½ä¼šåœ¨è¿™é‡Œæ³¨æ„åˆ°å¦å¤–ä¸¤ä¸ªæœ‰ç”¨çš„åŠŸèƒ½ï¼š OnBackPressedCallback çš„æž„é€ å‡½æ•°ä¸­çš„å¸ƒå°”ç±»åž‹çš„å‚æ•°æœ‰åŠ©äºŽæ ¹æ®å½“å‰çŠ¶æ€åŠ¨æ€ æ‰“å¼€/å…³é—­æŒ‰ä¸‹çš„è¡Œä¸º addCallback() æ–¹æ³•çš„å¯é€‰ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ LifecycleOwnerï¼Œä»¥ç¡®ä¿ä»…åœ¨æ‚¨çš„ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼ŒFragmentï¼‰è‡³å°‘å¤„äºŽ STARTED çŠ¶æ€æ—¶æ‰ä½¿ç”¨å›žè°ƒã€‚ é€šè¿‡ä½¿ç”¨ OnBackPressedDispatcher ï¼Œæ‚¨ä¸ä»…å¯ä»¥èŽ·å¾—åœ¨ Activity ä¹‹å¤–å¤„ç†è¿”å›žé”®çš„ä¾¿æ·æ–¹å¼ã€‚ æ ¹æ®æ‚¨çš„éœ€è¦ï¼Œæ‚¨å¯ä»¥åœ¨ä»»æ„ä½ç½®å®šä¹‰ OnBackPressedCallbackï¼Œä½¿å…¶å¯å¤ç”¨ï¼Œæˆ–æ ¹æ®åº”ç”¨ç¨‹åºçš„æž¶æž„è¿›è¡Œä»»ä½•æ“ä½œã€‚ æ‚¨ä¸å†éœ€è¦é‡å†™Activity ä¸­çš„ onBackPressed æ–¹æ³•ï¼Œä¹Ÿä¸å¿…æä¾›è‡ªå·±çš„æŠ½è±¡çš„æ¥å®žçŽ°éœ€æ±‚çš„ä»£ç ã€‚ 2. SavedStateRegistryå¦‚æžœæ‚¨å¸Œæœ› Activity åœ¨ç»ˆæ­¢å¹¶é‡å¯åŽæ¢å¤ä¹‹å‰çš„çŠ¶æ€ï¼Œåˆ™å¯èƒ½è¦ä½¿ç”¨ saved state åŠŸèƒ½ã€‚ è¿‡åŽ»ï¼Œæ‚¨éœ€è¦åœ¨ Activity ä¸­é‡å†™ä¸¤ä¸ªæ–¹æ³•ï¼šonSaveInstanceState å’Œ onRestoreInstanceStateã€‚ æ‚¨è¿˜å¯ä»¥åœ¨ onCreate æ–¹æ³•ä¸­è®¿é—®æ¢å¤çš„çŠ¶æ€ã€‚ åŒæ ·ï¼Œåœ¨ Fragment ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨onSaveInstanceState æ–¹æ³•ï¼ˆå¹¶ä¸”å¯ä»¥åœ¨ onCreateï¼ŒonCreateView å’ŒonActivityCreatedæ–¹æ³•ä¸­æ¢å¤çŠ¶æ€ï¼‰ã€‚ ä»Ž AndroidX SavedState 1.0.0ï¼ˆå®ƒæ˜¯ AndroidX Activity å’Œ AndroidX Fragment å†…éƒ¨çš„ä¾èµ–ã€‚è¯‘è€…æ³¨ï¼šæ‚¨ä¸éœ€è¦å•ç‹¬å£°æ˜Žå®ƒï¼‰å¼€å§‹ï¼Œæ‚¨å¯ä»¥è®¿é—® SavedStateRegistryï¼Œå®ƒä½¿ç”¨äº†ä¸Žå‰é¢æè¿°çš„ OnBackPressedDispatcher ç±»ä¼¼çš„æœºåˆ¶ï¼šæ‚¨å¯ä»¥ä»Ž Activity / Fragment ä¸­èŽ·å– SavedStateRegistryï¼Œç„¶åŽ æ³¨å†Œæ‚¨çš„ SavedStateProviderï¼š 12345678910111213141516171819202122232425262728class MyActivity : AppCompatActivity() &#123; companion object &#123; private const val MY_SAVED_STATE_KEY = "my_saved_state" private const val SOME_VALUE_KEY = "some_value" &#125; private lateinit var someValue: String private val savedStateProvider = SavedStateRegistry.SavedStateProvider &#123; Bundle().apply &#123; putString(SOME_VALUE_KEY, someValue) &#125; &#125; override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) savedStateRegistry .registerSavedStateProvider(MY_SAVED_STATE_KEY, savedStateProvider) &#125; fun someMethod() &#123; someValue = savedStateRegistry .consumeRestoredStateForKey(MY_SAVED_STATE_KEY) ?.getString(SOME_VALUE_KEY) ?: "" &#125;&#125; å¦‚æ‚¨æ‰€è§ï¼ŒSavedStateRegistry å¼ºåˆ¶æ‚¨å°†å¯†é’¥ç”¨äºŽæ•°æ®ã€‚ è¿™æ ·å¯ä»¥é˜²æ­¢æ‚¨çš„æ•°æ®è¢« attach åˆ°åŒä¸€ä¸ª Activity/Fragmentçš„å¦ä¸€ä¸ª SavedStateProvider ç ´åã€‚ å°±åƒåœ¨ OnBackPressedDispatcher ä¸­ä¸€æ ·ï¼Œæ‚¨å¯ä»¥ä¾‹å¦‚å°† SavedStateProvider æå–åˆ°å¦ä¸€ä¸ªç±»ï¼Œé€šè¿‡ä½¿ç”¨æ‰€éœ€çš„ä»»ä½•é€»è¾‘ä½¿å…¶ä¸Žæ•°æ®ä¸€èµ·ä½¿ç”¨ï¼Œä»Žè€Œåœ¨åº”ç”¨ç¨‹åºä¸­å®žçŽ°æ¸…æ™°çš„ä¿å­˜çŠ¶æ€è¡Œä¸ºã€‚ æ­¤å¤–ï¼Œå¦‚æžœæ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ ViewModelï¼Œè¯·è€ƒè™‘ä½¿ç”¨ AndroidX ViewModel-SavedState ä½¿ä½ çš„ViewModel å¯ä»¥ä¿å­˜å…¶çŠ¶æ€ã€‚ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œä»Ž AndroidX Activity 1.1.0 å’Œ AndroidX Fragment 1.2.0 å¼€å§‹ï¼Œå¯ç”¨ SavedState çš„SavedStateViewModelFactory æ˜¯åœ¨èŽ·å– ViewModel çš„æ‰€æœ‰æ–¹å¼ä¸­ä½¿ç”¨çš„é»˜è®¤å·¥åŽ‚ï¼šå§”æ‰˜ ViewModelProvider æž„é€ å‡½æ•°å’Œ ViewModelProviders.of() æ–¹æ³•ã€‚ FragmentFactoryFragment æœ€å¸¸æåŠçš„é—®é¢˜ä¹‹ä¸€æ˜¯ä¸èƒ½ä½¿ç”¨å¸¦æœ‰å‚æ•°çš„æž„é€ å‡½æ•°ã€‚ ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨ä½¿ç”¨ Dagger2 è¿›è¡Œä¾èµ–é¡¹æ³¨å…¥ï¼Œåˆ™æ— æ³•ä½¿ç”¨ Inject æ³¨è§£ Fragment æž„é€ å‡½æ•°å¹¶æŒ‡å®šå‚æ•°ã€‚ çŽ°åœ¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡æŒ‡å®š FragmentFactory ç±»æ¥å‡å°‘ Fragment åˆ›å»ºè¿‡ç¨‹ä¸­çš„ç±»ä¼¼é—®é¢˜ã€‚ é€šè¿‡åœ¨ FragmentManager ä¸­æ³¨å†Œ FragmentFactoryï¼Œå¯ä»¥é‡å†™å®žä¾‹åŒ– Fragment çš„é»˜è®¤æ–¹æ³•ï¼š 1234567891011121314class MyFragmentFactory : FragmentFactory() &#123; override fun instantiate(classLoader: ClassLoader, className: String): Fragment &#123; // Call loadFragmentClass() to obtain the Class object val fragmentClass = loadFragmentClass(classLoader, className) // Now you can use className/fragmentClass to determine your prefered way // of instantiating the Fragment object and just do it here. // Or just call regular FragmentFactory to instantiate the Fragment using // no arguments constructor return super.instantiate(classLoader, className) &#125;&#125; å¦‚æ‚¨æ‰€è§ï¼Œè¯¥APIéžå¸¸é€šç”¨ï¼Œå› æ­¤æ‚¨å¯ä»¥æ‰§è¡Œæƒ³è¦åˆ›å»º Fragment å®žä¾‹çš„æ‰€æœ‰æ“ä½œã€‚ å›žåˆ° Dagger2 ç¤ºä¾‹ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ³¨å…¥FragmentFactory Provider &lt;Fragment&gt; å¹¶ä½¿ç”¨å®ƒæ¥èŽ·å– Fragment å¯¹è±¡ã€‚ æµ‹è¯• Fragmentä»ŽAndroidX Fragment 1.1.0 å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ Fragment æµ‹è¯•ç»„ä»¶æä¾› FragmentScenario ç±»ï¼Œè¯¥ç±»å¯ä»¥å¸®åŠ©åœ¨æµ‹è¯•ä¸­å®žä¾‹åŒ– Fragment å¹¶è¿›è¡Œå•ç‹¬æµ‹è¯•ï¼š 12345678910111213141516// To launch a Fragment with a user interface:val scenario = launchFragmentInContainer&lt;FirstFragment&gt;() // To launch a headless Fragment:val scenario = launchFragment&lt;FirstFragment&gt;() // To move the fragment to specific lifecycle state:scenario.moveToState(CREATED)// Now you can e.g. perform actions using Espresso:onView(withId(R.id.refresh)).perform(click())// To obtain a Fragment instance:scenario.onFragment &#123; fragment -&gt; ...&#125; More Kotlin!å¾ˆé«˜å…´çœ‹åˆ° -ktx AndroidX è½¯ä»¶åŒ…ä¸­æä¾›äº†è®¸å¤šæœ‰ç”¨çš„ Kotlin æ‰©å±•æ–¹æ³•ï¼Œå¹¶ä¸”å®šæœŸæ·»åŠ äº†æ–°çš„æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œåœ¨AndroidX Fragment-KTX 1.2.0 ä¸­ï¼Œä½¿ç”¨ç‰‡æ®µåŒ–ç±»åž‹çš„æ‰©å±•åå¯ç”¨äºŽ FragmentTransaction ä¸Šçš„ replace() æ–¹æ³•ã€‚ å°†å…¶ä¸Ž commit() æ‰©å±•æ–¹æ³•ç»“åˆä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥èŽ·å¾—ä»¥ä¸‹ä»£ç ï¼š 12345678910// BeforesupportFragmentManager .beginTransaction() .add(R.id.container, MyFragment::class.java, null) .commit()// AftersupportFragmentManager.commit &#123; replace&lt;MyFragment&gt;(R.id.container)&#125; FragmentContainerViewä¸€ä»¶å°è€Œé‡è¦çš„äº‹æƒ…ã€‚ å¦‚æžœæ‚¨å°† FrameLayout ç”¨ä½œ Fragment çš„å®¹å™¨ï¼Œåˆ™åº”æ”¹ç”¨ FragmentContainerView ã€‚ å®ƒä¿®å¤äº†ä¸€äº›åŠ¨ç”» zè½´ç´¢å¼•é¡ºåºé—®é¢˜å’Œçª—å£æ’å…¥è°ƒåº¦ã€‚ ä»Ž AndroidX Fragment 1.2.0 å¼€å§‹å¯ä»¥ä½¿ç”¨ FragmentContainerViewã€‚ å…³äºŽæˆ‘ æˆ‘æ˜¯ Fly_with24 æŽ˜é‡‘ ç®€ä¹¦ Github]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
      <tags>
        <tag>androidx</tag>
        <tag>Jetpack</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€é‡å­¦Androidè¯»ä¹¦ç¬”è®°ã€‘Activityçš„ä»»åŠ¡æ ˆä¸Žè¿”å›žæ ˆ]]></title>
    <url>%2F2019%2F11%2F29%2Frelearn-task-back-stack%2F</url>
    <content type="text"><![CDATA[è®¢é˜… é‡å­¦å®‰å“ å¾ˆä¹…äº†ï¼Œæœ€è¿‘åœ¨æ•´ç†è¯»ä¹¦ç¬”è®°ï¼Œåœ¨æ­¤è®°å½•ä¹‹ã€‚ åœ¨æ­¤éš†é‡æŽ¨èè¿™ä½å¤§ä½¬ KunMinX æœ¬æ–‡è®°å½•Activityä»»åŠ¡æ ˆä¸Žè¿”å›žæ ˆç›¸å…³å†…å®¹çš„ç–‘é—®ä¸ŽæŽ¢ç´¢ è¯¥ä¸“æ çš„ä»£ç åœ°å€ï¼š https://github.com/KunMinX/Relearn-Android ç–‘æƒ‘äº§ç”Ÿæ ¹æ®å¤§ä½¬çš„ä»£ç ä»¥åŠæ–‡ç« æè¿°ï¼Œæœ‰ä¸ªåœ°æ–¹è®©æˆ‘å¾ˆç–‘æƒ‘ã€‚ æˆ‘è¿™é‡Œæ²¡æœ‰è¿‡æ»¤å½“å‰ä½¿ç”¨çš„appï¼Œæ‰€ä»¥app1å’Œapp2äº§ç”Ÿçš„æ—¥å¿—éƒ½æ˜¾ç¤ºäº†å‡ºæ¥ã€‚ å¤§ä½¬åœ¨è¯„è®ºåŒºå…³äºŽæ­¤çš„å›žç­” KunMinX #40 #2æ¥¼ @Sky63å¤§æ¦‚æ˜Žç™½ä½ æåˆ°çš„ã€é€ æˆå›°æ‰°çš„åœ°æ–¹äº†ã€‚D å’Œ C æ˜¯ç”± app1 å¯åŠ¨ï¼Œåœ¨ IDE ä¸­å¯é€šè¿‡ app1 çš„è§†è§’è§‚å¯Ÿåˆ°ã€‚åŒç†ï¼Œå½“ app2 çš„ B å”¤èµ· D æ—¶ï¼Œä½ åœ¨å›žé€€ D çš„æ—¶å€™èƒ½åœ¨ app2 å’Œ app1 çš„è§†è§’ä¸­åŒæ—¶è§‚å¯Ÿåˆ° D çš„é”€æ¯ã€‚è€Œç´§éšå…¶åŽå†å›žé€€ä¸€æ¬¡ï¼Œ ä¾¿èƒ½åœ¨ app1 ä¸­è§‚å¯Ÿåˆ° C è¢«é”€æ¯ã€‚å†ä¸‹ä¸€æ¬¡æ‰è½®åˆ° app2 ä¸­ B è¢«é”€æ¯ã€‚ ä½†æ˜¯æ ¹æ®æˆ‘æ“ä½œçœ‹åˆ°çš„çŽ°è±¡ï¼ŒDçš„é”€æ¯ä¸æ˜¯åœ¨ä¸åŒappè§†è§’è§‚å¯Ÿåˆ°çš„åŒä¸€æ¬¡é”€æ¯ã€‚é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹å‡ºä¸¤æ¬¡é”€æ¯æ˜¯æœ‰æ—¶é—´å·®çš„ï¼Œè€Œä¸”ç»è¿‡æˆ‘çš„äºŒæ¬¡ç¡®è®¤ï¼Œçš„ç¡®æ˜¯å…³é—­ä¸¤æ¬¡ç•Œé¢æ‰å‡ºçŽ°äº†ä¸¤æ¬¡é”€æ¯Logã€‚ é—®é¢˜æŽ’æŸ¥é€šè¿‡ adb shell ä¸­çš„ dumpsys activity activities å‘½ä»¤å¯ä»¥æŸ¥çœ‹ activity æ ˆä¿¡æ¯ï¼Œæ•…æˆ‘æˆªå–äº†ç›¸å…³çš„è¾“å‡ºï¼Œä»¥ä¸‹å †æ ˆä¿¡æ¯å‡ç»è¿‡ç²¾ç®€ã€‚ 1. app1 ä¾æ¬¡æ‰“å¼€ SingleTaskOne SingleTaskTwo 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364âžœ Relearn-Android (master) adb shellsagit:/ $ dumpsys activity activitiesACTIVITY MANAGER ACTIVITIES (dumpsys activity activities)Display #0 (activities from top to bottom): Stack #2: type=standard mode=fullscreen Task id #3 Running activities (most recent first): TaskRecord&#123;4920da #3 A=com.kunminx.task.c U=0 StackId=2 sz=2&#125; Run #1: ActivityRecord&#123;93c0c72 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t3&#125; Run #0: ActivityRecord&#123;999111 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskOneActivity t3&#125; mResumedActivity: ActivityRecord&#123;93c0c72 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t3&#125; mLastPausedActivity: ActivityRecord&#123;999111 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskOneActivity t3&#125; Stack #1: type=standard mode=fullscreen Task id #2 Running activities (most recent first): TaskRecord&#123;d91b3e8 #2 A=com.kunminx.relearn_android U=0 StackId=1 sz=2&#125; Run #1: ActivityRecord&#123;8b59240 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t2&#125; Run #0: ActivityRecord&#123;d76e9a5 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.TestMainActivity t2&#125; mLastPausedActivity: ActivityRecord&#123;8b59240 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t2&#125; Stack #0: type=home mode=fullscreen Task id #1 Running activities (most recent first): TaskRecord&#123;94a7a01 #1 I=com.miui.home/.launcher.Launcher U=0 StackId=0 sz=1&#125; Run #0: ActivityRecord&#123;7d6409 u0 com.miui.home/.launcher.Launcher t1&#125; mLastPausedActivity: ActivityRecord&#123;7d6409 u0 com.miui.home/.launcher.Launcher t1&#125; ResumedActivity:ActivityRecord&#123; 93c0c72u0com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t3&#125; mFocusedStack=ActivityStack&#123; 3a870a6 stackId=2 type=standard mode=fullscreen visible=true translucent=false, 1 tasks &#125; mLastFocusedStack=ActivityStack&#123; 3a870a6 stackId=2 type=standard mode=fullscreen visible=true translucent=false, 1 tasks &#125; mCurTaskIdForUser=&#123;0=3&#125; mUserStackInFront=&#123;&#125; displayId=0 stacks=3 mHomeStack=ActivityStack&#123; 76ebae7 stackId=0 type=home mode=fullscreen visible=false translucent=true, 1 tasks &#125; isHomeRecentsComponent=false KeyguardController: mKeyguardShowing=false mAodShowing=false mKeyguardGoingAway=false mOccluded=false mDismissingKeyguardActivity=null mDismissalRequested=false mVisibilityTransactionDepth=0 LockTaskController mLockTaskModeState=NONE mLockTaskModeTasks= mLockTaskPackages (userId:packages)= u0:[] æ­¤æ—¶çœ‹åˆ°å †æ ˆé¡ºåºä¸ºï¼šStack #2 -&lt; Stack #1 -&lt; Stack #0 å…¶ä¸­ Stack #0 ä¸º launcher èŽ·å–ç„¦ç‚¹çš„ ActivityStackï¼š 1234mFocusedStack=ActivityStack&#123; 3a870a6 stackId=2 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mLastFocusedStack=ActivityStack&#123; 3a870a6 stackId=2 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; 2. æŒ‰ä¸‹HOMEé”®ï¼Œæ‰“å¼€ app2 ä¾æ¬¡æ‰“å¼€ StandardOneActivity StandardTwoActivity 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970Display #0 (activities from top to bottom): Stack #3: type=standard mode=fullscreen Task id #4 Running activities (most recent first): TaskRecord&#123;718157f #4 A=com.kunminx.relearn_android_2 U=0 StackId=3 sz=4&#125; Run #3: ActivityRecord&#123;137a584 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardTwoActivity t4&#125; Run #2: ActivityRecord&#123;648188e u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t4&#125; Run #1: ActivityRecord&#123;f39ebe9 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t4&#125; Run #0: ActivityRecord&#123;f02fff8 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.TestMainActivity t4&#125; mResumedActivity: ActivityRecord&#123;137a584 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardTwoActivity t4&#125; mLastPausedActivity: ActivityRecord&#123;648188e u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t4&#125; Stack #0: type=home mode=fullscreen Task id #1 Running activities (most recent first): TaskRecord&#123;2094d95 #1 I=com.miui.home/.launcher.Launcher U=0 StackId=0 sz=1&#125; Run #0: ActivityRecord&#123;a7fed1a u0 com.miui.home/.launcher.Launcher t1&#125; mLastPausedActivity: ActivityRecord&#123;a7fed1a u0 com.miui.home/.launcher.Launcher t1&#125; Stack #2: type=standard mode=fullscreen Task id #3 Running activities (most recent first): TaskRecord&#123;9d79eaa #3 A=com.kunminx.task.c U=0 StackId=2 sz=2&#125; Run #1: ActivityRecord&#123;15d3e09 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t3&#125; Run #0: ActivityRecord&#123;20d177c u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskOneActivity t3&#125; mLastPausedActivity: ActivityRecord&#123;15d3e09 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t3&#125; Stack #1: type=standard mode=fullscreen isSleeping=false mBounds=Rect(0, 0 - 0, 0) Task id #2 Running activities (most recent first): TaskRecord&#123;e526e38 #2 A=com.kunminx.relearn_android U=0 StackId=1 sz=2&#125; Run #1: ActivityRecord&#123;19055b2 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t2&#125; Run #0: ActivityRecord&#123;5a647a6 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.TestMainActivity t2&#125; mLastPausedActivity: ActivityRecord&#123;19055b2 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t2&#125; ResumedActivity: ActivityRecord&#123;137a584 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardTwoActivity t4&#125; mFocusedStack=ActivityStack&#123; dfe2e11 stackId=3 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mLastFocusedStack=ActivityStack&#123; dfe2e11 stackId=3 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mCurTaskIdForUser=&#123;0=4&#125; mUserStackInFront=&#123;&#125; displayId=0 stacks=4 mHomeStack=ActivityStack&#123;968fb76 stackId=0 type=home mode=fullscreen visible=false translucent=true, 1 tasks&#125; isHomeRecentsComponent=false KeyguardController: mKeyguardShowing=false mAodShowing=false mKeyguardGoingAway=false mOccluded=false mDismissingKeyguardActivity=null mDismissalRequested=false mVisibilityTransactionDepth=0 LockTaskController mLockTaskModeState=NONE mLockTaskModeTasks= mLockTaskPackages (userId:packages)= u0:[] è¿™é‡Œçš„å †æ ˆé¡ºåºä¸º Stack #3 -&lt; Stack #0 -&lt; Stack #2 -&lt; Stack #1 Stack #0 ä¸ºhome ï¼Œè¿™é‡Œååº”å‡ºç‚¹å‡»homeé”®ï¼Œæ‰“å¼€app2 çš„æ“ä½œã€‚æ­¤æ—¶ Stack #3 ä¸­æœ‰ 4 ä¸ª ActivityRecord å½“å‰èŽ·å–ç„¦ç‚¹çš„ ActivityStack 12345 mFocusedStack=ActivityStack&#123; dfe2e11 stackId=3 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mLastFocusedStack=ActivityStack&#123; dfe2e11 stackId=3 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mCurTaskIdForUser=&#123;0=4&#125; 3. æŽ¥ä¸‹æ¥å¯åŠ¨ SingleTaskTwoActivity 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172sagit:/ $ dumpsys activity activitiesACTIVITY MANAGER ACTIVITIES (dumpsys activity activities)Display #0 (activities from top to bottom): Stack #2: type=standard mode=fullscreen Task id #3 Running activities (most recent first): TaskRecord&#123;4920da #3 A=com.kunminx.task.c U=0 StackId=2 sz=3&#125; Run #2: ActivityRecord&#123;55f799d u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t3&#125; Run #1: ActivityRecord&#123;93c0c72 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t3&#125; Run #0: ActivityRecord&#123;999111 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskOneActivity t3&#125; mResumedActivity: ActivityRecord&#123;55f799d u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t3&#125; Stack #3: type=standard mode=fullscreen Task id #4 Running activities (most recent first): TaskRecord&#123;f14a51a #4 A=com.kunminx.relearn_android_2 U=0 StackId=3 sz=4&#125; Run #3: ActivityRecord&#123;1838862 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardTwoActivity t4&#125; Run #2: ActivityRecord&#123;bdb3180 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t4&#125; Run #1: ActivityRecord&#123;7b21450 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t4&#125; Run #0: ActivityRecord&#123;ff57abb u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.TestMainActivity t4&#125; mLastPausedActivity: ActivityRecord&#123;1838862 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardTwoActivity t4&#125; Stack #0: type=home mode=fullscreen Task id #1 Running activities (most recent first): TaskRecord&#123;94a7a01 #1 I=com.miui.home/.launcher.Launcher U=0 StackId=0 sz=1&#125; Run #0: ActivityRecord&#123;7d6409 u0 com.miui.home/.launcher.Launcher t1&#125; mLastPausedActivity: ActivityRecord&#123;7d6409 u0 com.miui.home/.launcher.Launcher t1&#125; Stack #1: type=standard mode=fullscreen Task id #2 Running activities (most recent first): TaskRecord&#123;d91b3e8 #2 A=com.kunminx.relearn_android U=0 StackId=1 sz=2&#125; Run #1: ActivityRecord&#123;8b59240 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t2&#125; Run #0: ActivityRecord&#123;d76e9a5 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.TestMainActivity t2&#125; mLastPausedActivity: ActivityRecord&#123;8b59240 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t2&#125; ResumedActivity: ActivityRecord&#123;55f799d u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t3&#125; mFocusedStack=ActivityStack&#123; 3a870a6 stackId=2 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mLastFocusedStack=ActivityStack&#123; 3a870a6 stackId=2 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mCurTaskIdForUser=&#123;0=4&#125; mUserStackInFront=&#123;&#125; displayId=0 stacks=4 mHomeStack=ActivityStack&#123; 76ebae7 stackId=0 type=home mode=fullscreen visible=false translucent=true, 1 tasks&#125; isHomeRecentsComponent=false KeyguardController: mKeyguardShowing=false mAodShowing=false mKeyguardGoingAway=false mOccluded=false mDismissingKeyguardActivity=null mDismissalRequested=false mVisibilityTransactionDepth=0 LockTaskController mLockTaskModeState=NONE mLockTaskModeTasks= mLockTaskPackages (userId:packages)= u0:[] å½“å‰çš„å †æ ˆé¡ºåº Stack #2 -&lt; Stack #3 -&lt; Stack #0 -&lt;Stack #1 å½“å‰èŽ·å–ç„¦ç‚¹çš„ ActivityStack 12345mFocusedStack=ActivityStack&#123; 3a870a6 stackId=2 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mLastFocusedStack=ActivityStack&#123; 3a870a6 stackId=2 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125;mCurTaskIdForUser=&#123;0=4&#125; Stack #2 ä¸­ TaskRecordä¿¡æ¯ä¸º 1234TaskRecord&#123;4920da #3 A=com.kunminx.task.c U=0 StackId=2 sz=3&#125; Run #2: ActivityRecord&#123;55f799d u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t3&#125; Run #1: ActivityRecord&#123;93c0c72 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t3&#125; Run #0: ActivityRecord&#123;999111 u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskOneActivity t3&#125; è§£æƒ‘å…³é”®çš„åœ°æ–¹æ¥äº† çš„ç¡®æœ‰ä¸¤ä¸ª SingleTaskTwoActivity çš„ ActivityRecord ï¼Œæ ˆé¡¶çš„å±žäºŽ app2 ç¬¬äºŒä¸ªå±žäºŽ app1 ç”±æ­¤çœ‹å‡ºè¿™ä¸¤ä¸ªActivityRecord ä¸æ˜¯ä¸€ä¸ªå®žä¾‹ï¼Œæ‰€ä»¥è¿™é‡Œ app2 å¯åŠ¨çš„ SingleTaskTwoActivity åº”è¯¥æ˜¯ app2 è‡ªå·±çš„activity åºŸè¯ä¸è¯´ï¼Œç¿»ä»£ç ï¼è¿™é‡Œæˆªå–äº† BaseTaskActivity ä¸­çš„éƒ¨åˆ†ä»£ç ï¼Œapp1 å’Œ app2ä¸­çš„ activity éƒ½ç»§æ‰¿äº†BaseTaskActivity 12345678910111213141516171819202122232425262728293031323334353637383940@Override public void onClick(View v) &#123; int i = v.getId(); if (i == R.id.btn_standard_one) &#123; Intent intent = new Intent(this, StandardOneActivity.class); startActivityWithCheck(intent); &#125; else if (i == R.id.btn_standard_two) &#123; Intent intent = new Intent(this, StandardTwoActivity.class); startActivityWithCheck(intent); &#125; else if (i == R.id.btn_singletask_one) &#123; Intent intent = new Intent(this, SingleTaskOneActivity.class); startActivityWithCheck(intent); &#125; else if (i == R.id.btn_singletask_two) &#123; Intent intent = new Intent(this, SingleTaskTwoActivity.class); startActivityWithCheck(intent); //ä»¥ä¸‹æµ‹è¯•ç»“æžœè¯å®žï¼š //1.åœ¨ App2 ä¸­å¯åŠ¨ App1 çš„ standard Activityï¼Œä»ç„¶éµå®ˆ standard çš„ç‰¹ç‚¹ï¼šåœ¨å¯åŠ¨å®ƒçš„ Activity æ‰€åœ¨çš„ä»»åŠ¡ä¸­å¯åŠ¨ï¼Œä¹Ÿå³è·Ÿéš App2ã€‚ //2.åœ¨ App2 ä¸­å¯åŠ¨ App1 çš„ singleTop Activityï¼Œè·ŸéšçŠ¶å†µåŒ standardã€‚ //3.åœ¨ App2 ä¸­å¯åŠ¨ App1 çš„ singleTask Activityï¼Œä»ç„¶å¤„äºŽ App1 çš„ä»»åŠ¡ä¸­ï¼Œå¹¶ä¸è·Ÿéš App2ã€‚ &#125; else if (i == R.id.btn_singletask_a) &#123; Intent intent = new Intent(); ComponentName name = new ComponentName( "com.kunminx.relearn_android", "com.kunminx.relearn_android.SingleTaskAActivity"); intent.setComponent(name); startActivityWithCheck(intent); &#125; else if (i == R.id.btn_singletask_b) &#123; Intent intent = new Intent(); ComponentName name = new ComponentName( "com.kunminx.relearn_android", "com.kunminx.relearn_android.SingleTaskBActivity"); intent.setComponent(name); startActivityWithCheck(intent); &#125; å¯ä»¥çœ‹å‡ºè¿™é‡Œ app2 å¯åŠ¨SingleTaskTwoActivity çš„ç¡®æ˜¯è‡ªå·±çš„ activity é‚£ä¹ˆå®ƒä¸ºä»€ä¹ˆå’Œapp1 ä¸­çš„ SingleTaskTwoActivity æ˜¯åŒä¸€ä¸ª TaskRecord å‘¢ï¼Ÿ 12345678&lt;activity android:name=".test03_task_test.SingleTaskOneActivity" android:launchMode="singleTask" android:taskAffinity="com.kunminx.task.c" /&gt;&lt;activity android:name=".test03_task_test.SingleTaskTwoActivity" android:launchMode="singleTask" android:taskAffinity="com.kunminx.task.c" /&gt; å®ƒä»¬æœ‰ç€å…±åŒçš„ taskAffinityã€‚è‡³æ­¤ï¼Œæˆ‘çš„ç–‘æƒ‘å·²ç»å¾—åˆ°äº†ç­”æ¡ˆã€‚ æ‹“å±•æˆ‘è¯•äº†ä»¥ä¸‹ app2 ä¸­å¯åŠ¨ app1 ä¸­çš„Activityçš„æƒ…å†µ app1 ä¾æ¬¡å¯åŠ¨ StandardOneActivity -&lt; SingleTaskOneActivity -&lt; SingleTaskTwoActivity -&lt; SingleTaskAActivity å…¶ä¸­ SingleTaskOneActivity ä¸Ž SingleTaskTwoActivity è®¾ç½®äº†ç›¸åŒçš„ taskAffinity ,StandardOneActivity ä¸Ž SingleTaskAActivity æœªè®¾ç½® taskAffinity æŽ¥ç€æŒ‰ HOME é”®ï¼Œæ‰“å¼€ app2 ï¼Œä¾æ¬¡æ‰“å¼€ StandardOneActivity -&lt; StandardOneActivity -&lt; StandardTwoActivity æ­¤æ—¶å †æ ˆä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768âžœ Relearn-Android (master) adb shellsagit:/ $ dumpsys activity activitiesACTIVITY MANAGER ACTIVITIES (dumpsys activity activities)Display #0 (activities from top to bottom): Stack #3: type=standard mode=fullscreen isSleeping=false mBounds=Rect(0, 0 - 0, 0) Task id #48 Running activities (most recent first): TaskRecord&#123;3b07175 #48 A=com.kunminx.relearn_android_2 U=0 StackId=3 sz=4&#125; Run #3: ActivityRecord&#123;9cdafc6 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardTwoActivity t48&#125; Run #2: ActivityRecord&#123;83db884 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t48&#125; Run #1: ActivityRecord&#123;71254 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t48&#125; Run #0: ActivityRecord&#123;7c135cf u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.TestMainActivity t48&#125; mResumedActivity: ActivityRecord&#123;9cdafc6 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardTwoActivity t48&#125; mLastPausedActivity: ActivityRecord&#123;83db884 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t48&#125; Stack #0: type=home mode=fullscreen Running activities (most recent first): TaskRecord&#123;185017b #1 I=com.miui.home/.launcher.Launcher U=0 StackId=0 sz=1&#125; Run #0: ActivityRecord&#123;9fd4f88 u0 com.miui.home/.launcher.Launcher t1&#125; mLastPausedActivity: ActivityRecord&#123;9fd4f88 u0 com.miui.home/.launcher.Launcher t1&#125; Stack #1: type=standard mode=fullscreen Task id #46 Running activities (most recent first): TaskRecord&#123;c374b98 #46 A=com.kunminx.relearn_android U=0 StackId=1 sz=3&#125; Run #2: ActivityRecord&#123;5afc3da u0 com.kunminx.relearn_android/.SingleTaskAActivity t46&#125; Run #1: ActivityRecord&#123;bb0363c u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t46&#125; Run #0: ActivityRecord&#123;510711c u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.TestMainActivity t46&#125; mLastPausedActivity: ActivityRecord&#123;5afc3da u0 com.kunminx.relearn_android/.SingleTaskAActivity t46&#125; Stack #2: type=standard mode=fullscreen Task id #47 Running activities (most recent first): TaskRecord&#123;3387d6 #47 A=com.kunminx.task.c U=0 StackId=2 sz=2&#125; Run #1: ActivityRecord&#123;6375a1b u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t47&#125; Run #0: ActivityRecord&#123;e9850ca u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskOneActivity t47&#125; mLastPausedActivity: ActivityRecord&#123;6375a1b u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t47&#125; ResumedActivity: ActivityRecord&#123;9cdafc6 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardTwoActivity t48&#125; mFocusedStack=ActivityStack&#123;ed83a57 stackId=3 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mLastFocusedStack=ActivityStack&#123;ed83a57 stackId=3 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mCurTaskIdForUser=&#123;0=48&#125; mUserStackInFront=&#123;&#125; displayId=0 stacks=4 mHomeStack=ActivityStack&#123;a218944 stackId=0 type=home mode=fullscreen visible=false translucent=true, 1 tasks&#125; isHomeRecentsComponent=false KeyguardController: mKeyguardShowing=false mAodShowing=false mKeyguardGoingAway=false mOccluded=false mDismissingKeyguardActivity=null mDismissalRequested=false mVisibilityTransactionDepth=0 LockTaskController mLockTaskModeState=NONE mLockTaskModeTasks= mLockTaskPackages (userId:packages)= u0:[] æœ€åŽåœ¨ app2 ä¸­å¯åŠ¨ app1 çš„ SingleTaskAActivity æ­¤æ—¶å †æ ˆä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465âžœ Relearn-Android (master) adb shellsagit:/ $ dumpsys activity activitiesACTIVITY MANAGER ACTIVITIES (dumpsys activity activities)Display #0 (activities from top to bottom): Stack #1: type=standard mode=fullscreen Task id #46 Running activities (most recent first): TaskRecord&#123;c374b98 #46 A=com.kunminx.relearn_android U=0 StackId=1 sz=3&#125; Run #2: ActivityRecord&#123;5afc3da u0 com.kunminx.relearn_android/.SingleTaskAActivity t46&#125; Run #1: ActivityRecord&#123;bb0363c u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t46&#125; Run #0: ActivityRecord&#123;510711c u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.TestMainActivity t46&#125; mResumedActivity: ActivityRecord&#123;5afc3da u0 com.kunminx.relearn_android/.SingleTaskAActivity t46&#125; Stack #3: type=standard mode=fullscreen Task id #48 Running activities (most recent first): TaskRecord&#123;3b07175 #48 A=com.kunminx.relearn_android_2 U=0 StackId=3 sz=4&#125; Run #3: ActivityRecord&#123;9cdafc6 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardTwoActivity t48&#125; Run #2: ActivityRecord&#123;83db884 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t48&#125; Run #1: ActivityRecord&#123;71254 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardOneActivity t48&#125; Run #0: ActivityRecord&#123;7c135cf u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.TestMainActivity t48&#125; mLastPausedActivity: ActivityRecord&#123;9cdafc6 u0 com.kunminx.relearn_android_2/com.kunminx.basicfacttesting.test03_task_test.StandardTwoActivity t48&#125; Stack #0: type=home mode=fullscreen Task id #1 Running activities (most recent first): TaskRecord&#123;185017b #1 I=com.miui.home/.launcher.Launcher U=0 StackId=0 sz=1&#125; Run #0: ActivityRecord&#123;9fd4f88 u0 com.miui.home/.launcher.Launcher t1&#125; mLastPausedActivity: ActivityRecord&#123;9fd4f88 u0 com.miui.home/.launcher.Launcher t1&#125; Stack #2: type=standard mode=fullscreen Task id #47 Running activities (most recent first): TaskRecord&#123;3387d6 #47 A=com.kunminx.task.c U=0 StackId=2 sz=2&#125; Run #1: ActivityRecord&#123;6375a1b u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t47&#125; Run #0: ActivityRecord&#123;e9850ca u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskOneActivity t47&#125; mLastPausedActivity: ActivityRecord&#123;6375a1b u0 com.kunminx.relearn_android/com.kunminx.basicfacttesting.test03_task_test.SingleTaskTwoActivity t47&#125; ResumedActivity: ActivityRecord&#123;5afc3da u0 com.kunminx.relearn_android/.SingleTaskAActivity t46&#125; mFocusedStack=ActivityStack&#123;50922c2 stackId=1 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mLastFocusedStack=ActivityStack&#123;50922c2 stackId=1 type=standard mode=fullscreen visible=true translucent=false, 1 tasks&#125; mCurTaskIdForUser=&#123;0=48&#125; mUserStackInFront=&#123;&#125; displayId=0 stacks=4 mHomeStack=ActivityStack&#123;a218944 stackId=0 type=home mode=fullscreen visible=false translucent=true, 1 tasks&#125; isHomeRecentsComponent=false KeyguardController: mKeyguardShowing=false mAodShowing=false mKeyguardGoingAway=false mOccluded=false mDismissingKeyguardActivity=null mDismissalRequested=false mVisibilityTransactionDepth=0 LockTaskController mLockTaskModeState=NONE mLockTaskModeTasks= mLockTaskPackages (userId:packages)= u0:[] æ­¤æ—¶ app1 çš„ taskid 46 çš„TaskRecord è½¬ç§»åˆ°äº† æ ˆé¡¶ æŽ¥ä¸‹æ¥è¿”å›žé”€æ¯çš„é€»è¾‘å°±å¾ˆæ¸…æ™°äº†ã€‚ æœ€åŽé€€åˆ° launcher ç•Œé¢ app1 çš„ TaskRecord è½¬ç§»åˆ°äº† app2 çš„è¿”å›žæ ˆä¸­]]></content>
      <categories>
        <category>app</category>
      </categories>
      <tags>
        <tag>app</tag>
        <tag>é‡å­¦Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æµæ°´è´¦ã€‘Xposedæ¨¡å—å¼€å‘]]></title>
    <url>%2F2019%2F08%2F30%2FXposed%2F</url>
    <content type="text"><![CDATA[å†™åšå®¢æ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼Œä½†æ˜¯å†™çš„äººæ°´å¹³å‚å·®ä¸é½ï¼Œæˆ‘è§è¿‡æœ€æžç¬‘çš„å°±æ˜¯åšæ–‡çš„å†…å®¹æ˜¯å…¶ä»–åšå®¢çš„é“¾æŽ¥ã€‚æœ¬ç€ä¸è¯¯äººå­å¼Ÿçš„åŽŸåˆ™ï¼Œæˆ‘å†™åšå®¢ä¸€å‘å¾ˆå…‹åˆ¶ã€‚æµæ°´è´¦ç³»åˆ—æ˜¯æˆ‘å¹³æ—¶çš„ä¸€äº›è®°å½•ï¼Œæ˜¯ how to ç±»åž‹çš„æ–‡ç« ï¼Œç½‘ä¸Šç›¸å…³çš„èµ„æ–™ä¸€æœä¸€å¤§æŠŠï¼Œä»…ä¾›è‡ªå·±è®°å½•æŸ¥æ‰¾ã€‚ æœ¬ç¯‡åšå®¢æ˜¯è®°å½•ä¸€äº›å­¦ä¹  Xposedæ¨¡å—å¼€å‘æ—¶çŸ¥è¯†çš„æ•´ç†ã€‚ å¼€å‘å‰çš„å‡†å¤‡å·¥ä½œæŸ¥çœ‹ Xposed-Framework-API æ ¹æ®æ–‡æ¡£è¿›è¡Œé…ç½® 1234567repositories &#123; jcenter();&#125;dependencies &#123; compileOnly 'de.robv.android.xposed:api:82'&#125; AndroidManifest.xml ä¸­ application æ ‡ç­¾ä¸‹åŠ å…¥ 123456789101112&lt;!-- åº”ç”¨ä¸ºæ¨¡å— --&gt;&lt;meta-data android:name="xposedmodule" android:value="true" /&gt;&lt;!-- ç‰ˆæœ¬ä¿¡æ¯ è¯¥ç‰ˆæœ¬å·ä¸Žå¼•ç”¨çš„ä¾èµ–ç‰ˆæœ¬ç›¸åŒ--&gt;&lt;meta-data android:name="xposedminversion" android:value="82" /&gt;&lt;!-- æ¨¡å—æè¿° --&gt;&lt;meta-data android:name="xposeddescription" android:value="Xposed Test" /&gt; åˆ›å»º Hook ç±»ï¼Œè¯¥ç±»æ˜¯ Xposed çš„å…¥å£ç±»ï¼Œç”¨äºŽæ‹¦æˆªåŠ è½½çš„ package ï¼Œå®žçŽ° IXposedHookLoadPackage æŽ¥å£ 1234567package com.yyz.xposedtest;public class Main implements IXposedHookLoadPackage &#123; @Override public void handleLoadPackage(XC_LoadPackage.LoadPackageParam lpparam) throws Throwable &#123; // TODO: hooké€»è¾‘ &#125; &#125; åœ¨ src/main ç›®å½•ä¸‹åˆ›å»ºassetsç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸­åˆ›å»º xposed_ini tæ–‡ä»¶ï¼Œå†™å…¥ä¸Šé¢åˆ›å»ºçš„ Xposed çš„å…¥å£ç±»ï¼Œå¦‚ä¸‹ï¼š XposedHelpers å¸¸ç”¨æ–¹æ³•findAndHookMethod Look up a method and hook it. The last argument must be the callback for the hook. æœ€åŽä¸€ä¸ªå‚æ•°ä¸»è¦æœ‰ä¸¤ç§ XC_MethodHook åœ¨åŽŸæœ‰æ–¹æ³•é€»è¾‘ä¸Šæ·»åŠ é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ 12345678910111213141516//åœ¨åŽŸæœ‰æ–¹æ³•é€»è¾‘ä¸Šæ·»åŠ é€»è¾‘/** * 1. åŒ…å 2. classLoader 3. æ–¹æ³•å 4. å‚æ•°ç±»åž‹ï¼ˆæ²¡æœ‰åˆ™ä¸æ·»åŠ ï¼‰ 5.Callback */XposedHelpers.findAndHookMethod("cn.bcbook.kaixuetest.MainActivity", lpparam.classLoader, "printViewId", View.class, new XC_MethodHook() &#123; @Override protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123; super.beforeHookedMethod(param); &#125; @Override protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123; super.afterHookedMethod(param); Log.i("yyz", "afterHookedMethod hook success!"); &#125; &#125;); XC_MethodReplacement æ›¿æ¢åŽŸæœ‰æ–¹æ³•é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ 123456789//æ›¿æ¢åŽŸæœ‰æ–¹æ³•XposedHelpers.findAndHookMethod("cn.bcbook.kaixuetest.MainActivity", lpparam.classLoader, "printViewId", View.class, new XC_MethodReplacement() &#123; @Override protected Object replaceHookedMethod(MethodHookParam param) throws Throwable &#123; Log.i("yyz", "hook success!"); return null; &#125; &#125;);]]></content>
      <categories>
        <category>Xposed</category>
      </categories>
      <tags>
        <tag>æµæ°´è´¦</tag>
        <tag>Hook</tag>
        <tag>Xposed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æµæ°´è´¦ã€‘iptables å¸¸ç”¨æŒ‡ä»¤]]></title>
    <url>%2F2019%2F08%2F29%2Fiptabels%2F</url>
    <content type="text"><![CDATA[å†™åšå®¢æ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼Œä½†æ˜¯å†™çš„äººæ°´å¹³å‚å·®ä¸é½ï¼Œæˆ‘è§è¿‡æœ€æžç¬‘çš„å°±æ˜¯åšæ–‡çš„å†…å®¹æ˜¯å…¶ä»–åšå®¢çš„é“¾æŽ¥ã€‚æœ¬ç€ä¸è¯¯äººå­å¼Ÿçš„åŽŸåˆ™ï¼Œæˆ‘å†™åšå®¢ä¸€å‘å¾ˆå…‹åˆ¶ã€‚æµæ°´è´¦ç³»åˆ—æ˜¯æˆ‘å¹³æ—¶çš„ä¸€äº›è®°å½•ï¼Œæ˜¯ how to ç±»åž‹çš„æ–‡ç« ï¼Œç½‘ä¸Šç›¸å…³çš„èµ„æ–™ä¸€æœä¸€å¤§æŠŠï¼Œä»…ä¾›è‡ªå·±è®°å½•æŸ¥æ‰¾ã€‚ è¯¥æ–‡æ€»ç»“äº† iptables å¸¸ç”¨çš„æŒ‡ä»¤ã€‚iptables è¯¦ç»†å†…å®¹è¯·çœ‹åŒå°å¤§ä½¬ iptables è¯¦è§£ç³»åˆ— è§„åˆ™æŸ¥è¯¢æŸ¥çœ‹æŒ‡å®šè¡¨ä¸­çš„è§„åˆ™1iptables -t filter -L ä½¿ç”¨ -t é€‰é¡¹ï¼ŒæŒ‡å®šè¦æ“ä½œçš„è¡¨ï¼Œä½¿ç”¨ -L é€‰é¡¹ï¼ŒæŸ¥çœ‹-té€‰é¡¹å¯¹åº”çš„è¡¨çš„è§„åˆ™ï¼Œ -L é€‰é¡¹çš„æ„æ€æ˜¯ï¼Œåˆ—å‡ºè§„åˆ™ã€‚æ‰€ä»¥ï¼Œä¸Šè¿°å‘½ä»¤çš„å«ä¹‰ä¸ºåˆ—å‡ºfilterè¡¨çš„æ‰€æœ‰è§„åˆ™ã€‚ filter å¯æ›¿æ¢ä¸º raw mangle nat å¦‚æžœä»…æŸ¥çœ‹ filter å¯ä»¥çœç•¥ -t filter ï¼Œå½“æ²¡æœ‰ä½¿ç”¨ -t é€‰é¡¹æŒ‡å®šè¡¨æ—¶ï¼Œé»˜è®¤ä¸ºæ“ä½œ filter è¡¨ï¼Œå³ iptables -L è¡¨ç¤ºåˆ—å‡º filter è¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ã€‚ æŸ¥çœ‹æŒ‡å®šè¡¨ä¸­çš„æŒ‡å®šé“¾çš„è§„åˆ™1iptables -L INPUT åªæŸ¥çœ‹ filter è¡¨ä¸­ INPUT é“¾çš„è§„åˆ™ 1iptables -vL INPUT ä½¿ç”¨ -v æŸ¥çœ‹æ›´å¤šï¼Œæ›´è¯¦ç»†çš„ä¿¡æ¯ ä¸è®©ipè¿›è¡Œåè§£1iptables -nvL iptables é»˜è®¤è¿›è¡Œäº†åç§°è§£æžï¼Œä½†æ˜¯åœ¨è§„åˆ™éžå¸¸å¤šçš„æƒ…å†µä¸‹å¦‚æžœè¿›è¡Œåç§°è§£æžï¼Œæ•ˆçŽ‡ä¼šæ¯”è¾ƒä½Žã€‚ä½¿ç”¨ -n é€‰é¡¹ï¼Œè¡¨ç¤ºä¸å¯¹ ip åœ°å€è¿›è¡Œåç§°åè§£ï¼Œç›´æŽ¥æ˜¾ç¤º ip åœ°å€ åªæŸ¥çœ‹æŸä¸ªé“¾çš„è§„åˆ™ï¼Œå¹¶ä¸”ä¸è®© ip è¿›è¡Œåè§£ï¼Œiptables -nvL INPUT æ˜¾ç¤ºè§„åˆ™ç¼–å·123iptables --line-number -nvL INPUTæˆ–iptables --line -nvL INPUT è§„åˆ™ç®¡ç†æ·»åŠ è§„åˆ™æ³¨æ„ï¼šæ·»åŠ è§„åˆ™æ—¶ï¼Œè§„åˆ™çš„é¡ºåºéžå¸¸é‡è¦ 123456789101112131415# åœ¨æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„å°¾éƒ¨æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œ-Aé€‰é¡¹è¡¨ç¤ºåœ¨å¯¹åº”é“¾çš„æœ«å°¾æ·»åŠ è§„åˆ™å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -A é“¾å åŒ¹é…æ¡ä»¶ -j åŠ¨ä½œç¤ºä¾‹ï¼šiptables -t filter -A OUTPUT -s 192.168.10.225 -j DROP# åœ¨æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„é¦–éƒ¨æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œ-Ié€‰åž‹è¡¨ç¤ºåœ¨å¯¹åº”é“¾çš„å¼€å¤´æ·»åŠ è§„åˆ™å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -I é“¾å åŒ¹é…æ¡ä»¶ -j åŠ¨ä½œç¤ºä¾‹ï¼š iptables -t filter -I OUTPUT -s 192.168.10.225 -j ACCEPT# åœ¨æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„æŒ‡å®šä½ç½®æ·»åŠ ä¸€æ¡è§„åˆ™å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -I é“¾å è§„åˆ™åºå· åŒ¹é…æ¡ä»¶ -j åŠ¨ä½œç¤ºä¾‹ï¼š iptables -t filter -I OUTPUT 3 -s 192.168.10.225 -j REJECT# è®¾ç½®æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„é»˜è®¤ç­–ç•¥ï¼ˆé»˜è®¤åŠ¨ä½œï¼‰ï¼Œå¹¶éžæ·»åŠ è§„åˆ™å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -P é“¾å åŠ¨ä½œç¤ºä¾‹ï¼šiptables -t filter -P FORWARD ACCEPT åˆ é™¤è§„åˆ™æ³¨æ„ï¼šå¦‚æžœæ²¡æœ‰ä¿å­˜è§„åˆ™ï¼Œåˆ é™¤è§„åˆ™æ—¶è¯·æ…Žé‡ 123456789101112131415# æŒ‰ç…§è§„åˆ™åºå·åˆ é™¤è§„åˆ™ï¼Œåˆ é™¤æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„æŒ‡å®šè§„åˆ™ï¼Œ-Dé€‰é¡¹è¡¨ç¤ºåˆ é™¤å¯¹åº”é“¾ä¸­çš„è§„åˆ™å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -D é“¾å è§„åˆ™åºå·ç¤ºä¾‹ï¼šiptables -t filter -D INPUT 3# æŒ‰ç…§å…·ä½“çš„åŒ¹é…æ¡ä»¶ä¸ŽåŠ¨ä½œåˆ é™¤è§„åˆ™ï¼Œåˆ é™¤æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„æŒ‡å®šè§„åˆ™å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -D é“¾å åŒ¹é…æ¡ä»¶ -j åŠ¨ä½œç¤ºä¾‹ï¼šiptables -t filter -D INPUT -s 192.168.10.225 -j DROP# åˆ é™¤æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œ-Fé€‰é¡¹è¡¨ç¤ºæ¸…ç©ºå¯¹åº”é“¾ä¸­çš„è§„åˆ™å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -F é“¾åç¤ºä¾‹ï¼šiptables -t filter -F INPUT# åˆ é™¤æŒ‡å®šè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -Fç¤ºä¾‹ï¼šiptables -t filter -F OUTPUT ä¿®æ”¹è§„åˆ™æ³¨æ„ï¼šå¦‚æžœä½¿ç”¨-Ré€‰é¡¹ä¿®æ”¹è§„åˆ™ä¸­çš„åŠ¨ä½œï¼Œé‚£ä¹ˆå¿…é¡»æŒ‡æ˜ŽåŽŸè§„åˆ™ä¸­çš„åŽŸåŒ¹é…æ¡ä»¶ï¼Œä¾‹å¦‚æºipï¼Œç›®æ ‡ipç­‰ 123# ä¿®æ”¹æŒ‡å®šè¡¨ä¸­æŒ‡å®šé“¾çš„æŒ‡å®šè§„åˆ™ï¼Œ-Ré€‰é¡¹è¡¨ç¤ºä¿®æ”¹å¯¹åº”é“¾ä¸­çš„è§„åˆ™ï¼Œä½¿ç”¨-Ré€‰é¡¹æ—¶è¦åŒæ—¶æŒ‡å®šå¯¹åº”çš„é“¾ä»¥åŠè§„åˆ™å¯¹åº”çš„åºå·ï¼Œå¹¶ä¸”è§„åˆ™ä¸­åŽŸæœ¬çš„åŒ¹é…æ¡ä»¶ä¸å¯çœç•¥å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -R é“¾å è§„åˆ™åºå· è§„åˆ™åŽŸæœ¬çš„åŒ¹é…æ¡ä»¶ -j åŠ¨ä½œç¤ºä¾‹ï¼šiptables -t filter -R INPUT 3 -s 192.168.10.225 -j ACCEPT ä¸Šè¿°ç¤ºä¾‹è¡¨ç¤ºä¿®æ”¹ filter è¡¨ä¸­ INPUT é“¾çš„ç¬¬3æ¡è§„åˆ™ï¼Œå°†è¿™æ¡è§„åˆ™çš„åŠ¨ä½œä¿®æ”¹ä¸º ACCEPT ï¼Œ -s 192.168.10.225 ä¸ºè¿™æ¡è§„åˆ™ä¸­åŽŸæœ¬çš„åŒ¹é…æ¡ä»¶ï¼Œå¦‚æžœçœç•¥æ­¤åŒ¹é…æ¡ä»¶ï¼Œä¿®æ”¹åŽçš„è§„åˆ™ä¸­çš„æºåœ°å€å¯èƒ½ä¼šå˜ä¸º 0.0.0.0/0 å…¶ä»–ä¿®æ”¹è§„åˆ™çš„æ–¹æ³•ï¼šå…ˆé€šè¿‡ç¼–å·åˆ é™¤è§„åˆ™ï¼Œå†åœ¨åŽŸç¼–å·ä½ç½®æ·»åŠ ä¸€æ¡è§„åˆ™ 123# ä¿®æ”¹æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„é»˜è®¤ç­–ç•¥ï¼ˆé»˜è®¤åŠ¨ä½œï¼‰ï¼Œå¹¶éžä¿®æ”¹è§„åˆ™å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -P é“¾å åŠ¨ä½œç¤ºä¾‹ï¼šiptables -t filter -P FORWARD ACCEPT ä¿å­˜è§„åˆ™12# ä¿å­˜è§„åˆ™å‘½ä»¤ï¼Œè¡¨ç¤ºå°†iptablesè§„åˆ™ä¿å­˜è‡³/etc/sysconfig/iptablesæ–‡ä»¶ä¸­service iptables save åŒ¹é…æ¡ä»¶åŸºæœ¬åŒ¹é…æ¡ä»¶-s ç”¨äºŽåŒ¹é…æŠ¥æ–‡çš„æºåœ°å€,å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªæºåœ°å€ï¼Œæ¯ä¸ª ip ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ªç½‘æ®µ 123iptables -t filter -I INPUT -s 192.168.10.111,192.168.10.225 -j DROPiptables -t filter -I INPUT -s 192.168.10.0/24 -j ACCEPTiptables -t filter -I INPUT ! -s 192.168.10.0/24 -j ACCEPT -d ç”¨äºŽåŒ¹é…æŠ¥æ–‡çš„ç›®æ ‡åœ°å€,å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªç›®æ ‡åœ°å€ï¼Œæ¯ä¸ª ip ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ªç½‘æ®µ 123iptables -t filter -I OUTPUT -d 192.168.10.111,192.168.10.225 -j DROPiptables -t filter -I INPUT -d 192.168.10.0/24 -j ACCEPTiptables -t filter -I INPUT ! -d 192.168.10.0/24 -j ACCEPT -p ç”¨äºŽåŒ¹é…æŠ¥æ–‡çš„åè®®ç±»åž‹,å¯ä»¥åŒ¹é…çš„åè®®ç±»åž‹ tcp ã€udp ã€udplite ã€icmp ã€esp ã€ah ã€sctp ç­‰ 12iptables -t filter -I INPUT -p tcp -s 192.168.10.146 -j ACCEPTiptables -t filter -I INPUT ! -p udp -s 192.168.10.146 -j ACCEPT æ‰©å±•åŒ¹é…æ¡ä»¶ tcp æ‰©å±•æ¨¡å— -p tcp -m tcp --sport ç”¨äºŽåŒ¹é… tcp åè®®æŠ¥æ–‡çš„æºç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨å†’å·æŒ‡å®šä¸€ä¸ªè¿žç»­çš„ç«¯å£èŒƒå›´-p tcp -m tcp --dport ç”¨äºŽåŒ¹é… tcp åè®®æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨å†’å·æŒ‡å®šä¸€ä¸ªè¿žç»­çš„ç«¯å£èŒƒå›´ 12345iptables -t filter -I OUTPUT -d 192.168.10.225 -p tcp -m tcp --sport 22 -j REJECTiptables -t filter -I INPUT -s 192.168.10.225 -p tcp -m tcp --dport 22:25 -j REJECTiptables -t filter -I INPUT -s 192.168.10.225 -p tcp -m tcp --dport :22 -j REJECTiptables -t filter -I INPUT -s 192.168.10.225 -p tcp -m tcp --dport 80: -j REJECTiptables -t filter -I OUTPUT -d 192.168.10.225 -p tcp -m tcp ! --sport 22 -j ACCEPT multiport æ‰©å±•æ¨¡å— -p tcp -m multiport --sports ç”¨äºŽåŒ¹é…æŠ¥æ–‡çš„æºç«¯å£ï¼Œå¯ä»¥æŒ‡å®šç¦»æ•£çš„å¤šä¸ªç«¯å£å·,ç«¯å£ä¹‹é—´ç”¨â€é€—å·â€éš”å¼€-p udp -m multiport --dports ç”¨äºŽåŒ¹é…æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ï¼Œå¯ä»¥æŒ‡å®šç¦»æ•£çš„å¤šä¸ªç«¯å£å·ï¼Œç«¯å£ä¹‹é—´ç”¨â€é€—å·â€éš”å¼€ 12345iptables -t filter -I OUTPUT -d 192.168.10.225 -p udp -m multiport --sports 137,138 -j REJECTiptables -t filter -I INPUT -s 192.168.10.225 -p tcp -m multiport --dports 22,80 -j REJECTiptables -t filter -I INPUT -s 192.168.10.225 -p tcp -m multiport ! --dports 22,80 -j REJECTiptables -t filter -I INPUT -s 192.168.10.225 -p tcp -m multiport --dports 80:88 -j REJECTiptables -t filter -I INPUT -s 192.168.10.225 -p tcp -m multiport --dports 22,80:88 -j REJECT udp æ¨¡å— --sport åŒ¹é… udp æŠ¥æ–‡çš„æºåœ°å€--dport åŒ¹é… udp æŠ¥æ–‡çš„ç›®æ ‡åœ°å€ 123# å¯ä»¥ç»“åˆmultiportæ¨¡å—æŒ‡å®šå¤šä¸ªç¦»æ•£çš„ç«¯å£iptables -t filter -I INPUT -p udp -m udp --dport 137 -j ACCEPTiptables -t filter -I INPUT -p udp -m udp --dport 137:157 -j ACCEPT icmp æ¨¡å— --icmp-type åŒ¹é… icmp æŠ¥æ–‡çš„å…·ä½“ç±»åž‹ 12345iptables -t filter -I INPUT -p icmp -m icmp --icmp-type 8/0 -j REJECTiptables -t filter -I INPUT -p icmp --icmp-type 8 -j REJECTiptables -t filter -I OUTPUT -p icmp -m icmp --icmp-type 0/0 -j REJECTiptables -t filter -I OUTPUT -p icmp --icmp-type 0 -j REJECTiptables -t filter -I INPUT -p icmp --icmp-type "echo-request" -j REJECT iprange æ¨¡å— --src-range æŒ‡å®šè¿žç»­çš„æºåœ°å€èŒƒå›´--dst-range æŒ‡å®šè¿žç»­çš„ç›®æ ‡åœ°å€èŒƒå›´ 123iptables -t filter -I INPUT -m iprange --src-range 192.168.10.127-192.168.10.146 -j DROPiptables -t filter -I OUTPUT -m iprange --dst-range 192.168.10.127-192.168.10.146 -j DROPiptables -t filter -I INPUT -m iprange ! --src-range 192.168.10.127-192.168.10.146 -j DROP stirng æ¨¡å— --algo æŒ‡å®šå¯¹åº”çš„åŒ¹é…ç®—æ³•ï¼Œå¯ç”¨ç®—æ³•ä¸º bm ã€kmpï¼Œæ­¤é€‰é¡¹ä¸ºå¿…éœ€é€‰é¡¹ã€‚--string æŒ‡å®šéœ€è¦åŒ¹é…çš„å­—ç¬¦ä¸² 12iptables -t filter -I INPUT -p tcp --sport 80 -m string --algo bm --string "baidu" -j REJECTiptables -t filter -I INPUT -p tcp --sport 80 -m string --algo bm --string "baidu" -j REJECT time æ¨¡å— --timestart ç”¨äºŽæŒ‡å®šæ—¶é—´èŒƒå›´çš„å¼€å§‹æ—¶é—´ï¼Œä¸å¯å–å--timestop ç”¨äºŽæŒ‡å®šæ—¶é—´èŒƒå›´çš„ç»“æŸæ—¶é—´ï¼Œä¸å¯å–å--weekdays ç”¨äºŽæŒ‡å®šâ€æ˜ŸæœŸå‡ â€ï¼Œå¯å–å--monthdays ç”¨äºŽæŒ‡å®šâ€å‡ å·â€ï¼Œå¯å–å--datestart ç”¨äºŽæŒ‡å®šæ—¥æœŸèŒƒå›´çš„å¼€å§‹æ—¥æœŸï¼Œä¸å¯å–å--datestop ç”¨äºŽæŒ‡å®šæ—¥æœŸèŒƒå›´çš„ç»“æŸæ—¶é—´ï¼Œä¸å¯å–å 12345678iptables -t filter -I OUTPUT -p tcp --dport 80 -m time --timestart 09:00:00 --timestop 19:00:00 -j REJECTiptables -t filter -I OUTPUT -p tcp --dport 443 -m time --timestart 09:00:00 --timestop 19:00:00 -j REJECTiptables -t filter -I OUTPUT -p tcp --dport 80 -m time --weekdays 6,7 -j REJECTiptables -t filter -I OUTPUT -p tcp --dport 80 -m time --monthdays 22,23 -j REJECTiptables -t filter -I OUTPUT -p tcp --dport 80 -m time ! --monthdays 22,23 -j REJECTiptables -t filter -I OUTPUT -p tcp --dport 80 -m time --timestart 09:00:00 --timestop 18:00:00 --weekdays 6,7 -j REJECTiptables -t filter -I OUTPUT -p tcp --dport 80 -m time --weekdays 5 --monthdays 22,23,24,25,26,27,28 -j REJECTiptables -t filter -I OUTPUT -p tcp --dport 80 -m time --datestart 2017-12-24 --datestop 2017-12-27 -j REJECT connlimit æ¨¡å— --connlimit-above å•ç‹¬ä½¿ç”¨æ­¤é€‰é¡¹æ—¶ï¼Œè¡¨ç¤ºé™åˆ¶æ¯ä¸ª ip çš„é“¾æŽ¥æ•°é‡ã€‚--connlimit-mask æ­¤é€‰é¡¹ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œåœ¨ä½¿ç”¨ --connlimit-above é€‰é¡¹æ—¶ï¼Œé…åˆæ­¤é€‰é¡¹ï¼Œåˆ™å¯ä»¥é’ˆå¯¹â€æŸç±» ip æ®µå†…çš„ä¸€å®šæ•°é‡çš„ ip â€œè¿›è¡Œè¿žæŽ¥æ•°é‡çš„é™åˆ¶ 123iptables -I INPUT -p tcp --dport 22 -m connlimit --connlimit-above 2 -j REJECTiptables -I INPUT -p tcp --dport 22 -m connlimit --connlimit-above 20 --connlimit-mask 24 -j REJECTiptables -I INPUT -p tcp --dport 22 -m connlimit --connlimit-above 10 --connlimit-mask 27 -j REJECT limit æ¨¡å— --limit-burst æ­¤é€‰é¡¹ç”¨äºŽæŒ‡å®šä»¤ç‰Œæ¡¶ä¸­ä»¤ç‰Œçš„æœ€å¤§æ•°é‡--limit æ­¤é€‰é¡¹ç”¨äºŽæŒ‡å®šä»¤ç‰Œæ¡¶ä¸­ç”Ÿæˆæ–°ä»¤ç‰Œçš„é¢‘çŽ‡ï¼Œå¯ç”¨æ—¶é—´å•ä½æœ‰secondã€minute ã€hourã€day 12iptables -t filter -I INPUT -p icmp -m limit --limit-burst 3 --limit 10/minute -j ACCEPTiptables -t filter -A INPUT -p icmp -j REJECT è‡ªå®šä¹‰é“¾åˆ›å»ºè‡ªå®šä¹‰é“¾12# åœ¨filterè¡¨ä¸­åˆ›å»ºyyzè‡ªå®šä¹‰é“¾iptables -N yyz å¼•ç”¨è‡ªå®šä¹‰é“¾12# åœ¨OUTPUTé“¾ä¸­å¼•ç”¨åˆšæ‰åˆ›å»ºçš„è‡ªå®šä¹‰é“¾iptables -I OUTPUT -j yyz é‡å‘½åè‡ªå®šä¹‰é“¾12# å°†yyzè‡ªå®šä¹‰é“¾é‡å‘½åä¸ºtestiptabels -E yyz test åˆ é™¤è‡ªå®šä¹‰é“¾åˆ é™¤è‡ªå®šä¹‰é“¾éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ è‡ªå®šä¹‰é“¾ä¸­æ²¡æœ‰è¢«å¼•ç”¨ è‡ªå®šä¹‰é“¾ä¸­æ²¡æœ‰ä»»ä½•è§„åˆ™ 12# åˆ é™¤å¼•ç”¨è®¡æ•°ä¸º0ä¸”ä¸åŒ…å«ä»»ä½•è§„åˆ™çš„testé“¾iptabels -X test]]></content>
      <categories>
        <category>ROM</category>
      </categories>
      <tags>
        <tag>ROM</tag>
        <tag>framework</tag>
        <tag>æµæ°´è´¦</tag>
        <tag>iptables</tag>
        <tag>ç½‘ç»œé»‘ç™½åå•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æµæ°´è´¦ã€‘è®°å½•Frameworkå¼€å‘çš„å¸¸ç”¨æŒ‡ä»¤]]></title>
    <url>%2F2019%2F08%2F16%2FFramework-Option%2F</url>
    <content type="text"><![CDATA[å†™åšå®¢æ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼Œä½†æ˜¯å†™çš„äººæ°´å¹³å‚å·®ä¸é½ï¼Œæˆ‘è§è¿‡æœ€æžç¬‘çš„å°±æ˜¯åšæ–‡çš„å†…å®¹æ˜¯å…¶ä»–åšå®¢çš„é“¾æŽ¥ã€‚æœ¬ç€ä¸è¯¯äººå­å¼Ÿçš„åŽŸåˆ™ï¼Œæˆ‘å†™åšå®¢ä¸€å‘å¾ˆå…‹åˆ¶ã€‚æµæ°´è´¦ç³»åˆ—æ˜¯æˆ‘å¹³æ—¶çš„ä¸€äº›è®°å½•ï¼Œæ˜¯ how to ç±»åž‹çš„æ–‡ç« ï¼Œç½‘ä¸Šç›¸å…³çš„èµ„æ–™ä¸€æœä¸€å¤§æŠŠï¼Œä»…ä¾›è‡ªå·±è®°å½•æŸ¥æ‰¾ã€‚ æœ¬ç¯‡åšå®¢æ˜¯è®°å½•ä¸€äº›å­¦ä¹  framework å¼€å‘æ—¶çŸ¥è¯†çš„æ•´ç†ã€‚ æºç å…¨ç›˜ç¼–è¯‘æŒ‡ä»¤ source build/envsetup.sh è¾“å…¥ lunch åŒæ—¶é€‰æ‹©æ¬²ç¼–è¯‘çš„æºç  ç¼–è¯‘æŒ‡ä»¤ï¼šmake -j32 2&gt;&amp;1 | tee build_20190717_1724.log ç¼–è¯‘åŽoutç›®å½•å¯æŸ¥çœ‹ç¼–è¯‘å‡ºçš„é•œåƒ å‰ä¸¤æ­¥æ‰§è¡Œå®Œæ¯•å³å¯æ‰§è¡Œ mmm ç­‰å‘½ä»¤ï¼Œä½¿ç”¨ make cleanå¯ä»¥åœ¨ç¼–è¯‘å‰cleanæºç ï¼Œè¯¥æ“ä½œä¼šå¯¼è‡´ç¼–è¯‘æ—¶é—´è¾¹é•¿ã€‚ ROMçƒ§å½•ï¼ˆmtkï¼‰ æ‰“å¼€ flash_tool.exe é€‰æ‹©æºç çš„é…ç½®æ–‡ä»¶ åˆ‡æ¢ä¸‹è½½/å…¨éƒ¨æ ¼å¼åŒ–å’Œä¸‹ ç‚¹å‡»ä¸‹è½½ï¼ŒåŒæ—¶å°†å·²å…³æœºçš„è®¾å¤‡è¿žæŽ¥ç”µè„‘ ç­‰å¾…çº¢æ¡ï¼Œç»¿æ¡ï¼Œé»„æ¡èµ°å®Œçƒ§å½•æˆåŠŸ ROMå†™å· æ‰“å¼€ SN Writer.exe ç‚¹å‡» System Config é…ç½®æ¬²å†™å“ªäº›å·ï¼Œç‚¹å‡»AP_DBè¿›è¡Œé…ç½®æ–‡ä»¶ï¼Œç‚¹å‡» Save ç‚¹å‡» Start å°†å…³æœºçš„è®¾å¤‡è¿žå…¥ç”µè„‘ æºç æ£€å‡º1repo-local init -u git://&#123;ip&#125;/shupai_android7.1/manifests.git &amp;&amp; repo-local sync -j8 &amp;&amp; repo-local start --all master {ip} ä½¿ç”¨æºç åœ°å€æ›¿æ¢ å¼€æœºåŠ¨ç”»/system/media/ é‡æ–°æ‰“åŒ… System ç”Ÿæˆé•œåƒ1make -j8 snod å¯¹ Settings éƒ¨åˆ†çš„ä¿®æ”¹ ç§»é™¤æŸé¡¹ï¼ˆremovePreferenceæ–¹æ³•ï¼‰ ç¦ç”¨æŸé¡¹ ï¼ˆé…ç½®enabledå±žæ€§ï¼‰ éšè— Settings ä¸»ç•Œé¢é€‰é¡¹ï¼šTileUtils ä¸‰å¤§é‡‘åˆšé”® HOME å’Œ BACKPhoneWindowManager ç±» interceptKeyBeforeDispatching æ–¹æ³•ä¿®æ”¹ KEYCODE_HOME KEYCODE_BACK case ä¸­çš„é€»è¾‘ RECENTsrc/com/android/systemui/recents/RecentsImpl ç±» startRecentsActivity æ–¹æ³• é¢„è£…åº”ç”¨device/mediatek/common device.mk å…³æœº é‡å¯æ“ä½œ1base/services/core/java/com/android/server/policy/GloablActions PowerAction]]></content>
      <categories>
        <category>ROM</category>
      </categories>
      <tags>
        <tag>ROM</tag>
        <tag>framework</tag>
        <tag>æµæ°´è´¦</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šä¸ªé¡¹ç›®æ·»åŠ ä¾èµ–åŒä¸€ä¸ªæ¨¡å—]]></title>
    <url>%2F2019%2F04%2F13%2Fmulti-project-one-module%2F</url>
    <content type="text"><![CDATA[android Studio ä¸­çš„é¡¹ç›®åœ¨æ­£å¸¸å¼•ç”¨moduleçš„æ—¶å€™æ˜¯ç”¨å¤åˆ¶åˆ°é¡¹ç›®ä¸­çš„æ–¹å¼è¿›è¡Œï¼Œå•ä¸ªé¡¹ç›®è°ƒç”¨è¿˜èƒ½é€‚ç”¨ï¼Œä½†æ˜¯å¦‚æžœå¤šä¸ªé¡¹ç›®è¦å¼•ç”¨åŒä¸€ä¸ªmoduleçš„æ—¶å€™ï¼Œå¦‚æžœmoduleä¸­è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆæ¯ä¸ªé¡¹ç›®ä¸­çš„moduleéƒ½è¦è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ ·å¢žåŠ äº†å·¥ä½œé‡ï¼Œå¹¶ä¸”å®¹æ˜“å‡ºçŽ°bug å› æ­¤æˆ‘ä»¬éœ€è¦å¼•ç”¨module ï¼Œè€Œä¸æ˜¯å¤åˆ¶moduleï¼Œå®žçŽ°æ–¹æ³•å¦‚ä¸‹ æ–°å»ºé¡¹ç›® TestBaseï¼Œåœ¨å…¶ app build.gradle ä¸­å°† apply plugin: &#39;com.android.application&#39; æ”¹ä¸ºapply plugin: &#39;com.android.library&#39; åˆ é™¤applicationId é…ç½®é¡¹ï¼Œå°†moduleåä¿®æ”¹ä¸ºbaselibã€‚ æ–°å»ºé¡¹ç›® TestA åœ¨å…¶settings.gradle æ–‡ä»¶ä¸­åŠ å…¥ä¸‹åˆ—ä»£ç ã€‚ 123include ':app'include ':baselib'project(':baselib').projectDir=new File("../TestBase", 'baselib') å¼•ç”¨ä¾èµ–æ—¶æ­£å¸¸å¼•ç”¨å³å¯ 1implementation project(&apos;:baselib&apos;) åŒæ­¥gradle ï¼Œæ­¤æ—¶æˆ‘ä»¬å‘çŽ°baselibå‡ºçŽ°åœ¨TestAé¡¹ç›®ä¸­ã€‚ æ‰“å¼€TestA é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å‘çŽ°äº† baselib æ–‡ä»¶å¤¹ï¼Œä¸‹é¢åªæœ‰ä¸€ä¸ªbaselib.imlæ–‡ä»¶ åœ¨baselibä¸­åŠ å…¥Utils å·¥å…·ç±» åˆ‡æ¢åˆ°TestBaseä¸­æŸ¥çœ‹ï¼Œä»£ç æ˜¯ç›¸åŒçš„ã€‚ è¿™æ ·å°±è¾¾åˆ°äº†baselibè¢«ä¿®æ”¹åŽæ‰€æœ‰å¼•ç”¨baselibçš„é¡¹ç›®ä¼šåŒæ­¥å˜åŒ–ã€‚ git åŒæ­¥ç®¡ç† ä¸Šè¿°æ“ä½œéƒ½æ˜¯åŸºäºŽæœ¬åœ°çš„ï¼Œé‚£ä¹ˆå¦‚ä½•åŠ å…¥gitç®¡ç†å‘¢ å°†TestAå’ŒTestBaseåˆ†åˆ«ä¼ è‡³github åœ¨TestAé¡¹ç›®ä¸­æ‰“å¼€settingsï¼Œæ‰¾åˆ°å¦‚ä¸‹ä½ç½®å¹¶å°†TestBaseåŠ å…¥åˆ°gitç®¡ç† ç„¶åŽå°±å¯ä»¥åŒæ­¥ç®¡ç†è¿™ä¸¤ä¸ªé¡¹ç›®å•¦ å‚è€ƒï¼šhttps://www.jianshu.com/p/47156a6be8cehttps://blog.csdn.net/saintcs/article/details/78567612]]></content>
      <categories>
        <category>app</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>app</tag>
        <tag>gradle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Macä¸‹Androidåç¼–è¯‘åˆæŽ¢]]></title>
    <url>%2F2017%2F07%2F06%2FMac-decompile%2F</url>
    <content type="text"><![CDATA[å·¥ä½œç¬¬å››å¤©ï¼Œè¢«è¦æ±‚å­¦ä¹ é€†å‘å¼€å‘æ–¹é¢çš„çŸ¥è¯†ï¼ŒäºŽæ˜¯å…ˆå°†è‡ªå·±ä¹‹å‰å†™çš„æœªç»æ··æ·†çš„apkåç¼–è¯‘ï¼Œè®°å½•ä¹‹ã€‚ æ„Ÿè°¢è¯¥åšæ–‡æä¾›çš„æ€è·¯ 1. å·¥å…·å‡†å¤‡ éœ€è¦çš„ä¸‰ä»¶å¥—ï¼Œä¸‹è½½è¯·æˆ³ AndroidCrackTool ç”¨äºŽåç¼–è¯‘apkæ–‡ä»¶ä¸Žç›´æŽ¥è§£åŽ‹apkä¸åŒï¼Œç”¨è¯¥å·¥å…·èŽ·å¾—çš„æ–‡ä»¶èµ„æºå¯ä»¥ç›´æŽ¥æ‰“å¼€é˜…è¯»ï¼Œè€Œç›´æŽ¥è§£åŽ‹å¾—åˆ°çš„æ˜¯å­—èŠ‚ç ã€‚ dex2jar ç”¨äºŽå°†.dexæ–‡ä»¶è½¬ä¸ºjaræ–‡ä»¶ ä¼ ç»Ÿçš„Javaç¨‹åºç»è¿‡ç¼–è¯‘ï¼Œç”ŸæˆJavaå­—èŠ‚ç ä¿å­˜åœ¨classæ–‡ä»¶ä¸­ï¼ŒJavaè™šæ‹Ÿæœºé€šè¿‡è§£ç classæ–‡ä»¶ä¸­çš„å†…å®¹æ¥è¿è¡Œç¨‹åºã€‚è€ŒDalvikè™šæ‹Ÿæœºè¿è¡Œçš„æ˜¯Davikå­—èŠ‚ç ï¼Œæ‰€æœ‰çš„Davikå­—èŠ‚ç ç”±Javaå­—èŠ‚ç è½¬æ¢è€Œæ¥ï¼Œå¹¶è¢«æ‰“åŒ…åˆ°ä¸€ä¸ªDEXï¼ˆDalvik Executableï¼‰å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼ŒDalvikè™šæ‹Ÿæœºé€šè¿‡è§£é‡ŠDEXæ–‡ä»¶æ¥æ‰§è¡Œè¿™äº›å­—èŠ‚ç ã€‚ jd-gui ç”¨äºŽé˜…è¯»æºç  2. å¼€å§‹å·¥ä½œä½¿ç”¨AndroidCrackToolåç¼–è¯‘apkï¼Œè®¾ç½®å¥½ç›®å½•ç‚¹å‡»æ‰§è¡ŒæŒ‰é’®ï¼Œå‡ºçŽ°endå­—æ ·å³æˆåŠŸã€‚åœ¨è¿™é‡Œå¯ä»¥æŸ¥çœ‹ä¸€äº›èµ„æºæ–‡ä»¶ å°†apkä»¥æ™®é€šè§£åŽ‹çš„æ–¹å¼è§£åŽ‹å‡ºæ¥ï¼Œæ‰¾åˆ°å…¶ä¸­çš„classes.dexæ–‡ä»¶ï¼Œå°†å…¶å¤åˆ¶åˆ°dex2jarç›®å½•ï¼Œä½¿ç”¨ç»ˆç«¯è¿›å…¥dex2jarç›®å½•å¹¶æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ã€‚ 1sh dex2jar.sh classes.dex å¯ä»¥çœ‹åˆ°åœ¨dex2jarç›®å½•ä¸‹ç”Ÿæˆäº†classes_dex2jar.jarçš„æ–‡ä»¶ã€‚ ä½¿ç”¨ jd-guiæ‰“å¼€classes_dex2jar.jarå³å¯çœ‹åˆ°æºç ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘çš„apkå¹¶æ²¡æœ‰æ··æ·†ï¼Œæ‰€ä»¥åå­—éƒ½æ˜¯æ­£å¸¸çš„å‘½åï¼Œç»è¿‡æ··æ·†çš„åå­—å¤§éƒ½æ˜¯äº›å­—æ¯ã€‚]]></content>
      <categories>
        <category>app</category>
      </categories>
      <tags>
        <tag>åç¼–è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Handleræ·±å…¥åˆ†æž]]></title>
    <url>%2F2017%2F07%2F04%2FHandler%2F</url>
    <content type="text"><![CDATA[åœ¨androidä¸­æˆ‘ä»¬å¯ä»¥æœ‰å¾ˆå¤šæ–¹å¼åŽ»å®žçŽ°å¼‚æ­¥ï¼Œæ¯”å¦‚AsyncTaskï¼ŒRxjavaã€‚ä¸è¿‡å®ƒä»¬åº•å±‚éƒ½æ˜¯ä½¿ç”¨çš„Handlerï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹Handelrçš„å®žçŽ°ã€‚ 1. TreadLocalçš„ä½¿ç”¨ä¸‹é¢æˆ‘ä»¬æ¥å†™ä¸€ä¸ªå°demoï¼Œåˆ›å»ºä¸¤ä¸ªå­çº¿ç¨‹ï¼Œåœ¨ä¸¤ä¸ªå­çº¿ç¨‹ä¸­åˆ†åˆ«ä¸ºå­—ç¬¦ä¸²result2ï¼Œresult3èµ‹å€¼ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ä¸¤ä¸ªå­çº¿ç¨‹ï¼Œå¹¶ä¸”ä¸ºå­—ç¬¦ä¸²result1èµ‹å€¼ï¼Œæœ€åŽæ‰“å°è¾“å‡ºç»“æžœã€‚ æœ€åŽæˆ‘ä»¬çœ‹ä¸€ä¸‹æ‰“å°ç»“æžœ å¾ˆæ˜Žæ˜¾ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æžœã€‚çœ‹æ¥çº¿ç¨‹ä¹‹é—´ç›¸äº’å½±å“äº†ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠžæ³•å®žçŽ°ä¸Šè¿°çš„åŠŸèƒ½å‘¢ï¼Ÿ å½“ç„¶æœ‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ TreadLocal æˆ‘ä»¬å¯ä»¥æŠŠTreadLocalçœ‹åšæˆä¸€ä¸ªå®¹å™¨ï¼Œè°ƒç”¨å…¶ä¸­çš„setå’Œgetæ–¹æ³•ï¼Œå¯ä»¥è®¾å€¼å’Œå–å€¼ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦‚ä½•å®žçŽ°çš„ã€‚ é¦–å…ˆåˆ›å»ºä¸€ä¸ªThreadLocalå¯¹è±¡ï¼Œå¹¶è®¾ç½®æ³›åž‹ä¸ºStringè¿™é‡Œä¸åŒçš„æ˜¯é¦–å…ˆå°†è¦æ‰“å°çš„å­—ä¸²æ”¾å…¥ThreadLocalä¸­ï¼Œç„¶åŽä»ŽThreadLocalä¸­å–å‡ºã€‚ å­çº¿ç¨‹çš„æ“ä½œä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚ ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹æ‰“å°ç»“æžœ è¿™æ ·å°±å®Œæˆäº†ä¸Šè¿°åŠŸèƒ½ã€‚é‚£ä¹ˆè¿™é‡Œè¯´çš„ThreadLocalä¸ŽHandleræœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿåˆ«æ€¥ï¼Œå¾€ä¸‹çœ‹ã€‚ 2. åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºHandelræˆ‘ä»¬åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡ï¼Œç„¶åŽè¿è¡Œç¨‹åºã€‚ å¯ä»¥çœ‹åˆ°è¿è¡Œæ—¶å‡ºçŽ°äº†å¼‚å¸¸ java.lang.RuntimeException: Canâ€™t create handler inside thread that has not called Looper.prepare() çœ‹å­—é¢æ„æ€æ˜¯ä¸èƒ½åœ¨è°ƒç”¨Looper.prepare()ä¹‹å‰åœ¨çº¿ç¨‹ä¸­åˆ›å»ºhandlerã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨åˆ›å»ºhandlerä¹‹å‰åŽ»è°ƒç”¨Looper.prepare()ã€‚ä¹‹åŽå°±èƒ½æˆåŠŸè¿è¡Œäº†ã€‚ é‚£ä¹ˆæˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚é¼ æ ‡æ”¾åœ¨Handler()ä¸Šï¼ŒwinæŒ‰ä½control+é¼ æ ‡å·¦é”®ï¼ŒMacæŒ‰ä½command+é¼ æ ‡å·¦é”®ã€‚è¿›å…¥Handlerçš„æž„é€ å™¨ã€‚ç‚¹å‡»this æˆ‘ä»¬æ‰¾åˆ°äº†æºå¤´ï¼Œå¦‚æžœlooperä¸ºç©ºåˆ™æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚ åœ¨è¿™é‡Œä»Žlooperé‡Œå–å‡ºmQueueèµ‹å€¼ç»™mQueue ç„¶åŽæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªLooper.prepareæ–¹æ³•ï¼Œ ä¸Šæ–¹çš„æ³¨é‡Šè¯´å¾—å¾ˆæ¸…æ¥šï¼Œåœ¨çœŸæ­£å¼€å§‹è¿™ä¸ªloopä¹‹å‰ï¼Œè¯¥æ–¹æ³•ä¸ºä½ æä¾›äº†åˆ›å»ºå¼•ç”¨è¿™ä¸ªlooperçš„handelrçš„æœºä¼šã€‚åœ¨è°ƒç”¨å®Œè¯¥æ–¹æ³•åŽï¼Œåº”è¯¥ç¡®ä¿è°ƒç”¨äº†loop()æ–¹æ³•ï¼Œå¹¶ä¸”ä½¿ç”¨quit()æ–¹æ³•åŽ»ç»“æŸå®ƒã€‚ æˆ‘ä»¬è¿˜çœ‹åˆ°å¦‚æžœå¤šæ¬¡è°ƒç”¨prepareæ–¹æ³•ä¼šæŠ›å‡ºOnly one Looper may be created per threadå¼‚å¸¸ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†ç†Ÿæ‚‰çš„èº«å½±ï¼ŒThreadLocalã€‚åœ¨è¿™é‡Œä½¿ç”¨ThreadLocalæ¥å­˜looperã€‚ çœ‹åˆ°è¿™æˆ‘ä»¬ä¸ç¦è¦é—®ï¼Œåœ¨ä¸»çº¿ç¨‹æˆ‘ä»¬å¹¶æ²¡æœ‰è°ƒç”¨prepareæ–¹æ³•å•Šï¼Œæ²¡é”™ï¼Œåœ¨ä¸»çº¿ç¨‹ä½¿ç”¨çš„æ˜¯prepareMainLooperå¯ä»¥çœ‹åˆ°è¿™ä¸ªmain looperå·²ç»è¢«android environmentåˆ›å»ºäº†ï¼Œæ‰€ä»¥ä¸éœ€è¦è‡ªå·±è°ƒç”¨è¯¥æ–¹æ³•ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºHandlerçš„æ ‡å‡†å†™æ³•ã€‚ 123456789101112131415class ThreadLooper extends Thread &#123; public Handler mHandler; @Override public void run() &#123; super.run(); Looper.prepare(); mHandler = new Handler() &#123; @Override public void handleMessage(Message msg) &#123; &#125; &#125;; Looper.loop(); &#125; &#125; 3. Messageçš„å‘é€å’Œå¤„ç†è¿‡ç¨‹Handleré‡Œæä¾›äº†å‡ ä¸ªæ¶ˆæ¯å…¥é˜Ÿçš„æ–¹æ³• post()postAtTime()postDelayed()postAtFrontOfQueue()sendMessageAtTime(Message msg , long uptimeMillis) å…¶ä¸­post()ï¼ŒpostAtTime()ï¼ŒpostDelayed()éƒ½ä¼šç›´æŽ¥æˆ–é—´æŽ¥è°ƒç”¨sendMessageAtTimeæ–¹æ³•ã€‚ ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹sendMessageAtTimeæ–¹æ³• æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œmsg å’ŒuptimeMillis ï¼Œå¦‚æžœæ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æ‰“å°è­¦å‘Šï¼ŒåŒæ—¶è¿”å›žfalseã€‚åä¹‹åˆ™è°ƒç”¨enqueueMessageæ–¹æ³•ã€‚ ä¸‹é¢çœ‹ä¸€ä¸‹enqueueMessage è¿™é‡Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ“ä½œã€‚msg.targetèµ‹å€¼ä¸ºthisï¼Œæœ‰ä¸¤å±‚å«ä¹‰ï¼Œä¸€æ˜¯messageçš„æ¥æºæ˜¯å½“å‰handlerï¼ŒäºŒæ˜¯å½“å‰çš„handleræ¥å¤„ç†æ¶ˆæ¯ã€‚å°†æ¶ˆæ¯åŠ å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæ—¢ç„¶æ˜¯é˜Ÿåˆ—å°±æœ‰é¡ºåºï¼Œé‚£ä¹ˆæ ¹æ®ä»€ä¹ˆæ¥åˆ¤æ–­é¡ºåºå‘¢ï¼Ÿå°±æ˜¯æ ¹æ®uptimeMillis,è¿™ä¸ªæ—¶é—´ï¼Œæ—¶é—´çŸ­å°±åœ¨å‰é¢ï¼Œé•¿å°±åœ¨åŽé¢ã€‚ ç»†å¿ƒçš„ä½ å¯èƒ½å‘çŽ°åˆšåˆšæˆ‘æåˆ°post()ï¼ŒpostAtTime()ï¼ŒpostDelayed()éƒ½ä¼šç›´æŽ¥æˆ–é—´æŽ¥è°ƒç”¨sendMessageAtTimeæ–¹æ³•ï¼Œé‚£postAtFrontOfQueue()å‘¢ï¼Ÿä»Žå­—é¢ä¸Šçœ‹è¯¥æ–¹æ³•æ˜¯å°†æ¶ˆæ¯ç½®äºŽæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€å‰è¾¹ã€‚æ˜¯ä¸æ˜¯è¿™æ ·å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹æºç ã€‚ è¿™é‡Œå°†å…¥é˜Ÿçš„æ—¶é—´å‚æ•°ç›´æŽ¥å†™æ­»ä¸º0ï¼Œé‚£ä¹ˆè‚¯å®šå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æœ€å‰è¾¹å•¦ã€‚ æˆ‘ä»¬å†æ¥åˆ†æžä¸‹å…¥é˜Ÿä¹‹åŽçš„è¿‡ç¨‹ï¼Œä¸Šæ–‡æåˆ°è°ƒç”¨Looper.prepare()æ–¹æ³•åŽåº”è°ƒç”¨Looper.loop()æ–¹æ³•å¼€å§‹æ¶ˆæ¯çš„è½®è¯¢ã€‚é‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹loopæ–¹æ³•åšäº†äº›ä»€ä¹ˆã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public static void loop() &#123; final Looper me = myLooper(); if (me == null) &#123; throw new RuntimeException("No Looper; Looper.prepare() wasn't called on this thread."); &#125; final MessageQueue queue = me.mQueue; // Make sure the identity of this thread is that of the local process, // and keep track of what that identity token actually is. Binder.clearCallingIdentity(); final long ident = Binder.clearCallingIdentity(); for (;;) &#123; Message msg = queue.next(); // might block if (msg == null) &#123; // No message indicates that the message queue is quitting. return; &#125; // This must be in a local variable, in case a UI event sets the logger final Printer logging = me.mLogging; if (logging != null) &#123; logging.println("&gt;&gt;&gt;&gt;&gt; Dispatching to " + msg.target + " " + msg.callback + ": " + msg.what); &#125; final long traceTag = me.mTraceTag; if (traceTag != 0 &amp;&amp; Trace.isTagEnabled(traceTag)) &#123; Trace.traceBegin(traceTag, msg.target.getTraceName(msg)); &#125; try &#123; msg.target.dispatchMessage(msg); &#125; finally &#123; if (traceTag != 0) &#123; Trace.traceEnd(traceTag); &#125; &#125; if (logging != null) &#123; logging.println("&lt;&lt;&lt;&lt;&lt; Finished to " + msg.target + " " + msg.callback); &#125; // Make sure that during the course of dispatching the // identity of the thread wasn't corrupted. final long newIdent = Binder.clearCallingIdentity(); if (ident != newIdent) &#123; Log.wtf(TAG, "Thread identity changed from 0x" + Long.toHexString(ident) + " to 0x" + Long.toHexString(newIdent) + " while dispatching to " + msg.target.getClass().getName() + " " + msg.callback + " what=" + msg.what); &#125; msg.recycleUnchecked(); &#125;&#125; é¦–å…ˆä»ŽThreadLocalä¸­å–å‡ºlooperå¹¶åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œä¹‹åŽå°†looperä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—èµ‹å€¼ï¼Œå†ç„¶åŽè¿›å…¥ä¸€ä¸ªæ­»å¾ªçŽ¯ï¼Œå¾ªçŽ¯å†…åŽ»ä¸æ–­å¯»æ‰¾æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‹ä¸€é¡¹ï¼Œæ²¡æœ‰æ¶ˆæ¯å‘ç”Ÿé˜»å¡žã€‚ æ‰¾åˆ° msg.target.dispatchMessage(msg);è¿™ä¸€è¡Œï¼Œä¹‹å‰æˆ‘ä»¬æåˆ°targetå°±æ˜¯handlerå¯¹è±¡ï¼Œè¿™é‡ŒhandleræŠŠæ¶ˆæ¯æ´¾å‘å‡ºåŽ»ï¼ŒæŽ¥ä¸‹æ¥å°±è¿›å…¥æ¶ˆæ¯çš„å¤„ç†äº†ã€‚ è¿›å…¥åˆ°msg.target.dispatchMessageæ–¹æ³•ï¼Œè¿™é‡Œåˆ†ä¸‰æ­¥1.åˆ¤æ–­msgçš„å›žè°ƒæ˜¯å¦ä¸ºç©º å¦‚æžœä¸ä¸ºç©ºåˆ™ç›´æŽ¥è¯¥å›žè°ƒè‡ªå·±å¤„ç†ï¼Œåä¹‹åˆ¤æ–­è‡ªå·±çš„å›žè°ƒ æŠŠRunnable å°è£…æˆmsgçš„callback 2.åˆ¤æ–­è‡ªå·±çš„å›žè°ƒæ˜¯å¦ä¸ºç©º3.è°ƒç”¨handleMessageæ–¹æ³• è¿™é‡Œç”±å­ç±»é‡å†™æ¥å¤„ç†message 4. Handleræœºåˆ¶çš„æ€»ç»“ Thread è´Ÿè´£ä¸šåŠ¡é€»è¾‘Handler è´Ÿè´£å‘é€æ¶ˆæ¯å’Œå¤„ç†æ¶ˆæ¯MessageQueue è´Ÿè´£ä¿å­˜æ¶ˆæ¯Looper è´Ÿè´£è½®è¯¢æ¶ˆæ¯é˜Ÿåˆ—]]></content>
      <categories>
        <category>app</category>
      </categories>
      <tags>
        <tag>handler</tag>
        <tag>å¼‚æ­¥</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2.2ä»Žæ•™åŠ¡ç³»ç»ŸæŸ¥è¯¢æˆç»©å¹¶è®¡ç®—ç»©ç‚¹â€”â€”å±±ä¸œå»ºç­‘å¤§å­¦ä¸ºä¾‹]]></title>
    <url>%2F2017%2F06%2F18%2F2-2-grade%2F</url>
    <content type="text"><![CDATA[å‰ä¸¤å¤©é¢è¯•æ—¶è¢«é—®åˆ°ç»©ç‚¹æ˜¯å¤šå°‘ï¼Œä½†å­¦æ ¡æ•™åŠ¡ç³»ç»Ÿä¸æä¾›ç»©ç‚¹æŸ¥è¯¢çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½å†™ä¸€ä¸ªçˆ¬è™«ç¨‹åºå¹¶è®¡ç®—å‡ºç»©ç‚¹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼ æ„Ÿè°¢è¯¥åšå®¢æä¾›çš„æ€è·¯ 1. å‡†å¤‡HttpFoxæ’ä»¶ï¼Œæ˜¯ä¸€æ¬¾httpåè®®åˆ†æžæ’ä»¶ï¼Œåˆ†æžé¡µé¢è¯·æ±‚å’Œå“åº”çš„æ—¶é—´ã€å†…å®¹ã€ä»¥åŠæµè§ˆå™¨ç”¨åˆ°çš„COOKIEç­‰ã€‚æ˜¯ç«ç‹æµè§ˆå™¨çš„æ’ä»¶ã€‚è°·æ­Œæµè§ˆå™¨å’ŒSafariéƒ½æœ‰è‡ªå¸¦çš„åˆ†æžå·¥å…·ï¼Œå¯æ˜¯æ„Ÿè§‰å¤ªå¤æ‚ï¼Œæ²¡æœ‰è¿™æ¬¾å¥½ç”¨ã€‚ä¸è¿‡ç«ç‹æµè§ˆå™¨å¯¹å­¦æ ¡çš„æ•™åŠ¡ç³»ç»Ÿå…¼å®¹æ€§ä¸æ˜¯å¾ˆå¥½ï¼Œæˆ‘è¿˜ä¸‹è½½äº†IE tabæ’ä»¶ã€‚ å¯ä»¥éžå¸¸ç›´è§‚çš„æŸ¥çœ‹ç›¸åº”çš„ä¿¡æ¯ã€‚ç‚¹å‡»startæ˜¯å¼€å§‹æ£€æµ‹ï¼Œç‚¹å‡»stopæš‚åœæ£€æµ‹ï¼Œç‚¹å‡»clearæ¸…é™¤å†…å®¹ã€‚ 2. æŽ¢ç©¶è¿‡ç¨‹ä¸‹é¢å°±åŽ»å±±ä¸œå»ºç­‘å¤§å­¦å®˜ç½‘ç™»å½•åˆ°æ•°å­—æ ¡å›­ç»¼åˆä¿¡æ¯é—¨æˆ·ï¼Œçœ‹ä¸€çœ‹åœ¨ç™»å½•çš„æ—¶å€™ï¼Œåˆ°åº•å‘é€äº†é‚£äº›ä¿¡æ¯ã€‚å…ˆæ¥åˆ°ç™»å½•é¡µé¢ï¼ŒæŠŠhttpfoxæ‰“å¼€ï¼Œclearä¹‹åŽï¼Œç‚¹å‡»startå¼€å¯æ£€æµ‹ï¼š è¾“å…¥å®Œè´¦å·å¯†ç ï¼Œç¡®ä¿httpfoxå¤„äºŽå¼€å¯çŠ¶æ€ï¼Œç„¶åŽç‚¹å‡»ç™»å½•ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹åˆ°ï¼Œhttpfoxæ£€æµ‹åˆ°äº†å¥½å¤šä¿¡æ¯ï¼š é‚£ä¹ˆæˆ‘ä»¬æ¥åˆ†æžä¸€ä¸‹è¿™äº›æ•°æ® çœ‹èµ·æ¥çº¢æ¡†é‡Œçš„ä¸¤æ¡æ•°æ®æ¯”è¾ƒæœ‰æ„æ€ï¼Œå…ˆçœ‹çœ‹è¿™ä¸ªpost PostDataä¸­æˆ‘ä»¬çœ‹åˆ°äº†æ¯”è¾ƒç†Ÿæ‚‰çš„è¯ï¼Œusernameå’Œpasswordï¼Œå­¦è¿‡java webçš„æˆ‘ä»¬å¾ˆæ¸…æ¥šè¿™æ®µæ•°æ®çš„å«ä¹‰ï¼Œç‚¹å‡»ç™»å½•åŽå°†è¿™ç”¨æˆ·åå’Œä½ ä»¬æäº¤åˆ°æœåŠ¡å™¨æ¯”å¯¹ã€‚ å¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨getçš„æ–¹å¼åœ¨é“¾æŽ¥ä¸Šä»¥?çš„æ–¹å¼æ˜¾ç¤ºçš„åŠ ä¸Šäº†å‚æ•°ï¼Œè·³è½¬åˆ°ä¿¡æ¯é—¨æˆ·ã€‚æˆ‘ä»¬çš„postçš„æ•°æ®å°±å‘é€åˆ°äº†è¿™ä¸ªåœ°å€ 1http://urpe.sdjzu.edu.cn/loginPortalUrlForIndexLogin.portal éœ€è¦çš„postæ•°æ®æ˜¯ç”¨æˆ·åå¯†ç ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦è¾“å…¥è¿™ä¸¤ç§æ•°æ®æ¥æ¨¡æ‹Ÿç™»å½•è¿‡ç¨‹ã€‚ è¿›å…¥æ•™åŠ¡ç³»ç»ŸåŽç‚¹å‡»æˆç»©æŸ¥è¯¢ï¼Œæˆ‘ä»¬çœ‹åˆ°è¯·æ±‚çš„åœ°å€ä¸º 1http://jwfw1.sdjzu.edu.cn/ssfw/jwnavmenu.do?menuItemWid=1E057E24ABAB4CAFE0540010E0235690 æˆ‘ä»¬æ•´ç†ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹çš„æ€è·¯ã€‚ POSTå­¦å·å’Œå¯†ç â€”&gt;ç„¶åŽè¿”å›žcookieçš„å€¼ å‘é€cookieç»™æœåŠ¡å™¨â€”&gt;è¿”å›žé¡µé¢ä¿¡æ¯ã€‚ èŽ·å–åˆ°æˆç»©é¡µé¢çš„æ•°æ®ï¼Œç”¨æ­£åˆ™è¡¨è¾¾å¼å°†æˆç»©å’Œå­¦åˆ†å•ç‹¬å–å‡ºå¹¶è®¡ç®—åŠ æƒå¹³å‡æ•°ã€‚ okï¼Œç†é¡ºæ€è·¯åŽå‰©ä¸‹çš„å°±åªæœ‰ç¼–ç é—®é¢˜äº†ã€‚ 3. å®žéªŒæˆ‘ä»¬å…ˆæ¥å®žéªŒä¸‹æ˜¯å¦èƒ½å¤ŸèŽ·å¾—æŸ¥è¯¢æˆç»©ç•Œé¢çš„æºç  æˆ‘ä»¬å…ˆå‡†å¤‡ä¸€ä¸ªPOSTçš„æ•°æ®ï¼Œå†å‡†å¤‡ä¸€ä¸ªcookieçš„æŽ¥æ”¶ï¼Œç„¶åŽå†™å‡ºæºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728# coding=utf-8import urllibimport urllib2import cookielibcookie = cookielib.CookieJar()opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookie))# éœ€è¦çš„POSTæ•°æ®postdata = urllib.urlencode(&#123; &apos;userName&apos;: &apos;20140216064&apos;, &apos;password&apos;: &apos;*********&apos;&#125;)# è‡ªå®šä¹‰ä¸€ä¸ªè¯·æ±‚req1 = urllib2.Request( url=&apos;http://urpe.sdjzu.edu.cn/loginPortalUrlForIndexLogin.portal&apos;, data=postdata)req2 = urllib2.Request( url=&apos;http://jwfw1.sdjzu.edu.cn/ssfw/jwnavmenu.do?menuItemWid=1E057E24ABAB4CAFE0540010E0235690&apos;)# è®¿é—®ç™»å½•é“¾æŽ¥opener.open(req1)result = opener.open(req2)# æ‰“å°è¿”å›žçš„å†…å®¹print result.read() å¾ˆæ£’å‘¦ï¼Œçœ‹æ¥è·Ÿæˆ‘ä»¬é¢„æœŸçš„ä¸€æ ·ã€‚ 4. æ•´ç†æ•°æ® èŽ·å¾—äº†æˆç»©æŸ¥è¯¢ç•Œé¢çš„æºç åŽæˆ‘ä»¬éœ€è¦å°†æ•°æ®è¿›è¡Œæ•´ç†ï¼ŒèŽ·å¾—æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œè¯¾ç¨‹åç§°ï¼Œå­¦åˆ†ï¼Œæˆç»©ã€‚ å°†ç½‘é¡µæºç è´´åˆ°Sublime Textä¸­ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹æºç  é€šè¿‡æŸ¥çœ‹æºç æˆ‘ä»¬çœ‹åˆ°ä»Žè¿™ä¸ªå¼€å§‹åˆ°3640è¡Œéƒ½æ˜¯å…³äºŽæˆç»©çš„ä»£ç ï¼Œè€Œæˆç»©æ˜¯å­˜æ”¾åœ¨è¿™ä¸ªtableæ ‡ç­¾ä¸‹ã€‚çº¢è‰²æ¡†ä¸­åˆ†åˆ«ä¸ºè¯¾ç¨‹åï¼Œå­¦åˆ†ï¼Œä»¥åŠæˆç»©ã€‚è¿™äº›æ˜¯æˆ‘ä»¬éœ€è¦æŠ½å–å‡ºæ¥çš„æ•°æ®ã€‚çœ‹åˆ°è¿™é‡Œç«Ÿç„¶æœ‰æ„å¤–æ”¶èŽ·ï¼æ³¨æ„é»„è‰²æ¡†è¢«æ³¨é‡Šçš„éƒ¨åˆ†ï¼Œçœ‹æ¥å­¦æ ¡çš„æ•™åŠ¡ç³»ç»Ÿæœ‰è®¡ç®—ç»©ç‚¹çš„åŠŸèƒ½çš„ï¼Œä¸çŸ¥ç”±äºŽä½•ç§åŽŸå› ä¸ç”¨å‘¢ï¼Ÿ è¿™é‡Œæ˜¯è¿™æ®µç¨‹åºä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ï¼Œæˆ‘ä¹Ÿè¸©äº†å¾ˆå¤šå‘ã€‚æˆ‘å‚ç…§çš„åšå®¢æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æŠ½å–æƒ³è¦çš„ä¿¡æ¯çš„ï¼Œä½†æˆ‘å¯¹æ­£åˆ™è¡¨è¾¾å¼æŽŒæ¡çš„å¹¶ä¸å¥½ï¼Œå¼„äº†å¥½ä¹…ä¹Ÿæ²¡å†™å‡ºåˆé€‚çš„è¡¨è¾¾å¼ï¼ŒäºŽæ˜¯æˆ‘æžœæ–­æ”¾å¼ƒäº†ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‡‡ç”¨BeautifulSoupæ¥è¿›è¡Œä¿¡æ¯çš„ç­›é€‰ã€‚BeautifulSoupç”¨æ³•å‚è€ƒ 12345678910111213141516171819202122# å°†å†…å®¹ä»Žé¡µé¢æºç ä¸­æå–å‡ºæ¥ def deal_data(self, myPage): soup = BeautifulSoup(myPage) # ä»Žtitleå±žæ€§ä¸ºæœ‰æ•ˆæˆç»©çš„æ ‡ç­¾ä¸­èŽ·å–æ‰€æœ‰classå±žæ€§ä¸ºt_conçš„TAG(træ ‡ç­¾) trs = soup.find(attrs=&#123;&quot;title&quot;: &quot;æœ‰æ•ˆæˆç»©&quot;&#125;).findAll(attrs=&#123;&quot;class&quot;: &quot;t_con&quot;&#125;) # ä»Žtræ ‡ç­¾ä¸­çš„tdæ ‡ç­¾ä¸­èŽ·å–éœ€è¦çš„ä¿¡æ¯ã€‚ä¸‹æ ‡ä¸º3ï¼Œ7ï¼Œ8çš„åˆ†åˆ«ä¸ºè¯¾ç¨‹åï¼Œå­¦åˆ†ï¼Œæˆç»© for tr in trs: for index, td in enumerate(tr.findAll(&apos;td&apos;)): # enumerateèƒ½åœ¨forå¾ªçŽ¯ä¸­ä½¿ç”¨ä¸‹æ ‡ if index == 3: print td.text elif index == 7: self.weights.append(td.text.encode(&apos;utf8&apos;)) print td.text elif index == 8: self.points.append(td.text.encode(&apos;utf8&apos;)) print td.text print æ•´ä¸ªé€»è¾‘æˆ‘ç®€å•è¯´ä¸€ä¸‹ï¼Œæˆ‘è§‰å¾—è¿˜å¯ä»¥æ”¹è¿›ã€‚é¦–å…ˆæŸ¥æ‰¾titleå±žæ€§ä¸ºâ€æœ‰æ•ˆæˆç»©â€œçš„æ ‡ç­¾ï¼Œé€šè¿‡ä¸Šæ–‡çš„æˆªå›¾æˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™æ˜¯é‚£ä¸ªdivæ ‡ç­¾ï¼Œä¹‹åŽåœ¨è¯¥divæ ‡ç­¾ä¸­å®šä½classä¸ºt_conçš„træ ‡ç­¾ã€‚ä½ ä¹Ÿè®¸ä¼šé—®ä¸ºä»€ä¹ˆä¸ç›´æŽ¥å®šä½åˆ°træ ‡ç­¾ï¼Œå› ä¸ºåŽé¢çš„ç½‘é¡µä»£ç ä¸­è¿˜å­˜åœ¨class ä¸ºt_conçš„træ ‡ç­¾ï¼Œä½†ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„æˆç»©ã€‚ç„¶åŽåœ¨æ¯ä¸ªtræ ‡ç­¾ä¸‹æŠ½å–ä¸‹æ ‡ä¸º3ï¼Œ7ï¼Œ8çš„æ ‡ç­¾ï¼Œè¿™é‡Œæˆ‘æ˜¯æŠŠå®ƒå­˜åˆ°æ•°ç»„é‡Œäº†ã€‚æŽ¥ä¸‹æ¥å°±æ¸…æ™°äº†ï¼Œå…ˆæ‰“å°æˆç»©ä¿¡æ¯ï¼Œç„¶åŽè®¡ç®—ç»©ç‚¹ã€‚ å­¦æ¸£ä¸€ä¸ªï¼Œç»©ç‚¹ä½Žè¯·å¿½ç•¥ã€‚ æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475# encoding=utf8import urllibimport urllib2import cookielibimport reimport stringfrom BeautifulSoup import BeautifulSoupimport sysreload(sys)sys.setdefaultencoding(&apos;utf8&apos;)class SDJZU_Crawler: # å£°æ˜Žç›¸å…³çš„å±žæ€§ def __init__(self): self.loginUrl = &apos;http://urpe.sdjzu.edu.cn/loginPortalUrlForIndexLogin.portal&apos; # ç™»å½•çš„url self.resultUrl = &apos;http://jwfw1.sdjzu.edu.cn/ssfw/jwnavmenu.do?menuItemWid=1E057E24ABAB4CAFE0540010E0235690&apos; # æŸ¥è¯¢æˆç»©çš„url self.cookieJar = cookielib.CookieJar() # åˆå§‹åŒ–ä¸€ä¸ªCookieJaræ¥å¤„ç†Cookieçš„ä¿¡æ¯ self.postdata = urllib.urlencode(&#123;&apos;userName&apos;: &apos;&apos;, &apos;password&apos;: &apos;&apos;&#125;) # ç™»å½•éœ€è¦POSTçš„æ•°æ® self.weights = [] # å­˜å‚¨æƒé‡ï¼Œä¹Ÿå°±æ˜¯å­¦åˆ† self.points = [] # å­˜å‚¨åˆ†æ•°ï¼Œä¹Ÿå°±æ˜¯æˆç»© self.opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(self.cookieJar)) def sdjzu_init(self): username = raw_input(&apos;è¯·è¾“å…¥å­¦å·:&apos;) # è¿™é‡Œä¸è¦ç”¨inputï¼ŒäºŒè€…åŒºåˆ«è¯·è‡ªè¡ŒæŸ¥è¯¢ password = raw_input(&apos;è¯·è¾“å…¥å¯†ç :&apos;) self.postdata = urllib.urlencode(&#123;&apos;userName&apos;: username, &apos;password&apos;: password&#125;) # å°†ç”¨æˆ·åå¯†ç åŠ å…¥åˆ°POSTä¸­ # åˆå§‹åŒ–é“¾æŽ¥å¹¶ä¸”èŽ·å–cookie myRequest = urllib2.Request(url=self.loginUrl, data=self.postdata) # è‡ªå®šä¹‰ä¸€ä¸ªè¯·æ±‚ result = self.opener.open(myRequest) # è®¿é—®ç™»å½•é¡µé¢ï¼ŒèŽ·å–åˆ°å¿…é¡»çš„cookieçš„å€¼ result = self.opener.open(self.resultUrl) # è®¿é—®æˆç»©é¡µé¢ï¼ŒèŽ·å¾—æˆç»©çš„æ•°æ® self.deal_data(result.read()) self.calculate_gpa() # å°†å†…å®¹ä»Žé¡µé¢æºç ä¸­æå–å‡ºæ¥ def deal_data(self, myPage): soup = BeautifulSoup(myPage) # ä»Žtitleå±žæ€§ä¸ºæœ‰æ•ˆæˆç»©çš„æ ‡ç­¾ä¸­èŽ·å–æ‰€æœ‰classå±žæ€§ä¸ºt_conçš„TAG(træ ‡ç­¾) trs = soup.find(attrs=&#123;&quot;title&quot;: &quot;æœ‰æ•ˆæˆç»©&quot;&#125;).findAll(attrs=&#123;&quot;class&quot;: &quot;t_con&quot;&#125;) # ä»Žtræ ‡ç­¾ä¸­çš„tdæ ‡ç­¾ä¸­èŽ·å–éœ€è¦çš„ä¿¡æ¯ã€‚ä¸‹æ ‡ä¸º3ï¼Œ7ï¼Œ8çš„åˆ†åˆ«ä¸ºè¯¾ç¨‹åï¼Œå­¦åˆ†ï¼Œæˆç»© for tr in trs: for index, td in enumerate(tr.findAll(&apos;td&apos;)): # enumerateèƒ½åœ¨forå¾ªçŽ¯ä¸­ä½¿ç”¨ä¸‹æ ‡ if index == 3: print td.text elif index == 7: self.weights.append(td.text.encode(&apos;utf8&apos;)) print td.text elif index == 8: self.points.append(td.text.encode(&apos;utf8&apos;)) print td.text print # è®¡ç®—ç»©ç‚¹ï¼Œå¦‚æžœæˆç»©è¿˜æ²¡å‡ºæ¥ï¼Œå°±ä¸ç®—è¯¥æˆç»©ï¼Œ def calculate_gpa(self): point = 0.0 # æˆç»© weight = 0.0 # å­¦åˆ† for i in range(len(self.points)): if self.points[i].isdigit() and (self.weights[i] != 0): point += string.atof(self.points[i]) * string.atof(self.weights[i]) # æˆç»©*å­¦åˆ†ç´¯åŠ æ±‚å’Œ weight += string.atof(self.weights[i]) # å­¦åˆ†ç´¯åŠ æ±‚å’Œ print &quot;ç»©ç‚¹ä¸ºï¼š&quot; print point / weight # è¾“å‡ºç»©ç‚¹ å€¼æˆç»©*å­¦åˆ†ç´¯åŠ æ±‚å’Œ / å­¦åˆ†ç´¯åŠ æ±‚å’Œ# è°ƒç”¨mySpider = SDJZU_Crawler()mySpider.sdjzu_init() æˆ‘çš„githubåœ°å€]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>çˆ¬è™«</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2.1å¼€å§‹ç¬¬ä¸€ä¸ªçˆ¬è™«ç¨‹åº]]></title>
    <url>%2F2017%2F06%2F18%2F2-1-first-program%2F</url>
    <content type="text"><![CDATA[1. å®‰è£…IDEä»¥åŠhello world ä¸€ä¸ªä¼˜ç§€çš„IDEå¯ä»¥æžå¤§åœ°æé«˜å·¥ä½œæ•ˆçŽ‡ï¼Œåœ¨è¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨JetBrainså…¬å¸çš„PyCharmã€‚æ˜¯ä¸æ˜¯æœ‰äº›çœ¼ç†Ÿï¼Ÿæ²¡é”™ï¼ŒIDEA å’ŒAndroid Studioå°±æ˜¯ä»–ä»¬åšçš„ï¼ŒJetBrainså‡ºå“ï¼Œå¿…å±žç²¾å“ã€‚ ç‚¹å‡»è¿›å…¥ä¸‹è½½é“¾æŽ¥ ç‚¹å‡»downloadé€‰æ‹©ç›¸åº”å¹³å°åŠç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯ç¤¾åŒºç‰ˆã€‚ å®‰è£…è¿‡ç¨‹ï¼Œåˆ‡æ¢ä¸»é¢˜ï¼Œè°ƒæ•´å­—ä½“ä¹‹ç±»çš„éƒ½è·Ÿè·ŸIDEAç±»ä¼¼ï¼Œä¸éœ€èµ˜è¿°ã€‚ é‚£ä¹ˆå¼€å§‹æˆ‘ä»¬çš„hello worldç¨‹åºå§ã€‚æ–°å»ºä¸€ä¸ªPython file ï¼Œç„¶åŽå†™å…¥ 1print (&quot;hello world&quot;) ç¬¬ä¸€æ¬¡è¿è¡Œåœ¨å·¥ä½œåŒºå³å‡» runå³å¯ ä¹‹åŽå°±ä¼šåœ¨Toolbarä¸Šæ˜¾ç¤ºrunæŒ‰é’®äº† å¾ˆæ£’æœ‰æœ¨æœ‰ 2.1 å…ˆçˆ¬ä»–ä¸€ä¸ªç½‘é¡µä¸‹æ¥æ•²å…¥å¦‚ä¸‹ä»£ç  1234import urllib2response = urllib2.urlopen(&quot;http://www.baidu.com&quot;)print response.read() ç‚¹å‡»è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç»“æžœ è¿™ä¸ªç½‘é¡µçš„æºç è¢«æˆ‘ä»¬çˆ¬ä¸‹æ¥äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼ 2.2 åˆ†æžä»£ç ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æžä¸‹è¿™æ®µä»£ç  1import urllib2 urllib2åº“æ˜¯å­¦ä¹ Pythonçˆ¬è™«æœ€åŸºæœ¬çš„æ¨¡å—ï¼Œåˆ©ç”¨è¿™ä¸ªæ¨¡å—æˆ‘ä»¬å¯ä»¥å¾—åˆ°ç½‘é¡µçš„å†…å®¹ï¼Œå¹¶å¯¹å†…å®¹ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–åˆ†æžï¼Œå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æžœ 1response = urllib2.urlopen(&quot;http://www.baidu.com&quot;) é¦–å…ˆæˆ‘ä»¬è°ƒç”¨çš„æ˜¯urllib2åº“é‡Œé¢çš„urlopenæ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªURLï¼Œè¿™ä¸ªç½‘å€æ˜¯ç™¾åº¦é¦–é¡µï¼Œåè®®æ˜¯HTTPåè®®ï¼Œurlopenä¸€èˆ¬æŽ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œå®ƒçš„å‚æ•°å¦‚ä¸‹ï¼š ç¬¬ä¸€ä¸ªå‚æ•°urlå³ä¸ºURLï¼Œç¬¬äºŒä¸ªå‚æ•°dataæ˜¯è®¿é—®URLæ—¶è¦ä¼ é€çš„æ•°æ®ï¼Œç¬¬ä¸‰ä¸ªtimeoutæ˜¯è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚ ç¬¬äºŒä¸‰ä¸ªå‚æ•°æ˜¯å¯ä»¥ä¸ä¼ é€çš„ï¼Œdataé»˜è®¤ä¸ºç©ºNoneï¼Œtimeouté»˜è®¤ä¸º socket._GLOBAL_DEFAULT_TIMEOUT ç¬¬ä¸€ä¸ªå‚æ•°URLæ˜¯å¿…é¡»è¦ä¼ é€çš„ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œé¢æˆ‘ä»¬ä¼ é€äº†ç™¾åº¦çš„URLï¼Œæ‰§è¡Œurlopenæ–¹æ³•ä¹‹åŽï¼Œè¿”å›žä¸€ä¸ªresponseå¯¹è±¡ï¼Œè¿”å›žä¿¡æ¯ä¾¿ä¿å­˜åœ¨è¿™é‡Œé¢ã€‚ 1print response.read() responseå¯¹è±¡æœ‰ä¸€ä¸ªreadæ–¹æ³•ï¼Œå¯ä»¥è¿”å›žèŽ·å–åˆ°çš„ç½‘é¡µå†…å®¹ 2.3 æž„é€ Requestä¸Šé¢çš„urlopenå‚æ•°å¯ä»¥ä¼ å…¥ä¸€ä¸ªrequestè¯·æ±‚,å®ƒå…¶å®žå°±æ˜¯ä¸€ä¸ªRequestç±»çš„å®žä¾‹ï¼Œæž„é€ æ—¶éœ€è¦ä¼ å…¥Url,Dataç­‰ç­‰çš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„ä»£ç æ”¹å†™ä¸º 12345import urllib2request = urllib2.Request(&quot;http://www.baidu.com&quot;)response = urllib2.urlopen(request)print response.read() è¿è¡Œç»“æžœæ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåªä¸è¿‡ä¸­é—´å¤šäº†ä¸€ä¸ªrequestå¯¹è±¡ï¼ŒæŽ¨èå¤§å®¶è¿™ä¹ˆå†™ï¼Œå› ä¸ºåœ¨æž„å»ºè¯·æ±‚æ—¶è¿˜éœ€è¦åŠ å…¥å¥½å¤šå†…å®¹ï¼Œé€šè¿‡æž„å»ºä¸€ä¸ªrequestï¼ŒæœåŠ¡å™¨å“åº”è¯·æ±‚å¾—åˆ°åº”ç­”ï¼Œè¿™æ ·æ˜¾å¾—é€»è¾‘ä¸Šæ¸…æ™°æ˜Žç¡®ã€‚]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>çˆ¬è™«</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[1.1ä½¿ç”¨å‡½æ•°]]></title>
    <url>%2F2017%2F06%2F05%2F1-1-use-function%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬ç¼–ç¨‹æ—¶å¾ˆå®¹æ˜“ç–²åŠ³ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸ªå¯ä»¥åœ¨ä¸€æ®µæ—¶é—´åŽæé†’ä½ ä¼‘æ¯çš„å°ç¨‹åºã€‚æ¯”å¦‚æ¯éš”ä¸¤ä¸ªå°æ—¶æ‰“å¼€http://lines.frvr.com æ­¤ç½‘ç«™æ¥çŽ©ä¸€ä¼šå„¿å°æ¸¸æˆã€‚ è®©æˆ‘ä»¬æ¥åˆ†æžä¸‹éœ€è¦å“ªäº›æ­¥éª¤æˆ‘ä»¬é¦–å…ˆè¦è®©ç¨‹åºç­‰å¾…ä¸¤ä¸ªå°æ—¶ï¼Œåœ¨éœ€è¦ä¼‘æ¯çš„æ—¶å€™æ‰“å¼€æµè§ˆå™¨å¹¶è½¬åˆ°è¿™ä¸ªå°æ¸¸æˆçš„ç½‘ç«™ã€‚ä¹Ÿè®¸æˆ‘ä»¬ä¸€å¤©è¦ä¼‘æ¯å¤šæ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¾ªçŽ¯æ¥è®©å…¶å®žçŽ°å¤šæ¬¡ã€‚ 1231. ç­‰å¾…ä¸¤å°æ—¶2. æ‰“å¼€æµè§ˆå™¨é‡å¤ çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§~ é¦–å…ˆè®©æˆ‘ä»¬googleä¸€ä¸‹å¦‚ä½•ç”¨Pythonæ¥æ‰“å¼€æµè§ˆå™¨ 1webbrowser.open(&quot;http://lines.frvr.com&quot;) å¯ä»¥çœ‹åˆ°ä¸Šè¿°ä»£ç å¯ä»¥ä½¿ç”¨é»˜è®¤æµè§ˆå™¨æ‰“å¼€æŒ‡å®šç½‘é¡µã€‚ è®©æˆ‘ä»¬è¯•è¯•å§~ä¿å­˜å¹¶æ‰§è¡Œ å‡ºçŽ°äº†é”™è¯¯ï¼Œä¸è¿‡å­¦è¿‡javaçš„ä½ è‚¯å®šèƒ½çœ‹æ‡‚æ˜¯ä»€ä¹ˆåŽŸå› ã€‚ å¯¼å…¥webbrowseræ¨¡å—å°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œä¸è¦è¢«è¿™ä¸ªç½‘ç«™çš„å°æ¸¸æˆå¸å¼•èµ°å“¦ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ç»“æŸã€‚ ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹Pythonå¦‚ä½•èƒ½è®©ç¨‹åºç­‰å¾…2å°æ—¶ï¼Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬æŠŠç­‰å¾…æ—¶é—´è®¾ç½®ä¸º3ç§’ å¯ä»¥çœ‹åˆ°ä½¿ç”¨time.sleep()æ–¹æ³•å¯ä»¥æ˜¯ç¨‹åºç­‰å¾…ä¸€æ®µæ—¶é—´æ‰§è¡Œï¼Œå‚æ•°ä»¥ç§’ä¸ºå•ä½æ‰€ä»¥æˆ‘ä»¬åœ¨ç¨‹åºä¸­æ·»åŠ ä»¥ä¸‹ä»£ç  1time.sleep(3) å½“ç„¶ä¹Ÿè¦å¯¼å…¥ç›¸åº”æ¨¡å—ã€‚ å¾ˆç®€å•æœ‰æ²¡æœ‰ï¼Ÿ æŽ¥ä¸‹æ¥æˆ‘ä»¬æ¥è®©å…¶å¾ªçŽ¯3æ¬¡ è¾“å…¥ä»¥ä¸‹ä»£ç  12345678910import webbrowserimport timetotal_breaks = 3break_count = 0print(&quot;This program started on&quot; + time.ctime())while(break_count &lt; total_breaks): time.sleep(3) webbrowser.open(&quot;http://lines.frvr.com&quot;) break_count = break_count + 1 ä»£ç å¾ˆç®€å•ï¼Œé¦–å…ˆæˆ‘ä»¬å®šä¹‰äº†æ€»çš„ä¼‘æ¯æ¬¡æ•°ä¸º3ï¼Œæˆ‘ä»¬åˆå®šä¹‰äº†å·²ä¼‘æ¯æ¬¡æ•°åˆå§‹å€¼ä¸º0ã€‚æŽ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªwhileå¾ªçŽ¯ï¼Œå½“å·²ä¼‘æ¯æ¬¡æ•°å°äºŽæ€»ä¼‘æ¯æ¬¡æ•°æ—¶æ‰§è¡Œå¾ªçŽ¯ä½“ã€‚æœ€åŽå°†å·²ä¼‘æ¯æ¬¡æ•°åŠ 1ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯whileå¾ªçŽ¯å¹¶æ²¡æœ‰èŠ±æ‹¬å·ã€‚ å­¦ä¹  Python ä¸Žå…¶ä»–è¯­è¨€æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼ŒPython çš„ä»£ç å—ä¸ä½¿ç”¨å¤§æ‹¬å· {} æ¥æŽ§åˆ¶ç±»ï¼Œå‡½æ•°ä»¥åŠå…¶ä»–é€»è¾‘åˆ¤æ–­ã€‚python æœ€å…·ç‰¹è‰²çš„å°±æ˜¯ç”¨ç¼©è¿›æ¥å†™æ¨¡å—ã€‚ç¼©è¿›çš„ç©ºç™½æ•°é‡æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯æ‰€æœ‰ä»£ç å—è¯­å¥å¿…é¡»åŒ…å«ç›¸åŒçš„ç¼©è¿›ç©ºç™½æ•°é‡ï¼Œè¿™ä¸ªå¿…é¡»ä¸¥æ ¼æ‰§è¡Œã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š 1234if True: print &quot;True&quot;else: print &quot;False&quot; ä»¥ä¸‹ä»£ç å°†ä¼šæ‰§è¡Œé”™è¯¯ï¼š 12345678910#!/usr/bin/python# -*- coding: UTF-8 -*-# æ–‡ä»¶åï¼štest.py if True: print &quot;Answer&quot; print &quot;True&quot;else: print &quot;Answer&quot; # æ²¡æœ‰ä¸¥æ ¼ç¼©è¿›ï¼Œåœ¨æ‰§è¡Œæ—¶ä¼šæŠ¥é”™ print &quot;False&quot; æ‰§è¡Œä»¥ä¸Šä»£ç ï¼Œä¼šå‡ºçŽ°å¦‚ä¸‹é”™è¯¯æé†’ï¼š 12345$ python test.py File &quot;test.py&quot;, line 5 if True: ^IndentationError: unexpected indent IndentationError: unexpected indent é”™è¯¯æ˜¯ python ç¼–è¯‘å™¨æ˜¯åœ¨å‘Šè¯‰ä½ â€Hiï¼Œè€å…„ï¼Œä½ çš„æ–‡ä»¶é‡Œæ ¼å¼ä¸å¯¹äº†ï¼Œå¯èƒ½æ˜¯tabå’Œç©ºæ ¼æ²¡å¯¹é½çš„é—®é¢˜â€ï¼Œæ‰€æœ‰ python å¯¹æ ¼å¼è¦æ±‚éžå¸¸ä¸¥æ ¼ã€‚å¦‚æžœæ˜¯ IndentationError: unindent does not match any outer indentation levelé”™è¯¯è¡¨æ˜Žï¼Œä½ ä½¿ç”¨çš„ç¼©è¿›æ–¹å¼ä¸ä¸€è‡´ï¼Œæœ‰çš„æ˜¯ tab é”®ç¼©è¿›ï¼Œæœ‰çš„æ˜¯ç©ºæ ¼ç¼©è¿›ï¼Œæ”¹ä¸ºä¸€è‡´å³å¯ã€‚å› æ­¤ï¼Œåœ¨ Python çš„ä»£ç å—ä¸­å¿…é¡»ä½¿ç”¨ç›¸åŒæ•°ç›®çš„è¡Œé¦–ç¼©è¿›ç©ºæ ¼æ•°ã€‚å»ºè®®ä½ åœ¨æ¯ä¸ªç¼©è¿›å±‚æ¬¡ä½¿ç”¨ å•ä¸ªåˆ¶è¡¨ç¬¦ æˆ– ä¸¤ä¸ªç©ºæ ¼ æˆ– å››ä¸ªç©ºæ ¼ , åˆ‡è®°ä¸èƒ½æ··ç”¨ã€‚]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>çˆ¬è™«</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[0.ä»Žé›¶å¼€å§‹ï¼ŒPythonçš„å®‰è£…]]></title>
    <url>%2F2017%2F06%2F05%2F0-indtall-python%2F</url>
    <content type="text"><![CDATA[è¿™å­¦æœŸè®¡ç®—æœºç½‘ç»œè¯¾ç¨‹æœ‰ä¸€ä¸ªè¯¾ç¨‹è®¾è®¡ï¼Œè¦æ±‚ä½¿ç”¨Pythonå†™ä¸€ä¸ªå°ç¨‹åºã€‚ä¹‹å‰ä¹Ÿæ²¡æŽ¥è§¦è¿‡Pythonï¼Œä»Žä¼˜è¾¾å­¦åŸŽé‡Œçœ‹åˆ°ä¸€ä¸ªå…³äºŽPythonçš„è¯¾ç¨‹ï¼Œåœ¨æ­¤è®°å½•ã€‚ Windowså®‰è£…ä¸‹è½½åœ°å€ï¼šhttps://www.python.org/downloads/ ç¡®ä¿å®‰è£…äº† pip å¹¶ä¸” Python æ·»åŠ åˆ°äº†ä½ çš„ PATHã€‚ è¦æ£€æŸ¥å®‰è£…æ˜¯å¦æˆåŠŸï¼Œæ‰“å¼€ IDLEï¼ˆPython å®‰è£…çš„ä¸€æ¬¾ç¨‹åºï¼Œä½¿ä½ èƒ½å¤Ÿè½»æ¾åœ°ç¼–è¾‘å’Œè¿è¡Œ Python ä»£ç ï¼‰ã€‚ a) Windows 7ï¼ˆåŠæ›´æ—©ç‰ˆæœ¬ï¼‰ï¼šä¾æ¬¡ç‚¹å‡»â€œå¼€å§‹â€èœå•&gt;â€œæ‰€æœ‰ç¨‹åºâ€&gt;â€œPython 2.7â€ï¼Œæœ€åŽé€‰æ‹© IDLE (Python GUI)ã€‚ b) Windows 8/10ï¼šæœç´¢ IDLEã€‚ç›®å‰ï¼Œä½ å¯ä»¥ä»Žå±å¹•å³ä¾§å‘å·¦æ»‘åŠ¨æˆ–ç”¨é¼ æ ‡ç‚¹å‡»å±å¹•çš„å³ä¸‹è§’è¿›è¡Œæœç´¢ã€‚ MACå®‰è£…è¦åœ¨ Mac æœºå™¨ä¸Šå®‰è£… Pythonï¼Œä½ å¯ä»¥é‡‡ç”¨ä¸¤ç§æ–¹æ³•ï¼šåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ Homebrewï¼Œæˆ–åœ¨å®˜ç½‘ä¸Šæ‰¾åˆ°æ™®é€šçš„ Python å®‰è£…ç¨‹åºã€‚ æ–¹æ³• 1ï¼šç¨‹åºåŒ…å®‰è£…ç¨‹åºå®‰è£…åœ°å€ï¼šhttps://www.python.org/downloads/release/python-2713/æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ a) IDLE åº”è¯¥ä½äºŽæ‚¨çš„åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹ä¸­ã€‚b)é€šè¿‡æŒ‰ä¸‹ âŒ˜+ç©ºæ ¼é”®ï¼Œæ‰“å¼€ Spotlight ï¼Œå¹¶è¾“å…¥â€œidleâ€æ¥æŸ¥æ‰¾ IDLE ä»¥ä¸‹æ˜¯å®ƒåœ¨æˆ‘ä»¬çš„è®¡ç®—æœºä¸Šè¿è¡Œçš„å±å¹•æˆªå›¾ï¼ æ–¹æ³• 2ï¼šHomebrewè¦é€šè¿‡ Homebrew å®‰è£… Pythonï¼Œåªéœ€æ‰§è¡Œä»¥ä¸‹ä¸¤æ­¥ï¼š æ‰“å¼€ç»ˆç«¯ï¼Œå¹¶è¾“å…¥å‘½ä»¤ï¼š 1/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)â€ã€‚ å®‰è£…è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šå¤šæ¬¡å‘å‡ºæç¤º ã€‚å®‰è£…å®Œ Homebrew åŽï¼Œä½ å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ brew helpï¼ŒéªŒè¯ä¸€åˆ‡æ˜¯å¦æ­£å¸¸ã€‚çŽ°åœ¨è¾“å…¥ brew install python èŽ·å– Python 2 çš„æœ€æ–°ç‰ˆæœ¬ã€‚è¿™æ ·å°±å¯ä»¥äº†ï¼ é€šè¿‡åœ¨å‘½ä»¤è¡Œé‡Œè¾“å…¥ python å³å¯éªŒè¯ Python æ˜¯å¦å®‰è£…æ­£ç¡®ã€‚ç³»ç»Ÿåº”è¯¥æ¬¢è¿Žä½ ä½¿ç”¨ Python Shellã€‚]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>çˆ¬è™«</tag>
      </tags>
  </entry>
</search>
